# AZD ржжрж┐рзЯрзЗ ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯрзЗрж░ ржЙржжрж╛рж╣рж░ржг

ржПржЗ ржбрж┐рж░рзЗржХрзНржЯрж░рж┐рждрзЗ Azure Developer CLI (AZD) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ Azure Container Apps-ржП ржХржирзНржЯрзЗржЗржирж╛рж░рж╛ржЗржЬржб ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржбрж┐ржкрзНрж▓рзЯ ржХрж░рж╛рж░ ржЬржирзНржп ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд ржЙржжрж╛рж╣рж░ржг рж░рзЯрзЗржЫрзЗред ржПржЗ ржЙржжрж╛рж╣рж░ржгржЧрзБрж▓рзЛ ржмрж╛рж╕рзНрждржм ржЬрзАржмржирзЗрж░ ржкрзНржпрж╛ржЯрж╛рж░рзНржи, рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи ржПржмржВ ржкрзНрж░рзЛржбрж╛ржХрж╢ржи-рж░рзЗржбрж┐ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржкрзНрж░ржжрж░рзНрж╢ржи ржХрж░рзЗред

## ЁЯУЪ рж╕рзВржЪрж┐ржкрждрзНрж░

- [рж╕ржВржХрзНрж╖рж┐ржкрзНржд ржмрж┐ржмрж░ржг](../../../../examples/container-app)
- [ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝рждрж╛](../../../../examples/container-app)
- [ржжрзНрж░рзБржд рж╢рзБрж░рзБ ржЙржжрж╛рж╣рж░ржг](../../../../examples/container-app)
- [ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржЙржжрж╛рж╣рж░ржг](../../../../examples/container-app)
- [ржЙржирзНржиржд ржкрзНржпрж╛ржЯрж╛рж░рзНржи](../../../../examples/container-app)
- [рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи](../../../../examples/container-app)

## рж╕ржВржХрзНрж╖рж┐ржкрзНржд ржмрж┐ржмрж░ржг

Azure Container Apps ржПржХржЯрж┐ рж╕ржорзНржкрзВрж░рзНржг ржкрж░рж┐ржЪрж╛рж▓рж┐ржд рж╕рж╛рж░рзНржнрж╛рж░рж▓рзЗрж╕ ржХржирзНржЯрзЗржЗржирж╛рж░ ржкрзНрж▓рзНржпрж╛ржЯржлрж░рзНржо ржпрж╛ ржЖржкржирж╛ржХрзЗ ржорж╛ржЗржХрзНрж░рзЛрж╕рж╛рж░рзНржнрж┐рж╕ ржПржмржВ ржХржирзНржЯрзЗржЗржирж╛рж░рж╛ржЗржЬржб ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржЪрж╛рж▓рж╛рждрзЗ рж╕рж╛рж╣рж╛ржпрзНржп ржХрж░рзЗ, ржЕржмржХрж╛ржарж╛ржорзЛ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржЫрж╛ржбрж╝рж╛ржЗред AZD-ржПрж░ рж╕рж╛ржерзЗ ржорж┐рж▓рж┐ржд рж╣рж▓рзЗ ржЖржкржирж┐ ржкрж╛ржмрзЗржи:

- **рж╕рж╣ржЬ ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ**: ржПржХржХ ржХржорж╛ржирзНржбрзЗ ржХржирзНржЯрзЗржЗржирж╛рж░ ржПржмржВ ржЕржмржХрж╛ржарж╛ржорзЛ ржбрж┐ржкрзНрж▓рзЯ
- **рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ рж╕рзНржХрзЗрж▓рж┐ржВ**: HTTP ржЯрзНрж░рж╛ржлрж┐ржХ ржмрж╛ ржЗржнрзЗржирзНржЯрзЗрж░ ржнрж┐рждрзНрждрж┐рждрзЗ рж╢рзВржирзНржп ржерзЗржХрзЗ рж╕рзНржХрзЗрж▓ ржЖржЙржЯ
- **ржЗржирзНржЯрж┐ржЧрзНрж░рзЗржЯрзЗржб ржирзЗржЯржУржпрж╝рж╛рж░рзНржХрж┐ржВ**: ржмрж┐рж▓рзНржЯ-ржЗржи рж╕рж╛рж░рзНржнрж┐рж╕ ржбрж┐рж╕ржХржнрж╛рж░рж┐ ржПржмржВ ржЯрзНрж░рж╛ржлрж┐ржХ рж╕рзНржкрзНрж▓рж┐ржЯрж┐ржВ
- **ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐**: Azure рж░рж┐рж╕рзЛрж░рзНрж╕рзЗ ржирж┐рж░рж╛ржкржж ржкрзНрж░ржорж╛ржгрзАржХрж░ржг
- **ржЦрж░ржЪ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи**: рж╢рзБржзрзБржорж╛рждрзНрж░ ржмрзНржпржмрж╣рзГржд рж░рж┐рж╕рзЛрж░рзНрж╕рзЗрж░ ржЬржирзНржп ржЕрж░рзНрже ржкрзНрж░ржжрж╛ржи

## ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝рждрж╛

рж╢рзБрж░рзБ ржХрж░рж╛рж░ ржЖржЧрзЗ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржпрзЗ ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ рж░рзЯрзЗржЫрзЗ:

```bash
# AZD ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
azd version

# Azure CLI ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
az version

# Docker ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи (ржХрж╛рж╕рзНржЯржо ржЗржорзЗржЬ рждрзИрж░рж┐ ржХрж░рж╛рж░ ржЬржирзНржп)
docker --version

# Azure-ржП рж▓ржЧржЗржи ржХрж░рзБржи
azd auth login
az login
```

**ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ Azure рж░рж┐рж╕рзЛрж░рзНрж╕:**
- рж╕ржХрзНрж░рж┐ржпрж╝ Azure рж╕рж╛ржмрж╕рзНржХрзНрж░рж┐ржкрж╢ржи
- рж░рж┐рж╕рзЛрж░рзНрж╕ ржЧрзНрж░рзБржк рждрзИрж░рж┐рж░ ржЕржирзБржорждрж┐
- Container Apps ржкрж░рж┐ржмрзЗрж╢рзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕

## ржжрзНрж░рзБржд рж╢рзБрж░рзБ ржЙржжрж╛рж╣рж░ржг

### рзз. рж╕рж╛ржзрж╛рж░ржг ржУржпрж╝рзЗржм API (Python Flask)

Azure Container Apps-ржП ржПржХржЯрж┐ ржмрзЗрж╕рж┐ржХ REST API ржбрж┐ржкрзНрж▓рзЯ ржХрж░рзБржиред

**ржЙржжрж╛рж╣рж░ржг: Python Flask API**

```yaml
# azure.yaml
name: flask-api-demo
metadata:
  template: flask-api-demo@0.0.1-beta
services:
  api:
    project: ./src/api
    language: python
    host: containerapp
```

**ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ ржзрж╛ржкрж╕ржорзВрж╣:**

```bash
# ржЯрзЗржоржкрзНрж▓рзЗржЯ ржерзЗржХрзЗ ржЖрж░ржорзНржн ржХрж░рзБржи
azd init --template todo-python-mongo

# ржЕржмржХрж╛ржарж╛ржорзЛ ржкрзНрж░рж╕рзНрждрзБржд ржХрж░рзБржи ржПржмржВ рж╕рзНржерж╛ржкржи ржХрж░рзБржи
azd up

# рж╕рзНржерж╛ржкржирж╛рж░ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
azd show
curl $(azd show --output json | jq -r '.services.api.endpoint')/health
```

**ржорзВрж▓ ржмрзИрж╢рж┐рж╖рзНржЯрзНржп:**
- рзж ржерзЗржХрзЗ рззрзж рж░рж┐ржкрзНрж▓рж┐ржХрж╛ ржкрж░рзНржпржирзНржд ржЕржЯрзЛ-рж╕рзНржХрзЗрж▓рж┐ржВ
- рж╣рзЗрж▓рже ржкрзНрж░рзЛржм ржПржмржВ рж▓рж╛ржЗржнржирзЗрж╕ ржЪрзЗржХ
- ржПржиржнрж╛ржпрж╝рж░ржиржорзЗржирзНржЯ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржЗржиржЬрзЗржХрж╢ржи
- ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржЗржирж╕рж╛ржЗржЯрж╕ ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи

### рзи. Node.js Express API

MongoDB ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи рж╕рж╣ ржПржХржЯрж┐ Node.js ржмрзНржпрж╛ржХржПржирзНржб ржбрж┐ржкрзНрж▓рзЯ ржХрж░рзБржиред

```bash
# Node.js API ржЯрзЗржоржкрзНрж▓рзЗржЯ ржЖрж░ржорзНржн ржХрж░рзБржи
azd init --template todo-nodejs-mongo

# ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи
azd env set DATABASE_NAME todosdb
azd env set COLLECTION_NAME todos

# ржорзЛрждрж╛ржпрж╝рзЗржи ржХрж░рзБржи
azd up

# рж▓ржЧ ржжрзЗржЦрзБржи
azd logs api
```

**ржЗржиржлрзНрж░рж╛рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░ рж╣рж╛ржЗрж▓рж╛ржЗржЯрж╕:**
```bicep
// Bicep snippet from infra/main.bicep
resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'api-${resourceToken}'
  location: location
  properties: {
    managedEnvironmentId: containerEnv.id
    configuration: {
      ingress: {
        external: true
        targetPort: 3000
        transport: 'auto'
      }
      secrets: [
        {
          name: 'mongodb-connection'
          value: mongoConnection
        }
      ]
    }
    template: {
      containers: [
        {
          name: 'api'
          image: containerImage
          env: [
            {
              name: 'DATABASE_URL'
              secretRef: 'mongodb-connection'
            }
          ]
        }
      ]
      scale: {
        minReplicas: 0
        maxReplicas: 10
      }
    }
  }
}
```

### рзй. рж╕рзНржЯрзНржпрж╛ржЯрж┐ржХ ржлрзНрж░ржирзНржЯржПржирзНржб + API ржмрзНржпрж╛ржХржПржирзНржб

React ржлрзНрж░ржирзНржЯржПржирзНржб ржПржмржВ API ржмрзНржпрж╛ржХржПржирзНржб рж╕рж╣ ржПржХржЯрж┐ ржлрзБрж▓-рж╕рзНржЯрзНржпрж╛ржХ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржбрж┐ржкрзНрж▓рзЯ ржХрж░рзБржиред

```bash
# рж╕ржорзНржкрзВрж░рзНржг-рж╕рзНржЯрзНржпрж╛ржХ ржЯрзЗржоржкрзНрж▓рзЗржЯ ржЖрж░ржорзНржн ржХрж░рзБржи
azd init --template todo-csharp-sql-swa-func

# ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржкрж░рзНржпрж╛рж▓рзЛржЪржирж╛ ржХрж░рзБржи
cat azure.yaml

# ржЙржнржпрж╝ ржкрж░рж┐рж╖рзЗржмрж╛ рж╕рзНржерж╛ржкржи ржХрж░рзБржи
azd up

# ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржЦрзБрж▓рзБржи
azd show --output json | jq -r '.services.web.endpoint' | xargs start
```

## ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржЙржжрж╛рж╣рж░ржг

### ржЙржжрж╛рж╣рж░ржг рзз: ржорж╛ржЗржХрзНрж░рзЛрж╕рж╛рж░рзНржнрж┐рж╕ ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░

**ржкрж░рж┐рж╕рзНржерж┐рждрж┐**: ржПржХрж╛ржзрж┐ржХ ржорж╛ржЗржХрзНрж░рзЛрж╕рж╛рж░рзНржнрж┐рж╕ рж╕рж╣ ржЗ-ржХржорж╛рж░рзНрж╕ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи

**ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░:**
```
microservices-demo/
тФЬтФАтФА azure.yaml
тФЬтФАтФА infra/
тФВ   тФЬтФАтФА main.bicep
тФВ   тФЬтФАтФА app/
тФВ   тФВ   тФЬтФАтФА container-env.bicep
тФВ   тФВ   тФЬтФАтФА product-service.bicep
тФВ   тФВ   тФЬтФАтФА order-service.bicep
тФВ   тФВ   тФФтФАтФА payment-service.bicep
тФВ   тФФтФАтФА core/
тФВ       тФЬтФАтФА storage.bicep
тФВ       тФФтФАтФА database.bicep
тФФтФАтФА src/
    тФЬтФАтФА product-service/
    тФЬтФАтФА order-service/
    тФФтФАтФА payment-service/
```

**azure.yaml ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи:**
```yaml
name: microservices-ecommerce
services:
  product-service:
    project: ./src/product-service
    language: python
    host: containerapp
    
  order-service:
    project: ./src/order-service
    language: csharp
    host: containerapp
    
  payment-service:
    project: ./src/payment-service
    language: nodejs
    host: containerapp
```

**ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ:**
```bash
# ржкрзНрж░ржХрж▓рзНржк ржЖрж░ржорзНржн ржХрж░рзБржи
azd init

# ржЙрзОржкрж╛ржжржи ржкрж░рж┐ржмрзЗрж╢ рж╕рзЗржЯ ржХрж░рзБржи
azd env new production

# ржЙрзОржкрж╛ржжржи рж╕рзЗржЯрж┐ржВрж╕ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи
azd env set ENVIRONMENT production
azd env set MIN_REPLICAS 2
azd env set MAX_REPLICAS 50

# рж╕ржорж╕рзНржд ржкрж░рж┐рж╖рзЗржмрж╛ рж╕рзНржерж╛ржкржи ржХрж░рзБржи
azd up

# рж╕рзНржерж╛ржкржирж╛ ржкрж░рзНржпржмрзЗржХрзНрж╖ржг ржХрж░рзБржи
azd monitor --overview
```

### ржЙржжрж╛рж╣рж░ржг рзи: AI-ржЪрж╛рж▓рж┐ржд ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк

**ржкрж░рж┐рж╕рзНржерж┐рждрж┐**: Azure OpenAI ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи рж╕рж╣ AI ржЪрзНржпрж╛ржЯ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи

**ржлрж╛ржЗрж▓: src/ai-chat/app.py**
```python
from flask import Flask, request, jsonify
from azure.identity import DefaultAzureCredential
from azure.keyvault.secrets import SecretClient
import openai

app = Flask(__name__)

# ржирж┐рж░рж╛ржкржж ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕рзЗрж░ ржЬржирзНржп ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи
credential = DefaultAzureCredential()
vault_url = "https://{vault-name}.vault.azure.net"
client = SecretClient(vault_url=vault_url, credential=credential)

@app.route('/api/chat', methods=['POST'])
def chat():
    user_message = request.json.get('message')
    
    # ржХрзА ржнрж▓рзНржЯ ржерзЗржХрзЗ ржУржкрзЗржиржПржЖржЗ ржХрзА ржкрж╛ржи
    openai_key = client.get_secret("openai-api-key").value
    openai.api_key = openai_key
    
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[{"role": "user", "content": user_message}]
    )
    
    return jsonify({"response": response.choices[0].message.content})

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8000)
```

**ржлрж╛ржЗрж▓: azure.yaml**
```yaml
name: ai-chat-app
services:
  api:
    project: ./src/ai-chat
    language: python
    host: containerapp
```

**ржлрж╛ржЗрж▓: infra/main.bicep**
```bicep
param location string = resourceGroup().location
param environmentName string

var resourceToken = uniqueString(subscription().id, environmentName, location)

// Container Apps Environment
module containerEnv './app/container-env.bicep' = {
  name: 'container-env-${resourceToken}'
  params: {
    location: location
    environmentName: environmentName
  }
}

// Key Vault for secrets
resource keyVault 'Microsoft.KeyVault/vaults@2023-02-01' = {
  name: 'kv-${resourceToken}'
  location: location
  properties: {
    sku: {
      family: 'A'
      name: 'standard'
    }
    tenantId: subscription().tenantId
    enableRbacAuthorization: true
  }
}

// Container App with Managed Identity
module aiChatApp './app/container-app.bicep' = {
  name: 'ai-chat-app-${resourceToken}'
  params: {
    location: location
    environmentId: containerEnv.outputs.environmentId
    containerImage: 'your-registry.azurecr.io/ai-chat:latest'
    keyVaultName: keyVault.name
  }
}
```

**ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ ржХржорж╛ржирзНржб:**
```bash
# ржкрж░рж┐ржмрзЗрж╢ рж╕рзЗржЯ ржЖржк ржХрж░рзБржи
azd init --template ai-chat-app
azd env new dev

# ржУржкрзЗржиржПржЖржЗ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи
azd env set AZURE_OPENAI_ENDPOINT "https://your-openai.openai.azure.com/"
azd env set AZURE_OPENAI_DEPLOYMENT "gpt-4"

# ржорзЛрждрж╛ржпрж╝рзЗржи ржХрж░рзБржи
azd up

# API ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
curl -X POST $(azd show --output json | jq -r '.services.api.endpoint')/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello, how are you?"}'
```

### ржЙржжрж╛рж╣рж░ржг рзй: ржмрзНржпрж╛ржХржЧрзНрж░рж╛ржЙржирзНржб ржУржпрж╝рж╛рж░рзНржХрж╛рж░ ржПржмржВ ржХрж┐ржЙ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ

**ржкрж░рж┐рж╕рзНржерж┐рждрж┐**: ржорзЗрж╕рзЗржЬ ржХрж┐ржЙ рж╕рж╣ ржЕрж░рзНржбрж╛рж░ ржкрзНрж░рж╕рзЗрж╕рж┐ржВ рж╕рж┐рж╕рзНржЯрзЗржо

**ржбрж┐рж░рзЗржХрзНржЯрж░рж┐ рж╕рзНржЯрзНрж░рж╛ржХржЪрж╛рж░:**
```
queue-worker/
тФЬтФАтФА azure.yaml
тФЬтФАтФА infra/
тФВ   тФЬтФАтФА main.bicep
тФВ   тФЬтФАтФА app/
тФВ   тФВ   тФЬтФАтФА api.bicep
тФВ   тФВ   тФФтФАтФА worker.bicep
тФВ   тФФтФАтФА core/
тФВ       тФЬтФАтФА storage-queue.bicep
тФВ       тФФтФАтФА servicebus.bicep
тФФтФАтФА src/
    тФЬтФАтФА api/
    тФФтФАтФА worker/
```

**ржлрж╛ржЗрж▓: src/worker/processor.py**
```python
import os
from azure.storage.queue import QueueClient
from azure.identity import DefaultAzureCredential

def process_orders():
    credential = DefaultAzureCredential()
    queue_url = os.getenv('AZURE_QUEUE_URL')
    
    queue_client = QueueClient.from_queue_url(
        queue_url=queue_url,
        credential=credential
    )
    
    while True:
        messages = queue_client.receive_messages(max_messages=10)
        for message in messages:
            # ржЕрж░рзНржбрж╛рж░ ржкрзНрж░ржХрзНрж░рж┐ржпрж╝рж╛ ржХрж░рзБржи
            print(f"Processing order: {message.content}")
            
            # ржмрж╛рж░рзНрждрж╛ рж╕ржорзНржкржирзНржи ржХрж░рзБржи
            queue_client.delete_message(message)

if __name__ == '__main__':
    process_orders()
```

**ржлрж╛ржЗрж▓: azure.yaml**
```yaml
name: order-processing
services:
  api:
    project: ./src/api
    language: python
    host: containerapp
    
  worker:
    project: ./src/worker
    language: python
    host: containerapp
```

**ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ:**
```bash
# ржЖрж░ржорзНржн ржХрж░рзБржи
azd init

# рж╕рж╛рж░рж┐ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи рж╕рж╣ рж╕рзНржерж╛ржкржи ржХрж░рзБржи
azd up

# рж╕рж╛рж░рж┐рж░ ржжрзИрж░рзНржШрзНржпрзЗрж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ ржХрж░рзНржорзА рж╕рзНржХрзЗрж▓ ржХрж░рзБржи
az containerapp update \
  --name worker \
  --resource-group rg-order-processing \
  --scale-rule-name queue-scaling \
  --scale-rule-type azure-queue \
  --scale-rule-metadata queueName=orders accountName=storageaccount
```

## ржЙржирзНржиржд ржкрзНржпрж╛ржЯрж╛рж░рзНржи

### ржкрзНржпрж╛ржЯрж╛рж░рзНржи рзз: ржмрзНрж▓рзБ-ржЧрзНрж░рж┐ржи ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ

```bash
# ржирждрзБржи рж╕ржВрж╕рзНржХрж░ржг рждрзИрж░рж┐ ржХрж░рзБржи ржЯрзНрж░рж╛ржлрж┐ржХ ржЫрж╛ржбрж╝рж╛ржЗ
azd deploy api --revision-suffix blue --no-traffic

# ржирждрзБржи рж╕ржВрж╕рзНржХрж░ржг ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
curl https://api--blue.nicegrass-12345.eastus.azurecontainerapps.io/health

# ржЯрзНрж░рж╛ржлрж┐ржХ ржнрж╛ржЧ ржХрж░рзБржи (рзирзж% ржирзАрж▓, рзорзж% ржмрж░рзНрждржорж╛ржи)
az containerapp ingress traffic set \
  --name api \
  --resource-group rg-myapp \
  --revision-weight latest=80 blue=20

# рж╕ржорзНржкрзВрж░рзНржг ржкрж░рж┐ржмрж░рзНрждржи ржирзАрж▓рзЗрж░ ржжрж┐ржХрзЗ
az containerapp ingress traffic set \
  --name api \
  --resource-group rg-myapp \
  --revision-weight blue=100
```

### ржкрзНржпрж╛ржЯрж╛рж░рзНржи рзи: AZD рж╕рж╣ ржХрзНржпрж╛ржирж╛рж░рж┐ ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ

**ржлрж╛ржЗрж▓: .azure/dev/config.json**
```json
{
  "deploymentStrategy": "canary",
  "canary": {
    "initialTrafficPercentage": 10,
    "incrementPercentage": 10,
    "intervalMinutes": 5
  }
}
```

**ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ рж╕рзНржХрзНрж░рж┐ржкрзНржЯ:**
```bash
#!/bin/bash
# deploy-canary.sh

# ржирждрзБржи рж╕ржВрж╕рзНржХрж░ржг рззрзж% ржЯрзНрж░рж╛ржлрж┐ржХ рж╕рж╣ рж╕рзНржерж╛ржкржи ржХрж░рзБржи
azd deploy api --revision-mode multiple

# ржорзЗржЯрзНрж░рж┐ржХ ржкрж░рзНржпржмрзЗржХрзНрж╖ржг ржХрж░рзБржи
azd monitor --service api --duration 5m

# ржзрзАрж░рзЗ ржзрзАрж░рзЗ ржЯрзНрж░рж╛ржлрж┐ржХ ржмрзГржжрзНржзрж┐ ржХрж░рзБржи
for i in {20..100..10}; do
  echo "Increasing traffic to $i%"
  az containerapp revision set-traffic \
    --name api \
    --resource-group rg-myapp \
    --revision-weight latest=$i
  
  sleep 300  # рзл ржорж┐ржирж┐ржЯ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи
done
```

### ржкрзНржпрж╛ржЯрж╛рж░рзНржи рзй: ржорж╛рж▓рзНржЯрж┐-рж░рж┐ржЬрж┐ржУржи ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ

**ржлрж╛ржЗрж▓: azure.yaml**
```yaml
name: global-app
services:
  api:
    project: ./src/api
    language: python
    host: containerapp
    regions:
      - eastus
      - westeurope
      - southeastasia
```

**ржлрж╛ржЗрж▓: infra/multi-region.bicep**
```bicep
param regions array = ['eastus', 'westeurope', 'southeastasia']

module containerApps './app/container-app.bicep' = [for region in regions: {
  name: 'app-${region}'
  params: {
    location: region
    environmentName: environmentName
  }
}]

// Traffic Manager for global load balancing
resource trafficManager 'Microsoft.Network/trafficManagerProfiles@2022-04-01' = {
  name: 'tm-global-app'
  location: 'global'
  properties: {
    trafficRoutingMethod: 'Performance'
    endpoints: [for i in range(0, length(regions)): {
      name: 'endpoint-${regions[i]}'
      type: 'Microsoft.Network/trafficManagerProfiles/externalEndpoints'
      properties: {
        target: containerApps[i].outputs.fqdn
        endpointStatus: 'Enabled'
      }
    }]
  }
}
```

**ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ:**
```bash
# рж╕ржорж╕рзНржд ржЕржЮрзНржЪрж▓рзЗ рж╕рзНржерж╛ржкржи ржХрж░рзБржи
azd up

# ржПржирзНржбржкржпрж╝рзЗржирзНржЯржЧрзБрж▓рж┐ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи
azd show --output json | jq '.services.api.endpoints'
```

### ржкрзНржпрж╛ржЯрж╛рж░рзНржи рзк: Dapr ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи

**ржлрж╛ржЗрж▓: infra/app/dapr-enabled.bicep**
```bicep
resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'dapr-app'
  properties: {
    configuration: {
      dapr: {
        enabled: true
        appId: 'order-service'
        appPort: 8000
        appProtocol: 'http'
      }
    }
    template: {
      containers: [
        {
          name: 'app'
          image: containerImage
        }
      ]
    }
  }
}
```

**Dapr рж╕рж╣ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржХрзЛржб:**
```python
from flask import Flask
from dapr.clients import DaprClient

app = Flask(__name__)

@app.route('/orders', methods=['POST'])
def create_order():
    with DaprClient() as client:
        # ржЕржмрж╕рзНржерж╛ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи
        client.save_state(
            store_name='statestore',
            key='order-123',
            value={'status': 'pending'}
        )
        
        # ржЗржнрзЗржирзНржЯ ржкрзНрж░ржХрж╛рж╢ ржХрж░рзБржи
        client.publish_event(
            pubsub_name='pubsub',
            topic_name='orders',
            data={'orderId': '123'}
        )
    
    return {'status': 'created'}
```

## рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи

### рзз. рж░рж┐рж╕рзЛрж░рзНрж╕ рж╕ржВржЧржаржи

```bash
# рж╕рж╛ржоржЮрзНржЬрж╕рзНржпржкрзВрж░рзНржг ржирж╛ржоржХрж░ржгрзЗрж░ рж░рзАрждрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи
azd env set AZURE_ENV_NAME "myapp-prod"
azd env set AZURE_LOCATION "eastus"

# ржЦрж░ржЪ ржЯрзНрж░рзНржпрж╛ржХрж┐ржВржпрж╝рзЗрж░ ржЬржирзНржп рж╕ржорзНржкржж ржЯрзНржпрж╛ржЧ ржХрж░рзБржи
azd env set AZURE_TAGS "Environment=Production,CostCenter=Engineering"
```

### рзи. ржирж┐рж░рж╛ржкрждрзНрждрж╛ рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи

```bicep
// Always use managed identity
resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
  identity: {
    type: 'SystemAssigned'
  }
}

// Store secrets in Key Vault
resource keyVault 'Microsoft.KeyVault/vaults@2023-02-01' = {
  properties: {
    enableRbacAuthorization: true
    networkAcls: {
      defaultAction: 'Deny'
      bypass: 'AzureServices'
    }
  }
}

// Use private endpoints
resource privateEndpoint 'Microsoft.Network/privateEndpoints@2023-04-01' = {
  properties: {
    subnet: {
      id: subnetId
    }
    privateLinkServiceConnections: [
      {
        name: 'containerapp-connection'
        properties: {
          privateLinkServiceId: containerApp.id
        }
      }
    ]
  }
}
```

### рзй. ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи

```yaml
# azure.yaml with performance settings
services:
  api:
    project: ./src/api
    host: containerapp
    resources:
      cpu: 1.0
      memory: 2Gi
    scale:
      minReplicas: 2
      maxReplicas: 20
      rules:
        - name: http-rule
          http:
            concurrent: 100
```

### рзк. ржоржирж┐ржЯрж░рж┐ржВ ржПржмржВ ржкрж░рзНржпржмрзЗржХрзНрж╖ржг

```bash
# ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржЗржирж╕рж╛ржЗржЯрж╕ рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи
azd env set APPLICATIONINSIGHTS_CONNECTION_STRING "InstrumentationKey=..."

# рж░рж┐ржпрж╝рзЗрж▓-ржЯрж╛ржЗржорзЗ рж▓ржЧ ржжрзЗржЦрзБржи
azd logs api --follow

# ржорзЗржЯрзНрж░рж┐ржХрзНрж╕ ржкрж░рзНржпржмрзЗржХрзНрж╖ржг ржХрж░рзБржи
azd monitor --service api

# рж╕рждрж░рзНржХрждрж╛ рждрзИрж░рж┐ ржХрж░рзБржи
az monitor metrics alert create \
  --name high-cpu-alert \
  --resource-group rg-myapp \
  --scopes $(azd show --output json | jq -r '.services.api.resourceId') \
  --condition "avg CPU > 80" \
  --description "Alert when CPU exceeds 80%"
```

### рзл. ржЦрж░ржЪ ржЕржкрзНржЯрж┐ржорж╛ржЗржЬрзЗрж╢ржи

```bash
# ржмрзНржпржмрж╣рж╛рж░ ржирж╛ рж╣рж▓рзЗ рж╢рзВржирзНржпрзЗ рж╕рзНржХрзЗрж▓ ржХрж░рзБржи
az containerapp update \
  --name api \
  --resource-group rg-myapp \
  --min-replicas 0

# ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯ ржкрж░рж┐ржмрзЗрж╢рзЗрж░ ржЬржирзНржп рж╕рзНржкржЯ ржЗржирж╕рзНржЯрзНржпрж╛ржирзНрж╕ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи
azd env set CONTAINER_APP_REPLICA_TYPE "Spot"

# ржмрж╛ржЬрзЗржЯ рж╕рждрж░рзНржХрждрж╛ рж╕рзЗржЯ ржЖржк ржХрж░рзБржи
az consumption budget create \
  --budget-name myapp-budget \
  --amount 100 \
  --time-grain Monthly \
  --threshold 80
```

### рзм. CI/CD ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи

**GitHub Actions ржЙржжрж╛рж╣рж░ржг:**
```yaml
name: Deploy to Azure Container Apps

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup AZD
        uses: Azure/setup-azd@v1
      
      - name: Login to Azure
        run: |
          azd auth login --client-id ${{ secrets.AZURE_CLIENT_ID }} \
            --client-secret ${{ secrets.AZURE_CLIENT_SECRET }} \
            --tenant-id ${{ secrets.AZURE_TENANT_ID }}
      
      - name: Deploy
        run: azd up --no-prompt
        env:
          AZURE_ENV_NAME: ${{ secrets.AZURE_ENV_NAME }}
          AZURE_LOCATION: ${{ secrets.AZURE_LOCATION }}
```

## рж╕рж╛ржзрж╛рж░ржг ржХржорж╛ржирзНржб рж░рзЗржлрж╛рж░рзЗржирзНрж╕

```bash
# ржирждрзБржи ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк ржкрзНрж░ржХрж▓рзНржк ржЖрж░ржорзНржн ржХрж░рзБржи
azd init --template <template-name>

# ржЕржмржХрж╛ржарж╛ржорзЛ ржПржмржВ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рж╕рзНржерж╛ржкржи ржХрж░рзБржи
azd up

# рж╢рзБржзрзБржорж╛рждрзНрж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржХрзЛржб рж╕рзНржерж╛ржкржи ржХрж░рзБржи (ржЕржмржХрж╛ржарж╛ржорзЛ ржмрж╛ржж ржжрж┐ржи)
azd deploy

# рж╢рзБржзрзБржорж╛рждрзНрж░ ржЕржмржХрж╛ржарж╛ржорзЛ ржкрзНрж░рж╕рзНрждрзБржд ржХрж░рзБржи
azd provision

# рж╕рзНржерж╛ржкрж┐ржд рж╕ржорзНржкржж ржжрзЗржЦрзБржи
azd show

# рж▓ржЧ рж╕рзНржЯрзНрж░рж┐ржо ржХрж░рзБржи
azd logs <service-name> --follow

# ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржкрж░рзНржпржмрзЗржХрзНрж╖ржг ржХрж░рзБржи
azd monitor --overview

# рж╕ржорзНржкржж ржкрж░рж┐рж╖рзНржХрж╛рж░ ржХрж░рзБржи
azd down --force --purge
```

## рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи

### рж╕ржорж╕рзНржпрж╛: ржХржирзНржЯрзЗржЗржирж╛рж░ рж╢рзБрж░рзБ ржХрж░рждрзЗ ржмрзНржпрж░рзНрже

```bash
# рж▓ржЧржЧрзБрж▓рж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
azd logs api --tail 100

# ржХржирзНржЯрзЗржЗржирж╛рж░ ржЗржнрзЗржирзНржЯржЧрзБрж▓рж┐ ржжрзЗржЦрзБржи
az containerapp revision show \
  --name api \
  --resource-group rg-myapp \
  --revision latest

# рж╕рзНржерж╛ржирзАржпрж╝ржнрж╛ржмрзЗ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
docker build -t api:local ./src/api
docker run -p 8000:8000 api:local
```

### рж╕ржорж╕рзНржпрж╛: ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк ржПржирзНржбржкржпрж╝рзЗржирзНржЯрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛ ржпрж╛ржЪрзНржЫрзЗ ржирж╛

```bash
# ржЗржиржЧрзНрж░рзЗрж╕ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи
az containerapp show \
  --name api \
  --resource-group rg-myapp \
  --query properties.configuration.ingress

# ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи ржЕржнрзНржпржирзНрждрж░рзАржг ржЗржиржЧрзНрж░рзЗрж╕ рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж┐ржирж╛
az containerapp ingress update \
  --name api \
  --resource-group rg-myapp \
  --external true
```

### рж╕ржорж╕рзНржпрж╛: ржкрж╛рж░ржлрж░ржорзНржпрж╛ржирзНрж╕ рж╕ржорж╕рзНржпрж╛

```bash
# рж░рж┐рж╕рзЛрж░рзНрж╕ ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
az monitor metrics list \
  --resource $(azd show --output json | jq -r '.services.api.resourceId') \
  --metric "CPUPercentage,MemoryPercentage"

# рж░рж┐рж╕рзЛрж░рзНрж╕ ржмрзГржжрзНржзрж┐ ржХрж░рзБржи
az containerapp update \
  --name api \
  --resource-group rg-myapp \
  --cpu 2.0 \
  --memory 4Gi
```

## ржЕрждрж┐рж░рж┐ржХрзНржд рж░рж┐рж╕рзЛрж░рзНрж╕ ржПржмржВ ржЙржжрж╛рж╣рж░ржг
- [ржорж╛ржЗржХрзНрж░рзЛрж╕рж╛рж░рзНржнрж┐рж╕ ржЙржжрж╛рж╣рж░ржг](./microservices/README.md)
- [рж╕рж╛ржзрж╛рж░ржг Flask API ржЙржжрж╛рж╣рж░ржг](./simple-flask-api/README.md)
- [Azure Container Apps ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи](https://learn.microsoft.com/azure/container-apps/)
- [AZD ржЯрзЗржоржкрзНрж▓рзЗржЯ ржЧрзНржпрж╛рж▓рж╛рж░рж┐](https://azure.github.io/awesome-azd/)
- [Container Apps ржиржорзБржирж╛](https://github.com/Azure-Samples/container-apps-samples)
- [Bicep ржЯрзЗржоржкрзНрж▓рзЗржЯ](https://learn.microsoft.com/azure/azure-resource-manager/bicep/)

## ржЕржмржжрж╛ржи рж░рж╛ржЦрж╛

ржирждрзБржи ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк ржЙржжрж╛рж╣рж░ржг ржпрзЛржЧ ржХрж░рждрзЗ:

1. ржЖржкржирж╛рж░ ржЙржжрж╛рж╣рж░ржг рж╕рж╣ ржПржХржЯрж┐ ржирждрзБржи рж╕рж╛ржмржбрж┐рж░рзЗржХрзНржЯрж░рж┐ рждрзИрж░рж┐ ржХрж░рзБржи
2. рж╕ржорзНржкрзВрж░рзНржг `azure.yaml`, `infra/`, ржПржмржВ `src/` ржлрж╛ржЗрж▓ ржЕржирзНрждрж░рзНржнрзБржХрзНржд ржХрж░рзБржи
3. ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ ржирж┐рж░рзНржжрзЗрж╢ржирж╛ рж╕рж╣ ржмрж┐рж╕рзНрждрж╛рж░рж┐ржд README ржпрзЛржЧ ржХрж░рзБржи
4. `azd up` ржжрж┐ржпрж╝рзЗ ржбрж┐ржкрзНрж▓рзЯржорзЗржирзНржЯ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
5. ржПржХржЯрж┐ ржкрзБрж▓ рж░рж┐ржХрзЛржпрж╝рзЗрж╕рзНржЯ ржЬржорж╛ ржжрж┐ржи

---

**рж╕рж╛рж╣рж╛ржпрзНржп ржжрж░ржХрж╛рж░?** [Microsoft Foundry Discord](https://discord.gg/microsoft-azure) ржХржорж┐ржЙржирж┐ржЯрж┐рждрзЗ ржпрзЛржЧ ржжрж┐ржи рж╕рж╣рж╛ржпрж╝рждрж╛ ржПржмржВ ржкрзНрж░рж╢рзНржирзЗрж░ ржЬржирзНржпред

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**ржЕрж╕рзНржмрзАржХрзГрждрж┐**:  
ржПржЗ ржиржерж┐ржЯрж┐ AI ржЕржирзБржмрж╛ржж ржкрж░рж┐рж╖рзЗржмрж╛ [Co-op Translator](https://github.com/Azure/co-op-translator) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЕржирзБржмрж╛ржж ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред ржЖржорж░рж╛ ржпржерж╛рж╕рж╛ржзрзНржп рж╕ржарж┐ржХрждрж╛рж░ ржЬржирзНржп ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рж┐, рждржмрзЗ ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржоржирзЗ рж░рж╛ржЦржмрзЗржи ржпрзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ ржЕржирзБржмрж╛ржжрзЗ рждрзНрж░рзБржЯрж┐ ржмрж╛ ржЕрж╕ржЩрзНржЧрждрж┐ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред ржорзВрж▓ ржнрж╛рж╖рж╛ржпрж╝ ржерж╛ржХрж╛ ржиржерж┐ржЯрж┐ржХрзЗ ржкрзНрж░рж╛ржорж╛ржгрж┐ржХ ржЙрзОрж╕ рж╣рж┐рж╕рзЗржмрзЗ ржмрж┐ржмрзЗржЪржирж╛ ржХрж░рж╛ ржЙржЪрж┐рждред ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг рждржерзНржпрзЗрж░ ржЬржирзНржп, ржкрзЗрж╢рж╛ржжрж╛рж░ ржорж╛ржиржм ржЕржирзБржмрж╛ржж рж╕рзБржкрж╛рж░рж┐рж╢ ржХрж░рж╛ рж╣ржпрж╝ред ржПржЗ ржЕржирзБржмрж╛ржж ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржлрж▓рзЗ ржХрзЛржирзЛ ржнрзБрж▓ ржмрзЛржЭрж╛ржмрзБржЭрж┐ ржмрж╛ ржнрзБрж▓ ржмрзНржпрж╛ржЦрзНржпрж╛ рж╣рж▓рзЗ ржЖржорж░рж╛ ржжрж╛ржпрж╝рзА ржерж╛ржХржм ржирж╛ред
<!-- CO-OP TRANSLATOR DISCLAIMER END -->