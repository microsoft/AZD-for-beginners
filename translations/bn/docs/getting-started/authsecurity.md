<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "e13ff6e1197e0a7462ed0aede7df9f23",
  "translation_date": "2025-11-20T16:15:00+00:00",
  "source_file": "docs/getting-started/authsecurity.md",
  "language_code": "bn"
}
-->
# ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНржпрж╛ржЯрж╛рж░рзНржи ржПржмржВ ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐

тП▒я╕П **ржЖржирзБржорж╛ржирж┐ржХ рж╕ржоржпрж╝**: рзкрзл-рзмрзж ржорж┐ржирж┐ржЯ | ЁЯТ░ **ржЦрж░ржЪ ржкрзНрж░ржнрж╛ржм**: ржмрж┐ржирж╛ржорзВрж▓рзНржпрзЗ (ржЕрждрж┐рж░рж┐ржХрзНржд ржЪрж╛рж░рзНржЬ ржирзЗржЗ) | тнР **ржЬржЯрж┐рж▓рждрж╛**: ржоржзрзНржпржо

**ЁЯУЪ рж╢рзЗржЦрж╛рж░ ржкрже:**
- тЖР ржкрзВрж░рзНржмржмрж░рзНрждрзА: [ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ](configuration.md) - ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржПржмржВ рж╕рж┐ржХрзНрж░рзЗржЯ ржкрж░рж┐ржЪрж╛рж▓ржирж╛
- ЁЯОп **ржЖржкржирж┐ ржПржЦрж╛ржирзЗ ржЖржЫрзЗржи**: ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржУ ржирж┐рж░рж╛ржкрждрзНрждрж╛ (ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐, ржХрзА ржнрж▓рзНржЯ, ржирж┐рж░рж╛ржкржж ржкрзНржпрж╛ржЯрж╛рж░рзНржи)
- тЖТ ржкрж░ржмрж░рзНрждрзА: [ржкрзНрж░ржержо ржкрзНрж░ржХрж▓рзНржк](first-project.md) - ржЖржкржирж╛рж░ ржкрзНрж░ржержо AZD ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рждрзИрж░рж┐ ржХрж░рзБржи
- ЁЯПа [ржХрзЛрж░рзНрж╕ рж╣рзЛржо](../../README.md)

---

## ржЖржкржирж┐ ржХрзА рж╢рж┐ржЦржмрзЗржи

ржПржЗ ржкрж╛ржаржЯрж┐ рж╕ржорзНржкржирзНржи ржХрж░рж╛рж░ ржорж╛ржзрзНржпржорзЗ ржЖржкржирж┐:
- ржЕрзНржпрж╛ржЬрзБрж░ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНржпрж╛ржЯрж╛рж░рзНржи (ржХрзА, ржХрж╛ржирзЗржХрж╢ржи рж╕рзНржЯрзНрж░рж┐ржВ, ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐) ржмрзБржЭрждрзЗ ржкрж╛рж░ржмрзЗржи
- ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржбржмрж┐рж╣рзАржи ржкрзНрж░ржорж╛ржгрзАржХрж░ржгрзЗрж░ ржЬржирзНржп **ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐** ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи ржХрж░ржмрзЗржи
- **ржЕрзНржпрж╛ржЬрзБрж░ ржХрзА ржнрж▓рзНржЯ** ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржирзЗрж░ ржорж╛ржзрзНржпржорзЗ рж╕рж┐ржХрзНрж░рзЗржЯ рж╕рзБрж░ржХрзНрж╖рж┐ржд ржХрж░ржмрзЗржи
- AZD ржбрж┐ржкрзНрж▓ржпрж╝ржорзЗржирзНржЯрзЗрж░ ржЬржирзНржп **рж░рзЛрж▓-ржнрж┐рждрзНрждрж┐ржХ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХржирзНржЯрзНрж░рзЛрж▓ (RBAC)** ржХржиржлрж┐ржЧрж╛рж░ ржХрж░ржмрзЗржи
- ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк ржПржмржВ ржЕрзНржпрж╛ржЬрзБрж░ рж╕рж╛рж░рзНржнрж┐рж╕рзЗ ржирж┐рж░рж╛ржкрждрзНрждрж╛рж░ рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░ржмрзЗржи
- ржХрзА-ржнрж┐рждрзНрждрж┐ржХ ржерзЗржХрзЗ ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐-ржнрж┐рждрзНрждрж┐ржХ ржкрзНрж░ржорж╛ржгрзАржХрж░ржгрзЗ рж╕рзНржерж╛ржирж╛ржирзНрждрж░ ржХрж░ржмрзЗржи

## ржХрзЗржи ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг

### рж╕ржорж╕рзНржпрж╛: ржРрждрж┐рж╣рзНржпржмрж╛рж╣рзА ржкрзНрж░ржорж╛ржгрзАржХрж░ржг

**ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐рж░ ржЖржЧрзЗ:**
```javascript
// тЭМ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржЭрзБржБржХрж┐: ржХрзЛржбрзЗ рж╣рж╛рж░рзНржбржХрзЛржб ржХрж░рж╛ ржЧрзЛржкржирзАржпрж╝ рждржерзНржп
const connectionString = "Server=mydb.database.windows.net;User=admin;Password=P@ssw0rd123";
const storageKey = "xK7mN9pQ2wR5tY8uI0oP3aS6dF1gH4jK...";
const cosmosKey = "C2x7B9n4M1p8Q5w3E6r0T2y5U8i1O4p7...";
```

**рж╕ржорж╕рзНржпрж╛рж╕ржорзВрж╣:**
- ЁЯФ┤ **ржХрзЛржб, ржХржиржлрж┐ржЧ ржлрж╛ржЗрж▓, ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓рзЗ ржкрзНрж░ржХрж╛рж╢рж┐ржд рж╕рж┐ржХрзНрж░рзЗржЯ**
- ЁЯФ┤ **ржХрзНрж░рзЗржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓ рж░рзЛржЯрзЗрж╢ржи** ржХрзЛржб ржкрж░рж┐ржмрж░рзНрждржи ржПржмржВ ржкрзБржирж░рж╛ржпрж╝ ржбрж┐ржкрзНрж▓ржпрж╝ржорзЗржирзНржЯ ржкрзНрж░ржпрж╝рзЛржЬржи
- ЁЯФ┤ **ржЕржбрж┐ржЯрзЗрж░ ржжрзБржГрж╕рзНржмржкрзНржи** - ржХрзЗ ржХржЦржи ржХрзА ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рзЗржЫрзЗ?
- ЁЯФ┤ **ржмрж┐ржХрзНрж╖рж┐ржкрзНрждрждрж╛** - ржмрж┐ржнрж┐ржирзНржи рж╕рж┐рж╕рзНржЯрзЗржорзЗ ржЫржбрж╝рж┐ржпрж╝рзЗ ржерж╛ржХрж╛ рж╕рж┐ржХрзНрж░рзЗржЯ
- ЁЯФ┤ **ржХржоржкрзНрж▓рж╛ржпрж╝рзЗржирзНрж╕ ржЭрзБржБржХрж┐** - ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржЕржбрж┐ржЯрзЗ ржмрзНржпрж░рзНрже

### рж╕ржорж╛ржзрж╛ржи: ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐

**ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐рж░ ржкрж░рзЗ:**
```javascript
// тЬЕ ржирж┐рж░рж╛ржкржж: ржХрзЛржбрзЗ ржХрзЛржирзЛ ржЧрзЛржкржирзАржпрж╝рждрж╛ ржирзЗржЗ
const credential = new DefaultAzureCredential();
const client = new BlobServiceClient(
  "https://mystorageaccount.blob.core.windows.net",
  credential  // Azure рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ
);
```

**рж╕рзБржмрж┐ржзрж╛рж╕ржорзВрж╣:**
- тЬЕ **ржХрзЛржб ржмрж╛ ржХржиржлрж┐ржЧрзЗ ржХрзЛржирзЛ рж╕рж┐ржХрзНрж░рзЗржЯ ржирзЗржЗ**
- тЬЕ **рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ рж░рзЛржЯрзЗрж╢ржи** - ржЕрзНржпрж╛ржЬрзБрж░ ржПржЯрж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ
- тЬЕ **ржкрзВрж░рзНржг ржЕржбрж┐ржЯ ржЯрзНрж░рзЗржЗрж▓** ржЕрзНржпрж╛ржЬрзБрж░ AD рж▓ржЧрзЗ
- тЬЕ **ржХрзЗржирзНржжрзНрж░рзАржнрзВржд ржирж┐рж░рж╛ржкрждрзНрждрж╛** - ржЕрзНржпрж╛ржЬрзБрж░ ржкрзЛрж░рзНржЯрж╛рж▓рзЗ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзБржи
- тЬЕ **ржХржоржкрзНрж▓рж╛ржпрж╝рзЗржирзНрж╕ ржкрзНрж░рж╕рзНрждрзБржд** - ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржорж╛ржи ржкрзВрж░ржг ржХрж░рзЗ

**ржЙржкржорж╛**: ржРрждрж┐рж╣рзНржпржмрж╛рж╣рзА ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржЕржирзЗржХржЧрзБрж▓рзЛ ржжрж░ржЬрж╛рж░ ржЬржирзНржп ржЖрж▓рж╛ржжрж╛ ржЪрж╛ржмрж┐ ржмрж╣ржирзЗрж░ ржорждрзЛред ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржПржХржЯрж┐ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржмрзНржпрж╛ржЬрзЗрж░ ржорждрзЛ ржпрж╛ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржЖржкржирж╛рж░ ржкрж░рж┐ржЪржпрж╝рзЗрж░ ржЙржкрж░ ржнрж┐рждрзНрждрж┐ ржХрж░рзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрзНрж░ржжрж╛ржи ржХрж░рзЗтАФржХрзЛржирзЛ ржЪрж╛ржмрж┐ рж╣рж╛рж░рж╛ржирзЛрж░, ржХржкрж┐ ржХрж░рж╛рж░ ржмрж╛ рж░рзЛржЯрзЗржЯ ржХрж░рж╛рж░ ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗред

---

## ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░ ржУржнрж╛рж░ржнрж┐ржЙ

### ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐рж░ рж╕рж╛ржерзЗ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНрж░ржмрж╛рж╣

```mermaid
sequenceDiagram
    participant App as ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи<br/>(ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк)
    participant MI as ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐<br/>(ржЕрзНржпрж╛ржЬрзБрж░ AD)
    participant KV as ржХрзА ржнрж▓рзНржЯ
    participant Storage as ржЕрзНржпрж╛ржЬрзБрж░ рж╕рзНржЯрзЛрж░рзЗржЬ
    participant DB as ржЕрзНржпрж╛ржЬрзБрж░ SQL
    
    App->>MI: ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЯрзЛржХрзЗржи ржЕржирзБрж░рзЛржз ржХрж░рзБржи<br/>(рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝)
    MI->>MI: ржкрж░рж┐ржЪржпрж╝ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи<br/>(ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗ)
    MI-->>App: ржЯрзЛржХрзЗржи ржлрзЗрж░ржд ржжрж┐ржи<br/>(рзз ржШржгрзНржЯрж╛рж░ ржЬржирзНржп ржмрзИржз)
    
    App->>KV: рж╕рж┐ржХрзНрж░рзЗржЯ ржкрж╛ржи<br/>(ржЯрзЛржХрзЗржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ)
    KV->>KV: RBAC ржЕржирзБржорждрж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
    KV-->>App: рж╕рж┐ржХрзНрж░рзЗржЯ ржорж╛ржи ржлрзЗрж░ржд ржжрж┐ржи
    
    App->>Storage: ржмрзНрж▓ржм ржЖржкрж▓рзЛржб ржХрж░рзБржи<br/>(ржЯрзЛржХрзЗржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ)
    Storage->>Storage: RBAC ржЕржирзБржорждрж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
    Storage-->>App: рж╕ржлрж▓
    
    App->>DB: ржбрзЗржЯрж╛ ржЕржирзБрж╕ржирзНржзрж╛ржи ржХрж░рзБржи<br/>(ржЯрзЛржХрзЗржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ)
    DB->>DB: SQL ржЕржирзБржорждрж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
    DB-->>App: ржлрж▓рж╛ржлрж▓ ржлрзЗрж░ржд ржжрж┐ржи
    
    Note over App,DB: рж╕ржорж╕рзНржд ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржбржмрж┐рж╣рзАржи!
```
### ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐рж░ ржзрж░ржи

```mermaid
graph TB
    MI[ржкрж░рж┐ржЪрж╛рж▓рж┐ржд ржкрж░рж┐ржЪржпрж╝]
    SystemAssigned[рж╕рж┐рж╕рзНржЯрзЗржо-ржирж┐рж░рзНржзрж╛рж░рж┐ржд ржкрж░рж┐ржЪржпрж╝]
    UserAssigned[ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА-ржирж┐рж░рзНржзрж╛рж░рж┐ржд ржкрж░рж┐ржЪржпрж╝]
    
    MI --> SystemAssigned
    MI --> UserAssigned
    
    SystemAssigned --> SA1[рж╕ржорзНржкржжрзЗрж░ рж╕рж╛ржерзЗ ржЬрзАржмржиржЪржХрзНрж░ рж╕ржВржпрзБржХрзНржд]
    SystemAssigned --> SA2[рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ рж╕рзГрж╖рзНржЯрж┐/ржорзБржЫрзЗ ржлрзЗрж▓рж╛]
    SystemAssigned --> SA3[ржПржХржХ рж╕ржорзНржкржжрзЗрж░ ржЬржирзНржп рж╕рзЗрж░рж╛]
    
    UserAssigned --> UA1[рж╕рзНржмрждржирзНрждрзНрж░ ржЬрзАржмржиржЪржХрзНрж░]
    UserAssigned --> UA2[ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓ рж╕рзГрж╖рзНржЯрж┐/ржорзБржЫрзЗ ржлрзЗрж▓рж╛]
    UserAssigned --> UA3[рж╕ржорзНржкржжржЧрзБрж▓рж┐рж░ ржоржзрзНржпрзЗ ржнрж╛ржЧ ржХрж░рж╛]
    
    style SystemAssigned fill:#2196F3,stroke:#1976D2,stroke-width:2px,color:#fff
    style UserAssigned fill:#4CAF50,stroke:#388E3C,stroke-width:2px,color:#fff
```
| ржмрзИрж╢рж┐рж╖рзНржЯрзНржп | рж╕рж┐рж╕рзНржЯрзЗржо-ржЕрзНржпрж╛рж╕рж╛ржЗржиржб | ржЗржЙржЬрж╛рж░-ржЕрзНржпрж╛рж╕рж╛ржЗржиржб |
|---------|----------------|---------------|
| **рж▓рж╛ржЗржлрж╕рж╛ржЗржХрзЗрж▓** | рж░рж┐рж╕рзЛрж░рзНрж╕рзЗрж░ рж╕рж╛ржерзЗ рж╕ржВржпрзБржХрзНржд | рж╕рзНржмрж╛ржзрзАржи |
| **рждрзИрж░рж┐** | рж░рж┐рж╕рзЛрж░рзНрж╕рзЗрж░ рж╕рж╛ржерзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ | ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓ рждрзИрж░рж┐ |
| **ржорзБржЫрзЗ ржлрзЗрж▓рж╛** | рж░рж┐рж╕рзЛрж░рзНрж╕рзЗрж░ рж╕рж╛ржерзЗ ржорзБржЫрзЗ ржлрзЗрж▓рж╛ | рж░рж┐рж╕рзЛрж░рзНрж╕ ржорзБржЫрзЗ ржлрзЗрж▓рж╛рж░ ржкрж░рзЗржУ ржерж╛ржХрзЗ |
| **рж╢рзЗржпрж╝рж╛рж░рж┐ржВ** | рж╢рзБржзрзБржорж╛рждрзНрж░ ржПржХржЯрж┐ рж░рж┐рж╕рзЛрж░рзНрж╕ | ржПржХрж╛ржзрж┐ржХ рж░рж┐рж╕рзЛрж░рзНрж╕ |
| **ржмрзНржпржмрж╣рж╛рж░ ржХрзЗрж╕** | рж╕рж╣ржЬ ржкрж░рж┐рж╕рзНржерж┐рждрж┐ | ржЬржЯрж┐рж▓ ржмрж╣рзБ-рж░рж┐рж╕рзЛрж░рзНрж╕ ржкрж░рж┐рж╕рзНржерж┐рждрж┐ |
| **AZD ржбрж┐ржлрж▓рзНржЯ** | тЬЕ рж╕рзБржкрж╛рж░рж┐рж╢ржХрзГржд | ржРржЪрзНржЫрж┐ржХ |

---

## ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝рждрж╛

### ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржЯрзБрж▓рж╕

ржЖржкржирж╛рж░ ржХрж╛ржЫрзЗ ржЖржЧрзЗрж░ ржкрж╛ржа ржерзЗржХрзЗ ржПржЧрзБрж▓рзЛ ржЗржирж╕рзНржЯрж▓ ржХрж░рж╛ ржерж╛ржХрж╛ ржЙржЪрж┐ржд:

```bash
# ржЕрзНржпрж╛ржЬрзБрж░ ржбрзЗржнрзЗрж▓ржкрж╛рж░ CLI ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи
azd version
# тЬЕ ржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд: azd рж╕ржВрж╕рзНржХрж░ржг 1.0.0 ржмрж╛ рждрж╛рж░ ржмрзЗрж╢рж┐

# ржЕрзНржпрж╛ржЬрзБрж░ CLI ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи
az --version
# тЬЕ ржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд: azure-cli 2.50.0 ржмрж╛ рждрж╛рж░ ржмрзЗрж╢рж┐
```

### ржЕрзНржпрж╛ржЬрзБрж░ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝рждрж╛

- рж╕ржХрзНрж░рж┐ржпрж╝ ржЕрзНржпрж╛ржЬрзБрж░ рж╕рж╛ржмрж╕рзНржХрзНрж░рж┐ржкрж╢ржи
- ржЕржирзБржорждрж┐:
  - ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ рждрзИрж░рж┐ ржХрж░рждрзЗ
  - RBAC рж░рзЛрж▓ ржЕрзНржпрж╛рж╕рж╛ржЗржи ржХрж░рждрзЗ
  - ржХрзА ржнрж▓рзНржЯ рж░рж┐рж╕рзЛрж░рзНрж╕ рждрзИрж░рж┐ ржХрж░рждрзЗ
  - ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк ржбрж┐ржкрзНрж▓ржпрж╝ ржХрж░рждрзЗ

### ржЬрзНржЮрж╛ржи ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝рждрж╛

ржЖржкржирж╛рж░ рж╕ржорзНржкржирзНржи ржХрж░рж╛ ржЙржЪрж┐ржд:
- [ржЗржирж╕рзНржЯрж▓рзЗрж╢ржи ржЧрж╛ржЗржб](installation.md) - AZD рж╕рзЗржЯржЖржк
- [AZD ржмрзЗрж╕рж┐ржХрж╕](azd-basics.md) - ржорзВрж▓ ржзрж╛рж░ржгрж╛
- [ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржи ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ](configuration.md) - ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓

---

## ржкрж╛ржа рзз: ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНржпрж╛ржЯрж╛рж░рзНржи ржмрзЛржЭрж╛

### ржкрзНржпрж╛ржЯрж╛рж░рзНржи рзз: ржХрж╛ржирзЗржХрж╢ржи рж╕рзНржЯрзНрж░рж┐ржВ (ржкрзБрж░рж╛ржирзЛ - ржПржбрж╝рж┐ржпрж╝рзЗ ржЪрж▓рзБржи)

**ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ:**
```bash
# рж╕ржВржпрзЛржЧ рж╕рзНржЯрзНрж░рж┐ржВржпрж╝рзЗ рж╢ржВрж╕рж╛ржкрждрзНрж░ рж░ржпрж╝рзЗржЫрзЗ
STORAGE_CONNECTION_STRING="DefaultEndpointsProtocol=https;AccountName=myaccount;AccountKey=xK7mN9pQ2wR5..."
COSMOS_CONNECTION_STRING="AccountEndpoint=https://myaccount.documents.azure.com:443/;AccountKey=C2x7..."
SQL_CONNECTION_STRING="Server=myserver.database.windows.net;User=admin;Password=P@ssw0rd..."
```

**рж╕ржорж╕рзНржпрж╛рж╕ржорзВрж╣:**
- тЭМ ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓рзЗ рж╕рж┐ржХрзНрж░рзЗржЯ ржжрзГрж╢рзНржпржорж╛ржи
- тЭМ ржбрж┐ржкрзНрж▓ржпрж╝ржорзЗржирзНржЯ рж╕рж┐рж╕рзНржЯрзЗржорзЗ рж▓ржЧ ржХрж░рж╛ рж╣ржпрж╝
- тЭМ рж░рзЛржЯрзЗржЯ ржХрж░рж╛ ржХржарж┐ржи
- тЭМ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕рзЗрж░ ржХрзЛржирзЛ ржЕржбрж┐ржЯ ржЯрзНрж░рзЗржЗрж▓ ржирзЗржЗ

**ржХржЦржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи:** рж╢рзБржзрзБржорж╛рждрзНрж░ рж╕рзНржерж╛ржирзАржпрж╝ ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯрзЗрж░ ржЬржирзНржп, ржХржЦржирзЛ ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ ржиржпрж╝ред

---

### ржкрзНржпрж╛ржЯрж╛рж░рзНржи рзи: ржХрзА ржнрж▓рзНржЯ рж░рзЗржлрж╛рж░рзЗржирзНрж╕ (ржнрж╛рж▓рзЛ)

**ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ:**
```bicep
// Store secret in Key Vault
resource keyVault 'Microsoft.KeyVault/vaults@2023-02-01' = {
  name: 'mykv'
  properties: {
    enableRbacAuthorization: true
  }
}

// Reference in Container App
env: [
  {
    name: 'STORAGE_KEY'
    secretRef: 'storage-key'  // References Key Vault
  }
]
```

**рж╕рзБржмрж┐ржзрж╛рж╕ржорзВрж╣:**
- тЬЕ ржХрзА ржнрж▓рзНржЯрзЗ рж╕рж┐ржХрзНрж░рзЗржЯ ржирж┐рж░рж╛ржкржжрзЗ рж╕ржВрж░ржХрзНрж╖рж┐ржд
- тЬЕ ржХрзЗржирзНржжрзНрж░рзАржнрзВржд рж╕рж┐ржХрзНрж░рзЗржЯ ржорзНржпрж╛ржирзЗржЬржорзЗржирзНржЯ
- тЬЕ ржХрзЛржб ржкрж░рж┐ржмрж░рзНрждржи ржЫрж╛ржбрж╝рж╛ржЗ рж░рзЛржЯрзЗрж╢ржи

**рж╕рзАржорж╛ржмржжрзНржзрждрж╛:**
- тЪая╕П ржПржЦржиржУ ржХрзА/ржкрж╛рж╕ржУржпрж╝рж╛рж░рзНржб ржмрзНржпржмрж╣рж╛рж░ ржХрж░рж╛ рж╣ржЪрзНржЫрзЗ
- тЪая╕П ржХрзА ржнрж▓рзНржЯ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рждрзЗ рж╣ржмрзЗ

**ржХржЦржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи:** ржХрж╛ржирзЗржХрж╢ржи рж╕рзНржЯрзНрж░рж┐ржВ ржерзЗржХрзЗ ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐рждрзЗ рж╕рзНржерж╛ржирж╛ржирзНрждрж░рзЗрж░ ржЬржирзНржп ржПржХржЯрж┐ ржоржзрзНржпржмрж░рзНрждрзА ржзрж╛ржкред

---

### ржкрзНржпрж╛ржЯрж╛рж░рзНржи рзй: ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ (рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи)

**ржХрзАржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ:**
```bicep
// Enable managed identity
resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'myapp'
  identity: {
    type: 'SystemAssigned'  // Automatically creates identity
  }
}

// Grant permissions
resource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  scope: storageAccount
  properties: {
    roleDefinitionId: storageBlobDataContributorRole
    principalId: containerApp.identity.principalId
  }
}
```

**ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржХрзЛржб:**
```javascript
// ржХрзЛржирзЛ ржЧрзЛржкржирзАржпрж╝рждрж╛ ржкрзНрж░ржпрж╝рзЛржЬржи ржирзЗржЗ!
const { DefaultAzureCredential } = require('@azure/identity');
const { BlobServiceClient } = require('@azure/storage-blob');

const credential = new DefaultAzureCredential();
const blobServiceClient = new BlobServiceClient(
  'https://mystorageaccount.blob.core.windows.net',
  credential
);
```

**рж╕рзБржмрж┐ржзрж╛рж╕ржорзВрж╣:**
- тЬЕ ржХрзЛржб/ржХржиржлрж┐ржЧрзЗ ржХрзЛржирзЛ рж╕рж┐ржХрзНрж░рзЗржЯ ржирзЗржЗ
- тЬЕ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ ржХрзНрж░рзЗржбрзЗржирж╢рж┐ржпрж╝рж╛рж▓ рж░рзЛржЯрзЗрж╢ржи
- тЬЕ ржкрзВрж░рзНржг ржЕржбрж┐ржЯ ржЯрзНрж░рзЗржЗрж▓
- тЬЕ RBAC-ржнрж┐рждрзНрждрж┐ржХ ржЕржирзБржорждрж┐
- тЬЕ ржХржоржкрзНрж▓рж╛ржпрж╝рзЗржирзНрж╕ ржкрзНрж░рж╕рзНрждрзБржд

**ржХржЦржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи:** рж╕рж░рзНржмржжрж╛, ржкрзНрж░рзЛржбрж╛ржХрж╢ржи ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗрж░ ржЬржирзНржпред

---

## ржкрж╛ржа рзи: AZD ржПрж░ рж╕рж╛ржерзЗ ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи

### ржзрж╛ржкрзЗ ржзрж╛ржкрзЗ ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи

ржЪрж▓рзБржи ржПржХржЯрж┐ ржирж┐рж░рж╛ржкржж ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк рждрзИрж░рж┐ ржХрж░рж┐ ржпрж╛ ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЕрзНржпрж╛ржЬрзБрж░ рж╕рзНржЯрзЛрж░рзЗржЬ ржПржмржВ ржХрзА ржнрж▓рзНржЯ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рзЗред

### ржкрзНрж░ржХрж▓рзНржк ржХрж╛ржарж╛ржорзЛ

```
secure-app/
тФЬтФАтФА azure.yaml                 # AZD configuration
тФЬтФАтФА infra/
тФВ   тФЬтФАтФА main.bicep            # Main infrastructure
тФВ   тФЬтФАтФА core/
тФВ   тФВ   тФЬтФАтФА identity.bicep    # Managed identity setup
тФВ   тФВ   тФЬтФАтФА keyvault.bicep    # Key Vault configuration
тФВ   тФВ   тФФтФАтФА storage.bicep     # Storage with RBAC
тФВ   тФФтФАтФА app/
тФВ       тФФтФАтФА container-app.bicep
тФФтФАтФА src/
    тФЬтФАтФА app.js                # Application code
    тФЬтФАтФА package.json
    тФФтФАтФА Dockerfile
```

### рзз. AZD ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рзБржи (azure.yaml)

```yaml
name: secure-app
metadata:
  template: secure-app@1.0.0

services:
  api:
    project: ./src
    language: js
    host: containerapp

# Enable managed identity (AZD handles this automatically)
```

### рзи. ржЕржмржХрж╛ржарж╛ржорзЛ: ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи

**ржлрж╛ржЗрж▓: `infra/main.bicep`**

```bicep
targetScope = 'subscription'

param environmentName string
param location string = 'eastus'

var tags = { 'azd-env-name': environmentName }

// Resource group
resource rg 'Microsoft.Resources/resourceGroups@2021-04-01' = {
  name: 'rg-${environmentName}'
  location: location
  tags: tags
}

// Storage Account
module storage './core/storage.bicep' = {
  name: 'storage'
  scope: rg
  params: {
    name: 'st${uniqueString(rg.id)}'
    location: location
    tags: tags
  }
}

// Key Vault
module keyVault './core/keyvault.bicep' = {
  name: 'keyvault'
  scope: rg
  params: {
    name: 'kv-${uniqueString(rg.id)}'
    location: location
    tags: tags
  }
}

// Container App with Managed Identity
module containerApp './app/container-app.bicep' = {
  name: 'container-app'
  scope: rg
  params: {
    name: 'ca-${environmentName}'
    location: location
    tags: tags
    storageAccountName: storage.outputs.name
    keyVaultName: keyVault.outputs.name
  }
}

// Grant Container App access to Storage
module storageRoleAssignment './core/role-assignment.bicep' = {
  name: 'storage-role'
  scope: rg
  params: {
    principalId: containerApp.outputs.identityPrincipalId
    roleDefinitionId: 'ba92f5b4-2d11-453d-a403-e96b0029c9fe'  // Storage Blob Data Contributor
    targetResourceId: storage.outputs.id
  }
}

// Grant Container App access to Key Vault
module kvRoleAssignment './core/role-assignment.bicep' = {
  name: 'kv-role'
  scope: rg
  params: {
    principalId: containerApp.outputs.identityPrincipalId
    roleDefinitionId: '4633458b-17de-408a-b874-0445c86b69e6'  // Key Vault Secrets User
    targetResourceId: keyVault.outputs.id
  }
}

// Outputs
output AZURE_STORAGE_ACCOUNT_NAME string = storage.outputs.name
output AZURE_KEY_VAULT_NAME string = keyVault.outputs.name
output APP_URL string = containerApp.outputs.url
```

### рзй. рж╕рж┐рж╕рзНржЯрзЗржо-ржЕрзНржпрж╛рж╕рж╛ржЗржиржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐рж░ рж╕рж╛ржерзЗ ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк

**ржлрж╛ржЗрж▓: `infra/app/container-app.bicep`**

```bicep
param name string
param location string
param tags object = {}
param storageAccountName string
param keyVaultName string

resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
  name: name
  location: location
  tags: tags
  identity: {
    type: 'SystemAssigned'  // ЁЯФС Enable managed identity
  }
  properties: {
    configuration: {
      ingress: {
        external: true
        targetPort: 3000
      }
    }
    template: {
      containers: [
        {
          name: 'api'
          image: 'myregistry.azurecr.io/api:latest'
          resources: {
            cpu: json('0.5')
            memory: '1Gi'
          }
          env: [
            {
              name: 'AZURE_STORAGE_ACCOUNT_NAME'
              value: storageAccountName
            }
            {
              name: 'AZURE_KEY_VAULT_NAME'
              value: keyVaultName
            }
            // ЁЯФС No secrets - managed identity handles authentication!
          ]
        }
      ]
    }
  }
}

// Output the identity for RBAC assignments
output identityPrincipalId string = containerApp.identity.principalId
output id string = containerApp.id
output url string = 'https://${containerApp.properties.configuration.ingress.fqdn}'
```

### рзк. RBAC рж░рзЛрж▓ ржЕрзНржпрж╛рж╕рж╛ржЗржиржорзЗржирзНржЯ ржоржбрж┐ржЙрж▓

**ржлрж╛ржЗрж▓: `infra/core/role-assignment.bicep`**

```bicep
param principalId string
param roleDefinitionId string  // Azure built-in role ID
param targetResourceId string

resource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  name: guid(principalId, roleDefinitionId, targetResourceId)
  scope: resourceId('Microsoft.Resources/resourceGroups', resourceGroup().name)
  properties: {
    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', roleDefinitionId)
    principalId: principalId
    principalType: 'ServicePrincipal'
  }
}

output id string = roleAssignment.id
```

### рзл. ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐рж░ рж╕рж╛ржерзЗ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржХрзЛржб

**ржлрж╛ржЗрж▓: `src/app.js`**

```javascript
const express = require('express');
const { DefaultAzureCredential } = require('@azure/identity');
const { BlobServiceClient } = require('@azure/storage-blob');
const { SecretClient } = require('@azure/keyvault-secrets');

const app = express();
const PORT = process.env.PORT || 3000;

// ЁЯФС ржкрж░рж┐ржЪрж┐рждрж┐ ржкрзНрж░рж╛ржержорж┐ржХрзАржХрж░ржг (ржкрж░рж┐ржЪрж╛рж▓рж┐ржд ржкрж░рж┐ржЪржпрж╝рзЗрж░ рж╕рж╛ржерзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ)
const credential = new DefaultAzureCredential();

// Azure Storage рж╕рзЗржЯржЖржк
const storageAccountName = process.env.AZURE_STORAGE_ACCOUNT_NAME;
const blobServiceClient = new BlobServiceClient(
  `https://${storageAccountName}.blob.core.windows.net`,
  credential  // ржХрзЛржирзЛ ржХрзА ржкрзНрж░рзЯрзЛржЬржи ржирзЗржЗ!
);

// Key Vault рж╕рзЗржЯржЖржк
const keyVaultName = process.env.AZURE_KEY_VAULT_NAME;
const secretClient = new SecretClient(
  `https://${keyVaultName}.vault.azure.net`,
  credential  // ржХрзЛржирзЛ ржХрзА ржкрзНрж░рзЯрзЛржЬржи ржирзЗржЗ!
);

// рж╕рзНржмрж╛рж╕рзНржерзНржп ржкрж░рзАржХрзНрж╖рж╛
app.get('/health', (req, res) => {
  res.json({ status: 'healthy', authentication: 'managed-identity' });
});

// ржмрзНрж▓ржм рж╕рзНржЯрзЛрж░рзЗржЬрзЗ ржлрж╛ржЗрж▓ ржЖржкрж▓рзЛржб ржХрж░рзБржи
app.post('/upload', async (req, res) => {
  try {
    const containerClient = blobServiceClient.getContainerClient('uploads');
    await containerClient.createIfNotExists();
    
    const blobName = `file-${Date.now()}.txt`;
    const blockBlobClient = containerClient.getBlockBlobClient(blobName);
    
    await blockBlobClient.upload('Hello from managed identity!', 30);
    
    res.json({
      success: true,
      blobName: blobName,
      message: 'File uploaded using managed identity!'
    });
  } catch (error) {
    console.error('Upload error:', error);
    res.status(500).json({ error: error.message });
  }
});

// Key Vault ржерзЗржХрзЗ ржЧрзЛржкржи рждржерзНржп ржкрж╛ржи
app.get('/secret/:name', async (req, res) => {
  try {
    const secretName = req.params.name;
    const secret = await secretClient.getSecret(secretName);
    
    res.json({
      name: secretName,
      value: secret.value,
      message: 'Secret retrieved using managed identity!'
    });
  } catch (error) {
    console.error('Secret error:', error);
    res.status(500).json({ error: error.message });
  }
});

// ржмрзНрж▓ржм ржХржирзНржЯрзЗржЗржирж╛рж░ рждрж╛рж▓рж┐ржХрж╛ ржХрж░рзБржи (ржкрзЬрж╛рж░ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрзНрж░ржжрж░рзНрж╢ржи ржХрж░рзЗ)
app.get('/containers', async (req, res) => {
  try {
    const containers = [];
    for await (const container of blobServiceClient.listContainers()) {
      containers.push(container.name);
    }
    
    res.json({
      containers: containers,
      count: containers.length,
      message: 'Containers listed using managed identity!'
    });
  } catch (error) {
    console.error('List error:', error);
    res.status(500).json({ error: error.message });
  }
});

app.listen(PORT, () => {
  console.log(`Secure API listening on port ${PORT}`);
  console.log('Authentication: Managed Identity (passwordless)');
});
```

**ржлрж╛ржЗрж▓: `src/package.json`**

```json
{
  "name": "secure-app",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.18.2",
    "@azure/identity": "^4.0.0",
    "@azure/storage-blob": "^12.17.0",
    "@azure/keyvault-secrets": "^4.7.0"
  },
  "scripts": {
    "start": "node app.js"
  }
}
```

### рзм. ржбрж┐ржкрзНрж▓ржпрж╝ ржПржмржВ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи

```bash
# AZD ржкрж░рж┐ржмрзЗрж╢ ржЖрж░ржорзНржн ржХрж░рзБржи
azd init

# ржЕржмржХрж╛ржарж╛ржорзЛ ржПржмржВ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи рж╕рзНржерж╛ржкржи ржХрж░рзБржи
azd up

# ржЕрзНржпрж╛ржк URL ржкрж╛ржи
APP_URL=$(azd env get-values | grep APP_URL | cut -d '=' -f2 | tr -d '"')

# рж╕рзНржмрж╛рж╕рзНржерзНржп ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
curl $APP_URL/health
```

**тЬЕ ржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд ржЖржЙржЯржкрзБржЯ:**
```json
{
  "status": "healthy",
  "authentication": "managed-identity"
}
```

**ржмрзНрж▓ржм ржЖржкрж▓рзЛржб ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи:**
```bash
curl -X POST $APP_URL/upload
```

**тЬЕ ржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд ржЖржЙржЯржкрзБржЯ:**
```json
{
  "success": true,
  "blobName": "file-1700404800000.txt",
  "message": "File uploaded using managed identity!"
}
```

**ржХржирзНржЯрзЗржЗржирж╛рж░ рждрж╛рж▓рж┐ржХрж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи:**
```bash
curl $APP_URL/containers
```

**тЬЕ ржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд ржЖржЙржЯржкрзБржЯ:**
```json
{
  "containers": ["uploads"],
  "count": 1,
  "message": "Containers listed using managed identity!"
}
```

---

## рж╕рж╛ржзрж╛рж░ржг ржЕрзНржпрж╛ржЬрзБрж░ RBAC рж░рзЛрж▓

### ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐рж░ ржЬржирзНржп ржмрж┐рж▓рзНржЯ-ржЗржи рж░рзЛрж▓ ржЖржЗржбрж┐

| рж╕рж╛рж░рзНржнрж┐рж╕ | рж░рзЛрж▓ ржирж╛ржо | рж░рзЛрж▓ ржЖржЗржбрж┐ | ржЕржирзБржорждрж┐ |
|---------|-----------|---------|-------------|
| **рж╕рзНржЯрзЛрж░рзЗржЬ** | рж╕рзНржЯрзЛрж░рзЗржЬ ржмрзНрж▓ржм ржбрзЗржЯрж╛ рж░рж┐ржбрж╛рж░ | `2a2b9908-6b94-4a3d-8e5a-a7d8f8cc8a12` | ржмрзНрж▓ржм ржПржмржВ ржХржирзНржЯрзЗржЗржирж╛рж░ ржкржбрж╝рзБржи |
| **рж╕рзНржЯрзЛрж░рзЗржЬ** | рж╕рзНржЯрзЛрж░рзЗржЬ ржмрзНрж▓ржм ржбрзЗржЯрж╛ ржХржирзНржЯрзНрж░рж┐ржмрж┐ржЙржЯрж░ | `ba92f5b4-2d11-453d-a403-e96b0029c9fe` | ржмрзНрж▓ржм ржкржбрж╝рж╛, рж▓рзЗржЦрж╛, ржорзБржЫрзЗ ржлрзЗрж▓рж╛ |
| **рж╕рзНржЯрзЛрж░рзЗржЬ** | рж╕рзНржЯрзЛрж░рзЗржЬ ржХрж┐ржЙ ржбрзЗржЯрж╛ ржХржирзНржЯрзНрж░рж┐ржмрж┐ржЙржЯрж░ | `974c5e8b-45b9-4653-ba55-5f855dd0fb88` | ржХрж┐ржЙ ржорзЗрж╕рзЗржЬ ржкржбрж╝рж╛, рж▓рзЗржЦрж╛, ржорзБржЫрзЗ ржлрзЗрж▓рж╛ |
| **ржХрзА ржнрж▓рзНржЯ** | ржХрзА ржнрж▓рзНржЯ рж╕рж┐ржХрзНрж░рзЗржЯрж╕ ржЗржЙржЬрж╛рж░ | `4633458b-17de-408a-b874-0445c86b69e6` | рж╕рж┐ржХрзНрж░рзЗржЯ ржкржбрж╝рзБржи |
| **ржХрзА ржнрж▓рзНржЯ** | ржХрзА ржнрж▓рзНржЯ рж╕рж┐ржХрзНрж░рзЗржЯрж╕ ржЕржлрж┐рж╕рж╛рж░ | `b86a8fe4-44ce-4948-aee5-eccb2c155cd7` | рж╕рж┐ржХрзНрж░рзЗржЯ ржкржбрж╝рж╛, рж▓рзЗржЦрж╛, ржорзБржЫрзЗ ржлрзЗрж▓рж╛ |
| **ржХрж╕ржорж╕ ржбрж┐ржмрж┐** | ржХрж╕ржорж╕ ржбрж┐ржмрж┐ ржмрж┐рж▓рзНржЯ-ржЗржи ржбрзЗржЯрж╛ рж░рж┐ржбрж╛рж░ | `00000000-0000-0000-0000-000000000001` | ржХрж╕ржорж╕ ржбрж┐ржмрж┐ ржбрзЗржЯрж╛ ржкржбрж╝рзБржи |
| **ржХрж╕ржорж╕ ржбрж┐ржмрж┐** | ржХрж╕ржорж╕ ржбрж┐ржмрж┐ ржмрж┐рж▓рзНржЯ-ржЗржи ржбрзЗржЯрж╛ ржХржирзНржЯрзНрж░рж┐ржмрж┐ржЙржЯрж░ | `00000000-0000-0000-0000-000000000002` | ржХрж╕ржорж╕ ржбрж┐ржмрж┐ ржбрзЗржЯрж╛ ржкржбрж╝рж╛, рж▓рзЗржЦрж╛ |
| **SQL ржбрж╛ржЯрж╛ржмрзЗрж╕** | SQL DB ржХржирзНржЯрзНрж░рж┐ржмрж┐ржЙржЯрж░ | `9b7fa17d-e63e-47b0-bb0a-15c516ac86ec` | SQL ржбрж╛ржЯрж╛ржмрзЗрж╕ ржкрж░рж┐ржЪрж╛рж▓ржирж╛ |
| **рж╕рж╛рж░рзНржнрж┐рж╕ ржмрж╛рж╕** | ржЕрзНржпрж╛ржЬрзБрж░ рж╕рж╛рж░рзНржнрж┐рж╕ ржмрж╛рж╕ ржбрзЗржЯрж╛ ржУржирж╛рж░ | `090c5cfd-751d-490a-894a-3ce6f1109419` | ржорзЗрж╕рзЗржЬ ржкрж╛ржарж╛ржирзЛ, ржЧрзНрж░рж╣ржг, ржкрж░рж┐ржЪрж╛рж▓ржирж╛ |

### рж░рзЛрж▓ ржЖржЗржбрж┐ ржХрзАржнрж╛ржмрзЗ ржЦрзБржБржЬрзЗ ржкрж╛ржмрзЗржи

```bash
# рж╕ржорж╕рзНржд ржмрж┐рж▓рзНржЯ-ржЗржи ржнрзВржорж┐ржХрж╛ рждрж╛рж▓рж┐ржХрж╛ржнрзБржХрзНржд ржХрж░рзБржи
az role definition list --query "[].{Name:roleName, ID:name}" --output table

# ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржнрзВржорж┐ржХрж╛ ржЕржирзБрж╕ржирзНржзрж╛ржи ржХрж░рзБржи
az role definition list --query "[?contains(roleName, 'Storage Blob')].{Name:roleName, ID:name}" --output table

# ржнрзВржорж┐ржХрж╛рж░ ржмрж┐ржмрж░ржг ржкрж╛ржи
az role definition list --name "Storage Blob Data Contributor"
```

---

## ржмрзНржпржмрж╣рж╛рж░рж┐ржХ ржЕржирзБрж╢рзАрж▓ржи

### ржЕржирзБрж╢рзАрж▓ржи рзз: ржмрж┐ржжрзНржпржорж╛ржи ржЕрзНржпрж╛ржкрзЗрж░ ржЬржирзНржп ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи тнРтнР (ржоржзрзНржпржо)

**рж▓ржХрзНрж╖рзНржп**: ржПржХржЯрж┐ ржмрж┐ржжрзНржпржорж╛ржи ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк ржбрж┐ржкрзНрж▓ржпрж╝ржорзЗржирзНржЯрзЗ ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржпрзЛржЧ ржХрж░рзБржи

**ржкрж░рж┐рж╕рзНржерж┐рждрж┐**: ржЖржкржирж╛рж░ ржПржХржЯрж┐ ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк рж░ржпрж╝рзЗржЫрзЗ ржпрж╛ ржХрж╛ржирзЗржХрж╢ржи рж╕рзНржЯрзНрж░рж┐ржВ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрзЗред ржПржЯрж┐ржХрзЗ ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐рждрзЗ рж░рзВржкрж╛ржирзНрждрж░ ржХрж░рзБржиред

**рж╢рзБрж░рзБ ржХрж░рж╛рж░ ржкржпрж╝рзЗржирзНржЯ**: ржПржЗ ржХржиржлрж┐ржЧрж╛рж░рзЗрж╢ржирзЗрж░ рж╕рж╛ржерзЗ ржПржХржЯрж┐ ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржк:

```bicep
// тЭМ Current: Using connection string
env: [
  {
    name: 'STORAGE_CONNECTION_STRING'
    secretRef: 'storage-connection'
  }
]
```

**ржзрж╛ржкрж╕ржорзВрж╣**:

1. **ржмрж╛ржЗрж╕рзЗржкрзЗ ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи:**

```bicep
resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'myapp'
  identity: {
    type: 'SystemAssigned'  // Add this
  }
  // ... rest of configuration
}
```

2. **рж╕рзНржЯрзЛрж░рзЗржЬ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрзНрж░ржжрж╛ржи ржХрж░рзБржи:**

```bicep
// Get storage account reference
resource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' existing = {
  name: storageAccountName
}

// Assign role
resource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  name: guid(containerApp.id, 'ba92f5b4-2d11-453d-a403-e96b0029c9fe', storageAccount.id)
  scope: storageAccount
  properties: {
    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')
    principalId: containerApp.identity.principalId
    principalType: 'ServicePrincipal'
  }
}
```

3. **ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржХрзЛржб ржЖржкржбрзЗржЯ ржХрж░рзБржи:**

**ржЖржЧрзЗ (ржХрж╛ржирзЗржХрж╢ржи рж╕рзНржЯрзНрж░рж┐ржВ):**
```javascript
const { BlobServiceClient } = require('@azure/storage-blob');

const blobServiceClient = BlobServiceClient.fromConnectionString(
  process.env.STORAGE_CONNECTION_STRING
);
```

**ржкрж░рзЗ (ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐):**
```javascript
const { DefaultAzureCredential } = require('@azure/identity');
const { BlobServiceClient } = require('@azure/storage-blob');

const credential = new DefaultAzureCredential();
const blobServiceClient = new BlobServiceClient(
  `https://${process.env.STORAGE_ACCOUNT_NAME}.blob.core.windows.net`,
  credential
);
```

4. **ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржЖржкржбрзЗржЯ ржХрж░рзБржи:**

```bicep
env: [
  {
    name: 'STORAGE_ACCOUNT_NAME'
    value: storageAccountName  // Just the name, no secrets!
  }
  // Remove STORAGE_CONNECTION_STRING
]
```

5. **ржбрж┐ржкрзНрж▓ржпрж╝ ржПржмржВ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи:**

```bash
# ржкрзБржирж░рж╛ржпрж╝ рж╕рзНржерж╛ржкржи ржХрж░рзБржи
azd up

# ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи ржпрзЗ ржПржЯрж┐ ржПржЦржиржУ ржХрж╛ржЬ ржХрж░рзЗ
curl https://myapp.azurecontainerapps.io/upload
```

**тЬЕ рж╕рж╛ржлрж▓рзНржпрзЗрж░ ржорж╛ржиржжржгрзНржб:**
- тЬЕ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржХрзЛржирзЛ рждрзНрж░рзБржЯрж┐ ржЫрж╛ржбрж╝рж╛ржЗ ржбрж┐ржкрзНрж▓ржпрж╝ рж╣ржпрж╝
- тЬЕ рж╕рзНржЯрзЛрж░рзЗржЬ ржЕржкрж╛рж░рзЗрж╢ржи ржХрж╛ржЬ ржХрж░рзЗ (ржЖржкрж▓рзЛржб, рждрж╛рж▓рж┐ржХрж╛, ржбрж╛ржЙржирж▓рзЛржб)
- тЬЕ ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓рзЗ ржХрзЛржирзЛ ржХрж╛ржирзЗржХрж╢ржи рж╕рзНржЯрзНрж░рж┐ржВ ржирзЗржЗ
- тЬЕ ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржЕрзНржпрж╛ржЬрзБрж░ ржкрзЛрж░рзНржЯрж╛рж▓рзЗ "ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐" ржмрзНрж▓рзЗржбрзЗ ржжрзГрж╢рзНржпржорж╛ржи

**ржпрж╛ржЪрж╛ржЗ:**

```bash
# ржкрж░рж┐ржЪрж╛рж▓рж┐ржд ржкрж░рж┐ржЪржпрж╝ рж╕ржХрзНрж░рж┐ржпрж╝ ржЖржЫрзЗ ржХрж┐ржирж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
az containerapp show \
  --name myapp \
  --resource-group rg-myapp \
  --query "identity.type"
# тЬЕ ржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд: "SystemAssigned"

# ржнрзВржорж┐ржХрж╛ ржмрж░рж╛ржжрзНржж ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
az role assignment list \
  --assignee $(az containerapp show --name myapp --resource-group rg-myapp --query "identity.principalId" -o tsv) \
  --scope /subscriptions/{sub-id}/resourceGroups/rg-myapp/providers/Microsoft.Storage/storageAccounts/mystorageaccount
# тЬЕ ржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд: "Storage Blob Data Contributor" ржнрзВржорж┐ржХрж╛ ржжрзЗржЦрж╛ржпрж╝
```

**рж╕ржоржпрж╝**: рзирзж-рзйрзж ржорж┐ржирж┐ржЯ

---

### ржЕржирзБрж╢рзАрж▓ржи рзи: ржЗржЙржЬрж╛рж░-ржЕрзНржпрж╛рж╕рж╛ржЗржиржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐рж░ рж╕рж╛ржерзЗ ржмрж╣рзБ-рж╕рж╛рж░рзНржнрж┐рж╕ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ тнРтнРтнР (ржЙржирзНржиржд)

**рж▓ржХрзНрж╖рзНржп**: ржПржХрж╛ржзрж┐ржХ ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржкрзЗрж░ ржоржзрзНржпрзЗ ржнрж╛ржЧ ржХрж░рж╛ ржПржХржЯрж┐ ржЗржЙржЬрж╛рж░-ржЕрзНржпрж╛рж╕рж╛ржЗржиржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ рждрзИрж░рж┐ ржХрж░рзБржи

**ржкрж░рж┐рж╕рзНржерж┐рждрж┐**: ржЖржкржирж╛рж░ рзйржЯрж┐ ржорж╛ржЗржХрзНрж░рзЛрж╕рж╛рж░рзНржнрж┐рж╕ рж░ржпрж╝рзЗржЫрзЗ ржпрж╛ ржПржХржЗ рж╕рзНржЯрзЛрж░рзЗржЬ ржЕрзНржпрж╛ржХрж╛ржЙржирзНржЯ ржПржмржВ ржХрзА ржнрж▓рзНржЯ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ рж╣ржмрзЗред

**ржзрж╛ржкрж╕ржорзВрж╣**:

1. **ржЗржЙржЬрж╛рж░-ржЕрзНржпрж╛рж╕рж╛ржЗржиржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ рждрзИрж░рж┐ ржХрж░рзБржи:**

**ржлрж╛ржЗрж▓: `infra/core/identity.bicep`**

```bicep
param name string
param location string
param tags object = {}

resource userAssignedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2023-01-31' = {
  name: name
  location: location
  tags: tags
}

output id string = userAssignedIdentity.id
output principalId string = userAssignedIdentity.properties.principalId
output clientId string = userAssignedIdentity.properties.clientId
```

2. **ржЗржЙржЬрж╛рж░-ржЕрзНржпрж╛рж╕рж╛ржЗржиржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐рждрзЗ рж░рзЛрж▓ ржЕрзНржпрж╛рж╕рж╛ржЗржи ржХрж░рзБржи:**

```bicep
// In main.bicep
module userIdentity './core/identity.bicep' = {
  name: 'user-identity'
  scope: rg
  params: {
    name: 'id-${environmentName}'
    location: location
    tags: tags
  }
}

// Grant Storage access
resource storageRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  name: guid(userIdentity.outputs.principalId, 'storage-contributor')
  scope: storageAccount
  properties: {
    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')
    principalId: userIdentity.outputs.principalId
    principalType: 'ServicePrincipal'
  }
}

// Grant Key Vault access
resource kvRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  name: guid(userIdentity.outputs.principalId, 'kv-secrets-user')
  scope: keyVault
  properties: {
    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4633458b-17de-408a-b874-0445c86b69e6')
    principalId: userIdentity.outputs.principalId
    principalType: 'ServicePrincipal'
  }
}
```

3. **ржПржХрж╛ржзрж┐ржХ ржХржирзНржЯрзЗржЗржирж╛рж░ ржЕрзНржпрж╛ржкрзЗ ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржЕрзНржпрж╛рж╕рж╛ржЗржи ржХрж░рзБржи:**

```bicep
resource apiGateway 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'api-gateway'
  identity: {
    type: 'UserAssigned'
    userAssignedIdentities: {
      '${userIdentity.outputs.id}': {}
    }
  }
  // ... rest of config
}

resource productService 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'product-service'
  identity: {
    type: 'UserAssigned'
    userAssignedIdentities: {
      '${userIdentity.outputs.id}': {}
    }
  }
  // ... rest of config
}

resource orderService 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'order-service'
  identity: {
    type: 'UserAssigned'
    userAssignedIdentities: {
      '${userIdentity.outputs.id}': {}
    }
  }
  // ... rest of config
}
```

4. **ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржХрзЛржб (рж╕ржм рж╕рж╛рж░рзНржнрж┐рж╕ ржПржХржЗ ржкрзНржпрж╛ржЯрж╛рж░рзНржи ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ):**

```javascript
const { DefaultAzureCredential, ManagedIdentityCredential } = require('@azure/identity');

// ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА-ржирж┐рж░рзНржзрж╛рж░рж┐ржд ржкрж░рж┐ржЪржпрж╝рзЗрж░ ржЬржирзНржп, ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ ржЖржЗржбрж┐ ржирж┐рж░рзНржжрж┐рж╖рзНржЯ ржХрж░рзБржи
const credential = new ManagedIdentityCredential(
  process.env.AZURE_CLIENT_ID  // ржмрзНржпржмрж╣рж╛рж░ржХрж╛рж░рзА-ржирж┐рж░рзНржзрж╛рж░рж┐ржд ржкрж░рж┐ржЪржпрж╝рзЗрж░ ржХрзНрж▓рж╛ржпрж╝рзЗржирзНржЯ ржЖржЗржбрж┐
);

// ржЕржержмрж╛ DefaultAzureCredential ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи (рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ржнрж╛ржмрзЗ рж╕ржирж╛ржХрзНржд ржХрж░рзЗ)
const credential = new DefaultAzureCredential();

const blobServiceClient = new BlobServiceClient(
  `https://${process.env.STORAGE_ACCOUNT_NAME}.blob.core.windows.net`,
  credential
);
```

5. **ржбрж┐ржкрзНрж▓ржпрж╝ ржПржмржВ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи:**

```bash
azd up

# рж╕ржорж╕рзНржд ржкрж░рж┐рж╖рзЗржмрж╛ рж╕рзНржЯрзЛрж░рзЗржЬрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░рзЗ ржХрж┐ржирж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
curl https://api-gateway.azurecontainerapps.io/upload
curl https://product-service.azurecontainerapps.io/upload
curl https://order-service.azurecontainerapps.io/upload
```

**тЬЕ рж╕рж╛ржлрж▓рзНржпрзЗрж░ ржорж╛ржиржжржгрзНржб:**
- тЬЕ рзйржЯрж┐ рж╕рж╛рж░рзНржнрж┐рж╕рзЗрж░ ржоржзрзНржпрзЗ ржПржХржЯрж┐ ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржнрж╛ржЧ ржХрж░рж╛
- тЬЕ рж╕ржм рж╕рж╛рж░рзНржнрж┐рж╕ рж╕рзНржЯрзЛрж░рзЗржЬ ржПржмржВ ржХрзА ржнрж▓рзНржЯ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рждрзЗ ржкрж╛рж░рзЗ
- тЬЕ ржПржХржЯрж┐ рж╕рж╛рж░рзНржнрж┐рж╕ ржорзБржЫрзЗ ржлрзЗрж▓рж▓рзЗ ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржерж╛ржХрзЗ
- тЬЕ ржХрзЗржирзНржжрзНрж░рзАржнрзВржд ржЕржирзБржорждрж┐ ржкрж░рж┐ржЪрж╛рж▓ржирж╛

**ржЗржЙржЬрж╛рж░-ржЕрзНржпрж╛рж╕рж╛ржЗржиржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐рж░ рж╕рзБржмрж┐ржзрж╛:**
- ржкрж░рж┐ржЪрж╛рж▓ржирж╛рж░ ржЬржирзНржп ржПржХржЯрж┐ ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐
- рж╕рж╛рж░рзНржнрж┐рж╕ ржЬрзБржбрж╝рзЗ рж╕рж╛ржоржЮрзНржЬрж╕рзНржпржкрзВрж░рзНржг ржЕржирзБржорждрж┐
- рж╕рж╛рж░рзНржнрж┐рж╕ ржорзБржЫрзЗ ржлрзЗрж▓рж▓рзЗржУ ржЯрж┐ржХрзЗ ржерж╛ржХрзЗ
- ржЬржЯрж┐рж▓ ржЖрж░рзНржХрж┐ржЯрзЗржХржЪрж╛рж░рзЗрж░ ржЬржирзНржп ржнрж╛рж▓рзЛ

**рж╕ржоржпрж╝**: рзйрзж-рзкрзж ржорж┐ржирж┐ржЯ

---

### ржЕржирзБрж╢рзАрж▓ржи рзй: ржХрзА ржнрж▓рзНржЯ рж╕рж┐ржХрзНрж░рзЗржЯ рж░рзЛржЯрзЗрж╢ржи ржмрж╛рж╕рзНрждржмрж╛ржпрж╝ржи тнРтнРтнР (ржЙржирзНржиржд)

**рж▓ржХрзНрж╖рзНржп**: ржХрзА ржнрж▓рзНржЯрзЗ рждрзГрждрзАржпрж╝ ржкржХрзНрж╖рзЗрж░ API ржХрзА рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи ржПржмржВ ржорзНржпрж╛ржирзЗржЬржб ржЖржЗржбрзЗржирзНржЯрж┐ржЯрж┐ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ рж╕рзЗржЧрзБрж▓рзЛ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рзБржи

**ржкрж░рж┐рж╕рзНржерж┐рждрж┐**: ржЖржкржирж╛рж░ ржЕрзНржпрж╛ржкржХрзЗ ржПржХржЯрж┐ ржмрж╛рж╣рзНржпрж┐ржХ API (OpenAI, Stripe, SendGrid) ржХрж▓ ржХрж░рждрзЗ рж╣ржмрзЗ ржпрж╛ API ржХрзА ржкрзНрж░ржпрж╝рзЛржЬржиред

**ржзрж╛ржкрж╕ржорзВрж╣**:

1. **RBAC рж╕рж╣ ржХрзА ржнрж▓рзНржЯ рждрзИрж░рж┐ ржХрж░рзБржи:**

**ржлрж╛ржЗрж▓: `infra/core/keyvault.bicep`**

```bicep
param name string
param location string
param tags object = {}

resource keyVault 'Microsoft.KeyVault/vaults@2023-02-01' = {
  name: name
  location: location
  tags: tags
  properties: {
    enableRbacAuthorization: true  // Use RBAC instead of access policies
    sku: {
      family: 'A'
      name: 'standard'
    }
    tenantId: subscription().tenantId
    enableSoftDelete: true
    softDeleteRetentionInDays: 90
  }
}

// Allow Container App to read secrets
output id string = keyVault.id
output name string = keyVault.name
output uri string = keyVault.properties.vaultUri
```

2. **ржХрзА ржнрж▓рзНржЯрзЗ рж╕рж┐ржХрзНрж░рзЗржЯ рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи:**

```bash
# ржХрзА ржнрж▓рзНржЯ ржирж╛ржо ржкрж╛ржи
KV_NAME=$(azd env get-values | grep AZURE_KEY_VAULT_NAME | cut -d '=' -f2 | tr -d '"')

# рждрзГрждрзАржпрж╝ ржкржХрзНрж╖рзЗрж░ API ржХрзА рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи
az keyvault secret set \
  --vault-name $KV_NAME \
  --name "OpenAI-ApiKey" \
  --value "sk-proj-xxxxxxxxxxxxx"

az keyvault secret set \
  --vault-name $KV_NAME \
  --name "Stripe-ApiKey" \
  --value "sk_live_xxxxxxxxxxxxx"

az keyvault secret set \
  --vault-name $KV_NAME \
  --name "SendGrid-ApiKey" \
  --value "SG.xxxxxxxxxxxxx"
```

3. **рж╕рж┐ржХрзНрж░рзЗржЯ ржкрзБржирж░рзБржжрзНржзрж╛рж░рзЗрж░ ржЬржирзНржп ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржХрзЛржб:**

**ржлрж╛ржЗрж▓: `src/config.js`**

```javascript
const { DefaultAzureCredential } = require('@azure/identity');
const { SecretClient } = require('@azure/keyvault-secrets');

class Config {
  constructor() {
    this.credential = new DefaultAzureCredential();
    this.secretClient = new SecretClient(
      `https://${process.env.AZURE_KEY_VAULT_NAME}.vault.azure.net`,
      this.credential
    );
    this.cache = {};
  }

  async getSecret(secretName) {
    // ржкрзНрж░ржержорзЗ ржХрзНржпрж╛рж╢ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
    if (this.cache[secretName]) {
      return this.cache[secretName];
    }

    try {
      const secret = await this.secretClient.getSecret(secretName);
      this.cache[secretName] = secret.value;
      console.log(`тЬЕ Retrieved secret: ${secretName}`);
      return secret.value;
    } catch (error) {
      console.error(`тЭМ Failed to get secret ${secretName}:`, error.message);
      throw error;
    }
  }

  async getOpenAIKey() {
    return this.getSecret('OpenAI-ApiKey');
  }

  async getStripeKey() {
    return this.getSecret('Stripe-ApiKey');
  }

  async getSendGridKey() {
    return this.getSecret('SendGrid-ApiKey');
  }
}

module.exports = new Config();
```

4. **ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржирзЗ рж╕рж┐ржХрзНрж░рзЗржЯ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи:**

**ржлрж╛ржЗрж▓: `src/app.js`**

```javascript
const express = require('express');
const config = require('./config');
const { OpenAI } = require('openai');

const app = express();

// ржХрзА ржнрж▓рзНржЯ ржерзЗржХрзЗ ржХрзА ржжрж┐ржпрж╝рзЗ ржУржкрзЗржиржПржЖржЗ ржЖрж░ржорзНржн ржХрж░рзБржи
let openaiClient;

async function initializeServices() {
  const openaiKey = await config.getOpenAIKey();
  openaiClient = new OpenAI({ apiKey: openaiKey });
  console.log('тЬЕ Services initialized with secrets from Key Vault');
}

// рж╕рзНржЯрж╛рж░рзНржЯржЖржкрзЗ ржХрж▓ ржХрж░рзБржи
initializeServices().catch(console.error);

app.post('/chat', async (req, res) => {
  try {
    const completion = await openaiClient.chat.completions.create({
      model: 'gpt-4',
      messages: [{ role: 'user', content: 'Hello!' }]
    });
    
    res.json({
      response: completion.choices[0].message.content,
      authentication: 'Key from Key Vault via Managed Identity'
    });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

app.listen(3000, () => {
  console.log('Secure API with Key Vault integration running');
});
```

5. **ржбрж┐ржкрзНрж▓ржпрж╝ ржПржмржВ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи:**

```bash
azd up

# API ржХрзА ржХрж╛ржЬ ржХрж░рзЗ рждрж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
curl -X POST https://myapp.azurecontainerapps.io/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"Hello AI"}'
```

**тЬЕ рж╕рж╛ржлрж▓рзНржпрзЗрж░ ржорж╛ржиржжржгрзНржб:**
- тЬЕ ржХрзЛржб ржмрж╛ ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓рзЗ ржХрзЛржирзЛ API ржХрзА ржирзЗржЗ
- тЬЕ ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржХрзА ржнрж▓рзНржЯ ржерзЗржХрзЗ ржХрзА ржкрзБржирж░рзБржжрзНржзрж╛рж░ ржХрж░рзЗ
- тЬЕ рждрзГрждрзАржпрж╝ ржкржХрзНрж╖рзЗрж░ API рж╕ржарж┐ржХржнрж╛ржмрзЗ ржХрж╛ржЬ ржХрж░рзЗ
- тЬЕ ржХрзЛржб ржкрж░рж┐ржмрж░рзНрждржи ржЫрж╛ржбрж╝рж╛ржЗ ржХрзА рж░рзЛржЯрзЗржЯ ржХрж░рж╛ ржпрж╛ржпрж╝

**ржПржХржЯрж┐ рж╕рж┐ржХрзНрж░рзЗржЯ рж░рзЛржЯрзЗржЯ ржХрж░рзБржи:**

```bash
# ржХрзА ржнрж▓рзНржЯрзЗ ржЧрзЛржкржирзАржпрж╝рждрж╛ ржЖржкржбрзЗржЯ ржХрж░рзБржи
az keyvault secret set \
  --vault-name $KV_NAME \
  --name "OpenAI-ApiKey" \
  --value "sk-proj-NEW_KEY_HERE"

# ржирждрзБржи ржХрзА ржЧрзНрж░рж╣ржг ржХрж░рждрзЗ ржЕрзНржпрж╛ржкржЯрж┐ ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ ржХрж░рзБржи
az containerapp revision restart \
  --name myapp \
  --resource-group rg-myapp
```

**рж╕ржоржпрж╝**: рзирзл-рзйрзл ржорж┐ржирж┐ржЯ

---

## ржЬрзНржЮрж╛ржи ржпрж╛ржЪрж╛ржЗ

### рзз. ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНржпрж╛ржЯрж╛рж░рзНржи тЬУ

ржЖржкржирж╛рж░ ржмрзЛржЭрж╛ржкржбрж╝рж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи:

- [ ] **ржкрзНрж░рж╢рзНржи рзз**: ржкрзНрж░ржзрж╛ржи рждрж┐ржиржЯрж┐ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНржпрж╛ржЯрж╛рж░рзНржи ржХрзА ржХрзА? 
  - **ржЙрждрзНрждрж░**: ржХрж╛ржирзЗржХрж╢ржи рж╕рзНржЯрзНрж░рж┐ржВ (ржкрзБрж░рж╛ржирзЛ), ржХрзА ржнрж▓рзНржЯ рж░рзЗржлрж╛рж░рзЗржирзНрж╕ (ржоржзрзНржпржмрж░рзНрждрзА), ржорзНржпрж╛ржирзЗржЬ
- [ ] **ржкрзНрж░рж╢рзНржи рзз**: ржХрзАржнрж╛ржмрзЗ Key Vault-ржП RBAC рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░ржмрзЗржи access policies-ржПрж░ ржкрж░рж┐ржмрж░рзНрждрзЗ?
  - **ржЙрждрзНрждрж░**: Bicep-ржП `enableRbacAuthorization: true` рж╕рзЗржЯ ржХрж░рзБржи

- [ ] **ржкрзНрж░рж╢рзНржи рзи**: ржХрзЛржи Azure SDK рж▓рж╛ржЗржмрзНрж░рзЗрж░рж┐ managed identity authentication ржкрж░рж┐ржЪрж╛рж▓ржирж╛ ржХрж░рзЗ?
  - **ржЙрждрзНрждрж░**: `@azure/identity` ржПржмржВ `DefaultAzureCredential` ржХрзНрж▓рж╛рж╕

- [ ] **ржкрзНрж░рж╢рзНржи рзй**: Key Vault рж╕рж┐ржХрзНрж░рзЗржЯ ржХрждржХрзНрж╖ржг ржХрзНржпрж╛рж╢рзЗ ржерж╛ржХрзЗ?
  - **ржЙрждрзНрждрж░**: ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи-ржирж┐рж░рзНржнрж░; ржирж┐ржЬрж╕рзНржм ржХрзНржпрж╛рж╢рж┐ржВ ржХрзМрж╢рж▓ ржкрзНрж░ржпрж╝рзЛржЧ ржХрж░рзБржи

**рж╣рзНржпрж╛ржирзНржбрж╕-ржЕржи ржпрж╛ржЪрж╛ржЗржХрж░ржг:**
```bash
# ржХрзА ржнрж▓рзНржЯ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
az keyvault secret show \
  --vault-name $KV_NAME \
  --name "OpenAI-ApiKey" \
  --query "value"

# RBAC рж╕ржХрзНрж░рж┐ржпрж╝ ржЖржЫрзЗ ржХрж┐ржирж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
az keyvault show \
  --name $KV_NAME \
  --query "properties.enableRbacAuthorization"
# тЬЕ ржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд: рж╕рждрзНржп
```

---

## ржирж┐рж░рж╛ржкрждрзНрждрж╛ рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи

### тЬЕ ржХрж░ржгрзАржпрж╝:

1. **ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ рж╕рж░рзНржмржжрж╛ managed identity ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи**
   ```bicep
   identity: {
     type: 'SystemAssigned'
   }
   ```

2. **рж╕рж░рзНржмржирж┐ржорзНржи-ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ RBAC ржнрзВржорж┐ржХрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи**
   - рж╕ржорзНржнржм рж╣рж▓рзЗ "Reader" ржнрзВржорж┐ржХрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи
   - "Owner" ржмрж╛ "Contributor" ржПржбрж╝рж┐ржпрж╝рзЗ ржЪрж▓рзБржи ржпржжрж┐ ржирж╛ ржПржХрж╛ржирзНржд ржкрзНрж░ржпрж╝рзЛржЬржи рж╣ржпрж╝

3. **рждрзГрждрзАржпрж╝ ржкржХрзНрж╖рзЗрж░ ржХрзА Key Vault-ржП рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи**
   ```javascript
   const apiKey = await secretClient.getSecret('ThirdPartyApiKey');
   ```

4. **ржЕржбрж┐ржЯ рж▓ржЧрж┐ржВ рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи**
   ```bicep
   diagnosticSettings: {
     logs: [{ category: 'AuditEvent', enabled: true }]
   }
   ```

5. **ржбрзЗржн/рж╕рзНржЯрзЗржЬрж┐ржВ/ржкрзНрж░рзЛржб-ржПрж░ ржЬржирзНржп ржнрж┐ржирзНржи ржкрж░рж┐ржЪржпрж╝ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи**
   ```bash
   azd env new dev
   azd env new staging
   azd env new prod
   ```

6. **ржирж┐ржпрж╝ржорж┐ржд рж╕рж┐ржХрзНрж░рзЗржЯ ржШрзЛрж░рж╛ржи**
   - Key Vault рж╕рж┐ржХрзНрж░рзЗржЯрзЗрж░ ржЬржирзНржп ржорзЗржпрж╝рж╛ржж рж╢рзЗрж╖ рж╣ржУржпрж╝рж╛рж░ рждрж╛рж░рж┐ржЦ ржирж┐рж░рзНржзрж╛рж░ржг ржХрж░рзБржи
   - Azure Functions ржжрж┐ржпрж╝рзЗ ржШрзЛрж░рж╛ржирзЛ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи

### тЭМ ржХрж░ржгрзАржпрж╝ ржиржпрж╝:

1. **рж╕рж┐ржХрзНрж░рзЗржЯ ржХржЦржирзЛ рж╣рж╛рж░рзНржбржХрзЛржб ржХрж░ржмрзЗржи ржирж╛**
   ```javascript
   // тЭМ ржЦрж╛рж░рж╛ржк
   const apiKey = "sk-proj-xxxxxxxxxxxxx";
   ```

2. **ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ ржХрж╛ржирзЗржХрж╢ржи рж╕рзНржЯрзНрж░рж┐ржВ ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржмрзЗржи ржирж╛**
   ```javascript
   // тЭМ ржЦрж╛рж░рж╛ржк
   BlobServiceClient.fromConnectionString(process.env.STORAGE_CONNECTION_STRING)
   ```

3. **ржЕрждрж┐рж░рж┐ржХрзНржд ржЕржирзБржорждрж┐ ржкрзНрж░ржжрж╛ржи ржХрж░ржмрзЗржи ржирж╛**
   ```bicep
   // тЭМ BAD - too much access
   roleDefinitionId: 'Owner'
   
   // тЬЕ GOOD - least privilege
   roleDefinitionId: 'Storage Blob Data Reader'
   ```

4. **рж╕рж┐ржХрзНрж░рзЗржЯ рж▓ржЧ ржХрж░ржмрзЗржи ржирж╛**
   ```javascript
   // тЭМ ржЦрж╛рж░рж╛ржк
   console.log('API Key:', apiKey);
   
   // тЬЕ ржнрж╛рж▓рзЛ
   console.log('API Key retrieved successfully');
   ```

5. **ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗрж░ ржкрж░рж┐ржЪржпрж╝ ржмрж┐ржнрж┐ржирзНржи ржкрж░рж┐ржмрзЗрж╢рзЗ рж╢рзЗржпрж╝рж╛рж░ ржХрж░ржмрзЗржи ржирж╛**
   ```bicep
   // тЭМ BAD - same identity for dev and prod
   // тЬЕ GOOD - separate identities per environment
   ```

---

## рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржирзЗрж░ ржирж┐рж░рзНржжрзЗрж╢рж┐ржХрж╛

### рж╕ржорж╕рзНржпрж╛: Azure Storage ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рж╛рж░ рж╕ржоржпрж╝ "Unauthorized"

**рж▓ржХрзНрж╖ржг:**
```
Error: Unauthorized (403)
AuthorizationPermissionMismatch: This request is not authorized to perform this operation
```

**ржирж┐рж░рзНржгржпрж╝:**

```bash
# ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи ржкрж░рж┐ржЪрж╛рж▓рж┐ржд ржкрж░рж┐ржЪржпрж╝ рж╕ржХрзНрж░рж┐ржпрж╝ ржЖржЫрзЗ ржХрж┐ржирж╛
az containerapp show \
  --name myapp \
  --resource-group rg-myapp \
  --query "identity.type"
# тЬЕ ржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд: "SystemAssigned" ржмрж╛ "UserAssigned"

# ржнрзВржорж┐ржХрж╛ ржмрж░рж╛ржжрзНржжржЧрзБрж▓рж┐ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи
PRINCIPAL_ID=$(az containerapp show --name myapp --resource-group rg-myapp --query "identity.principalId" -o tsv)
az role assignment list --assignee $PRINCIPAL_ID

# ржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд: "Storage Blob Data Contributor" ржмрж╛ ржЕржирзБрж░рзВржк ржнрзВржорж┐ржХрж╛ ржжрзЗржЦрждрзЗ рж╣ржмрзЗ
```

**рж╕ржорж╛ржзрж╛ржирж╕ржорзВрж╣:**

1. **рж╕ржарж┐ржХ RBAC ржнрзВржорж┐ржХрж╛ ржкрзНрж░ржжрж╛ржи ржХрж░рзБржи:**
```bash
STORAGE_ID=$(az storage account show --name mystorageaccount --resource-group rg-myapp --query "id" -o tsv)
az role assignment create \
  --assignee $PRINCIPAL_ID \
  --role "Storage Blob Data Contributor" \
  --scope $STORAGE_ID
```

2. **ржкрзНрж░ржЪрж╛рж░ рж╣рждрзЗ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи (рзл-рззрзж ржорж┐ржирж┐ржЯ рж╕ржоржпрж╝ рж▓рж╛ржЧрждрзЗ ржкрж╛рж░рзЗ):**
```bash
# ржнрзВржорж┐ржХрж╛ ржмрж░рж╛ржжрзНржжрзЗрж░ рж╕рзНржерж┐рждрж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
az role assignment list --assignee $PRINCIPAL_ID --scope $STORAGE_ID
```

3. **ржЕрзНржпрж╛ржкрзНрж▓рж┐ржХрзЗрж╢ржи ржХрзЛржб рж╕ржарж┐ржХ credential ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрзЗ ржХрж┐ржирж╛ ржпрж╛ржЪрж╛ржЗ ржХрж░рзБржи:**
```javascript
// ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи ржпрзЗ ржЖржкржирж┐ DefaultAzureCredential ржмрзНржпржмрж╣рж╛рж░ ржХрж░ржЫрзЗржи
const credential = new DefaultAzureCredential();
```

---

### рж╕ржорж╕рзНржпрж╛: Key Vault ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржЕрж╕рзНржмрзАржХрзГржд

**рж▓ржХрзНрж╖ржг:**
```
Error: Forbidden (403)
The user, group or application does not have secrets get permission
```

**ржирж┐рж░рзНржгржпрж╝:**

```bash
# ржХрзА ржнрж▓рзНржЯ RBAC рж╕ржХрзНрж░рж┐ржпрж╝ ржЖржЫрзЗ ржХрж┐ржирж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
az keyvault show \
  --name $KV_NAME \
  --query "properties.enableRbacAuthorization"
# тЬЕ ржкрзНрж░рждрзНржпрж╛рж╢рж┐ржд: рж╕рждрзНржп

# ржнрзВржорж┐ржХрж╛ ржмрж░рж╛ржжрзНржжржЧрзБрж▓рж┐ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
az role assignment list \
  --assignee $PRINCIPAL_ID \
  --scope /subscriptions/{sub-id}/resourceGroups/rg-myapp/providers/Microsoft.KeyVault/vaults/$KV_NAME
```

**рж╕ржорж╛ржзрж╛ржирж╕ржорзВрж╣:**

1. **Key Vault-ржП RBAC рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи:**
```bash
az keyvault update \
  --name $KV_NAME \
  --enable-rbac-authorization true
```

2. **Key Vault Secrets User ржнрзВржорж┐ржХрж╛ ржкрзНрж░ржжрж╛ржи ржХрж░рзБржи:**
```bash
KV_ID=$(az keyvault show --name $KV_NAME --query "id" -o tsv)
az role assignment create \
  --assignee $PRINCIPAL_ID \
  --role "Key Vault Secrets User" \
  --scope $KV_ID
```

---

### рж╕ржорж╕рзНржпрж╛: DefaultAzureCredential рж╕рзНржерж╛ржирзАржпрж╝ржнрж╛ржмрзЗ ржмрзНржпрж░рзНрже рж╣ржЪрзНржЫрзЗ

**рж▓ржХрзНрж╖ржг:**
```
Error: DefaultAzureCredential failed to retrieve a token
CredentialUnavailableError: No credential available
```

**ржирж┐рж░рзНржгржпрж╝:**

```bash
# ржЖржкржирж┐ рж▓ржЧ ржЗржи ржХрж░рзЗржЫрзЗржи ржХрж┐ржирж╛ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
az account show

# Azure CLI ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
az ad signed-in-user show
```

**рж╕ржорж╛ржзрж╛ржирж╕ржорзВрж╣:**

1. **Azure CLI-рждрзЗ рж▓ржЧржЗржи ржХрж░рзБржи:**
```bash
az login
```

2. **Azure рж╕рж╛ржмрж╕рзНржХрзНрж░рж┐ржкрж╢ржи рж╕рзЗржЯ ржХрж░рзБржи:**
```bash
az account set --subscription "Your Subscription Name"
```

3. **рж╕рзНржерж╛ржирзАржпрж╝ ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯрзЗрж░ ржЬржирзНржп ржкрж░рж┐ржмрзЗрж╢ ржнрзЗрж░рж┐ржпрж╝рзЗржмрж▓ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи:**
```bash
export AZURE_TENANT_ID="your-tenant-id"
export AZURE_CLIENT_ID="your-client-id"
export AZURE_CLIENT_SECRET="your-client-secret"
```

4. **ржЕржержмрж╛ рж╕рзНржерж╛ржирзАржпрж╝ржнрж╛ржмрзЗ ржнрж┐ржирзНржи credential ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи:**
```javascript
const { DefaultAzureCredential, AzureCliCredential } = require('@azure/identity');

// рж╕рзНржерж╛ржирзАржпрж╝ ржбрзЗржнрзЗрж▓ржкржорзЗржирзНржЯрзЗрж░ ржЬржирзНржп AzureCliCredential ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи
const credential = process.env.NODE_ENV === 'production' 
  ? new DefaultAzureCredential()
  : new AzureCliCredential();
```

---

### рж╕ржорж╕рзНржпрж╛: ржнрзВржорж┐ржХрж╛ ржЕрзНржпрж╛рж╕рж╛ржЗржиржорзЗржирзНржЯ ржкрзНрж░ржЪрж╛рж░рзЗ ржЕржирзЗржХ рж╕ржоржпрж╝ ржирж┐ржЪрзНржЫрзЗ

**рж▓ржХрзНрж╖ржг:**
- ржнрзВржорж┐ржХрж╛ рж╕ржлрж▓ржнрж╛ржмрзЗ ржЕрзНржпрж╛рж╕рж╛ржЗржи ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗ
- ржПржЦржиржУ рзкрзжрзй рждрзНрж░рзБржЯрж┐ ржжрзЗржЦрж╛ржЪрзНржЫрзЗ
- ржорж╛ржЭрзЗ ржорж╛ржЭрзЗ ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ рж╣ржЪрзНржЫрзЗ (ржХржЦржирзЛ ржХрж╛ржЬ ржХрж░ржЫрзЗ, ржХржЦржирзЛ ржХрж░ржЫрзЗ ржирж╛)

**ржмрзНржпрж╛ржЦрзНржпрж╛:**
Azure RBAC ржкрж░рж┐ржмрж░рзНрждржиржЧрзБрж▓рж┐ ржмрж┐рж╢рзНржмржмрзНржпрж╛ржкрзА ржкрзНрж░ржЪрж╛рж░рзЗ рзл-рззрзж ржорж┐ржирж┐ржЯ рж╕ржоржпрж╝ ржирж┐рждрзЗ ржкрж╛рж░рзЗред

**рж╕ржорж╛ржзрж╛ржи:**

```bash
# ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи ржПржмржВ ржкрзБржирж░рж╛ржпрж╝ ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рзБржи
echo "Waiting for RBAC propagation..."
sleep 300  # рзл ржорж┐ржирж┐ржЯ ржЕржкрзЗржХрзНрж╖рж╛ ржХрж░рзБржи

# ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржкрж░рзАржХрзНрж╖рж╛ ржХрж░рзБржи
curl https://myapp.azurecontainerapps.io/upload

# ржпржжрж┐ ржПржЦржиржУ ржмрзНржпрж░рзНрже рж╣ржпрж╝, ржЕрзНржпрж╛ржкржЯрж┐ ржкрзБржирж░рж╛ржпрж╝ ржЪрж╛рж▓рзБ ржХрж░рзБржи
az containerapp revision restart \
  --name myapp \
  --resource-group rg-myapp
```

---

## ржЦрж░ржЪ ржмрж┐ржмрзЗржЪржирж╛

### Managed Identity ржЦрж░ржЪ

| рж░рж┐рж╕рзЛрж░рзНрж╕ | ржЦрж░ржЪ |
|----------|------|
| **Managed Identity** | ЁЯЖУ **ржлрзНрж░рж┐** - ржХрзЛржирзЛ ржЪрж╛рж░рзНржЬ ржирзЗржЗ |
| **RBAC ржнрзВржорж┐ржХрж╛ ржЕрзНржпрж╛рж╕рж╛ржЗржиржорзЗржирзНржЯ** | ЁЯЖУ **ржлрзНрж░рж┐** - ржХрзЛржирзЛ ржЪрж╛рж░рзНржЬ ржирзЗржЗ |
| **Azure AD ржЯрзЛржХрзЗржи ржЕржирзБрж░рзЛржз** | ЁЯЖУ **ржлрзНрж░рж┐** - ржЕржирзНрждрж░рзНржнрзБржХрзНржд |
| **Key Vault ржЕржкрж╛рж░рзЗрж╢ржи** | $0.03 ржкрзНрж░рждрж┐ рззрзж,рзжрзжрзж ржЕржкрж╛рж░рзЗрж╢ржи |
| **Key Vault рж╕рзНржЯрзЛрж░рзЗржЬ** | $0.024 ржкрзНрж░рждрж┐ рж╕рж┐ржХрзНрж░рзЗржЯ ржкрзНрж░рждрж┐ ржорж╛рж╕рзЗ |

**Managed identity ржЕрж░рзНрже рж╕рж╛рж╢рзНрж░ржпрж╝ ржХрж░рзЗ:**
- тЬЕ рж╕рзЗржмрж╛-ржерзЗржХрзЗ-рж╕рзЗржмрж╛ ржкрзНрж░ржорж╛ржгрзАржХрж░ржгрзЗрж░ ржЬржирзНржп Key Vault ржЕржкрж╛рж░рзЗрж╢ржи ржмрж╛ржж ржжрзЗржпрж╝
- тЬЕ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржШржЯржирж╛рж░ рж╕ржВржЦрзНржпрж╛ ржХржорж╛ржпрж╝ (ржХрзЛржирзЛ ржлрж╛ржБрж╕ рж╣ржУржпрж╝рж╛ credential ржирзЗржЗ)
- тЬЕ ржкрж░рж┐ржЪрж╛рж▓ржи ржмрзНржпржпрж╝ ржХржорж╛ржпрж╝ (ржХрзЛржирзЛ ржорзНржпрж╛ржирзБржпрж╝рж╛рж▓ ржШрзЛрж░рж╛ржирзЛ ржирзЗржЗ)

**ржЙржжрж╛рж╣рж░ржг ржЦрж░ржЪ рждрзБрж▓ржирж╛ (ржорж╛рж╕рж┐ржХ):**

| ржкрж░рж┐рж╕рзНржерж┐рждрж┐ | ржХрж╛ржирзЗржХрж╢ржи рж╕рзНржЯрзНрж░рж┐ржВ | Managed Identity | рж╕рж╛рж╢рзНрж░ржпрж╝ |
|----------|-------------------|-----------------|---------|
| ржЫрзЛржЯ ржЕрзНржпрж╛ржк (рззM ржЕржирзБрж░рзЛржз) | ~$50 (Key Vault + ржЕржкрж╛рж░рзЗрж╢ржи) | ~$0 | $50/ржорж╛рж╕ |
| ржорж╛ржЭрж╛рж░рж┐ ржЕрзНржпрж╛ржк (рззрзжM ржЕржирзБрж░рзЛржз) | ~$200 | ~$0 | $200/ржорж╛рж╕ |
| ржмржбрж╝ ржЕрзНржпрж╛ржк (рззрзжрзжM ржЕржирзБрж░рзЛржз) | ~$1,500 | ~$0 | $1,500/ржорж╛рж╕ |

---

## ржЖрж░ржУ ржЬрж╛ржирзБржи

### ржЕржлрж┐рж╕рж┐ржпрж╝рж╛рж▓ ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи
- [Azure Managed Identity](https://learn.microsoft.com/entra/identity/managed-identities-azure-resources/overview)
- [Azure RBAC](https://learn.microsoft.com/azure/role-based-access-control/overview)
- [Azure Key Vault](https://learn.microsoft.com/azure/key-vault/general/overview)
- [DefaultAzureCredential](https://learn.microsoft.com/dotnet/api/azure.identity.defaultazurecredential)

### SDK ржбржХрзБржорзЗржирзНржЯрзЗрж╢ржи
- [@azure/identity (Node.js)](https://www.npmjs.com/package/@azure/identity)
- [Azure.Identity (C#)](https://www.nuget.org/packages/Azure.Identity/)
- [azure-identity (Python)](https://pypi.org/project/azure-identity/)

### ржПржЗ ржХрзЛрж░рзНрж╕рзЗ ржкрж░ржмрж░рзНрждрзА ржзрж╛ржк
- тЖР ржкрзВрж░рзНржмржмрж░рзНрждрзА: [Configuration Management](configuration.md)
- тЖТ ржкрж░ржмрж░рзНрждрзА: [ржкрзНрж░ржержо ржкрзНрж░ржХрж▓рзНржк](first-project.md)
- ЁЯПа [ржХрзЛрж░рзНрж╕ рж╣рзЛржо](../../README.md)

### рж╕ржорзНржкрж░рзНржХрж┐ржд ржЙржжрж╛рж╣рж░ржг
- [Azure OpenAI Chat Example](../../../../examples/azure-openai-chat) - Azure OpenAI-ржПрж░ ржЬржирзНржп managed identity ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ
- [Microservices Example](../../../../examples/microservices) - ржмрж╣рзБ-рж╕рзЗржмрж╛ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНржпрж╛ржЯрж╛рж░рзНржи

---

## рж╕рж╛рж░рж╕ржВржХрзНрж╖рзЗржк

**ржЖржкржирж┐ рж╢рж┐ржЦрзЗржЫрзЗржи:**
- тЬЕ рждрж┐ржиржЯрж┐ ржкрзНрж░ржорж╛ржгрзАржХрж░ржг ржкрзНржпрж╛ржЯрж╛рж░рзНржи (ржХрж╛ржирзЗржХрж╢ржи рж╕рзНржЯрзНрж░рж┐ржВ, Key Vault, managed identity)
- тЬЕ AZD-рждрзЗ managed identity рж╕ржХрзНрж░рж┐ржпрж╝ ржПржмржВ ржХржиржлрж┐ржЧрж╛рж░ ржХрж░рж╛рж░ ржкржжрзНржзрждрж┐
- тЬЕ Azure рж╕рзЗржмрж╛рж░ ржЬржирзНржп RBAC ржнрзВржорж┐ржХрж╛ ржЕрзНржпрж╛рж╕рж╛ржЗржиржорзЗржирзНржЯ
- тЬЕ рждрзГрждрзАржпрж╝ ржкржХрзНрж╖рзЗрж░ рж╕рж┐ржХрзНрж░рзЗржЯрзЗрж░ ржЬржирзНржп Key Vault ржЗржирзНржЯрж┐ржЧрзНрж░рзЗрж╢ржи
- тЬЕ User-assigned ржПржмржВ system-assigned ржкрж░рж┐ржЪржпрж╝рзЗрж░ ржоржзрзНржпрзЗ ржкрж╛рж░рзНржержХрзНржп
- тЬЕ ржирж┐рж░рж╛ржкрждрзНрждрж╛ рж╕рзЗрж░рж╛ ржЕржирзБрж╢рзАрж▓ржи ржПржмржВ рж╕ржорж╕рзНржпрж╛ рж╕ржорж╛ржзрж╛ржи

**ржорзВрж▓ ржмрж┐рж╖ржпрж╝:**
1. **ржкрзНрж░рзЛржбрж╛ржХрж╢ржирзЗ рж╕рж░рзНржмржжрж╛ managed identity ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи** - ржХрзЛржирзЛ рж╕рж┐ржХрзНрж░рзЗржЯ ржирзЗржЗ, рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ ржШрзЛрж░рж╛ржирзЛ
2. **рж╕рж░рзНржмржирж┐ржорзНржи-ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ RBAC ржнрзВржорж┐ржХрж╛ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи** - рж╢рзБржзрзБржорж╛рждрзНрж░ ржкрзНрж░ржпрж╝рзЛржЬржирзАржпрж╝ ржЕржирзБржорждрж┐ ржкрзНрж░ржжрж╛ржи ржХрж░рзБржи
3. **рждрзГрждрзАржпрж╝ ржкржХрзНрж╖рзЗрж░ ржХрзА Key Vault-ржП рж╕ржВрж░ржХрзНрж╖ржг ржХрж░рзБржи** - ржХрзЗржирзНржжрзНрж░рзАржпрж╝ рж╕рж┐ржХрзНрж░рзЗржЯ ржмрзНржпржмрж╕рзНржерж╛ржкржирж╛
4. **ржкрзНрж░рждрж┐ржЯрж┐ ржкрж░рж┐ржмрзЗрж╢рзЗрж░ ржЬржирзНржп ржЖрж▓рж╛ржжрж╛ ржкрж░рж┐ржЪржпрж╝ ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзБржи** - ржбрзЗржн, рж╕рзНржЯрзЗржЬрж┐ржВ, ржкрзНрж░рзЛржб ржЖрж▓рж╛ржжрж╛ рж░рж╛ржЦрзБржи
5. **ржЕржбрж┐ржЯ рж▓ржЧрж┐ржВ рж╕ржХрзНрж░рж┐ржпрж╝ ржХрж░рзБржи** - ржХрзЗ ржХрзА ржЕрзНржпрж╛ржХрзНрж╕рзЗрж╕ ржХрж░рзЗржЫрзЗ рждрж╛ ржЯрзНрж░рзНржпрж╛ржХ ржХрж░рзБржи

**ржкрж░ржмрж░рзНрждрзА ржзрж╛ржк:**
1. ржЙржкрж░рзЗрж░ ржмрзНржпржмрж╣рж╛рж░рж┐ржХ ржЕржирзБрж╢рзАрж▓ржи рж╕ржорзНржкржирзНржи ржХрж░рзБржи
2. ржПржХржЯрж┐ ржмрж┐ржжрзНржпржорж╛ржи ржЕрзНржпрж╛ржк ржХрж╛ржирзЗржХрж╢ржи рж╕рзНржЯрзНрж░рж┐ржВ ржерзЗржХрзЗ managed identity-рждрзЗ рж╕рзНржерж╛ржирж╛ржирзНрждрж░ ржХрж░рзБржи
3. ржкрзНрж░ржержо AZD ржкрзНрж░ржХрж▓рзНржк рждрзИрж░рж┐ ржХрж░рзБржи ржПржмржВ ржкрзНрж░ржержо ржжрж┐ржи ржерзЗржХрзЗржЗ ржирж┐рж░рж╛ржкрждрзНрждрж╛ ржирж┐рж╢рзНржЪрж┐ржд ржХрж░рзБржи: [ржкрзНрж░ржержо ржкрзНрж░ржХрж▓рзНржк](first-project.md)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**ржЕрж╕рзНржмрзАржХрзГрждрж┐**:  
ржПржЗ ржиржерж┐ржЯрж┐ AI ржЕржирзБржмрж╛ржж ржкрж░рж┐рж╖рзЗржмрж╛ [Co-op Translator](https://github.com/Azure/co-op-translator) ржмрзНржпржмрж╣рж╛рж░ ржХрж░рзЗ ржЕржирзБржмрж╛ржж ржХрж░рж╛ рж╣ржпрж╝рзЗржЫрзЗред ржЖржорж░рж╛ ржпржерж╛рж╕рж╛ржзрзНржп рж╕ржарж┐ржХрждрж╛рж░ ржЬржирзНржп ржЪрзЗрж╖рзНржЯрж╛ ржХрж░рж┐, рждржмрзЗ ржЕржирзБржЧрзНрж░рж╣ ржХрж░рзЗ ржоржирзЗ рж░рж╛ржЦржмрзЗржи ржпрзЗ рж╕рзНржмржпрж╝ржВржХрзНрж░рж┐ржпрж╝ ржЕржирзБржмрж╛ржжрзЗ рждрзНрж░рзБржЯрж┐ ржмрж╛ ржЕрж╕ржЩрзНржЧрждрж┐ ржерж╛ржХрждрзЗ ржкрж╛рж░рзЗред ржорзВрж▓ ржнрж╛рж╖рж╛ржпрж╝ ржерж╛ржХрж╛ ржиржерж┐ржЯрж┐ржХрзЗ ржкрзНрж░рж╛ржорж╛ржгрж┐ржХ ржЙрзОрж╕ рж╣рж┐рж╕рзЗржмрзЗ ржмрж┐ржмрзЗржЪржирж╛ ржХрж░рж╛ ржЙржЪрж┐рждред ржЧрзБрж░рзБрждрзНржмржкрзВрж░рзНржг рждржерзНржпрзЗрж░ ржЬржирзНржп, ржкрзЗрж╢рж╛ржжрж╛рж░ ржорж╛ржиржм ржЕржирзБржмрж╛ржж рж╕рзБржкрж╛рж░рж┐рж╢ ржХрж░рж╛ рж╣ржпрж╝ред ржПржЗ ржЕржирзБржмрж╛ржж ржмрзНржпржмрж╣рж╛рж░рзЗрж░ ржлрж▓рзЗ ржХрзЛржирзЛ ржнрзБрж▓ ржмрзЛржЭрж╛ржмрзБржЭрж┐ ржмрж╛ ржнрзБрж▓ ржмрзНржпрж╛ржЦрзНржпрж╛ рж╣рж▓рзЗ ржЖржорж░рж╛ ржжрж╛ржпрж╝ржмржжрзНржз ржерж╛ржХржм ржирж╛ред
<!-- CO-OP TRANSLATOR DISCLAIMER END -->