# Deploying a Microsoft SQL Database and Web App with AZD

โฑ๏ธ **ุฒูุงู ุชูุฑุจ**: 20-30 ุฏููู | ๐ฐ **ูุฒูู ุชุฎูู**: ~$15-25/ูุงู | โญ **ูพฺุฏฺฏ**: ูุชูุณุท

ุงู ูุซุงู ฺฉุงูู ู ุนูู ูุดุงู ูโุฏูุฏ ฺฺฏููู ุงุฒ [Azure Developer CLI (azd)](https://learn.microsoft.com/azure/developer/azure-developer-cli/) ุจุฑุง ุงุณุชูุฑุงุฑ ฺฉ ุจุฑูุงููู ูุจ Python Flask ููุฑุงู ุจุง ฺฉ ูพุงฺฏุงูโุฏุงุฏูู Microsoft SQL ุฏุฑ Azure ุงุณุชูุงุฏู ฺฉูุฏ. ุชูุงู ฺฉุฏูุง ฺฏูุฌุงูุฏู ู ุชุณุช ุดุฏูโุงูุฏ โ ูุงุฒ ุจู ูุงุจุณุชฺฏโูุง ุฎุงุฑุฌ ูุณุช.

## ุขูฺู ุงุฏ ุฎูุงูุฏ ฺฏุฑูุช

ุจุง ุชฺฉูู ุงู ูุซุงูุ ุดูุง:
- ุงุณุชูุฑุงุฑ ฺฉ ุจุฑูุงููู ฺูุฏูุงู (ูุจ ุงูพ + ูพุงฺฏุงูโุฏุงุฏู) ุจุง ุงุณุชูุงุฏู ุงุฒ ุฒุฑุณุงุฎุช ุจูโุนููุงูโฺฉุฏ
- ูพฺฉุฑุจูุฏ ุงุชุตุงู ุงูู ุจู ูพุงฺฏุงูโุฏุงุฏู ุจุฏูู ูุฑุงุฑ ุฏุงุฏู ุฑุงุฒูุง ุฏุฑ ฺฉุฏ
- ูพุงุด ุณูุงูุช ุจุฑูุงูู ุจุง Application Insights
- ูุฏุฑุช ููุงุจุน Azure ุจูโุตูุฑุช ฺฉุงุฑุขูุฏ ุจุง AZD CLI
- ูพุฑู ุงุฒ ุจูุชุฑู ุดููโูุง Azure ุจุฑุง ุงููุชุ ุจูููโุณุงุฒ ูุฒูู ู ูุงุจูุช ูุดุงูุฏู

## ููุง ฺฉู ุณูุงุฑู
- **ูุจ ุงูพ**: API REST ุจุง Python Flask ู ุงุชุตุงู ุจู ูพุงฺฏุงูโุฏุงุฏู
- **ูพุงฺฏุงูโุฏุงุฏู**: Azure SQL Database ุจุง ุฏุงุฏูู ููููู
- **ุฒุฑุณุงุฎุช**: ูุฑุงููโุดุฏู ุจุง Bicep (ุงูฺฏููุง ูุงฺููุงุฑ ู ูุงุจู ุงุณุชูุงุฏู ูุฌุฏุฏ)
- **ุงุณุชูุฑุงุฑ**: ฺฉุงููุงู ุฎูุฏฺฉุงุฑ ุจุง ุฏุณุชูุฑุงุช `azd`
- **ูพุงุด**: Application Insights ุจุฑุง ูุงฺฏโูุง ู ุชููโูุชุฑ

## ูพุดโูุงุฒูุง

### ุงุจุฒุงุฑูุง ููุฑุฏ ูุงุฒ

ูุจู ุงุฒ ุดุฑูุนุ ุจุฑุฑุณ ฺฉูุฏ ฺฉู ุงู ุงุจุฒุงุฑูุง ูุตุจ ุดุฏู ุจุงุดูุฏ:

1. **[Azure CLI](https://learn.microsoft.com/cli/azure/install-azure-cli)** (ูุณุฎูู 2.50.0 ุง ุจุงูุงุชุฑ)
   ```sh
   az --version
   # ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ: azure-cli ูุณุฎู 2.50.0 ุง ุจุงูุงุชุฑ
   ```

2. **[Azure Developer CLI (azd)](https://learn.microsoft.com/azure/developer/azure-developer-cli/install-azd)** (ูุณุฎูู 1.0.0 ุง ุจุงูุงุชุฑ)
   ```sh
   azd version
   # ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ: ูุณุฎูโ azd 1.0.0 ุง ุจุงูุงุชุฑ
   ```

3. **[Python 3.8+](https://www.python.org/downloads/)** (ุจุฑุง ุชูุณุนูู ูุญู)
   ```sh
   python --version
   # ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ: ูพุงุชูู ณูซธ ุง ุจุงูุงุชุฑ
   ```

4. **[Docker](https://www.docker.com/get-started)** (ุงุฎุชุงุฑุ ุจุฑุง ุชูุณุนูู ูุญู ุฏุฑ ฺฉุงูุชูุฑ)
   ```sh
   docker --version
   # ุฎุฑูุฌ ููุฑุฏ ุงูุชุธุงุฑ: ูุณุฎู ุฏุงฺฉุฑ ฒฐูซฑฐ ุง ุจุงูุงุชุฑ
   ```

### ุงูุฒุงูุงุช Azure

- ฺฉ **ุงุดุชุฑุงฺฉ Azure** ูุนุงู ([ุงุฌุงุฏ ฺฉ ุญุณุงุจ ุฑุงฺฏุงู](https://azure.microsoft.com/free/))
- ุฏุณุชุฑุณ ุจุฑุง ุงุฌุงุฏ ููุงุจุน ุฏุฑ ุงุดุชุฑุงฺฉ ุดูุง
- ููุด **Owner** ุง **Contributor** ุฑู ุงุดุชุฑุงฺฉ ุง ฺฏุฑูู ููุงุจุน

### ูพุดโูุงุฒูุง ุฏุงูุด

ุงู ฺฉ ูุซุงู ุฏุฑ ุณุทุญ **ูุชูุณุท** ุงุณุช. ุจุงุฏ ุจุง ููุงุฑุฏ ุฒุฑ ุขุดูุง ุจุงุดุฏ:
- ุนููุงุช ุงุจุชุฏุง ุฎุท ูุฑูุงู
- ููุงูู ูพุงูู ุงุจุฑ (ููุงุจุนุ ฺฏุฑููโูุง ููุงุจุน)
- ุฏุฑฺฉ ูพุงูโุง ุงุฒ ุจุฑูุงููโูุง ูุจ ู ูพุงฺฏุงูโุฏุงุฏูโูุง

**ุชุงุฒู ุจุง AZD ุขุดูุง ุดุฏุฏุ** ุงุจุชุฏุง ุฑุงูููุง [Getting Started](../../docs/chapter-01-foundation/azd-basics.md) ุฑุง ุจุจูุฏ.

## ูุนูุงุฑ

ุงู ูุซุงู ฺฉ ูุนูุงุฑ ุฏู ูุงู ุดุงูู ุจุฑูุงููู ูุจ ู ูพุงฺฏุงูโุฏุงุฏู SQL ุฑุง ูุณุชูุฑ ูโฺฉูุฏ:

```
โโโโโโโโโโโโโโโโโโโ        โโโโโโโโโโโโโโโโโโโโโโโโ
โ  User Browser   โโโโโโโโโบโ   Azure Web App      โ
โโโโโโโโโโโโโโโโโโโ        โ   (Flask API)        โ
                           โ   - /health          โ
                           โ   - /products        โ
                           โโโโโโโโโโโโฌโโโโโโโโโโโโ
                                      โ
                                      โ Secure Connection
                                      โ (Encrypted)
                                      โ
                           โโโโโโโโโโโโผโโโโโโโโโโโโ
                           โ Azure SQL Database   โ
                           โ   - Products table   โ
                           โ   - Sample data      โ
                           โโโโโโโโโโโโโโโโโโโโโโโโ
```

**ุงุณุชูุฑุงุฑ ููุงุจุน:**
- **Resource Group**: ูุญูุธูโุง ุจุฑุง ูููู ููุงุจุน
- **App Service Plan**: ูุฒุจุงู ูุจุชู ุจุฑ ูููฺฉุณ (ุฑุฏูู B1 ุจุฑุง ุจูููโุณุงุฒ ูุฒูู)
- **Web App**: runtime ูพุงุชูู 3.11 ุจุง ุจุฑูุงููู Flask
- **SQL Server**: ุณุฑูุฑ ูุฏุฑุชโุดุฏูู ูพุงฺฏุงูโุฏุงุฏู ุจุง ุญุฏุงูู TLS 1.2
- **SQL Database**: ุฑุฏูู Basic (2GBุ ููุงุณุจ ุจุฑุง ุชูุณุนู/ุชุณุช)
- **Application Insights**: ูพุงุด ู ูุงฺฏโฺฏุฑ
- **Log Analytics Workspace**: ุฐุฎุฑูโุณุงุฒ ูุชูุฑฺฉุฒ ูุงฺฏโูุง

**ุชุดุจู**: ุชุตูุฑ ฺฉูุฏ ุงู ูุซู ฺฉ ุฑุณุชูุฑุงู (ูุจ ุงูพ) ุจุง ฺฉ ูุฑุฒุฑ ุจุฒุฑฺฏ (ูพุงฺฏุงูโุฏุงุฏู) ุงุณุช. ูุดุชุฑุงู ุงุฒ ููู ุณูุงุฑุด ูโุฏููุฏ (ุงูุฏูพููุชโูุง API)ุ ู ุขุดูพุฒุฎุงูู (ุงูพ Flask) ููุงุฏ (ุฏุงุฏูโูุง) ุฑุง ุงุฒ ูุฑุฒุฑ ุจุฑูโุฏุงุฑุฏ. ูุฏุฑ ุฑุณุชูุฑุงู (Application Insights) ูููู ุงุชูุงูุงุช ุฑุง ุฑุฏุงุจ ูโฺฉูุฏ.

## ุณุงุฎุชุงุฑ ูพูุดูโูุง

ุชูุงู ูุงูโูุง ุฏุฑ ุงู ูุซุงู ฺฏูุฌุงูุฏู ุดุฏูโุงูุฏ โ ูุงุฒ ุจู ูุงุจุณุชฺฏโูุง ุฎุงุฑุฌ ูุณุช:

```
examples/database-app/
โ
โโโ README.md                    # This file
โโโ azure.yaml                   # AZD configuration file
โโโ .env.sample                  # Sample environment variables
โโโ .gitignore                   # Git ignore patterns
โ
โโโ infra/                       # Infrastructure as Code (Bicep)
โ   โโโ main.bicep              # Main orchestration template
โ   โโโ abbreviations.json      # Azure naming conventions
โ   โโโ resources/              # Modular resource templates
โ       โโโ sql-server.bicep    # SQL Server configuration
โ       โโโ sql-database.bicep  # Database configuration
โ       โโโ app-service-plan.bicep  # Hosting plan
โ       โโโ app-insights.bicep  # Monitoring setup
โ       โโโ web-app.bicep       # Web application
โ
โโโ src/
    โโโ web/                    # Application source code
        โโโ app.py              # Flask REST API
        โโโ requirements.txt    # Python dependencies
        โโโ Dockerfile          # Container definition
```

**ูุฑ ูุงู ฺู ฺฉุงุฑ ุงูุฌุงู ูโุฏูุฏ:**
- **azure.yaml**: ุจู AZD ูโฺฏูุฏ ฺู ฺุฒ ุฑุง ูุณุชูุฑ ฺฉูุฏ ู ฺฉุฌุง
- **infra/main.bicep**: ููุงููฺฏโฺฉููุฏูู ุชูุงู ููุงุจุน Azure
- **infra/resources/*.bicep**: ุชุนุฑูโูุง ุฌุฏุงฺฏุงููู ููุงุจุน (ูุงฺููุงุฑ ุจุฑุง ุงุณุชูุงุฏูู ูุฌุฏุฏ)
- **src/web/app.py**: ุจุฑูุงููู Flask ุจุง ููุทู ูพุงฺฏุงูโุฏุงุฏู
- **requirements.txt**: ูุงุจุณุชฺฏโูุง ูพฺฉุฌ ูพุงุชูู
- **Dockerfile**: ุฏุณุชูุฑุงูุนููโูุง ฺฉุงูุชูุฑ ุดุฏู ุจุฑุง ุงุณุชูุฑุงุฑ

## ุดุฑูุน ุณุฑุน (ูุฏูโุจูโูุฏู)

### ฺฏุงู 1: ฺฉููู ู ูุฑูุฏ ุจู ูพูุดู

```sh
git clone https://github.com/microsoft/AZD-for-beginners.git
cd AZD-for-beginners/examples/database-app
```

**โ ุจุฑุฑุณ ููููุช**: ุชุฃุฏ ฺฉูุฏ `azure.yaml` ู ูพูุดูู `infra/` ุฑุง ูโุจูุฏ:
```sh
ls
# ุงูุชุธุงุฑ ูโุฑูุฏ: README.md, azure.yaml, infra/, src/
```

### ฺฏุงู 2: ุงุญุฑุงุฒ ููุช ุจุง Azure

```sh
azd auth login
```

ุงู ูุฑูุฑฺฏุฑ ุดูุง ุฑุง ุจุฑุง ุงุญุฑุงุฒ ููุช ุฏุฑ Azure ุจุงุฒ ูโฺฉูุฏ. ุจุง ุงุทูุงุนุงุช ุญุณุงุจ Azure ุฎูุฏ ูุงุฑุฏ ุดูุฏ.

**โ ุจุฑุฑุณ ููููุช**: ุดูุง ุจุงุฏ ููุงุฑุฏ ุฒุฑ ุฑุง ุจุจูุฏ:
```
Logged in to Azure.
```

### ฺฏุงู 3: ููุฏุงุฑุฏู ุงูููู ูุญุท

```sh
azd init
```

**ฺู ุงุชูุงู ูโุงูุชุฏ**: AZD ฺฉ ูพฺฉุฑุจูุฏ ูุญู ุจุฑุง ุงุณุชูุฑุงุฑ ุดูุง ุงุฌุงุฏ ูโฺฉูุฏ.

**ูพุฑุณุดโูุง ฺฉู ูโุจูุฏ**:
- **Environment name**: ฺฉ ูุงู ฺฉูุชุงู ูุงุฑุฏ ฺฉูุฏ (ูุซูุงู `dev`, `myapp`)
- **Azure subscription**: ุงุดุชุฑุงฺฉ ุฎูุฏ ุฑุง ุงุฒ ููุฑุณุช ุงูุชุฎุงุจ ฺฉูุฏ
- **Azure location**: ฺฉ ููุทูู ุงูุชุฎุงุจ ฺฉูุฏ (ูุซูุงู `eastus`, `westeurope`)

**โ ุจุฑุฑุณ ููููุช**: ุดูุง ุจุงุฏ ููุงุฑุฏ ุฒุฑ ุฑุง ุจุจูุฏ:
```
SUCCESS: New project initialized!
```

### ฺฏุงู 4: ูุฑุงููโุณุงุฒ ููุงุจุน Azure

```sh
azd provision
```

**ฺู ุงุชูุงู ูโุงูุชุฏ**: AZD ุชูุงู ุฒุฑุณุงุฎุช ุฑุง ูุณุชูุฑ ูโฺฉูุฏ (ต-ธ ุฏููู ุทูู ูโฺฉุดุฏ):
1. ุงุฌุงุฏ ฺฏุฑูู ููุงุจุน
2. ุงุฌุงุฏ SQL Server ู Database
3. ุงุฌุงุฏ App Service Plan
4. ุงุฌุงุฏ Web App
5. ุงุฌุงุฏ Application Insights
6. ูพฺฉุฑุจูุฏ ุดุจฺฉู ู ุงููุช

**ุงุฒ ุดูุง ุฎูุงุณุชู ุฎูุงูุฏ ุดุฏ**:
- **SQL admin username**: ฺฉ ูุงู ฺฉุงุฑุจุฑ ูุงุฑุฏ ฺฉูุฏ (ูุซูุงู `sqladmin`)
- **SQL admin password**: ฺฉ ุฑูุฒ ูู ูุงุฑุฏ ฺฉูุฏ (ุงู ุฑุง ุฐุฎุฑู ฺฉูุฏ!)

**โ ุจุฑุฑุณ ููููุช**: ุดูุง ุจุงุฏ ููุงุฑุฏ ุฒุฑ ุฑุง ุจุจูุฏ:
```
SUCCESS: Your application was provisioned in Azure in X minutes Y seconds.
You can view the resources created under the resource group rg-<env-name> in Azure Portal:
https://portal.azure.com/#@/resource/subscriptions/.../resourceGroups/rg-<env-name>
```

**โฑ๏ธ ุฒูุงู**: 5-8 ุฏููู

### ฺฏุงู 5: ุงุณุชูุฑุงุฑ ุจุฑูุงูู

```sh
azd deploy
```

**ฺู ุงุชูุงู ูโุงูุชุฏ**: AZD ุจุฑูุงููู Flask ุดูุง ุฑุง ูโุณุงุฒุฏ ู ูุณุชูุฑ ูโฺฉูุฏ:
1. ุจุณุชูโุจูุฏ ุจุฑูุงููู ูพุงุชูู
2. ุณุงุฎุช ฺฉุงูุชูุฑ Docker
3. ูพูุด ุจู Azure Web App
4. ููุฏุงุฑุฏู ุงูููู ูพุงฺฏุงูโุฏุงุฏู ุจุง ุฏุงุฏูู ููููู
5. ุฑุงูโุงูุฏุงุฒ ุจุฑูุงูู

**โ ุจุฑุฑุณ ููููุช**: ุดูุง ุจุงุฏ ููุงุฑุฏ ุฒุฑ ุฑุง ุจุจูุฏ:
```
SUCCESS: Your application was deployed to Azure in X minutes Y seconds.
You can view the resources created under the resource group rg-<env-name> in Azure Portal:
https://portal.azure.com/#@/resource/subscriptions/.../resourceGroups/rg-<env-name>
```

**โฑ๏ธ ุฒูุงู**: 3-5 ุฏููู

### ฺฏุงู 6: ูุฑูุฑ ุจุฑูุงูู

```sh
azd browse
```

ุงู URL ุจุฑูุงููู ูุณุชูุฑ ุดูุง ุฑุง ุฏุฑ ูุฑูุฑฺฏุฑ ุจุงุฒ ูโฺฉูุฏ: `https://app-<unique-id>.azurewebsites.net`

**โ ุจุฑุฑุณ ููููุช**: ุดูุง ุจุงุฏ ุฎุฑูุฌ JSON ุฑุง ุจุจูุฏ:
```json
{
  "message": "Welcome to the Database App API",
  "endpoints": {
    "/": "This help message",
    "/health": "Health check endpoint",
    "/products": "List all products",
    "/products/<id>": "Get product by ID"
  }
}
```

### ฺฏุงู 7: ุชุณุช ุงูุฏูพููุชโูุง API

**ุจุฑุฑุณ ุณูุงูุช** (ุงุชุตุงู ุจู ูพุงฺฏุงูโุฏุงุฏู ุฑุง ุจุฑุฑุณ ฺฉูุฏ):
```sh
curl https://app-<your-id>.azurewebsites.net/health
```

**ูพุงุณุฎ ููุฑุฏ ุงูุชุธุงุฑ**:
```json
{
  "status": "healthy",
  "database": "connected"
}
```

**ูุณุช ูุญุตููุงุช** (ุฏุงุฏูู ููููู):
```sh
curl https://app-<your-id>.azurewebsites.net/products
```

**ูพุงุณุฎ ููุฑุฏ ุงูุชุธุงุฑ**:
```json
[
  {
    "id": 1,
    "name": "Laptop",
    "description": "High-performance laptop",
    "price": 1299.99,
    "created_at": "2025-11-19T10:30:00"
  },
  ...
]
```

**ุฏุฑุงูุช ฺฉ ูุญุตูู ุฎุงุต**:
```sh
curl https://app-<your-id>.azurewebsites.net/products/1
```

**โ ุจุฑุฑุณ ููููุช**: ูููู ุงูุฏูพููุชโูุง ุฏุงุฏูู JSON ุฑุง ุจุฏูู ุฎุทุง ุจุงุฒูโฺฏุฑุฏุงููุฏ.

---

**๐ ุชุจุฑฺฉ!** ุดูุง ุจุง ููููุช ฺฉ ุจุฑูุงููู ูุจ ุจุง ูพุงฺฏุงูโุฏุงุฏู ุฑุง ุจุง ุงุณุชูุงุฏู ุงุฒ AZD ุฏุฑ Azure ูุณุชูุฑ ฺฉุฑุฏุฏ.

## ุจุฑุฑุณ ุฏููโุชุฑ ูพฺฉุฑุจูุฏ

### ูุชุบุฑูุง ูุญุท

ุฑุงุฒูุง ุจูโุตูุฑุช ุงูู ุงุฒ ุทุฑู ูพฺฉุฑุจูุฏ App Service ุฏุฑ Azure ูุฏุฑุช ูโุดููุฏ โ **ูุฑฺฏุฒ ุฏุฑ ฺฉุฏ ููุจุน ูุฑุงุฑ ุฏุงุฏู ูุดููุฏ**.

**ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ุชูุณุท AZD ูพฺฉุฑุจูุฏ ูโุดูุฏ**:
- `SQL_CONNECTION_STRING`: ุงุชุตุงู ูพุงฺฏุงูโุฏุงุฏู ุจุง ุงุนุชุจุงุฑูุงููู ุฑูุฒูฺฏุงุฑโุดุฏู
- `APPLICATIONINSIGHTS_CONNECTION_STRING`: ููุทูู ูพุงุงู ุชููโูุชุฑ ูพุงุด
- `SCM_DO_BUILD_DURING_DEPLOYMENT`: ูุตุจ ุฎูุฏฺฉุงุฑ ูุงุจุณุชฺฏโูุง ุฑุง ูุนุงู ูโฺฉูุฏ

**ูุญู ุฐุฎุฑูู ุฑุงุฒูุง**:
1. ุฏุฑ ุทูู `azd provision`ุ ุงุนุชุจุงุฑูุงููู SQL ุงุฒ ุทุฑู ูพุฑุณุดโูุง ุงูู ูุงุฑุฏ ูโฺฉูุฏ
2. AZD ุขููุง ุฑุง ุฏุฑ ูุงู ูุญู `.azure/<env-name>/.env` ุฐุฎุฑู ูโฺฉูุฏ (ุฏุฑ Git ูุงุฏุฏู ฺฏุฑูุชู ุดุฏู)
3. AZD ุขููุง ุฑุง ุฏุฑ ูพฺฉุฑุจูุฏ Azure App Service ุชุฒุฑู ูโฺฉูุฏ (ุฏุฑ ุญุงูุช at-rest ุฑูุฒูฺฏุงุฑโุดุฏู)
4. ุจุฑูุงูู ุขููุง ุฑุง ุฏุฑ ุฒูุงู ุงุฌุฑุง ุงุฒ ุทุฑู `os.getenv()` ูโุฎูุงูุฏ

### ุชูุณุนูู ูุญู

ุจุฑุง ุชุณุช ูุญูุ ฺฉ ูุงู `.env` ุงุฒ ููููู ุจุณุงุฒุฏ:

```sh
cp .env.sample .env
# ูุงู .env ุฑุง ุจุง ุงุทูุงุนุงุช ุงุชุตุงู ูพุงฺฏุงูโุฏุงุฏูู ูุญู ุฎูุฏ ูุฑุงุด ฺฉูุฏ.
```

**ฺฏุฑุฏุด ฺฉุงุฑ ุชูุณุนูู ูุญู**:
```sh
# ูุงุจุณุชฺฏโูุง ุฑุง ูุตุจ ฺฉูุฏ
cd src/web
pip install -r requirements.txt

# ูุชุบุฑูุง ูุญุท ุฑุง ุชูุธู ฺฉูุฏ
export SQL_CONNECTION_STRING="your-local-connection-string"

# ุจุฑูุงูู ุฑุง ุงุฌุฑุง ฺฉูุฏ
python app.py
```

**ุชุณุช ูุญู**:
```sh
curl http://localhost:8000/health
# ุงูุชุธุงุฑ ูโุฑูุฏ: {"status": "healthy", "database": "connected"}
```

### ุฒุฑุณุงุฎุช ุจูโุนููุงูโฺฉุฏ

ุชูุงู ููุงุจุน Azure ุฏุฑ ูุงูุจโูุง **Bicep** (`infra/` ูพูุดู) ุชุนุฑู ุดุฏูโุงูุฏ:

- **ุทุฑุงุญ ูุงฺููุงุฑ**: ูุฑ ููุน ููุจุน ูุงู ุฌุฏุงฺฏุงููโุง ุจุฑุง ูุงุจูุช ุงุณุชูุงุฏูู ูุฌุฏุฏ ุฏุงุฑุฏ
- **ูพุงุฑุงูุชุฑโุดุฏู**: ุงูฺฉุงู ุณูุงุฑุดโุณุงุฒ SKUsุ ููุงุทูุ ููุงุนุฏ ูุงูโฺฏุฐุงุฑ
- **ุจูุชุฑู ุดููโูุง**: ุงุฒ ุงุณุชุงูุฏุงุฑุฏูุง ูุงูโฺฏุฐุงุฑ ู ุชูุธูุงุช ุงููุช ูพุดโูุฑุถ Azure ูพุฑู ูโฺฉูุฏ
- **ฺฉูุชุฑู ูุณุฎู**: ุชุบุฑุงุช ุฒุฑุณุงุฎุช ุฏุฑ Git ูพฺฏุฑ ูโุดููุฏ

**ูููููู ุณูุงุฑุดโุณุงุฒ**:
ุจุฑุง ุชุบุฑ ุฑุฏูู ูพุงฺฏุงูโุฏุงุฏูุ `infra/resources/sql-database.bicep` ุฑุง ูุฑุงุด ฺฉูุฏ:
```bicep
sku: {
  name: 'Standard'  // Changed from 'Basic'
  tier: 'Standard'
  capacity: 10
}
```

## ุจูุชุฑู ุดููโูุง ุงููุช

ุงู ูุซุงู ุงุฒ ุจูุชุฑู ุดููโูุง ุงููุช Azure ูพุฑู ูโฺฉูุฏ:

### 1. **ุจุฏูู ุฑุงุฒ ุฏุฑ ฺฉุฏ ููุจุน**
- โ ุงุนุชุจุงุฑูุงููโูุง ุฏุฑ ูพฺฉุฑุจูุฏ Azure App Service ุฐุฎุฑู ูโุดููุฏ (ุฑูุฒูฺฏุงุฑโุดุฏู)
- โ ูุงูโูุง `.env` ุงุฒ ุทุฑู `.gitignore` ุงุฒ Git ูุณุชุซู ุดุฏูโุงูุฏ
- โ ุฑุงุฒูุง ุงุฒ ุทุฑู ูพุงุฑุงูุชุฑูุง ุงูู ุฏุฑ ุฒูุงู ูุฑุงููโุณุงุฒ ููุชูู ูโุดููุฏ

### 2. **ุงุชุตุงูุงุช ุฑูุฒูฺฏุงุฑโุดุฏู**
- โ ุญุฏุงูู TLS 1.2 ุจุฑุง SQL Server
- โ ุงุฌุจุงุฑ ุจู HTTPS ุจุฑุง Web App
- โ ุงุชุตุงูุงุช ูพุงฺฏุงูโุฏุงุฏู ุงุฒ ฺฉุงูุงูโูุง ุฑูุฒูฺฏุงุฑโุดุฏู ุงุณุชูุงุฏู ูโฺฉููุฏ

### 3. **ุงููุช ุดุจฺฉู**
- โ ูุงุฑูุงู SQL Server ุทูุฑ ูพฺฉุฑุจูุฏ ุดุฏู ฺฉู ููุท ุฎุฏูุงุช Azure ุฑุง ูุฌุงุฒ ฺฉูุฏ
- โ ุฏุณุชุฑุณ ุดุจฺฉูู ุนููู ูุญุฏูุฏ ุดุฏู (ูโุชูุงูุฏ ุจุดุชุฑ ุจุง Private Endpoints ููู ุดูุฏ)
- โ FTPS ุฑู Web App ุบุฑูุนุงู ุงุณุช

### 4. **ุงุญุฑุงุฒ ููุช ู ูุฌูุฒุฏู**
- โ๏ธ **ูุนู**: ุงุญุฑุงุฒ ููุช SQL (ูุงู ฺฉุงุฑุจุฑ/ฺฉูููโุนุจูุฑ)
- โ **ุชูุตู ุจุฑุง ุชููุฏ**: ุงุณุชูุงุฏู ุงุฒ Managed Identity Azure ุจุฑุง ุงุญุฑุงุฒ ููุช ุจุฏูู ุฑูุฒ ุนุจูุฑ

**ุจุฑุง ุงุฑุชูุงุก ุจู Managed Identity** (ุจุฑุง ูุญุท ุชููุฏ):
1. ูุนุงูโุณุงุฒ managed identity ุฑู Web App
2. ุงุนุทุง ุฏุณุชุฑุณโูุง SQL ุจู identity
3. ุจูโุฑูุฒโุฑุณุงู connection string ุจุฑุง ุงุณุชูุงุฏู ุงุฒ managed identity
4. ุญุฐู ุงุญุฑุงุฒ ููุช ูุจุชู ุจุฑ ฺฉูููโุนุจูุฑ

### 5. **ููุฒ ู ุงูุทุจุงู**
- โ Application Insights ูููู ุฏุฑุฎูุงุณุชโูุง ู ุฎุทุงูุง ุฑุง ูุงฺฏ ูโฺฉูุฏ
- โ ููุฒ SQL Database ูุนุงู ุงุณุช (ูุงุจู ูพฺฉุฑุจูุฏ ุจุฑุง ุงูุทุจุงู)
- โ ูููู ููุงุจุน ุจุฑุง ุญฺฉูุฑุงู ุชฺฏโฺฏุฐุงุฑ ุดุฏูโุงูุฏ

**ฺฺฉโูุณุช ุงููุช ูุจู ุงุฒ ุชููุฏ**:
- [ ] ูุนุงูโุณุงุฒ Azure Defender ุจุฑุง SQL
- [ ] ูพฺฉุฑุจูุฏ Private Endpoints ุจุฑุง SQL Database
- [ ] ูุนุงูโุณุงุฒ Web Application Firewall (WAF)
- [ ] ูพุงุฏูโุณุงุฒ Azure Key Vault ุจุฑุง ฺุฑุฎุด ุฑุงุฒูุง
- [ ] ูพฺฉุฑุจูุฏ ุงุญุฑุงุฒ ููุช Azure AD
- [ ] ูุนุงูโุณุงุฒ ูุงฺฏโฺฏุฑ ุชุดุฎุต ุจุฑุง ูููู ููุงุจุน

## ุจูููโุณุงุฒ ูุฒูู

**ูุฒููู ูุงูุงููู ุชุฎูู** (ุจูโุฑูุฒ ุดุฏู ุชุง ููุงูุจุฑ 2025):

| Resource | SKU/Tier | Estimated Cost |
|----------|----------|----------------|
| App Service Plan | B1 (Basic) | ~$13/month |
| SQL Database | Basic (2GB) | ~$5/month |
| Application Insights | Pay-as-you-go | ~$2/month (low traffic) |
| **Total** | | **~$20/month** |

**๐ก ูฺฉุงุช ุตุฑููโุฌู ุฏุฑ ูุฒูู**:

1. **ุจุฑุง ุงุฏฺฏุฑ ุงุฒ ุฑุฏูู ุฑุงฺฏุงู ุงุณุชูุงุฏู ฺฉูุฏ**:
   - App Service: ุฑุฏูู F1 (ุฑุงฺฏุงูุ ุณุงุนุงุช ูุญุฏูุฏ)
   - SQL Database: ุงุณุชูุงุฏู ุงุฒ Azure SQL Database serverless
   - Application Insights: 5GB/ูุงู ูุฑูุฏ ุฑุงฺฏุงู

2. **ููุงุจุน ุฑุง ุฒูุงู ฺฉู ุงุณุชูุงุฏู ููโุดููุฏ ูุชููู ฺฉูุฏ**:
   ```sh
   # ุจุฑูุงููู ูุจ ุฑุง ูุชููู ฺฉูุฏ (ูุฒููู ูพุงฺฏุงูโุฏุงุฏู ููฺูุงู ุฏุฑุงูุช ูโุดูุฏ)
   az webapp stop --name <app-name> --resource-group <rg-name>
   
   # ุฏุฑ ุตูุฑุช ูุงุฒ ุฏูุจุงุฑู ุฑุงูโุงูุฏุงุฒ ฺฉูุฏ
   az webapp start --name <app-name> --resource-group <rg-name>
   ```

3. **ูพุณ ุงุฒ ุชุณุช ููู ฺุฒ ุฑุง ุญุฐู ฺฉูุฏ**:
   ```sh
   azd down
   ```
   ุงู ูููู ููุงุจุน ุฑุง ุญุฐู ูโฺฉูุฏ ู ูุฒููโูุง ุฑุง ูุชููู ูโุณุงุฒุฏ.

4. **SKUูุง ุชูุณุนู ุฏุฑ ููุงุจู ุชููุฏ**:
   - **ุชูุณุนู**: ุฑุฏูู Basic (ุงุณุชูุงุฏูโุดุฏู ุฏุฑ ุงู ูุซุงู)
   - **ุชููุฏ**: ุฑุฏูู Standard/Premium ุจุง ุงูุฒููฺฏ

**ูพุงุด ูุฒูู**:
- ูุฒููโูุง ุฑุง ุฏุฑ [Azure Cost Management](https://portal.azure.com/#view/Microsoft_Azure_CostManagement) ุจุจูุฏ
- ูุดุฏุงุฑูุง ูุฒูู ุชูุธู ฺฉูุฏ ุชุง ุงุฒ ุดฺฏูุชโูุง ุฌููฺฏุฑ ุดูุฏ
- ูููู ููุงุจุน ุฑุง ุจุง `azd-env-name` ุชฺฏโฺฏุฐุงุฑ ฺฉูุฏ ุจุฑุง ูพฺฏุฑ

**ุฌุงฺฏุฒู ุฑุฏูู ุฑุงฺฏุงู**:
ุจุฑุง ุงูุฏุงู ุขููุฒุดุ ูโุชูุงูุฏ `infra/resources/app-service-plan.bicep` ุฑุง ุชุบุฑ ุฏูุฏ:
```bicep
sku: {
  name: 'F1'  // Free tier
  tier: 'Free'
}
```
**ุชูุฌู**: ุฑุฏูู ุฑุงฺฏุงู ูุญุฏูุฏุชโูุง ุฏุงุฑุฏ (60 ุฏููู/ุฑูุฒ CPUุ ุนุฏู ูพุดุชุจุงู ุงุฒ always-on).

## ูพุงุด ู ูุงุจูุช ูุดุงูุฏู

### ฺฉูพุงุฑฺูโุณุงุฒ Application Insights

ุงู ูุซุงู ุดุงูู **Application Insights** ุจุฑุง ูพุงุด ุฌุงูุน ุงุณุช:

**ฺู ฺุฒูุง ูพุงุด ูโุดููุฏ**:
- โ ุฏุฑุฎูุงุณุชโูุง HTTP (ุฒูุงู ุชุฃุฎุฑุ ฺฉุฏูุง ูุถุนุชุ ุงูุฏูพููุชโูุง)
- โ ุฎุทุงูุง ู ุงุณุชุซูุงูุง ุจุฑูุงูู
- โ ูุงฺฏโูุง ุณูุงุฑุด ุงุฒ ุงูพ Flask
- โ ุณูุงูุช ุงุชุตุงู ุจู ูพุงฺฏุงูโุฏุงุฏู
- โ ูุนุงุฑูุง ุนููฺฉุฑุฏ (CPUุ ุญุงูุธู)

**ุฏุณุชุฑุณ ุจู Application Insights**:
1. ุจุงุฒ ฺฉุฑุฏู [Azure Portal](https://portal.azure.com)
2. ุฑูุชู ุจู ฺฏุฑูู ููุงุจุน ุดูุง (`rg-<env-name>`)
3. ฺฉูฺฉ ุฑู ููุจุน Application Insights (`appi-<unique-id>`)

**ูพุฑุณโูุฌููุง ููุฏ** (Application Insights โ Logs):

**ููุงุด ูููู ุฏุฑุฎูุงุณุชโูุง**:
```kusto
requests
| where timestamp > ago(1h)
| order by timestamp desc
| project timestamp, name, url, resultCode, duration
```

**ุงูุชู ุฎุทุงูุง**:
```kusto
exceptions
| where timestamp > ago(24h)
| order by timestamp desc
| project timestamp, type, outerMessage, operation_Name
```

**ุจุฑุฑุณ ุงูุฏูพููุช ุณูุงูุช**:
```kusto
requests
| where name contains "health"
| summarize count() by resultCode, bin(timestamp, 1h)
```

### ููุฒ SQL Database

**ููุฒ SQL Database ูุนุงู ุงุณุช** ุชุง ููุงุฑุฏ ุฒุฑ ุฑุง ุฑุฏุงุจ ฺฉูุฏ:
- ุงูฺฏููุง ุฏุณุชุฑุณ ุจู ูพุงฺฏุงูโุฏุงุฏู
- ุชูุงุดโูุง ูุฑูุฏ ูุงูููู
- ุชุบุฑุงุช ุงุณฺฉูู
- ุฏุณุชุฑุณ ุจู ุฏุงุฏูโูุง (ุจุฑุง ุงูุทุจุงู)

**ุฏุณุชุฑุณ ุจู ูุงฺฏโูุง ููุฒ**:
1. Azure Portal โ SQL Database โ Auditing
2. ูุดุงูุฏูู ูุงฺฏโูุง ุฏุฑ Log Analytics workspace

### ูพุงุด ุจูุงุฏุฑูฺฏ

**ูุดุงูุฏูู ูุนุงุฑูุง ุฒูุฏู**:
1. Application Insights โ Live Metrics
2. ูุดุงูุฏูู ุฏุฑุฎูุงุณุชโูุงุ ุดฺฉุณุชโูุง ู ุนููฺฉุฑุฏ ุฏุฑ ุฒูุงู ูุงูุน

**ุชูุธู ูุดุฏุงุฑูุง**:
ูุดุฏุงุฑูุง ุจุฑุง ุฑูุฏุงุฏูุง ุจุญุฑุงู ุงุฌุงุฏ ฺฉูุฏ:
- ุฎุทุงูุง HTTP 500 > 5 ุฏุฑ 5 ุฏููู
- ุดฺฉุณุชโูุง ุงุชุตุงู ุจู ูพุงฺฏุงูโุฏุงุฏู
- ุฒูุงู ูพุงุณุฎโุฏู ุจุงูุง (>2 ุซุงูู)

**ููููู ุงุฌุงุฏ ูุดุฏุงุฑ**:
```sh
az monitor metrics alert create \
  --name "High-Response-Time" \
  --resource-group <rg-name> \
  --scopes <app-insights-resource-id> \
  --condition "avg requests/duration > 2000" \
  --description "Alert when response time exceeds 2 seconds"
```

## ุนุจโุงุจ

### ูุดฺฉูุงุช ุฑุงุฌ ู ุฑุงูโุญูโูุง

#### 1. `azd provision` ุจุง ุฎุทุง "Location not available" ุดฺฉุณุช ูโุฎูุฑุฏ

**ุนูุงุฆู**:
```
Error: The subscription is not registered for the resource type 'components' in the location 'centralus'.
```

**ุฑุงูโุญู**:
ฺฉ ูุงุญู (region) ุฏฺฏุฑ ุฏุฑ Azure ุงูุชุฎุงุจ ฺฉูุฏ ุง ุงุฑุงุฆูโุฏููุฏูู ููุงุจุน ุฑุง ุซุจุช ฺฉูุฏ:
```sh
az provider register --namespace Microsoft.Insights
```

#### 2. ุงุชุตุงู SQL ููฺฏุงู ุงุณุชูุฑุงุฑ ุดฺฉุณุช ูโุฎูุฑุฏ

**ุนูุงุฆู**:
```
pyodbc.OperationalError: ('08001', '[08001] [Microsoft][ODBC Driver 18 for SQL Server]TCP Provider...')
```

**ุฑุงูโุญู**:
- ุจุฑุฑุณ ฺฉูุฏ ูุงุฑูุงู ุณุฑูุฑ SQL ุงุฌุงุฒูู ุฎุฏูุงุช Azure ุฑุง ูโุฏูุฏ (ุจูโุตูุฑุช ุฎูุฏฺฉุงุฑ ูพฺฉุฑุจูุฏ ูโุดูุฏ)
- ุจุฑุฑุณ ฺฉูุฏ ุฑูุฒ ุนุจูุฑ ูุฏุฑ SQL ุจูโุฏุฑุณุช ููฺฏุงู ุงุฌุฑุง `azd provision` ูุงุฑุฏ ุดุฏู ุงุณุช
- ูุทูุฆู ุดูุฏ ุณุฑูุฑ SQL ฺฉุงููุงู ูุฑุงููโ ุดุฏู ุงุณุช (ููฺฉู ุงุณุช 2-3 ุฏููู ุทูู ุจฺฉุดุฏ)

**ุจุฑุฑุณ ุงุชุตุงู**:
```sh
# ุงุฒ ูพูุฑุชุงู ุขุฒูุฑุ ุจู ยซูพุงฺฏุงู ุฏุงุฏู SQLยป โ ยซูุฑุงุดฺฏุฑ ูพุฑุณโูุฌูยป ุจุฑูุฏ
# ุณุน ฺฉูุฏ ุจุง ุงุทูุงุนุงุช ูุฑูุฏ ุฎูุฏ ูุชุตู ุดูุฏ
```

#### 3. ุจุฑูุงูู ูุจ ูพุงู "Application Error" ุฑุง ููุงุด ูโุฏูุฏ

**ุนูุงุฆู**:
ูุฑูุฑฺฏุฑ ุตูุญูู ุฎุทุง ุนููู ุฑุง ููุงุด ูโุฏูุฏ.

**ุฑุงูโุญู**:
ูุงฺฏโูุง ุจุฑูุงูู ุฑุง ุจุฑุฑุณ ฺฉูุฏ:
```sh
# ูุดุงูุฏู ูุงฺฏโูุง ุงุฎุฑ
az webapp log tail --name <app-name> --resource-group <rg-name>
```

**ุฏูุงู ุฑุงุฌ**:
- ูุชุบุฑูุง ูุญุท ููููุฏ (App Service โ Configuration ุฑุง ุจุฑุฑุณ ฺฉูุฏ)
- ูุตุจ ุจุณุชูู Python ูุงูููู ุจูุฏู ุงุณุช (ูุงฺฏโูุง ุงุณุชูุฑุงุฑ ุฑุง ุจุฑุฑุณ ฺฉูุฏ)
- ุฎุทุง ุฑุงูโุงูุฏุงุฒ ูพุงฺฏุงู ุฏุงุฏู (ุงุชุตุงู SQL ุฑุง ุจุฑุฑุณ ฺฉูุฏ)

#### 4. `azd deploy` ุจุง ุฎุทุง "Build Error" ุดฺฉุณุช ูโุฎูุฑุฏ

**ุนูุงุฆู**:
```
Error: Failed to build project
```

**ุฑุงูโุญู**:
- ุงุทููุงู ุญุงุตู ฺฉูุฏ `requirements.txt` ุฎุทุง ูุญู ูุฏุงุฑุฏ
- ุจุฑุฑุณ ฺฉูุฏ Python 3.11 ุฏุฑ `infra/resources/web-app.bicep` ูุดุฎุต ุดุฏู ุจุงุดุฏ
- ุชุฃุฏ ฺฉูุฏ Dockerfile ุชุตูุฑ ูพุงูู ุตุญุญ ุฏุงุฑุฏ

**ุงุดฺฉุงูโุฒุฏุง ูุญู**:
```sh
cd src/web
docker build -t test-app .
docker run -p 8000:8000 test-app
```

#### 5. ููฺฏุงู ุงุฌุฑุง ุฏุณุชูุฑุงุช AZD ุฎุทุง "Unauthorized"

**ุนูุงุฆู**:
```
ERROR: (Unauthorized) The client '<id>' with object id '<id>' does not have authorization
```

**ุฑุงูโุญู**:
ุฏูุจุงุฑู ุจุง Azure ุงุญุฑุงุฒ ููุช ฺฉูุฏ:
```sh
azd auth login
az login
```

ุจุฑุฑุณ ฺฉูุฏ ุฏุณุชุฑุณโูุง ุตุญุญ ุฑุง ุฏุงุฑุฏ (ููุด Contributor) ุฑู subscription.

#### 6. ูุฒููโูุง ุจุงูุง ูพุงฺฏุงู ุฏุงุฏู

**ุนูุงุฆู**:
ุตูุฑุชโุญุณุงุจ ุบุฑููุชุธุฑูู Azure.

**ุฑุงูโุญู**:
- ุจุฑุฑุณ ฺฉูุฏ ุขุง ูพุณ ุงุฒ ุชุณุช ูุฑุงููุด ฺฉุฑุฏูโุงุฏ `azd down` ุฑุง ุงุฌุฑุง ฺฉูุฏ
- ุชุฃุฏ ฺฉูุฏ SQL Database ุงุฒ tier Basic ุงุณุชูุงุฏู ูโฺฉูุฏ (ูู Premium)
- ูุฒููโูุง ุฑุง ุฏุฑ Azure Cost Management ูุฑูุฑ ฺฉูุฏ
- ูุดุฏุงุฑูุง ูุฒูู ุฑุง ุชูุธู ฺฉูุฏ

### ุฏุฑุงูุช ฺฉูฺฉ

**ูุดุงูุฏูู ุชูุงู ูุชุบุฑูุง ูุญุท AZD**:
```sh
azd env get-values
```

**ุจุฑุฑุณ ูุถุนุช ุงุณุชูุฑุงุฑ**:
```sh
az webapp show --name <app-name> --resource-group <rg-name> --query state
```

**ุฏุณุชุฑุณ ุจู ูุงฺฏโูุง ุจุฑูุงูู**:
```sh
az webapp log download --name <app-name> --resource-group <rg-name> --log-file app-logs.zip
```

**ูุงุฒ ุจู ฺฉูฺฉ ุจุดุชุฑุ**
- [ุฑุงูููุง ุนุจโุงุจ AZD](../../docs/chapter-07-troubleshooting/common-issues.md)
- [ุนุจโุงุจ Azure App Service](https://learn.microsoft.com/azure/app-service/troubleshoot-diagnostic-logs)
- [ุนุจโุงุจ Azure SQL](https://learn.microsoft.com/azure/azure-sql/database/troubleshoot-common-errors-issues)

## ุชูุฑูโูุง ุนูู

### ุชูุฑู 1: ุชุฃุฏ ุงุณุชูุฑุงุฑ ุดูุง (ููุฏูุงุช)

**ูุฏู**: ุชุฃุฏ ฺฉูุฏ ูููู ููุงุจุน ูุณุชูุฑ ุดุฏูโุงูุฏ ู ุจุฑูุงูู ฺฉุงุฑ ูโฺฉูุฏ.

**ูุฑุงุญู**:
1. ููุฑุณุช ุชูุงู ููุงุจุน ุฏุฑ ฺฏุฑูู ููุงุจุน ุฎูุฏ:
   ```sh
   az resource list --resource-group rg-<env-name> --output table
   ```
   **ููุฑุฏ ุงูุชุธุงุฑ**: 6-7 resources (Web App, SQL Server, SQL Database, App Service Plan, Application Insights, Log Analytics)

2. ุชูุงู endpointโูุง API ุฑุง ุชุณุช ฺฉูุฏ:
   ```sh
   curl https://app-<your-id>.azurewebsites.net/
   curl https://app-<your-id>.azurewebsites.net/health
   curl https://app-<your-id>.azurewebsites.net/products
   curl https://app-<your-id>.azurewebsites.net/products/1
   ```
   **ููุฑุฏ ุงูุชุธุงุฑ**: ูููู endpointูุง JSON ูุนุชุจุฑ ุจุฏูู ุฎุทุง ุจุงุฒฺฏุฑุฏุงููุฏ

3. ุจุฑุฑุณ Application Insights:
   - ุจู Application Insights ุฏุฑ Azure Portal ุจุฑูุฏ
   - ุจู "Live Metrics" ุจุฑูุฏ
   - ูุฑูุฑฺฏุฑ ุฎูุฏ ุฑุง ุฑู ูุจโุงูพ ุฑูุฑุด ฺฉูุฏ
   **ููุฑุฏ ุงูุชุธุงุฑ**: ูุดุงูุฏูู ุฏุฑุฎูุงุณุชโูุง ุฏุฑ ุฒูุงู ูุงูุน

**ูุนุงุฑูุง ููููุช**: ูููู ถ-ท ููุจุน ูุฌูุฏ ุฏุงุดุชู ุจุงุดูุฏุ ูููู endpointูุง ุฏุงุฏู ุจุงุฒฺฏุฑุฏุงููุฏุ Live Metrics ูุนุงูุช ุฑุง ูุดุงู ุฏูุฏ.

---

### ุชูุฑู 2: ุงุถุงูู ฺฉุฑุฏู ฺฉ endpoint ุฌุฏุฏ API (ูุชูุณุท)

**ูุฏู**: ฺฏุณุชุฑุด ุจุฑูุงููู Flask ุจุง ฺฉ endpoint ุฌุฏุฏ.

**ฺฉุฏ ุดุฑูุน**: endpointูุง ูุนู ุฏุฑ `src/web/app.py`

**ูุฑุงุญู**:
1. ูุงู `src/web/app.py` ุฑุง ูุฑุงุด ฺฉูุฏ ู ฺฉ endpoint ุฌุฏุฏ ุจุนุฏ ุงุฒ ุชุงุจุน `get_product()` ุงุถุงูู ฺฉูุฏ:
   ```python
   @app.route('/products/search/<keyword>')
   def search_products(keyword):
       """Search products by name or description."""
       try:
           conn = get_db_connection()
           cursor = conn.cursor()
           cursor.execute(
               "SELECT id, name, description, price, created_at FROM products WHERE name LIKE ? OR description LIKE ?",
               (f'%{keyword}%', f'%{keyword}%')
           )
           
           products = []
           for row in cursor.fetchall():
               products.append({
                   'id': row[0],
                   'name': row[1],
                   'description': row[2],
                   'price': float(row[3]) if row[3] else None,
                   'created_at': row[4].isoformat() if row[4] else None
               })
           
           cursor.close()
           conn.close()
           
           logger.info(f"Search for '{keyword}' returned {len(products)} results")
           return jsonify(products), 200
           
       except Exception as e:
           logger.error(f"Error searching products: {str(e)}")
           return jsonify({'error': str(e)}), 500
   ```

2. ุจุฑูุงููู ุจูโุฑูุฒุดุฏู ุฑุง ูุณุชูุฑ ฺฉูุฏ:
   ```sh
   azd deploy
   ```

3. endpoint ุฌุฏุฏ ุฑุง ุชุณุช ฺฉูุฏ:
   ```sh
   curl https://app-<your-id>.azurewebsites.net/products/search/laptop
   ```
   **ููุฑุฏ ุงูุชุธุงุฑ**: ุจุงุฒฺฏุฑุฏุงูุฏู ูุญุตููุงุช ูุทุงุจู ุจุง "laptop"

**ูุนุงุฑูุง ููููุช**: endpoint ุฌุฏุฏ ฺฉุงุฑ ูโฺฉูุฏุ ูุชุงุฌ ููุชุฑุดุฏู ุจุงุฒูโฺฏุฑุฏุงูุฏุ ุฏุฑ ูุงฺฏโูุง Application Insights ุธุงูุฑ ูโุดูุฏ.

---

### ุชูุฑู 3: ุงุถุงูู ฺฉุฑุฏู ูุงูุชูุฑูฺฏ ู ูุดุฏุงุฑูุง (ูพุดุฑูุชู)

**ูุฏู**: ุฑุงูโุงูุฏุงุฒ ูุงูุชูุฑูฺฏ ูพุดฺฏุฑุงูู ุจุง ูุดุฏุงุฑูุง.

**ูุฑุงุญู**:
1. ุงุฌุงุฏ ฺฉ ูุดุฏุงุฑ ุจุฑุง ุฎุทุงูุง HTTP 500:
   ```sh
   # ุดูุงุณูู ููุจุน Application Insights ุฑุง ุฏุฑุงูุช ฺฉูุฏ
   AI_ID=$(az monitor app-insights component show \
     --app appi-<your-id> \
     --resource-group rg-<env-name> \
     --query id -o tsv)
   
   # ูุดุฏุงุฑ ุงุฌุงุฏ ฺฉูุฏ
   az monitor metrics alert create \
     --name "High-Error-Rate" \
     --resource-group rg-<env-name> \
     --scopes $AI_ID \
     --condition "count requests/failed > 5" \
     --window-size 5m \
     --evaluation-frequency 1m \
     --description "Alert when >5 failed requests in 5 minutes"
   ```

2. ุจุง ุงุฌุงุฏ ุฎุทุงูุง ูุดุฏุงุฑ ุฑุง ูุนุงู ฺฉูุฏ:
   ```sh
   # ุฏุฑุฎูุงุณุช ฺฉ ูุญุตูู ูุงููุฌูุฏ
   for i in {1..10}; do curl https://app-<your-id>.azurewebsites.net/products/999; done
   ```

3. ุจุฑุฑุณ ฺฉูุฏ ุขุง ูุดุฏุงุฑ ุงุฌุฑุง ุดุฏู ุงุณุช:
   - Azure Portal โ Alerts โ Alert Rules
   - ุงูู ุฎูุฏ ุฑุง ุจุฑุฑุณ ฺฉูุฏ (ุงฺฏุฑ ูพฺฉุฑุจูุฏ ุดุฏู ุจุงุดุฏ)

**ูุนุงุฑูุง ููููุช**: ูุงููู ูุดุฏุงุฑ ุงุฌุงุฏ ุดุฏูุ ููฺฏุงู ุฎุทุงูุง ูุนุงู ุดูุฏุ ุงุนูุงูโูุง ุฏุฑุงูุช ุดููุฏ.

---

### ุชูุฑู 4: ุชุบุฑุงุช ุทุฑุญโูุงุฑูู ูพุงฺฏุงู ุฏุงุฏู (ูพุดุฑูุชู)

**ูุฏู**: ุงุถุงูู ฺฉุฑุฏู ุฌุฏูู ุฌุฏุฏ ู ุงุตูุงุญ ุจุฑูุงูู ุจุฑุง ุงุณุชูุงุฏู ุงุฒ ุขู.

**ูุฑุงุญู**:
1. ุจุง ุงุณุชูุงุฏู ุงุฒ Query Editor ุฏุฑ Azure Portal ุจู SQL Database ูุชุตู ุดูุฏ

2. ฺฉ ุฌุฏูู ุฌุฏุฏ `categories` ุงุฌุงุฏ ฺฉูุฏ:
   ```sql
   CREATE TABLE categories (
       id INT PRIMARY KEY IDENTITY(1,1),
       name NVARCHAR(50) NOT NULL,
       description NVARCHAR(200)
   );
   
   INSERT INTO categories (name, description) VALUES
   ('Electronics', 'Electronic devices and accessories'),
   ('Office Supplies', 'Office equipment and supplies');
   
   -- Add category to products table
   ALTER TABLE products ADD category_id INT;
   UPDATE products SET category_id = 1; -- Set all to Electronics
   ```

3. ูุงู `src/web/app.py` ุฑุง ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ ุชุง ุงุทูุงุนุงุช ุฏุณุชูโุจูุฏ ุฑุง ุฏุฑ ูพุงุณุฎโูุง ูุงุฑุฏ ฺฉูุฏ

4. ูุณุชูุฑ ฺฉุฑุฏู ู ุชุณุช ฺฉูุฏ

**ูุนุงุฑูุง ููููุช**: ุฌุฏูู ุฌุฏุฏ ูุฌูุฏ ุฏุงุดุชู ุจุงุดุฏุ ูุญุตููุงุช ุงุทูุงุนุงุช ุฏุณุชูโุจูุฏ ุฑุง ูุดุงู ุฏููุฏุ ุจุฑูุงูู ููฺูุงู ฺฉุงุฑ ฺฉูุฏ.

---

### ุชูุฑู 5: ูพุงุฏูโุณุงุฒ ฺฉุด (ูุชุฎุตุต)

**ูุฏู**: ุงูุฒูุฏู Azure Redis Cache ุจุฑุง ุจูุจูุฏ ุนููฺฉุฑุฏ.

**ูุฑุงุญู**:
1. Redis Cache ุฑุง ุจู `infra/main.bicep` ุงุถุงูู ฺฉูุฏ
2. `src/web/app.py` ุฑุง ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ ุชุง ูพุฑุณโูุฌููุง ูุญุตููุงุช ุฏุฑ ฺฉุด ุฐุฎุฑู ุดููุฏ
3. ุจูุจูุฏ ุนููฺฉุฑุฏ ุฑุง ุจุง Application Insights ุงูุฏุงุฒูโฺฏุฑ ฺฉูุฏ
4. ุฒูุงูโูุง ูพุงุณุฎโุฏู ูุจู/ุจุนุฏ ุงุฒ ฺฉุด ุฑุง ููุงุณู ฺฉูุฏ

**ูุนุงุฑูุง ููููุช**: Redis ูุณุชูุฑ ุดุฏู ุจุงุดุฏุ ฺฉุด ฺฉุงุฑ ฺฉูุฏุ ุฒูุงู ูพุงุณุฎโุฏู ุจุด ุงุฒ 50ูช ุจูุจูุฏ ุงุจุฏ.

**ูฺฉุชู**: ุงุฒ ูุณุชูุฏุงุช [Azure Cache for Redis documentation](https://learn.microsoft.com/azure/azure-cache-for-redis/) ุดุฑูุน ฺฉูุฏ.

---

## ูพุงฺฉโุณุงุฒ

ุจุฑุง ุฌููฺฏุฑ ุงุฒ ูุฒููโูุง ูุฏุงููุ ูพุณ ุงุฒ ูพุงุงู ูููู ููุงุจุน ุฑุง ุญุฐู ฺฉูุฏ:

```sh
azd down
```

**ุฏุฑุฎูุงุณุช ุชุฃุฏ**:
```
? Total resources to delete: 7, are you sure you want to continue? (y/N)
```

ุจุฑุง ุชุฃุฏ `y` ุฑุง ุชุงูพ ฺฉูุฏ.

**โ ุจุฑุฑุณ ููููุช**: 
- ูููู ููุงุจุน ุงุฒ Azure Portal ุญุฐู ุดุฏูโุงูุฏ
- ูฺ ูุฒููู ูุฏุงูู ูุณุช
- ูพูุดูู ูุญู `.azure/<env-name>` ุฑุง ูโุชูุงู ุญุฐู ฺฉุฑุฏ

**ุฌุงฺฏุฒู** (ูฺฏูโุฏุงุดุชู ุฒุฑุณุงุฎุชุ ุญุฐู ุฏุงุฏูโูุง):
```sh
# ููุท ฺฏุฑูู ููุงุจุน ุฑุง ุญุฐู ฺฉูุฏ (ูพฺฉุฑุจูุฏ AZD ุฑุง ูฺฏู ุฏุงุฑุฏ)
az group delete --name rg-<env-name> --yes
```
## ุงุทูุงุนุงุช ุจุดุชุฑ

### ูุณุชูุฏุงุช ูุฑุชุจุท
- [ูุณุชูุฏุงุช Azure Developer CLI](https://learn.microsoft.com/azure/developer/azure-developer-cli/)
- [ูุณุชูุฏุงุช Azure SQL Database](https://learn.microsoft.com/azure/azure-sql/database/)
- [ูุณุชูุฏุงุช Azure App Service](https://learn.microsoft.com/azure/app-service/)
- [ูุณุชูุฏุงุช Application Insights](https://learn.microsoft.com/azure/azure-monitor/app/app-insights-overview)
- [ูุฑุฌุน ุฒุจุงู Bicep](https://learn.microsoft.com/azure/azure-resource-manager/bicep/)

### ูุฑุงุญู ุจุนุฏ ุฏุฑ ุงู ุฏูุฑู
- **[ููููู Container Apps](../../../../examples/container-app)**: ุงุณุชูุฑุงุฑ ูฺฉุฑูุณุฑูุณโูุง ุจุง Azure Container Apps
- **[ุฑุงูููุง ฺฉูพุงุฑฺูโุณุงุฒ AI](../../../../docs/ai-foundry)**: ุงูุฒูุฏู ูุงุจูุชโูุง AI ุจู ุงูพูฺฉุดู ุดูุง
- **[ุจูุชุฑู ุดููโูุง ุงุณุชูุฑุงุฑ](../../docs/chapter-04-infrastructure/deployment-guide.md)**: ุงูฺฏููุง ุงุณุชูุฑุงุฑ ุฏุฑ ุชููุฏ

### ููุถูุนุงุช ูพุดุฑูุชู
- **Managed Identity**: ุญุฐู ุฑูุฒุนุจูุฑ ู ุงุณุชูุงุฏู ุงุฒ ุงุญุฑุงุฒ ููุช Azure AD
- **Private Endpoints**: ุงููโุณุงุฒ ุงุชุตุงูุงุช ูพุงฺฏุงู ุฏุงุฏู ุฏุฑูู ฺฉ ุดุจฺฉู ูุฌุงุฒ
- **CI/CD Integration**: ุฎูุฏฺฉุงุฑุณุงุฒ ุงุณุชูุฑุงุฑูุง ุจุง GitHub Actions ุง Azure DevOps
- **Multi-Environment**: ุฑุงูโุงูุฏุงุฒ ูุญุทโูุง devุ staging ู production
- **Database Migrations**: ุงุณุชูุงุฏู ุงุฒ Alembic ุง Entity Framework ุจุฑุง ูุณุฎูโุจูุฏ ุทุฑุญโูุงุฑู

### ููุงุณู ุจุง ุฑูุดโูุง ุฏฺฏุฑ

**AZD ุฏุฑ ููุงุจู ARM Templates**:
- โ AZD: ุงูุชุฒุงุน ุณุทูุญ ุจุงูุงุชุฑุ ุฏุณุชูุฑุงุช ุณุงุฏูโุชุฑ
- โ๏ธ ARM: ุทููุงูโุชุฑุ ฺฉูุชุฑู ุฌุฒุฆโุชุฑ

**AZD ุฏุฑ ููุงุจู Terraform**:
- โ AZD: ุจูู Azureุ ฺฉูพุงุฑฺู ุจุง ุณุฑูุณโูุง Azure
- โ๏ธ Terraform: ูพุดุชุจุงู ฺูุฏุงุจุฑุ ุงฺฉูุณุณุชู ุจุฒุฑฺฏโุชุฑ

**AZD ุฏุฑ ููุงุจู Azure Portal**:
- โ AZD: ุชฺฉุฑุงุฑุดููุฏูุ ุชุญุช ฺฉูุชุฑู ูุณุฎูุ ูุงุจู ุฎูุฏฺฉุงุฑุณุงุฒ
- โ๏ธ Portal: ฺฉูฺฉโูุง ุฏุณุชุ ุฏุดูุงุฑ ุจุฑุง ุจุงุฒุชููุฏ

**ุจู AZD ูุงููุฏ**: Docker Compose ุจุฑุง Azure ุฏุฑ ูุธุฑ ุจฺฏุฑุฏ โ ูพฺฉุฑุจูุฏ ุณุงุฏูโุดุฏู ุจุฑุง ุงุณุชูุฑุงุฑูุง ูพฺุฏู.

---

## ูพุฑุณุดโูุง ูุชุฏุงูู

**ูพุฑุณุด: ุขุง ูโุชูุงูู ุงุฒ ุฒุจุงู ุจุฑูุงููโููุณ ุฏฺฏุฑ ุงุณุชูุงุฏู ฺฉููุ**  
ูพุงุณุฎ: ุจูู! ูพูุดูู `src/web/` ุฑุง ุจุง ฺฉุฏ Node.jsุ C#ุ Go ุง ูุฑ ุฒุจุงู ุฏฺฏุฑ ุฌุงฺฏุฒู ฺฉูุฏ. `azure.yaml` ู Bicep ุฑุง ูุชูุงุณุจ ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ.

**ูพุฑุณุด: ฺฺฏููู ุฏุชุงุจุณโูุง ุจุดุชุฑ ุงุถุงูู ฺฉููุ**  
ูพุงุณุฎ: ฺฉ ูุงฺูู SQL Database ุฏฺฏุฑ ุฏุฑ `infra/main.bicep` ุงุถุงูู ฺฉูุฏ ุง ุงุฒ PostgreSQL/MySQL ุงุฒ ุณุฑูุณโูุง ุฏุชุงุจุณ Azure ุงุณุชูุงุฏู ฺฉูุฏ.

**ูพุฑุณุด: ุขุง ูโุชูุงูู ุงุฒ ุงู ุฏุฑ ุชููุฏ ุงุณุชูุงุฏู ฺฉููุ**  
ูพุงุณุฎ: ุงู ฺฉ ููุทูู ุดุฑูุน ุงุณุช. ุจุฑุง ุชููุฏ ุงุถุงูู ฺฉูุฏ: managed identityุ private endpointsุ ุงูุฒููฺฏุ ุงุณุชุฑุงุชฺ ูพุดุชุจุงูโฺฏุฑุ WAFุ ู ูุงูุชูุฑูฺฏ ูพุดุฑูุชู.

**ูพุฑุณุด: ุงฺฏุฑ ุจุฎูุงูู ุจูโุฌุง ุงุณุชูุฑุงุฑ ฺฉุฏ ุงุฒ ฺฉุงูุชูุฑ ุงุณุชูุงุฏู ฺฉูู ฺูุ**  
ูพุงุณุฎ: ุจู [ููููู Container Apps](../../../../examples/container-app) ูุฑุงุฌุนู ฺฉูุฏ ฺฉู ุฏุฑ ุณุฑุงุณุฑ ุขู ุงุฒ ฺฉุงูุชูุฑูุง Docker ุงุณุชูุงุฏู ุดุฏู ุงุณุช.

**ูพุฑุณุด: ฺฺฏููู ุงุฒ ูุงุดู ูุญูโุงู ุจู ุฏุชุงุจุณ ูุชุตู ุดููุ**  
ูพุงุณุฎ: IP ุฎูุฏ ุฑุง ุจู ูุงุฑูุงู SQL Server ุงุถุงูู ฺฉูุฏ:
```sh
az sql server firewall-rule create \
  --resource-group rg-<env-name> \
  --server sql-<unique-id> \
  --name AllowMyIP \
  --start-ip-address <your-ip> \
  --end-ip-address <your-ip>
```

**ูพุฑุณุด: ุขุง ูโุชูุงูู ุงุฒ ฺฉ ุฏุชุงุจุณ ููุฌูุฏ ุจูโุฌุง ุงุฌุงุฏ ุฏุชุงุจุณ ุฌุฏุฏ ุงุณุชูุงุฏู ฺฉููุ**  
ูพุงุณุฎ: ุจููุ `infra/main.bicep` ุฑุง ุชุบุฑ ุฏูุฏ ุชุง ุจู ฺฉ SQL Server ููุฌูุฏ ุงุดุงุฑู ฺฉูุฏ ู ูพุงุฑุงูุชุฑูุง ุฑุดุชูู ุงุชุตุงู ุฑุง ุจูโุฑูุฒุฑุณุงู ฺฉูุฏ.

---

> **ุชูุฌู:** ุงู ูุซุงู ุจูุชุฑู ุฑูุดโูุง ุฑุง ุจุฑุง ุงุณุชูุฑุงุฑ ฺฉ ุจุฑูุงูู ูุจ ุจุง ฺฉ ูพุงฺฏุงู ุฏุงุฏู ุจุง ุงุณุชูุงุฏู ุงุฒ AZD ูุดุงู ูโุฏูุฏ. ุดุงูู ฺฉุฏ ฺฉุงุฑุ ูุณุชูุฏุงุช ุฌุงูุนุ ู ุชูุฑูโูุง ุนูู ุจุฑุง ุชููุช ุงุฏฺฏุฑ ุงุณุช. ุจุฑุง ุงุณุชูุฑุงุฑูุง ุชููุฏุ ูุงุฒููุฏโูุง ุงููุชุ ููุงุณโูพุฐุฑุ ุงูุทุจุงู ู ูุฒูู ูุฎุตูุต ุณุงุฒูุงูุชุงู ุฑุง ุจุงุฒุจู ฺฉูุฏ.

**๐ ูุงูุจุฑ ุฏูุฑู:**
- โ ูุจู: [ููููู Container Apps](../../../../examples/container-app)
- โ ุจุนุฏ: [ุฑุงูููุง ฺฉูพุงุฑฺูโุณุงุฒ AI](../../../../docs/ai-foundry)
- ๐ [ุตูุญูู ุงุตู ุฏูุฑู](../../README.md)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
ุณูุจ ูุณุฆููุช:
ุงู ุณูุฏ ุจุง ุงุณุชูุงุฏู ุงุฒ ุณุฑูุณ ุชุฑุฌููโ ููุด ูุตููุน Co-op Translator (https://github.com/Azure/co-op-translator) ุชุฑุฌูู ุดุฏู ุงุณุช. ุงฺฏุฑฺู ูุง ุฏุฑ ุชูุงุด ุจุฑุง ุญูุธ ุฏูุช ูุณุชูุ ูุทูุงู ุชูุฌู ุฏุงุดุชู ุจุงุดุฏ ฺฉู ุชุฑุฌููโูุง ุฎูุฏฺฉุงุฑ ููฺฉู ุงุณุช ุฏุงุฑุง ุฎุทุงูุง ุง ูุงุฏุฑุณุชโูุง ุจุงุดูุฏ. ูุณุฎูู ุงุตู ุณูุฏ ุจู ุฒุจุงู ูุจุฏุฃ ุจุงุฏ ุจูโุนููุงู ููุจุน ูุนุชุจุฑ ุฏุฑ ูุธุฑ ฺฏุฑูุชู ุดูุฏ. ุจุฑุง ุงุทูุงุนุงุช ุญุณุงุณ ุง ุญุงุชุ ุชูุตู ูโุดูุฏ ุงุฒ ุชุฑุฌููู ุญุฑููโุง ู ุงูุณุงู ุงุณุชูุงุฏู ููุงุฏ. ูุง ุฏุฑ ูุจุงู ูุฑฺฏููู ุณูุกุชูุงูู ุง ุชูุณุฑ ูุงุฏุฑุณุช ูุงุด ุงุฒ ุงุณุชูุงุฏู ุงุฒ ุงู ุชุฑุฌูู ูุณุฆููุช ูุฏุงุฑู.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->