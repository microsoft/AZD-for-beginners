<!--
CO_OP_TRANSLATOR_METADATA:
{
  "original_hash": "7816c6ec50c694c331e7c6092371be4d",
  "translation_date": "2025-09-25T02:12:14+00:00",
  "source_file": "workshop/docs/instructions/2-Validate-AI-Template.md",
  "language_code": "bg"
}
-->
# 2. Валидиране на шаблон

!!! tip "В КРАЯ НА ТОЗИ МОДУЛ ЩЕ МОЖЕТЕ ДА"

    - [ ] Анализирате архитектурата на AI решение
    - [ ] Разберете работния процес на AZD разгръщане
    - [ ] Използвате GitHub Copilot за помощ при използването на AZD
    - [ ] **Лаборатория 2:** Разгръщане и валидиране на шаблона за AI агенти

---

## 1. Въведение

[Azure Developer CLI](https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/) или `azd` е инструмент с отворен код за команден ред, който улеснява работния процес на разработчиците при създаване и разгръщане на приложения в Azure.

[AZD шаблони](https://learn.microsoft.com/azure/developer/azure-developer-cli/azd-templates) са стандартизирани хранилища, които включват примерен код на приложения, активи за _инфраструктура като код_ и конфигурационни файлове за `azd`, създавайки цялостна архитектура на решение. Осигуряването на инфраструктурата става толкова просто, колкото командата `azd provision`, докато използването на `azd up` позволява едновременно осигуряване на инфраструктурата **и** разгръщане на вашето приложение!

Така, стартирането на процеса на разработка на вашето приложение може да бъде толкова лесно, колкото намирането на подходящ _AZD Starter шаблон_, който най-добре отговаря на вашите нужди за приложение и инфраструктура, след което персонализиране на хранилището според вашите изисквания.

Преди да започнем, нека се уверим, че имате инсталиран Azure Developer CLI.

1. Отворете терминала на VS Code и въведете тази команда:

      ```bash title="" linenums="0"
      azd version
      ```

1. Трябва да видите нещо подобно!

      ```bash title="" linenums="0"
      azd version 1.19.0 (commit b3d68cea969b2bfbaa7b7fa289424428edb93e97)
      ```

**Вече сте готови да изберете и разположите шаблон с azd**

---

## 2. Избор на шаблон

Платформата Azure AI Foundry предлага [набор от препоръчани AZD шаблони](https://learn.microsoft.com/en-us/azure/ai-foundry/how-to/develop/ai-template-get-started), които обхващат популярни сценарии за решения като _автоматизация на работни процеси с множество агенти_ и _мултимодална обработка на съдържание_. Можете също така да откриете тези шаблони, като посетите портала Azure AI Foundry.

1. Посетете [https://ai.azure.com/templates](https://ai.azure.com/templates)
1. Влезте в портала Azure AI Foundry, когато бъдете подканени - ще видите нещо подобно.

![Pick](../../../../../translated_images/01-pick-template.60d2d5fff5ebc374d04f05f556f505a3800b2b5fb08e03153b1b878939b49da6.bg.png)

**Основните** опции са вашите стартови шаблони:

1. [ ] [Започнете с AI чат](https://github.com/Azure-Samples/get-started-with-ai-chat), който разгръща основно чат приложение _с вашите данни_ в Azure Container Apps. Използвайте това, за да изследвате основен сценарий за AI чатбот.
1. [X] [Започнете с AI агенти](https://github.com/Azure-Samples/get-started-with-ai-agents), който също разгръща стандартен AI агент (с Azure AI Agent Service). Използвайте това, за да се запознаете с решения за агентен AI, включващи инструменти и модели.

Посетете втория линк в нов раздел на браузъра (или кликнете върху `Open in GitHub` за свързаната карта). Трябва да видите хранилището за този AZD шаблон. Отделете минута, за да разгледате README. Архитектурата на приложението изглежда така:

![Arch](../../../../../translated_images/architecture.8cec470ec15c65c743dcc1aa383d2500be4d6a9270693b8bfeb3d8deca4a22e1.bg.png)

---

## 3. Активиране на шаблон

Нека се опитаме да разположим този шаблон и да се уверим, че е валиден. Ще следваме указанията в секцията [Getting Started](https://github.com/Azure-Samples/get-started-with-ai-agents?tab=readme-ov-file#getting-started).

1. Кликнете върху [този линк](https://github.com/codespaces/new/Azure-Samples/get-started-with-ai-agents) - потвърдете стандартното действие `Create codespace`
1. Това отваря нов раздел на браузъра - изчакайте сесията на GitHub Codespaces да се зареди напълно
1. Отворете терминала на VS Code в Codespaces - въведете следната команда:

   ```bash title="" linenums="0"
   azd up
   ```

Завършете стъпките на работния процес, които това ще задейства:

1. Ще бъдете подканени да влезете в Azure - следвайте инструкциите за удостоверяване
1. Въведете уникално име на среда за вас - напр., аз използвах `nitya-mshack-azd`
1. Това ще създаде `.azure/` папка - ще видите подпапка с името на средата
1. Ще бъдете подканени да изберете име на абонамент - изберете стандартното
1. Ще бъдете подканени за местоположение - използвайте `East US 2`

Сега изчакайте осигуряването да завърши. **Това отнема 10-15 минути**

1. Когато приключи, вашата конзола ще покаже съобщение за УСПЕХ като това:
      ```bash title="" linenums="0"
      SUCCESS: Your up workflow to provision and deploy to Azure completed in 10 minutes 17 seconds.
      ```
1. Вашият Azure портал вече ще има осигурена ресурсна група с това име на среда:

      ![Infra](../../../../../translated_images/02-provisioned-infra.46c706b14f56e0bf36cb90ba441d16690ce10a00d42990bb9441126ceff08990.bg.png)

1. **Вече сте готови да валидирате разположената инфраструктура и приложение**.

---

## 4. Валидиране на шаблон

1. Посетете страницата [Resource Groups](https://portal.azure.com/#browse/resourcegroups) в Azure Portal - влезте, когато бъдете подканени
1. Кликнете върху RG за името на вашата среда - ще видите страницата по-горе

      - кликнете върху ресурса Azure Container Apps
      - кликнете върху URL на приложението в секцията _Essentials_ (горе вдясно)

1. Трябва да видите хостван потребителски интерфейс на приложението като този:

   ![App](../../../../../translated_images/03-test-application.471910da12c3038e4a3c20e98ebf080abb227e122699ef7b7a262b87af6f98c3.bg.png)

1. Опитайте да зададете няколко [примерни въпроса](https://github.com/Azure-Samples/get-started-with-ai-agents/blob/main/docs/sample_questions.md)

      1. Попитайте: ```Каква е столицата на Франция?``` 
      1. Попитайте: ```Кой е най-добрият палатка под $200 за двама души и какви характеристики включва?```

1. Трябва да получите отговори, подобни на показаните по-долу. _Но как работи това?_ 

      ![App](../../../../../translated_images/03-test-question.521c1e863cbaddb604172e95d704407b4b6304c0e04d9130e51b7994f951b026.bg.png)

---

## 5. Валидиране на агент

Azure Container App разгръща крайна точка, която се свързва с AI агента, осигурен в проекта Azure AI Foundry за този шаблон. Нека разгледаме какво означава това.

1. Върнете се на страницата _Overview_ в Azure Portal за вашата ресурсна група

1. Кликнете върху ресурса `Azure AI Foundry` в този списък

1. Трябва да видите това. Кликнете върху бутона `Go to Azure AI Foundry Portal`. 
   ![Foundry](../../../../../translated_images/04-view-foundry-project.fb94ca41803f28f3a7baa67099e11360380dc7f17bfb0583689cf34419b80498.bg.png)

1. Трябва да видите страницата на проекта Foundry за вашето AI приложение
   ![Project](../../../../../translated_images/05-visit-foundry-portal.d734e98135892d7e96324cebee01acfa6c339706b2d5e50ede4682beb5d431d9.bg.png)

1. Кликнете върху `Agents` - ще видите стандартния агент, осигурен във вашия проект
   ![Agents](../../../../../translated_images/06-visit-agents.bccb263f77b00a0917878ae22b420c3b0df0ade50c0df8e20e6e45d49a220514.bg.png)

1. Изберете го - и ще видите подробности за агента. Обърнете внимание на следното:

      - Агента използва File Search по подразбиране (винаги)
      - Знанията на агента показват, че има качени 32 файла (за File Search)
      ![Agents](../../../../../translated_images/07-view-agent-details.0e049f37f61eae6292faf47da2651994dab9ac9cf06c20e7c996c54dbca02245.bg.png)

1. Потърсете опцията `Data+indexes` в лявото меню и кликнете за подробности. 

      - Трябва да видите 32 качени файла с данни за знания.
      - Те ще съответстват на 12 клиентски файла и 20 продуктови файла под `src/files` 
      ![Data](../../../../../translated_images/08-visit-data-indexes.5a4cc1686fa0d19a49625f0d4956f3b22681ae275a62c35516dabf1eb9d49a89.bg.png)

**Валидирахте работата на агента!** 

1. Отговорите на агента са базирани на знанията в тези файлове. 
1. Сега можете да задавате въпроси, свързани с тези данни, и да получавате обосновани отговори.
1. Пример: `customer_info_10.json` описва 3 покупки, направени от "Amanda Perez"

Върнете се в раздела на браузъра с крайна точка на Container App и попитайте: `Какви продукти притежава Amanda Perez?`. Трябва да видите нещо подобно:

![Data](../../../../../translated_images/09-ask-in-aca.4102297fc465a4d5617af2a71501c3b7607d198df9e598f84abacc32423c17b9.bg.png)

---

## 6. Игрална площадка за агенти

Нека изградим малко повече интуиция за възможностите на Azure AI Foundry, като изпробваме агента в игралната площадка за агенти. 

1. Върнете се на страницата `Agents` в Azure AI Foundry - изберете стандартния агент
1. Кликнете върху опцията `Try in Playground` - трябва да получите потребителски интерфейс на игралната площадка като този
1. Задайте същия въпрос: `Какви продукти притежава Amanda Perez?`

    ![Data](../../../../../translated_images/09-ask-in-playground.a1b93794f78fa676c13e7b81dd60bc8589c742cf1069dc4589acf36ac050298d.bg.png)

Получавате същия (или подобен) отговор - но също така получавате допълнителна информация, която можете да използвате, за да разберете качеството, разходите и производителността на вашето приложение с агенти. Например:

1. Обърнете внимание, че отговорът цитира файлове с данни, използвани за "обосновка" на отговора
1. Задръжте курсора върху някой от тези етикети на файлове - съответстват ли данните на вашето запитване и показания отговор?

Също така виждате ред със _статистики_ под отговора. 

1. Задръжте курсора върху някой метрик - напр., Safety. Виждате нещо подобно
1. Съответства ли оценената оценка на вашата интуиция за нивото на безопасност на отговора?

      ![Data](../../../../../translated_images/10-view-run-info-meter.6cdb89a0eea5531fced8249c58037ab5fb939478145db95b840a6aab8b21d85e.bg.png)

---x

## 7. Вградена наблюдаемост

Наблюдаемостта се отнася до инструментализиране на вашето приложение, за да генерира данни, които могат да се използват за разбиране, отстраняване на проблеми и оптимизиране на неговите операции. За да добиете представа за това:

1. Кликнете върху бутона `View Run Info` - трябва да видите този изглед. Това е пример за [проследяване на агенти](https://learn.microsoft.com/en-us/azure/ai-foundry/how-to/develop/trace-agents-sdk#view-trace-results-in-the-azure-ai-foundry-agents-playground) в действие. _Можете също така да получите този изглед, като кликнете върху Thread Logs в главното меню_.

   - Получете представа за стъпките на изпълнение и инструментите, ангажирани от агента
   - Разберете общия брой токени (срещу използването на токени за изход) за отговор
   - Разберете латентността и къде се изразходва време при изпълнение

      ![Agent](../../../../../translated_images/10-view-run-info.b20ebd75fef6a1cc01382282300bc7d4afe4aa289de08bc97d1e097d7dc4b77d.bg.png)

1. Кликнете върху таба `Metadata`, за да видите допълнителни атрибути за изпълнението, които могат да предоставят полезен контекст за отстраняване на проблеми по-късно.   

      ![Agent](../../../../../translated_images/11-view-run-info-metadata.7966986122c7c2dfef2df06e56db549f922c09658b51496fac040106de75e2b9.bg.png)

1. Кликнете върху таба `Evaluations`, за да видите автоматични оценки, направени върху отговора на агента. Те включват оценки за безопасност (напр., Self-harm) и специфични за агента оценки (напр., Intent resolution, Task adherence).

      ![Agent](../../../../../translated_images/12-view-run-info-evaluations.ef25e4577d70efeb777dfadf51fed1694661fa370dd5a4e5fea4aec8de234568.bg.png)

1. И накрая, кликнете върху таба `Monitoring` в страничното меню.

      - Изберете таба `Resource usage` на показаната страница - и прегледайте метриките.
      - Проследете използването на приложението по отношение на разходи (токени) и натоварване (заявки).
      - Проследете латентността на приложението до първия байт (обработка на входа) и последния байт (изход).

      ![Agent](../../../../../translated_images/13-monitoring-resources.5148015f7311807f774aaa6a45b7156969ce1b1861d1c34d191c98b61d6d8b84.bg.png)

---

## 8. Променливи на средата

Досега преминахме през разгръщането в браузъра - и валидирахме, че нашата инфраструктура е осигурена и приложението е оперативно. Но за да работим с приложението _на ниво код_, трябва да конфигурираме нашата локална среда за разработка с подходящите променливи, необходими за работа с тези ресурси. Използването на `azd` прави това лесно.

1. Azure Developer CLI [използва променливи на средата](https://learn.microsoft.com/en-us/azure/developer/azure-developer-cli/manage-environment-variables?tabs=bash), за да съхранява и управлява конфигурационни настройки за разгръщанията на приложения.

1. Променливите на средата се съхраняват в `.azure/<env-name>/.env` - това ги ограничава до средата `<env-name>`, използвана по време на разгръщане, и помага за изолиране на среди между различни цели за разгръщане в едно и също хранилище.

1. Променливите на средата се зареждат автоматично от командата `azd`, когато тя изпълнява конкретна команда (напр., `azd up`). Обърнете внимание, че `azd` не чете автоматично _потребителски_ променливи на средата (напр., зададени в shell) - вместо това използвайте `azd set env` и `azd get env`, за да прехвърляте информация в скриптове.

Нека изпробваме няколко команди:

1. Получете всички променливи на средата, зададени за `azd` в тази среда:

      ```bash title="" linenums="0"
      azd env get-values
      ```
      
      Виждате нещо подобно:

      ```bash title="" linenums="0"
      AZURE_AI_AGENT_DEPLOYMENT_NAME="gpt-4o-mini"
      AZURE_AI_AGENT_NAME="agent-template-assistant"
      AZURE_AI_EMBED_DEPLOYMENT_NAME="text-embedding-3-small"
      AZURE_AI_EMBED_DIMENSIONS=100
      ...
      ```

1. Получете конкретна стойност - напр., искам да знам дали сме задали стойността `AZURE_AI_AGENT_MODEL_NAME`

      ```bash title="" linenums="0"
      azd env get-value AZURE_AI_AGENT_MODEL_NAME 
      ```
      
      Виждате нещо подобно - не беше зададено по подразбиране!

      ```bash title="" linenums="0"
      ERROR: key 'AZURE_AI_AGENT_MODEL_NAME' not found in the environment values
      ```

1. Задайте нова променлива на средата за `azd`. Тук актуализираме името на модела на агента. _Забележка: всички направени промени ще бъдат незабавно отразени в `.azure/<env-name>/.env` файла.

      ```bash title="" linenums="0"
      azd env set AZURE_AI_AGENT_MODEL_NAME gpt-4.1
      azd env set AZURE_AI_AGENT_MODEL_VERSION 2025-04-14
      azd env set AZURE_AI_AGENT_DEPLOYMENT_CAPACITY 150
      ```

      Сега трябва да открием, че стойността е зададена:

      ```bash title="" linenums="0"
      azd env get-value AZURE_AI_AGENT_MODEL_NAME 
      ```

1. Обърнете внимание, че някои ресурси са постоянни (напр., разгръщания на модели) и ще изискват повече от просто `azd up`, за да принудят повторно разгръщане. Нека опитаме да премахнем оригиналното разгръщане и да го разположим отново с променени променливи на средата.

1. **Обновяване** Ако преди това сте разположили инфраструктура, използвайки шаблон azd - можете да _обновите_ състоянието на вашите локални променливи на средата въз основа на текущото състояние на вашето Azure разгръщане, използвайки тази команда:
      ```bash title="" linenums="0"
      azd env refresh
      ```

      Това е мощен начин за _синхронизиране_ на променливи на средата между две или повече локални среди за разработка (например екип с множество разработчици) - позволявайки на внедрената инфраструктура да служи като основен източник за състоянието на променливите на средата. Членовете на екипа просто _обновяват_ променливите, за да се синхронизират отново.

---

## 9. Поздравления 🏆

Току-що завършихте цялостен работен процес, в който:

- [X] Избрахте AZD шаблона, който искате да използвате
- [X] Стартирахте шаблона с GitHub Codespaces
- [X] Внедрихте шаблона и потвърдихте, че работи

---

