# роЕроЩрпНроХрпАроХро╛ро░роорпН роорпБро▒рпИ рооро▒рпНро▒рпБроорпН роорпЗро▓ро╛рогрпНроорпИ роЕроЯрпИропро╛ро│роорпН

тП▒я╕П **роородро┐рокрпНрокро┐роЯрокрпНрокроЯрпНроЯ роирпЗро░роорпН**: 45-60 роиро┐рооро┐роЯроЩрпНроХро│рпН | ЁЯТ░ **роЪрпЖро▓ро╡рпБ родро╛роХрпНроХроорпН**: роЗро▓ро╡роЪроорпН (роХрпВроЯрпБродро▓рпН роХроЯрпНроЯрогроЩрпНроХро│рпН роЗро▓рпНро▓рпИ) | тнР **роЪро┐роХрпНроХро▓ро╛ройродрпБ**: роироЯрпБродрпНродро░

**ЁЯУЪ роХро▒рпНро▒ро▓рпН рокро╛родрпИ:**
- тЖР роорпБроирпНродрпИропродрпБ: [роХроЯрпНроЯроорпИрокрпНрокрпБ роорпЗро▓ро╛рогрпНроорпИ](configuration.md) - роЪрпВро┤ро▓рпН рооро╛ро▒ро┐роХро│рпН рооро▒рпНро▒рпБроорпН ро░роХроЪро┐ропроЩрпНроХро│рпИ роиро┐ро░рпНро╡роХро┐родрпНродро▓рпН
- ЁЯОп **роирпАроЩрпНроХро│рпН роЗроЩрпНроХрпЗ**: роЕроЩрпНроХрпАроХро╛ро░роорпН & рокро╛родрпБроХро╛рокрпНрокрпБ (роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│роорпН, роорпБроХрпНроХро┐роп роХро╛рокрпНрокроХроорпН, рокро╛родрпБроХро╛рокрпНрокро╛рой роорпБро▒рпИроХро│рпН)
- тЖТ роЕроЯрпБродрпНродродрпБ: [роорпБродро▓рпН родро┐роЯрпНроЯроорпН](first-project.md) - роЙроЩрпНроХро│рпН роорпБродро▓рпН AZD рокропройрпНрокро╛роЯрпНроЯрпИ роЙро░рпБро╡ро╛роХрпНроХрпБроЩрпНроХро│рпН
- ЁЯПа [рокро╛роЯроирпЖро▒ро┐ роорпБроХрокрпНрокрпБ](../../README.md)

---

## роирпАроЩрпНроХро│рпН роОройрпНрой роХро▒рпНро▒рпБроХрпНроХрпКро│рпНро╡рпАро░рпНроХро│рпН

роЗроирпНрод рокро╛роЯродрпНродрпИ роорпБроЯро┐рокрпНрокродройрпН роорпВро▓роорпН, роирпАроЩрпНроХро│рпН:
- Azure роЕроЩрпНроХрпАроХро╛ро░ роорпБро▒рпИроХро│рпИ (роорпБроХрпНроХро┐ропроЩрпНроХро│рпН, роЗрогрпИрокрпНрокрпБ роЪро░роЩрпНроХро│рпН, роорпЗро▓ро╛рогрпНроорпИ роЕроЯрпИропро╛ро│роорпН) рокрпБро░ро┐роирпНродрпБроХрпКро│рпНро╡рпАро░рпНроХро│рпН
- **роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│роорпН** роорпВро▓роорпН роХроЯро╡рпБроЪрпНроЪрпКро▓рпН роЗро▓рпНро▓ро╛род роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБроЩрпНроХро│рпН
- **Azure Key Vault** роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБроЯройрпН ро░роХроЪро┐ропроЩрпНроХро│рпИ рокро╛родрпБроХро╛роХрпНроХрпБроЩрпНроХро│рпН
- AZD рокро┐ро░роЪро╛ро░роЩрпНроХро│рпБроХрпНроХрпБ **рокроЩрпНроХрпБ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой роЕрогрпБроХро▓рпН роХроЯрпНроЯрпБрокрпНрокро╛роЯрпБ (RBAC)** роЕроорпИроХрпНроХро╡рпБроорпН
- Container Apps рооро▒рпНро▒рпБроорпН Azure роЪрпЗро╡рпИроХро│ро┐ро▓рпН рокро╛родрпБроХро╛рокрпНрокрпБ роЪро┐ро▒роирпНрод роорпБро▒рпИроХро│рпИ рокропройрпНрокроЯрпБродрпНродрпБроЩрпНроХро│рпН
- роорпБроХрпНроХро┐роп роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро┐ро░рпБроирпНродрпБ роЕроЯрпИропро╛ро│ роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой роЕроЩрпНроХрпАроХро╛ро░родрпНродро┐ро▒рпНроХрпБ рооро╛ро▒рпБроЩрпНроХро│рпН

## роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродро┐ройрпН роорпБроХрпНроХро┐ропродрпНродрпБро╡роорпН

### рокро┐ро░роЪрпНроЪро┐ройрпИ: рокро╛ро░роорпНрокро░ро┐роп роЕроЩрпНроХрпАроХро╛ро░роорпН

**роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродро┐ро▒рпНроХрпБ роорпБройрпН:**
```javascript
// тЭМ рокро╛родрпБроХро╛рокрпНрокрпБ роЖрокродрпНродрпБ: роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓рпН роХроЯро┐ройрооро╛роХ роХрпБро▒ро┐роХрпНроХрокрпНрокроЯрпНроЯ ро░роХроЪро┐ропроЩрпНроХро│рпН
const connectionString = "Server=mydb.database.windows.net;User=admin;Password=P@ssw0rd123";
const storageKey = "xK7mN9pQ2wR5tY8uI0oP3aS6dF1gH4jK...";
const cosmosKey = "C2x7B9n4M1p8Q5w3E6r0T2y5U8i1O4p7...";
```

**рокро┐ро░роЪрпНроЪро┐ройрпИроХро│рпН:**
- ЁЯФ┤ **роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓рпН ро╡рпЖро│ро┐рокрпНрокроЯрпИропро╛рой ро░роХроЪро┐ропроЩрпНроХро│рпН**, роХроЯрпНроЯроорпИрокрпНрокрпБ роХрпЛрокрпНрокрпБроХро│рпН, роЪрпВро┤ро▓рпН рооро╛ро▒ро┐роХро│рпН
- ЁЯФ┤ **роЕроЩрпНроХрпАроХро╛ро░ рооро╛ро▒рпНро▒роорпН** роХрпБро▒ро┐ропрпАроЯрпНроЯрпБ рооро╛ро▒рпНро▒роЩрпНроХро│рпН рооро▒рпНро▒рпБроорпН роорпАро│рпНроиро┐ро░рпНро╡ро╛роХроорпН родрпЗро╡рпИ
- ЁЯФ┤ **родрпКроХрпБрокрпНрокрпБроХро│рпН** - ропро╛ро░рпН роОрокрпНрокрпЛродрпБ роЕрогрпБроХро┐ройро╛ро░рпН роОройрпНрокродрпИрокрпН рокро▒рпНро▒ро┐роп роХрогрпНроХро╛рогро┐рокрпНрокрпБ роЪро┐роХрпНроХро▓рпНроХро│рпН
- ЁЯФ┤ **рокро░ро╡ро▓рпН** - рокро▓ роЕроорпИрокрпНрокрпБроХро│ро┐ро▓рпН рокро░ро╡ро┐роп ро░роХроЪро┐ропроЩрпНроХро│рпН
- ЁЯФ┤ **роЗрогроХрпНроХ роЪро┐роХрпНроХро▓рпНроХро│рпН** - рокро╛родрпБроХро╛рокрпНрокрпБ роЖропрпНро╡рпБроХро│рпИ родрпЛро▓рпНро╡ро┐ роЕроЯрпИроХро┐ро▒родрпБ

### родрпАро░рпНро╡рпБ: роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│роорпН

**роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродро┐ро▒рпНроХрпБ рокро┐ройрпН:**
```javascript
// тЬЕ рокро╛родрпБроХро╛рокрпНрокро╛ройродрпБ: роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓рпН ро░роХроЪро┐ропроЩрпНроХро│рпН роЗро▓рпНро▓рпИ
const credential = new DefaultAzureCredential();
const client = new BlobServiceClient(
  "https://mystorageaccount.blob.core.windows.net",
  credential  // Azure родро╛ройро╛роХро╡рпЗ роЕроЩрпНроХрпАроХро╛ро░родрпНродрпИ роХрпИропро╛ро│рпБроХро┐ро▒родрпБ
);
```

**роиройрпНроорпИроХро│рпН:**
- тЬЕ **роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓рпН роЕро▓рпНро▓родрпБ роХроЯрпНроЯроорпИрокрпНрокро┐ро▓рпН ро░роХроЪро┐ропроЩрпНроХро│рпН роЗро▓рпНро▓рпИ**
- тЬЕ **родро╛ройро┐ропроЩрпНроХро┐ рооро╛ро▒рпНро▒роорпН** - Azure роЗродрпИ роиро┐ро░рпНро╡роХро┐роХрпНроХро┐ро▒родрпБ
- тЬЕ **роорпБро┤рпБ роХрогрпНроХро╛рогро┐рокрпНрокрпБ** Azure AD рокродро┐ро╡рпБроХро│ро┐ро▓рпН
- тЬЕ **роорпИропрокрпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯ рокро╛родрпБроХро╛рокрпНрокрпБ** - Azure Portal-ро▓рпН роиро┐ро░рпНро╡роХро┐роХрпНроХро╡рпБроорпН
- тЬЕ **роЗрогроХрпНроХродрпНродрпБроХрпНроХрпБ родропро╛ро░ро╛роХ** - рокро╛родрпБроХро╛рокрпНрокрпБ родро░роЩрпНроХро│рпИ рокрпВро░рпНродрпНродро┐ роЪрпЖропрпНроХро┐ро▒родрпБ

**роЙро░рпБро╡роХроорпН**: рокро╛ро░роорпНрокро░ро┐роп роЕроЩрпНроХрпАроХро╛ро░роорпН роОройрпНрокродрпБ рокро▓ роХродро╡рпБроХро│рпБроХрпНроХрпБ рокро▓ physical роХрпАроХро│рпИ роОроЯрпБродрпНродрпБроЪрпН роЪрпЖро▓рпНро▓рпБро╡родрпБ рокрпЛройрпНро▒родрпБ. роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│роорпН роОройрпНрокродрпБ роЙроЩрпНроХро│рпН роЕроЯрпИропро╛ро│родрпНродро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН родро╛ройро╛роХро╡рпЗ роЕрогрпБроХро▓рпИ ро╡ро┤роЩрпНроХрпБроорпН рокро╛родрпБроХро╛рокрпНрокрпБ роЕроЯрпИропро╛ро│роорпН рокрпЛройрпНро▒родрпБтАФроЗро┤роХрпНроХ, роироХро▓рпЖроЯрпБроХрпНроХ, роЕро▓рпНро▓родрпБ рооро╛ро▒рпНро▒ родрпЗро╡рпИропро┐ро▓рпНро▓рпИ.

---

## роХроЯрпНроЯроорпИрокрпНрокрпБ роХрогрпНрогрпЛроЯрпНроЯроорпН

### роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродрпБроЯройрпН роЕроЩрпНроХрпАроХро╛ро░ роУроЯрпНроЯроорпН

```mermaid
sequenceDiagram
    participant App as роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпБ<br/>(роХрогрпНроЯрпЖропрпНройро░рпН рокропройрпНрокро╛роЯрпБ)
    participant MI as роорпЗро▓ро╛рогрпНроорпИ роЕроЯрпИропро╛ро│роорпН<br/>(роЕроЪрпВро░рпН AD)
    participant KV as роХрпА ро╡ро╛ро▓рпНроЯрпН
    participant Storage as роЕроЪрпВро░рпН роЪрпЗрооро┐рокрпНрокрпБ
    participant DB as роЕроЪрпВро░рпН SQL
    
    App->>MI: роЕрогрпБроХро▓рпН роЯрпЛроХрпНроХройрпИ роХрпЛро░рпБроХ<br/>(родро╛ройро┐ропроЩрпНроХро┐)
    MI->>MI: роЕроЯрпИропро╛ро│родрпНродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН<br/>(роХроЯро╡рпБроЪрпНроЪрпКро▓рпН родрпЗро╡рпИропро┐ро▓рпНро▓рпИ)
    MI-->>App: роЯрпЛроХрпНроХройрпИ родро┐ро░рпБрокрпНрокро╡рпБроорпН<br/>(1 роорогро┐ роирпЗро░родрпНродро┐ро▒рпНроХрпБ роЪрпЖро▓рпНро▓рпБрокроЯро┐ропро╛роХрпБроорпН)
    
    App->>KV: ро░роХроЪро┐ропродрпНродрпИ рокрпЖро▒рпБроХ<br/>(роЯрпЛроХрпНроХройрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐)
    KV->>KV: RBAC роЕройрпБроородро┐роХро│рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
    KV-->>App: ро░роХроЪро┐роп роородро┐рокрпНрокрпИ родро┐ро░рпБрокрпНрокро╡рпБроорпН
    
    App->>Storage: рокро┐ро│ро╛рокрпН рокродро┐ро╡рпЗро▒рпНро▒рпБроХ<br/>(роЯрпЛроХрпНроХройрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐)
    Storage->>Storage: RBAC роЕройрпБроородро┐роХро│рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
    Storage-->>App: ро╡рпЖро▒рпНро▒ро┐
    
    App->>DB: родро░ро╡рпБроХро│рпИ ро╡ро┐ройро╡рпБроХ<br/>(роЯрпЛроХрпНроХройрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐)
    DB->>DB: SQL роЕройрпБроородро┐роХро│рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
    DB-->>App: роорпБроЯро┐ро╡рпБроХро│рпИ родро┐ро░рпБрокрпНрокро╡рпБроорпН
    
    Note over App,DB: роЕройрпИродрпНродрпБ роЕроЩрпНроХрпАроХро╛ро░роорпБроорпН роХроЯро╡рпБроЪрпНроЪрпКро▓рпНро▓ро┐ройрпНро▒ро┐!
```
### роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродро┐ройрпН ро╡роХрпИроХро│рпН

```mermaid
graph TB
    MI[роорпЗро▓ро╛рогрпНроорпИ роЕроЯрпИропро╛ро│роорпН]
    SystemAssigned[роХрогро┐ройро┐ роТродрпБроХрпНроХрокрпНрокроЯрпНроЯ роЕроЯрпИропро╛ро│роорпН]
    UserAssigned[рокропройро░рпН роТродрпБроХрпНроХрокрпНрокроЯрпНроЯ роЕроЯрпИропро╛ро│роорпН]
    
    MI --> SystemAssigned
    MI --> UserAssigned
    
    SystemAssigned --> SA1[ро╡ро│родрпНродрпБроЯройрпН ро╡ро╛ро┤рпНроХрпНроХрпИроЪрпН роЪрпБро┤ро▒рпНроЪро┐ роЗрогрпИроХрпНроХрокрпНрокроЯрпНроЯродрпБ]
    SystemAssigned --> SA2[родро╛ройро┐ропроЩрпНроХрпБроорпН роЙро░рпБро╡ро╛роХрпНроХроорпН/роирпАроХрпНроХроорпН]
    SystemAssigned --> SA3[роТро░рпЗ ро╡ро│родрпНродро┐ро▒рпНроХрпБрокрпН роЪро┐ро▒роирпНродродрпБ]
    
    UserAssigned --> UA1[роЪрпБропро╛родрпАрой ро╡ро╛ро┤рпНроХрпНроХрпИроЪрпН роЪрпБро┤ро▒рпНроЪро┐]
    UserAssigned --> UA2[роХрпИропрпЗроЯрпБ роЙро░рпБро╡ро╛роХрпНроХроорпН/роирпАроХрпНроХроорпН]
    UserAssigned --> UA3[ро╡ро│роЩрпНроХро│рпБроХрпНроХро┐роЯрпИропрпЗ рокроХро┐ро░рокрпНрокроЯрпНроЯродрпБ]
    
    style SystemAssigned fill:#2196F3,stroke:#1976D2,stroke-width:2px,color:#fff
    style UserAssigned fill:#4CAF50,stroke:#388E3C,stroke-width:2px,color:#fff
```
| роЕроорпНроЪроорпН | Resource-роХрпНроХрпБ роТродрпБроХрпНроХрокрпНрокроЯрпНроЯ | рокропройро░рпН-роТродрпБроХрпНроХрокрпНрокроЯрпНроЯ |
|---------|----------------|---------------|
| **ро╡ро╛ро┤рпНроиро┐ро▓рпИ** | Resource-роХрпНроХрпБ роЗрогрпИроХрпНроХрокрпНрокроЯрпНроЯродрпБ | роЪрпБропро╛родрпАройрооро╛ройродрпБ |
| **роЙро░рпБро╡ро╛роХрпНроХроорпН** | Resource роЙроЯройрпН родро╛ройро┐ропроЩрпНроХро┐ | роХрпИропрпЗроЯрпБ роЙро░рпБро╡ро╛роХрпНроХроорпН |
| **роирпАроХрпНроХроорпН** | Resource роЙроЯройрпН роирпАроХрпНроХрокрпНрокроЯрпНроЯродрпБ | Resource роирпАроХрпНроХродрпНродро┐ро▒рпНроХрпБрокрпН рокро┐ро▒роХрпБ родрпКроЯро░рпНроХро┐ро▒родрпБ |
| **рокроХро┐ро░рпНро╡рпБ** | роТро░рпБ Resource роороЯрпНроЯрпБроорпН | рокро▓ Resource-роХро│рпН |
| **рокропройрпНрокро╛роЯрпНроЯрпБ ро╡ро┤роХрпНроХрпБ** | роОро│ро┐роп роЪрпВро┤ро▓рпНроХро│рпН | роЪро┐роХрпНроХро▓ро╛рой рокро▓ Resource роЪрпВро┤ро▓рпНроХро│рпН |
| **AZD роЗропро▓рпНрокрпБроиро┐ро▓рпИ** | тЬЕ рокро░ро┐роирпНродрпБро░рпИроХрпНроХрокрпНрокроЯрпНроЯродрпБ | ро╡ро┐ро░рпБрокрпНрокроорпН |

---

## роорпБройрпН родрпЗро╡рпИроХро│рпН

### родрпЗро╡рпИропро╛рой роХро░рпБро╡ро┐роХро│рпН

роорпБроирпНродрпИроп рокро╛роЯроЩрпНроХро│ро┐ро▓рпН роЗро░рпБроирпНродрпБ роирпАроЩрпНроХро│рпН роПро▒рпНроХройро╡рпЗ роЗро╡рпИ роиро┐ро▒рпБро╡ро┐ропро┐ро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН:

```bash
# Azure Developer CLI роР роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
azd version
# тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ: azd рокродро┐рокрпНрокрпБ 1.0.0 роЕро▓рпНро▓родрпБ роЕродро▒рпНроХрпБ роорпЗро▓рпН

# Azure CLI роР роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az --version
# тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ: azure-cli 2.50.0 роЕро▓рпНро▓родрпБ роЕродро▒рпНроХрпБ роорпЗро▓рпН
```

### Azure родрпЗро╡рпИроХро│рпН

- роЪрпЖропро▓ро┐ро▓рпН Azure роЪроирпНродро╛
- роЕройрпБроородро┐роХро│рпН:
  - роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│роЩрпНроХро│рпИ роЙро░рпБро╡ро╛роХрпНроХ
  - RBAC рокроЩрпНроХрпБроХро│рпИ роТродрпБроХрпНроХ
  - Key Vault ро╡ро│роЩрпНроХро│рпИ роЙро░рпБро╡ро╛роХрпНроХ
  - Container Apps-роР рокро┐ро░роЪро╛ро░роорпН роЪрпЖропрпНроп

### роЕро▒ро┐ро╡рпБ роорпБройрпН родрпЗро╡рпИроХро│рпН

роирпАроЩрпНроХро│рпН роорпБроЯро┐родрпНродро┐ро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН:
- [роиро┐ро▒рпБро╡ро▓рпН ро╡ро┤ро┐роХро╛роЯрпНроЯро┐](installation.md) - AZD роЕроорпИрокрпНрокрпБ
- [AZD роЕроЯро┐рокрпНрокроЯрпИроХро│рпН](azd-basics.md) - роорпБроХрпНроХро┐роп роХро░рпБродрпНродрпБроХрпНроХро│рпН
- [роХроЯрпНроЯроорпИрокрпНрокрпБ роорпЗро▓ро╛рогрпНроорпИ](configuration.md) - роЪрпВро┤ро▓рпН рооро╛ро▒ро┐роХро│рпН

---

## рокро╛роЯроорпН 1: роЕроЩрпНроХрпАроХро╛ро░ роорпБро▒рпИроХро│рпИрокрпН рокрпБро░ро┐роирпНродрпБроХрпКро│рпНро╡родрпБ

### роорпБро▒рпИ 1: роЗрогрпИрокрпНрокрпБ роЪро░роЩрпНроХро│рпН (рокро╛ро░роорпНрокро░ро┐ропроорпН - родро╡ро┐ро░рпНроХрпНроХро╡рпБроорпН)

**роЗродрпБ роОрокрпНрокроЯро┐ ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ро▒родрпБ:**
```bash
# роЗрогрпИрокрпНрокрпБ роЪро░роорпН роироорпНрокроХродрпНродройрпНроорпИроХро│рпИ роХрпКрогрпНроЯрпБро│рпНро│родрпБ
STORAGE_CONNECTION_STRING="DefaultEndpointsProtocol=https;AccountName=myaccount;AccountKey=xK7mN9pQ2wR5..."
COSMOS_CONNECTION_STRING="AccountEndpoint=https://myaccount.documents.azure.com:443/;AccountKey=C2x7..."
SQL_CONNECTION_STRING="Server=myserver.database.windows.net;User=admin;Password=P@ssw0rd..."
```

**рокро┐ро░роЪрпНроЪро┐ройрпИроХро│рпН:**
- тЭМ роЪрпВро┤ро▓рпН рооро╛ро▒ро┐роХро│ро┐ро▓рпН ро╡рпЖро│ро┐рокрпНрокроЯрпИропро╛рой ро░роХроЪро┐ропроЩрпНроХро│рпН
- тЭМ Deployment роЕроорпИрокрпНрокрпБроХро│ро┐ро▓рпН рокродро┐ро╡рпБ роЪрпЖропрпНропрокрпНрокроЯрпНроЯродрпБ
- тЭМ рооро╛ро▒рпНро▒роорпН роХроЯро┐ройроорпН
- тЭМ роЕрогрпБроХро▓ро┐ройрпН роХрогрпНроХро╛рогро┐рокрпНрокрпБ роЗро▓рпНро▓рпИ

**роОрокрпНрокрпЛродрпБ рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН:** роЙро│рпНро│рпВро░рпН роорпЗроорпНрокро╛роЯрпНроЯро┐ро▒рпНроХро╛роХ роороЯрпНроЯрпБроорпЗ, роЙро▒рпНрокродрпНродро┐ропро┐ро▓рпН роТро░рпБрокрпЛродрпБроорпН роЗро▓рпНро▓рпИ.

---

### роорпБро▒рпИ 2: Key Vault роХрпБро▒ро┐рокрпНрокрпБроХро│рпН (роЪро┐ро▒роирпНродродрпБ)

**роЗродрпБ роОрокрпНрокроЯро┐ ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ро▒родрпБ:**
```bicep
// Store secret in Key Vault
resource keyVault 'Microsoft.KeyVault/vaults@2023-02-01' = {
  name: 'mykv'
  properties: {
    enableRbacAuthorization: true
  }
}

// Reference in Container App
env: [
  {
    name: 'STORAGE_KEY'
    secretRef: 'storage-key'  // References Key Vault
  }
]
```

**роиройрпНроорпИроХро│рпН:**
- тЬЕ Key Vault-ро▓рпН рокро╛родрпБроХро╛рокрпНрокро╛роХ ро░роХроЪро┐ропроЩрпНроХро│рпН роЪрпЗрооро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ
- тЬЕ роорпИропрокрпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯ ро░роХроЪро┐роп роорпЗро▓ро╛рогрпНроорпИ
- тЬЕ роХрпБро▒ро┐ропрпАроЯрпНроЯрпБ рооро╛ро▒рпНро▒роЩрпНроХро│рпН роЗро▓рпНро▓ро╛рооро▓рпН рооро╛ро▒рпНро▒роорпН

**роорпБроЯрпБроХрпНроХроЩрпНроХро│рпН:**
- тЪая╕П роЗройрпНройрпБроорпН роорпБроХрпНроХро┐ропроЩрпНроХро│рпН/роХроЯро╡рпБроЪрпНроЪрпКро▒рпНроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ
- тЪая╕П Key Vault роЕрогрпБроХро▓рпИ роиро┐ро░рпНро╡роХро┐роХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН

**роОрокрпНрокрпЛродрпБ рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН:** роЗрогрпИрокрпНрокрпБ роЪро░роЩрпНроХро│ро┐ро▓ро┐ро░рпБроирпНродрпБ роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродро┐ро▒рпНроХрпБ рооро╛ро▒рпБроорпН роЗроЯрпИроиро┐ро▓рпИ.

---

### роорпБро▒рпИ 3: роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│роорпН (роЪро┐ро▒роирпНрод роироЯрпИроорпБро▒рпИ)

**роЗродрпБ роОрокрпНрокроЯро┐ ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ро▒родрпБ:**
```bicep
// Enable managed identity
resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'myapp'
  identity: {
    type: 'SystemAssigned'  // Automatically creates identity
  }
}

// Grant permissions
resource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  scope: storageAccount
  properties: {
    roleDefinitionId: storageBlobDataContributorRole
    principalId: containerApp.identity.principalId
  }
}
```

**рокропройрпНрокро╛роЯрпНроЯрпБ роХрпБро▒ро┐ропрпАроЯрпБ:**
```javascript
// ро░роХроЪро┐ропроЩрпНроХро│рпН родрпЗро╡рпИропро┐ро▓рпНро▓рпИ!
const { DefaultAzureCredential } = require('@azure/identity');
const { BlobServiceClient } = require('@azure/storage-blob');

const credential = new DefaultAzureCredential();
const blobServiceClient = new BlobServiceClient(
  'https://mystorageaccount.blob.core.windows.net',
  credential
);
```

**роиройрпНроорпИроХро│рпН:**
- тЬЕ роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓рпН/роХроЯрпНроЯроорпИрокрпНрокро┐ро▓рпН ро░роХроЪро┐ропроЩрпНроХро│рпН роЗро▓рпНро▓рпИ
- тЬЕ родро╛ройро┐ропроЩрпНроХро┐ роЕроЩрпНроХрпАроХро╛ро░ рооро╛ро▒рпНро▒роорпН
- тЬЕ роорпБро┤рпБ роХрогрпНроХро╛рогро┐рокрпНрокрпБ
- тЬЕ RBAC роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой роЕройрпБроородро┐роХро│рпН
- тЬЕ роЗрогроХрпНроХродрпНродрпБроХрпНроХрпБ родропро╛ро░ро╛роХ

**роОрокрпНрокрпЛродрпБ рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН:** роОрокрпНрокрпЛродрпБроорпН, роЙро▒рпНрокродрпНродро┐ рокропройрпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ.

---

## рокро╛роЯроорпН 2: AZD роЙроЯройрпН роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродрпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБродро▓рпН

### рокроЯро┐рокрпНрокроЯро┐ропро╛роХ роЪрпЖропро▓рпНрокроЯрпБродрпНродро▓рпН

Azure Storage рооро▒рпНро▒рпБроорпН Key Vault-роР роЕрогрпБроХ роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБроорпН роТро░рпБ рокро╛родрпБроХро╛рокрпНрокро╛рой Container App-роР роЙро░рпБро╡ро╛роХрпНроХрпБро╡рпЛроорпН.

### родро┐роЯрпНроЯ роЕроорпИрокрпНрокрпБ

```
secure-app/
тФЬтФАтФА azure.yaml                 # AZD configuration
тФЬтФАтФА infra/
тФВ   тФЬтФАтФА main.bicep            # Main infrastructure
тФВ   тФЬтФАтФА core/
тФВ   тФВ   тФЬтФАтФА identity.bicep    # Managed identity setup
тФВ   тФВ   тФЬтФАтФА keyvault.bicep    # Key Vault configuration
тФВ   тФВ   тФФтФАтФА storage.bicep     # Storage with RBAC
тФВ   тФФтФАтФА app/
тФВ       тФФтФАтФА container-app.bicep
тФФтФАтФА src/
    тФЬтФАтФА app.js                # Application code
    тФЬтФАтФА package.json
    тФФтФАтФА Dockerfile
```

### 1. AZD-роР роХроЯрпНроЯроорпИроХрпНроХро╡рпБроорпН (azure.yaml)

```yaml
name: secure-app
metadata:
  template: secure-app@1.0.0

services:
  api:
    project: ./src
    language: js
    host: containerapp

# Enable managed identity (AZD handles this automatically)
```

### 2. роЕроЯро┐рокрпНрокроЯрпИ: роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродрпИ роЗропроХрпНроХро╡рпБроорпН

**роХрпЛрокрпНрокрпБ: `infra/main.bicep`**

```bicep
targetScope = 'subscription'

param environmentName string
param location string = 'eastus'

var tags = { 'azd-env-name': environmentName }

// Resource group
resource rg 'Microsoft.Resources/resourceGroups@2021-04-01' = {
  name: 'rg-${environmentName}'
  location: location
  tags: tags
}

// Storage Account
module storage './core/storage.bicep' = {
  name: 'storage'
  scope: rg
  params: {
    name: 'st${uniqueString(rg.id)}'
    location: location
    tags: tags
  }
}

// Key Vault
module keyVault './core/keyvault.bicep' = {
  name: 'keyvault'
  scope: rg
  params: {
    name: 'kv-${uniqueString(rg.id)}'
    location: location
    tags: tags
  }
}

// Container App with Managed Identity
module containerApp './app/container-app.bicep' = {
  name: 'container-app'
  scope: rg
  params: {
    name: 'ca-${environmentName}'
    location: location
    tags: tags
    storageAccountName: storage.outputs.name
    keyVaultName: keyVault.outputs.name
  }
}

// Grant Container App access to Storage
module storageRoleAssignment './core/role-assignment.bicep' = {
  name: 'storage-role'
  scope: rg
  params: {
    principalId: containerApp.outputs.identityPrincipalId
    roleDefinitionId: 'ba92f5b4-2d11-453d-a403-e96b0029c9fe'  // Storage Blob Data Contributor
    targetResourceId: storage.outputs.id
  }
}

// Grant Container App access to Key Vault
module kvRoleAssignment './core/role-assignment.bicep' = {
  name: 'kv-role'
  scope: rg
  params: {
    principalId: containerApp.outputs.identityPrincipalId
    roleDefinitionId: '4633458b-17de-408a-b874-0445c86b69e6'  // Key Vault Secrets User
    targetResourceId: keyVault.outputs.id
  }
}

// Outputs
output AZURE_STORAGE_ACCOUNT_NAME string = storage.outputs.name
output AZURE_KEY_VAULT_NAME string = keyVault.outputs.name
output APP_URL string = containerApp.outputs.url
```

### 3. System-Assigned Identity роЙроЯройрпН Container App

**роХрпЛрокрпНрокрпБ: `infra/app/container-app.bicep`**

```bicep
param name string
param location string
param tags object = {}
param storageAccountName string
param keyVaultName string

resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
  name: name
  location: location
  tags: tags
  identity: {
    type: 'SystemAssigned'  // ЁЯФС Enable managed identity
  }
  properties: {
    configuration: {
      ingress: {
        external: true
        targetPort: 3000
      }
    }
    template: {
      containers: [
        {
          name: 'api'
          image: 'myregistry.azurecr.io/api:latest'
          resources: {
            cpu: json('0.5')
            memory: '1Gi'
          }
          env: [
            {
              name: 'AZURE_STORAGE_ACCOUNT_NAME'
              value: storageAccountName
            }
            {
              name: 'AZURE_KEY_VAULT_NAME'
              value: keyVaultName
            }
            // ЁЯФС No secrets - managed identity handles authentication!
          ]
        }
      ]
    }
  }
}

// Output the identity for RBAC assignments
output identityPrincipalId string = containerApp.identity.principalId
output id string = containerApp.id
output url string = 'https://${containerApp.properties.configuration.ingress.fqdn}'
```

### 4. RBAC рокроЩрпНроХрпБ роТродрпБроХрпНроХрпАроЯрпНроЯрпБ родрпКроХрпБродро┐

**роХрпЛрокрпНрокрпБ: `infra/core/role-assignment.bicep`**

```bicep
param principalId string
param roleDefinitionId string  // Azure built-in role ID
param targetResourceId string

resource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  name: guid(principalId, roleDefinitionId, targetResourceId)
  scope: resourceId('Microsoft.Resources/resourceGroups', resourceGroup().name)
  properties: {
    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', roleDefinitionId)
    principalId: principalId
    principalType: 'ServicePrincipal'
  }
}

output id string = roleAssignment.id
```

### 5. роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродрпБроЯройрпН рокропройрпНрокро╛роЯрпНроЯрпБ роХрпБро▒ро┐ропрпАроЯрпБ

**роХрпЛрокрпНрокрпБ: `src/app.js`**

```javascript
const express = require('express');
const { DefaultAzureCredential } = require('@azure/identity');
const { BlobServiceClient } = require('@azure/storage-blob');
const { SecretClient } = require('@azure/keyvault-secrets');

const app = express();
const PORT = process.env.PORT || 3000;

// ЁЯФС роЪро╛ройрпНро▒рпБроХро│рпИ родрпКроЯроЩрпНроХро╡рпБроорпН (роорпЗро▓ро╛рогрпНроорпИ роЕроЯрпИропро╛ро│родрпНродрпБроЯройрпН родро╛ройро╛роХро╡рпЗ роЪрпЖропро▓рпНрокроЯрпБроХро┐ро▒родрпБ)
const credential = new DefaultAzureCredential();

// Azure Storage роЕроорпИрокрпНрокрпБ
const storageAccountName = process.env.AZURE_STORAGE_ACCOUNT_NAME;
const blobServiceClient = new BlobServiceClient(
  `https://${storageAccountName}.blob.core.windows.net`,
  credential  // роОроирпНрод ро╡ро┐роЪрпИроХро│рпБроорпН родрпЗро╡рпИропро┐ро▓рпНро▓рпИ!
);

// Key Vault роЕроорпИрокрпНрокрпБ
const keyVaultName = process.env.AZURE_KEY_VAULT_NAME;
const secretClient = new SecretClient(
  `https://${keyVaultName}.vault.azure.net`,
  credential  // роОроирпНрод ро╡ро┐роЪрпИроХро│рпБроорпН родрпЗро╡рпИропро┐ро▓рпНро▓рпИ!
);

// роЖро░рпЛроХрпНроХро┐роп роЪрпЛродройрпИ
app.get('/health', (req, res) => {
  res.json({ status: 'healthy', authentication: 'managed-identity' });
});

// рокрпНро│ро╛рокрпН роЪрпЗрооро┐рокрпНрокроХродрпНродро┐ро▒рпНроХрпБ роХрпЛрокрпНрокрпИ рокродро┐ро╡рпЗро▒рпНро▒ро╡рпБроорпН
app.post('/upload', async (req, res) => {
  try {
    const containerClient = blobServiceClient.getContainerClient('uploads');
    await containerClient.createIfNotExists();
    
    const blobName = `file-${Date.now()}.txt`;
    const blockBlobClient = containerClient.getBlockBlobClient(blobName);
    
    await blockBlobClient.upload('Hello from managed identity!', 30);
    
    res.json({
      success: true,
      blobName: blobName,
      message: 'File uploaded using managed identity!'
    });
  } catch (error) {
    console.error('Upload error:', error);
    res.status(500).json({ error: error.message });
  }
});

// Key Vault роЗро▓ро┐ро░рпБроирпНродрпБ ро░роХроЪро┐ропродрпНродрпИ рокрпЖро▒ро╡рпБроорпН
app.get('/secret/:name', async (req, res) => {
  try {
    const secretName = req.params.name;
    const secret = await secretClient.getSecret(secretName);
    
    res.json({
      name: secretName,
      value: secret.value,
      message: 'Secret retrieved using managed identity!'
    });
  } catch (error) {
    console.error('Secret error:', error);
    res.status(500).json({ error: error.message });
  }
});

// рокрпНро│ро╛рокрпН роХрпЖрогрпНроЯрпЖропрпНройро░рпНроХро│рпИ рокроЯрпНроЯро┐ропро▓ро┐роЯро╡рпБроорпН (рокроЯро┐роХрпНроХ роЕройрпБроородро┐ропрпИ роХро╛роЯрпНроЯрпБроХро┐ро▒родрпБ)
app.get('/containers', async (req, res) => {
  try {
    const containers = [];
    for await (const container of blobServiceClient.listContainers()) {
      containers.push(container.name);
    }
    
    res.json({
      containers: containers,
      count: containers.length,
      message: 'Containers listed using managed identity!'
    });
  } catch (error) {
    console.error('List error:', error);
    res.status(500).json({ error: error.message });
  }
});

app.listen(PORT, () => {
  console.log(`Secure API listening on port ${PORT}`);
  console.log('Authentication: Managed Identity (passwordless)');
});
```

**роХрпЛрокрпНрокрпБ: `src/package.json`**

```json
{
  "name": "secure-app",
  "version": "1.0.0",
  "dependencies": {
    "express": "^4.18.2",
    "@azure/identity": "^4.0.0",
    "@azure/storage-blob": "^12.17.0",
    "@azure/keyvault-secrets": "^4.7.0"
  },
  "scripts": {
    "start": "node app.js"
  }
}
```

### 6. рокро┐ро░роЪро╛ро░роорпН рооро▒рпНро▒рпБроорпН роЪрпЛродройрпИ

```bash
# AZD роЪрпВро┤ро▓рпИ родрпКроЯроЩрпНроХро╡рпБроорпН
azd init

# роЕроЯрпБроХрпНроХроорпИрокрпНрокрпБ рооро▒рпНро▒рпБроорпН рокропройрпНрокро╛роЯрпНроЯрпИ рокро┐ро░роЪрпБро░ро┐роХрпНроХро╡рпБроорпН
azd up

# рокропройрпНрокро╛роЯрпНроЯро┐ройрпН URL роР рокрпЖро▒ро╡рпБроорпН
APP_URL=$(azd env get-values | grep APP_URL | cut -d '=' -f2 | tr -d '"')

# роЖро░рпЛроХрпНроХро┐роп роЪрпЛродройрпИропрпИ роЪрпЛродро┐роХрпНроХро╡рпБроорпН
curl $APP_URL/health
```

**тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпБроорпН ро╡рпЖро│ро┐ропрпАроЯрпБ:**
```json
{
  "status": "healthy",
  "authentication": "managed-identity"
}
```

**Blob upload роЪрпЛродройрпИ:**
```bash
curl -X POST $APP_URL/upload
```

**тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпБроорпН ро╡рпЖро│ро┐ропрпАроЯрпБ:**
```json
{
  "success": true,
  "blobName": "file-1700404800000.txt",
  "message": "File uploaded using managed identity!"
}
```

**Container listing роЪрпЛродройрпИ:**
```bash
curl $APP_URL/containers
```

**тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпБроорпН ро╡рпЖро│ро┐ропрпАроЯрпБ:**
```json
{
  "containers": ["uploads"],
  "count": 1,
  "message": "Containers listed using managed identity!"
}
```

---

## рокрпКродрпБро╡ро╛рой Azure RBAC рокроЩрпНроХрпБроХро│рпН

### роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродро┐ро▒рпНроХро╛рой Built-in Role IDs

| роЪрпЗро╡рпИ | рокроЩрпНроХрпБ рокрпЖропро░рпН | Role ID | роЕройрпБроородро┐роХро│рпН |
|---------|-----------|---------|-------------|
| **Storage** | Storage Blob Data Reader | `2a2b9908-6b94-4a3d-8e5a-a7d8f8cc8a12` | Blobs рооро▒рпНро▒рпБроорпН Containers-роР рокроЯро┐роХрпНроХ |
| **Storage** | Storage Blob Data Contributor | `ba92f5b4-2d11-453d-a403-e96b0029c9fe` | Blobs-роР рокроЯро┐роХрпНроХ, роОро┤рпБрод, роирпАроХрпНроХ |
| **Storage** | Storage Queue Data Contributor | `974c5e8b-45b9-4653-ba55-5f855dd0fb88` | Queue Messages-роР рокроЯро┐роХрпНроХ, роОро┤рпБрод, роирпАроХрпНроХ |
| **Key Vault** | Key Vault Secrets User | `4633458b-17de-408a-b874-0445c86b69e6` | ро░роХроЪро┐ропроЩрпНроХро│рпИ рокроЯро┐роХрпНроХ |
| **Key Vault** | Key Vault Secrets Officer | `b86a8fe4-44ce-4948-aee5-eccb2c155cd7` | ро░роХроЪро┐ропроЩрпНроХро│рпИ рокроЯро┐роХрпНроХ, роОро┤рпБрод, роирпАроХрпНроХ |
| **Cosmos DB** | Cosmos DB Built-in Data Reader | `00000000-0000-0000-0000-000000000001` | Cosmos DB родро░ро╡рпБроХро│рпИ рокроЯро┐роХрпНроХ |
| **Cosmos DB** | Cosmos DB Built-in Data Contributor | `00000000-0000-0000-0000-000000000002` | Cosmos DB родро░ро╡рпБроХро│рпИ рокроЯро┐роХрпНроХ, роОро┤рпБрод |
| **SQL Database** | SQL DB Contributor | `9b7fa17d-e63e-47b0-bb0a-15c516ac86ec` | SQL родро░ро╡рпБродрпНродрпКроХрпБрокрпНрокрпБроХро│рпИ роиро┐ро░рпНро╡роХро┐роХрпНроХ |
| **Service Bus** | Azure Service Bus Data Owner | `090c5cfd-751d-490a-894a-3ce6f1109419` | Messages-роР роЕройрпБрокрпНрок, рокрпЖро▒, роиро┐ро░рпНро╡роХро┐роХрпНроХ |

### Role IDs-роР роОро╡рпНро╡ро╛ро▒рпБ роХрогрпНроЯро▒ро┐ро╡родрпБ

```bash
# роЕройрпИродрпНродрпБ роЙро│рпНро│роорпИроХрпНроХрокрпНрокроЯрпНроЯ ро╡рпЗроЯроЩрпНроХро│рпИ рокроЯрпНроЯро┐ропро▓ро┐роЯро╡рпБроорпН
az role definition list --query "[].{Name:roleName, ID:name}" --output table

# роХрпБро▒ро┐рокрпНрокро┐роЯрпНроЯ ро╡рпЗроЯродрпНродрпИ родрпЗроЯро╡рпБроорпН
az role definition list --query "[?contains(roleName, 'Storage Blob')].{Name:roleName, ID:name}" --output table

# ро╡рпЗроЯ ро╡ро┐ро╡ро░роЩрпНроХро│рпИ рокрпЖро▒ро╡рпБроорпН
az role definition list --name "Storage Blob Data Contributor"
```

---

## роироЯрпИроорпБро▒рпИ рокропро┐ро▒рпНроЪро┐роХро│рпН

### рокропро┐ро▒рпНроЪро┐ 1: роЙро│рпНро│роорпИроирпНрод рокропройрпНрокро╛роЯрпНроЯро┐ро▒рпНроХрпБ роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродрпИ роЗропроХрпНроХро╡рпБроорпН тнРтнР (роироЯрпБродрпНродро░)

**роирпЛроХрпНроХроорпН**: роЙро│рпНро│роорпИроирпНрод Container App рокро┐ро░роЪро╛ро░родрпНродро┐ро▒рпНроХрпБ роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН

**роЪрпВро┤ро▓рпН**: роирпАроЩрпНроХро│рпН роЗрогрпИрокрпНрокрпБ роЪро░роЩрпНроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБроорпН Container App-роР ро╡рпИродрпНродро┐ро░рпБроХрпНроХро┐ро▒рпАро░рпНроХро│рпН. роЕродрпИ роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродро┐ро▒рпНроХрпБ рооро╛ро▒рпНро▒ро╡рпБроорпН.

**родрпКроЯроХрпНроХ рокрпБро│рпНро│ро┐**: роЗроирпНрод роХроЯрпНроЯроорпИрокрпНрокрпБроЯройрпН Container App:

```bicep
// тЭМ Current: Using connection string
env: [
  {
    name: 'STORAGE_CONNECTION_STRING'
    secretRef: 'storage-connection'
  }
]
```

**рокроЯро┐роХро│рпН**:

1. **Bicep-ро▓рпН роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродрпИ роЗропроХрпНроХро╡рпБроорпН:**

```bicep
resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'myapp'
  identity: {
    type: 'SystemAssigned'  // Add this
  }
  // ... rest of configuration
}
```

2. **Storage роЕрогрпБроХро▓рпИ ро╡ро┤роЩрпНроХро╡рпБроорпН:**

```bicep
// Get storage account reference
resource storageAccount 'Microsoft.Storage/storageAccounts@2023-01-01' existing = {
  name: storageAccountName
}

// Assign role
resource roleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  name: guid(containerApp.id, 'ba92f5b4-2d11-453d-a403-e96b0029c9fe', storageAccount.id)
  scope: storageAccount
  properties: {
    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')
    principalId: containerApp.identity.principalId
    principalType: 'ServicePrincipal'
  }
}
```

3. **рокропройрпНрокро╛роЯрпНроЯрпБ роХрпБро▒ро┐ропрпАроЯрпНроЯрпИ рокрпБродрпБрокрпНрокро┐роХрпНроХро╡рпБроорпН:**

**роорпБройрпН (роЗрогрпИрокрпНрокрпБ роЪро░роорпН):**
```javascript
const { BlobServiceClient } = require('@azure/storage-blob');

const blobServiceClient = BlobServiceClient.fromConnectionString(
  process.env.STORAGE_CONNECTION_STRING
);
```

**рокро┐ройрпН (роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│роорпН):**
```javascript
const { DefaultAzureCredential } = require('@azure/identity');
const { BlobServiceClient } = require('@azure/storage-blob');

const credential = new DefaultAzureCredential();
const blobServiceClient = new BlobServiceClient(
  `https://${process.env.STORAGE_ACCOUNT_NAME}.blob.core.windows.net`,
  credential
);
```

4. **роЪрпВро┤ро▓рпН рооро╛ро▒ро┐роХро│рпИ рокрпБродрпБрокрпНрокро┐роХрпНроХро╡рпБроорпН:**

```bicep
env: [
  {
    name: 'STORAGE_ACCOUNT_NAME'
    value: storageAccountName  // Just the name, no secrets!
  }
  // Remove STORAGE_CONNECTION_STRING
]
```

5. **рокро┐ро░роЪро╛ро░роорпН рооро▒рпНро▒рпБроорпН роЪрпЛродройрпИ:**

```bash
# роорпАрогрпНроЯрпБроорпН рокро┐ро░ропрпЛроХро┐роХрпНроХро╡рпБроорпН
azd up

# роЗродрпБ роЗройрпНройрпБроорпН роЪрпЖропро▓рпНрокроЯрпБроХро┐ро▒родро╛ роОройрпНрокродрпИ роЪрпЛродро┐роХрпНроХро╡рпБроорпН
curl https://myapp.azurecontainerapps.io/upload
```

**тЬЕ ро╡рпЖро▒рпНро▒ро┐ропро┐ройрпН роЕро│ро╡рпБроХрпЛро▓рпН:**
- тЬЕ рокропройрпНрокро╛роЯрпБ рокро┐ро┤рпИроХро│рпН роЗро▓рпНро▓ро╛рооро▓рпН рокро┐ро░роЪро╛ро░роорпН роЪрпЖропрпНропрокрпНрокроЯрпБроХро┐ро▒родрпБ
- тЬЕ Storage роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпН ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ро▒родрпБ (upload, list, download)
- тЬЕ роЪрпВро┤ро▓рпН рооро╛ро▒ро┐роХро│ро┐ро▓рпН роЗрогрпИрокрпНрокрпБ роЪро░роЩрпНроХро│рпН роЗро▓рпНро▓рпИ
- тЬЕ Azure Portal-ро▓рпН "Identity" blade-роЗро▓рпН роЕроЯрпИропро╛ро│роорпН роХро╛рогрокрпНрокроЯрпБроХро┐ро▒родрпБ

**роЪро░ро┐рокро╛ро░рпНрокрпНрокрпБ:**

```bash
# роорпЗро▓ро╛рогрпНроорпИ роЕроЯрпИропро╛ро│роорпН роЗропроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родро╛ роОройрпНрокродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az containerapp show \
  --name myapp \
  --resource-group rg-myapp \
  --query "identity.type"
# тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ: "SystemAssigned"

# рокроЩрпНроХрпБ роТродрпБроХрпНроХрпАроЯрпНроЯрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az role assignment list \
  --assignee $(az containerapp show --name myapp --resource-group rg-myapp --query "identity.principalId" -o tsv) \
  --scope /subscriptions/{sub-id}/resourceGroups/rg-myapp/providers/Microsoft.Storage/storageAccounts/mystorageaccount
# тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ: "Storage Blob Data Contributor" рокроЩрпНроХрпБ роХро╛роЯрпНроЯрпБроХро┐ро▒родрпБ
```

**роирпЗро░роорпН**: 20-30 роиро┐рооро┐роЯроЩрпНроХро│рпН

---

### рокропро┐ро▒рпНроЪро┐ 2: рокро▓ роЪрпЗро╡рпИроХро│рпБроЯройрпН User-Assigned Identity тнРтнРтнР (роорпЗроорпНрокроЯрпНроЯродрпБ)

**роирпЛроХрпНроХроорпН**: рокро▓ Container Apps-роХрпНроХрпБ рокроХро┐ро░рокрпНрокроЯрпНроЯ User-Assigned Identity роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН

**роЪрпВро┤ро▓рпН**: роЙроЩрпНроХро│рпБроХрпНроХрпБ роТро░рпЗ Storage роХрогроХрпНроХрпБ рооро▒рпНро▒рпБроорпН Key Vault-роР роЕрогрпБроХ 3 роорпИроХрпНро░рпЛроЪрпЗро╡рпИроХро│рпН родрпЗро╡рпИ.

**рокроЯро┐роХро│рпН**:

1. **User-Assigned Identity роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН:**

**роХрпЛрокрпНрокрпБ: `infra/core/identity.bicep`**

```bicep
param name string
param location string
param tags object = {}

resource userAssignedIdentity 'Microsoft.ManagedIdentity/userAssignedIdentities@2023-01-31' = {
  name: name
  location: location
  tags: tags
}

output id string = userAssignedIdentity.id
output principalId string = userAssignedIdentity.properties.principalId
output clientId string = userAssignedIdentity.properties.clientId
```

2. **User-Assigned Identity-роХрпНроХрпБ рокроЩрпНроХрпБроХро│рпИ роТродрпБроХрпНроХро╡рпБроорпН:**

```bicep
// In main.bicep
module userIdentity './core/identity.bicep' = {
  name: 'user-identity'
  scope: rg
  params: {
    name: 'id-${environmentName}'
    location: location
    tags: tags
  }
}

// Grant Storage access
resource storageRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  name: guid(userIdentity.outputs.principalId, 'storage-contributor')
  scope: storageAccount
  properties: {
    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', 'ba92f5b4-2d11-453d-a403-e96b0029c9fe')
    principalId: userIdentity.outputs.principalId
    principalType: 'ServicePrincipal'
  }
}

// Grant Key Vault access
resource kvRoleAssignment 'Microsoft.Authorization/roleAssignments@2022-04-01' = {
  name: guid(userIdentity.outputs.principalId, 'kv-secrets-user')
  scope: keyVault
  properties: {
    roleDefinitionId: subscriptionResourceId('Microsoft.Authorization/roleDefinitions', '4633458b-17de-408a-b874-0445c86b69e6')
    principalId: userIdentity.outputs.principalId
    principalType: 'ServicePrincipal'
  }
}
```

3. **рокро▓ Container Apps-роХрпНроХрпБ Identity-роР роТродрпБроХрпНроХро╡рпБроорпН:**

```bicep
resource apiGateway 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'api-gateway'
  identity: {
    type: 'UserAssigned'
    userAssignedIdentities: {
      '${userIdentity.outputs.id}': {}
    }
  }
  // ... rest of config
}

resource productService 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'product-service'
  identity: {
    type: 'UserAssigned'
    userAssignedIdentities: {
      '${userIdentity.outputs.id}': {}
    }
  }
  // ... rest of config
}

resource orderService 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'order-service'
  identity: {
    type: 'UserAssigned'
    userAssignedIdentities: {
      '${userIdentity.outputs.id}': {}
    }
  }
  // ... rest of config
}
```

4. **рокропройрпНрокро╛роЯрпНроЯрпБ роХрпБро▒ро┐ропрпАроЯрпБ (роЕройрпИродрпНродрпБ роЪрпЗро╡рпИроХро│рпБроорпН роТро░рпЗ роорпБро▒рпИропрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ):**

```javascript
const { DefaultAzureCredential, ManagedIdentityCredential } = require('@azure/identity');

// рокропройро░рпН роТродрпБроХрпНроХрокрпНрокроЯрпНроЯ роЕроЯрпИропро╛ро│родрпНродро┐ро▒рпНроХро╛роХ, ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН роРроЯро┐ропрпИ роХрпБро▒ро┐рокрпНрокро┐роЯро╡рпБроорпН
const credential = new ManagedIdentityCredential(
  process.env.AZURE_CLIENT_ID  // рокропройро░рпН роТродрпБроХрпНроХрокрпНрокроЯрпНроЯ роЕроЯрпИропро╛ро│ ро╡ро╛роЯро┐роХрпНроХрпИропро╛ро│ро░рпН роРроЯро┐
);

// роЕро▓рпНро▓родрпБ DefaultAzureCredential роР рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН (родро╛ройро╛роХ роХрогрпНроЯро▒ро┐роХро┐ро▒родрпБ)
const credential = new DefaultAzureCredential();

const blobServiceClient = new BlobServiceClient(
  `https://${process.env.STORAGE_ACCOUNT_NAME}.blob.core.windows.net`,
  credential
);
```

5. **рокро┐ро░роЪро╛ро░роорпН рооро▒рпНро▒рпБроорпН роЪро░ро┐рокро╛ро░рпНрокрпНрокрпБ:**

```bash
azd up

# роЕройрпИродрпНродрпБ роЪрпЗро╡рпИроХро│рпБроорпН роЪрпЗрооро┐рокрпНрокроХродрпНродрпИ роЕрогрпБроХ роорпБроЯро┐ропрпБроорпН роОройрпНрокродрпИ роЪрпЛродро┐роХрпНроХро╡рпБроорпН
curl https://api-gateway.azurecontainerapps.io/upload
curl https://product-service.azurecontainerapps.io/upload
curl https://order-service.azurecontainerapps.io/upload
```

**тЬЕ ро╡рпЖро▒рпНро▒ро┐ропро┐ройрпН роЕро│ро╡рпБроХрпЛро▓рпН:**
- тЬЕ 3 роЪрпЗро╡рпИроХро│рпБроХрпНроХрпБ рокроХро┐ро░рокрпНрокроЯрпНроЯ роТро░рпБ Identity
- тЬЕ роЕройрпИродрпНродрпБ роЪрпЗро╡рпИроХро│рпБроорпН Storage рооро▒рпНро▒рпБроорпН Key Vault-роР роЕрогрпБроХ роорпБроЯро┐ропрпБроорпН
- тЬЕ роТро░рпБ роЪрпЗро╡рпИропрпИ роирпАроХрпНроХро┐ройро╛ро▓рпН Identity родрпКроЯро░рпНроХро┐ро▒родрпБ
- тЬЕ роорпИропрокрпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯ роЕройрпБроородро┐ роорпЗро▓ро╛рогрпНроорпИ

**User-Assigned Identity-ропро┐ройрпН роиройрпНроорпИроХро│рпН:**
- роТро░рпЗ Identity-роР роиро┐ро░рпНро╡роХро┐роХрпНроХ
- роЪрпЗро╡рпИроХро│рпБроХрпНроХрпБ роТро░рпЗ роЕройрпБроородро┐роХро│рпН
- роЪрпЗро╡рпИ роирпАроХрпНроХродрпНродрпИродрпН родро╛рогрпНроЯро┐ Identity родрпКроЯро░рпНроХро┐ро▒родрпБ
- роЪро┐роХрпНроХро▓ро╛рой роХроЯрпНроЯроорпИрокрпНрокрпБроХро│рпБроХрпНроХрпБ роЪро┐ро▒роирпНродродрпБ

**роирпЗро░роорпН**: 30-40 роиро┐рооро┐роЯроЩрпНроХро│рпН

---

### рокропро┐ро▒рпНроЪро┐ 3: Key Vault ро░роХроЪро┐роп рооро╛ро▒рпНро▒родрпНродрпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН тнРтнРтнР (роорпЗроорпНрокроЯрпНроЯродрпБ)

**роирпЛроХрпНроХроорпН**: роорпВройрпНро▒ро╛роорпН родро░рокрпНрокрпБ API роорпБроХрпНроХро┐ропроЩрпНроХро│рпИ Key Vault-ро▓рпН роЪрпЗрооро┐родрпНродрпБ, роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│родрпНродрпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ роЕрогрпБроХро╡рпБроорпН

**роЪрпВро┤ро▓рпН**: роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпБ OpenAI, Stripe, SendGrid рокрпЛройрпНро▒ ро╡рпЖро│ро┐рокрпНрокрпБро▒ API-роХро│рпИ роЕро┤рпИроХрпНроХ API роорпБроХрпНроХро┐ропроЩрпНроХро│рпИ родрпЗро╡рпИ.

**рокроЯро┐роХро│рпН**:

1. **RBAC роЙроЯройрпН Key Vault роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН:**

**роХрпЛрокрпНрокрпБ: `infra/core/keyvault.bicep`**

```bicep
param name string
param location string
param tags object = {}

resource keyVault 'Microsoft.KeyVault/vaults@2023-02-01' = {
  name: name
  location: location
  tags: tags
  properties: {
    enableRbacAuthorization: true  // Use RBAC instead of access policies
    sku: {
      family: 'A'
      name: 'standard'
    }
    tenantId: subscription().tenantId
    enableSoftDelete: true
    softDeleteRetentionInDays: 90
  }
}

// Allow Container App to read secrets
output id string = keyVault.id
output name string = keyVault.name
output uri string = keyVault.properties.vaultUri
```

2. **Key Vault-ро▓рпН ро░роХроЪро┐ропроЩрпНроХро│рпИ роЪрпЗрооро┐роХрпНроХро╡рпБроорпН:**

```bash
# роХрпА ро╡ро╛ро▓рпНроЯрпН рокрпЖропро░рпИ рокрпЖро▒ро╡рпБроорпН
KV_NAME=$(azd env get-values | grep AZURE_KEY_VAULT_NAME | cut -d '=' -f2 | tr -d '"')

# роорпВройрпНро▒ро╛роорпН родро░рокрпНрокрпБ API роХрпАроХро│рпИ роЪрпЗрооро┐роХрпНроХро╡рпБроорпН
az keyvault secret set \
  --vault-name $KV_NAME \
  --name "OpenAI-ApiKey" \
  --value "sk-proj-xxxxxxxxxxxxx"

az keyvault secret set \
  --vault-name $KV_NAME \
  --name "Stripe-ApiKey" \
  --value "sk_live_xxxxxxxxxxxxx"

az keyvault secret set \
  --vault-name $KV_NAME \
  --name "SendGrid-ApiKey" \
  --value "SG.xxxxxxxxxxxxx"
```

3. **ро░роХроЪро┐ропроЩрпНроХро│рпИ рокрпЖро▒ рокропройрпНрокро╛роЯрпНроЯрпБ роХрпБро▒ро┐ропрпАроЯрпБ:**

**роХрпЛрокрпНрокрпБ: `src/config.js`**

```javascript
const { DefaultAzureCredential } = require('@azure/identity');
const { SecretClient } = require('@azure/keyvault-secrets');

class Config {
  constructor() {
    this.credential = new DefaultAzureCredential();
    this.secretClient = new SecretClient(
      `https://${process.env.AZURE_KEY_VAULT_NAME}.vault.azure.net`,
      this.credential
    );
    this.cache = {};
  }

  async getSecret(secretName) {
    // роорпБродро▓ро┐ро▓рпН роХрпЗро╖рпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
    if (this.cache[secretName]) {
      return this.cache[secretName];
    }

    try {
      const secret = await this.secretClient.getSecret(secretName);
      this.cache[secretName] = secret.value;
      console.log(`тЬЕ Retrieved secret: ${secretName}`);
      return secret.value;
    } catch (error) {
      console.error(`тЭМ Failed to get secret ${secretName}:`, error.message);
      throw error;
    }
  }

  async getOpenAIKey() {
    return this.getSecret('OpenAI-ApiKey');
  }

  async getStripeKey() {
    return this.getSecret('Stripe-ApiKey');
  }

  async getSendGridKey() {
    return this.getSecret('SendGrid-ApiKey');
  }
}

module.exports = new Config();
```

4. **рокропройрпНрокро╛роЯрпНроЯро┐ро▓рпН ро░роХроЪро┐ропроЩрпНроХро│рпИрокрпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН:**

**роХрпЛрокрпНрокрпБ: `src/app.js`**

```javascript
const express = require('express');
const config = require('./config');
const { OpenAI } = require('openai');

const app = express();

// роХрпА ро╡ро╛ро▓рпНроЯро┐ро▓ро┐ро░рпБроирпНродрпБ родро┐ро▒ро╡рпБроХрпЛро▓рпИрокрпН рокропройрпНрокроЯрпБродрпНродро┐ OpenAI роР родрпКроЯроЩрпНроХро╡рпБроорпН
let openaiClient;

async function initializeServices() {
  const openaiKey = await config.getOpenAIKey();
  openaiClient = new OpenAI({ apiKey: openaiKey });
  console.log('тЬЕ Services initialized with secrets from Key Vault');
}

// родрпКроЯроХрпНроХродрпНродро┐ро▓рпН роЕро┤рпИроХрпНроХро╡рпБроорпН
initializeServices().catch(console.error);

app.post('/chat', async (req, res) => {
  try {
    const completion = await openaiClient.chat.completions.create({
      model: 'gpt-4',
      messages: [{ role: 'user', content: 'Hello!' }]
    });
    
    res.json({
      response: completion.choices[0].message.content,
      authentication: 'Key from Key Vault via Managed Identity'
    });
  } catch (error) {
    res.status(500).json({ error: error.message });
  }
});

app.listen(3000, () => {
  console.log('Secure API with Key Vault integration running');
});
```

5. **рокро┐ро░роЪро╛ро░роорпН рооро▒рпНро▒рпБроорпН роЪрпЛродройрпИ:**

```bash
azd up

# API ро╡ро┐роЪрпИроХро│рпН ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ро▒родро╛ роОройрпНрокродрпИ роЪрпЛродро┐роХрпНроХро╡рпБроорпН
curl -X POST https://myapp.azurecontainerapps.io/chat \
  -H "Content-Type: application/json" \
  -d '{"message":"Hello AI"}'
```

**тЬЕ ро╡рпЖро▒рпНро▒ро┐ропро┐ройрпН роЕро│ро╡рпБроХрпЛро▓рпН:**
- тЬЕ API роорпБроХрпНроХро┐ропроЩрпНроХро│рпН роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓рпН роЕро▓рпНро▓родрпБ роЪрпВро┤ро▓рпН рооро╛ро▒ро┐роХро│ро┐ро▓рпН роЗро▓рпНро▓рпИ
- тЬЕ рокропройрпНрокро╛роЯрпБ Key Vault-ро▓рпН роЗро░рпБроирпНродрпБ роорпБроХрпНроХро┐ропроЩрпНроХро│рпИрокрпН рокрпЖро▒рпБроХро┐ро▒родрпБ
- тЬЕ роорпВройрпНро▒ро╛роорпН родро░рокрпНрокрпБ API-роХро│рпН роЪро░ро┐ропро╛роХ ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ро▒родрпБ
- тЬЕ роХрпБро▒ро┐ропрпАроЯрпНроЯрпБ рооро╛ро▒рпНро▒роЩрпНроХро│рпН роЗро▓рпНро▓ро╛рооро▓рпН роорпБроХрпНроХро┐ропроЩрпНроХро│рпИ рооро╛ро▒рпНро▒ роорпБроЯро┐ропрпБроорпН

**роТро░рпБ ро░роХроЪро┐ропродрпНродрпИ рооро╛ро▒рпНро▒ро╡рпБроорпН:**

```bash
# роХрпА ро╡ро╛ро▓рпНроЯро┐ро▓рпН ро░роХроЪро┐ропродрпНродрпИ рокрпБродрпБрокрпНрокро┐роХрпНроХро╡рпБроорпН
az keyvault secret set \
  --vault-name $KV_NAME \
  --name "OpenAI-ApiKey" \
  --value "sk-proj-NEW_KEY_HERE"

# рокрпБродро┐роп роХрпАропрпИ роОроЯрпБродрпНродрпБроХрпНроХрпКро│рпНро│ рокропройрпНрокро╛роЯрпНроЯрпИ роорпАрогрпНроЯрпБроорпН родрпКроЯроЩрпНроХро╡рпБроорпН
az containerapp revision restart \
  --name myapp \
  --resource-group rg-myapp
```

**роирпЗро░роорпН**: 25-35 роиро┐рооро┐роЯроЩрпНроХро│рпН

---

## роЕро▒ро┐ро╡рпБ роЪрпЛродройрпИ

### 1. роЕроЩрпНроХрпАроХро╛ро░ роорпБро▒рпИроХро│рпН тЬУ

роЙроЩрпНроХро│рпН рокрпБро░ро┐родро▓рпИ роЪрпЛродро┐роХрпНроХро╡рпБроорпН:

- [ ] **Q1**: роорпВройрпНро▒рпБ роорпБроХрпНроХро┐роп роЕроЩрпНроХрпАроХро╛ро░ роорпБро▒рпИроХро│рпН роОройрпНрой? 
  - **A**: роЗрогрпИрокрпНрокрпБ роЪро░роЩрпНроХро│рпН (рокро╛ро░роорпНрокро░ро┐ропроорпН), Key Vault роХрпБро▒ро┐рокрпНрокрпБроХро│рпН (роЗроЯрпИроиро┐ро▓рпИ), роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│роорпН (роЪро┐ро▒роирпНродродрпБ)

- [ ] **Q2**: роЗрогрпИрокрпНрокрпБ роЪро░роЩрпНроХро│рпБроЯройрпН роТрокрпНрокро┐роЯрпБроорпНрокрпЛродрпБ роорпБроХро╡ро░ро┐ропрпБроЯройрпН роЕроЯрпИропро╛ро│роорпН роПройрпН роЪро┐ро▒роирпНродродрпБ?
  - **A**: роХрпБро▒ро┐ропрпАроЯрпНроЯро┐ро▓рпН ро░роХроЪро┐ропроЩрпНроХро│рпН роЗро▓рпНро▓рпИ, родро╛ройро┐ропроЩрпНроХро┐ рооро╛ро▒рпНро▒роорпН, роорпБро┤рпБ роХрогрпНроХро╛рогро┐рокрпНрокрпБ, RBAC роЕройрпБроородро┐роХро│рпН

- [ ] **Q3**: System-Assigned Identity-роХрпНроХрпБ рокродро┐ро▓ро╛роХ User-Assigned Identity роОрокрпНрокрпЛродрпБ рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН?
  - **A**: рокро▓ Resource-роХро│рпБроХрпНроХрпБ Identity-роР рокроХро┐ро░рпБроорпНрокрпЛродрпБ роЕро▓рпНро▓родрпБ Resource ро╡ро╛ро┤рпНроиро┐ро▓рпИроХрпНроХрпБ роЪрпБропро╛родрпАройрооро╛роХ Identity родрпЗро╡рпИрокрпНрокроЯрпБроорпН рокрпЛродрпБ

**роХрпИроорпБро▒рпИропро╛роХ роЪро░ро┐рокро╛ро░рпНрокрпНрокрпБ:**
```bash
# роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпБ роОроирпНрод ро╡роХрпИропро╛рой роЕроЯрпИропро╛ро│родрпНродрпИ рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ роОройрпНрокродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az containerapp show \
  --name myapp \
  --resource-group rg-myapp \
  --query "identity.type"

# роЕроЯрпИропро╛ро│родрпНродро┐ро▒рпНроХро╛рой роЕройрпИродрпНродрпБ ро╡рпЗроЯ роТродрпБроХрпНроХрпАроЯрпБроХро│рпИропрпБроорпН рокроЯрпНроЯро┐ропро▓ро┐роЯро╡рпБроорпН
az role assignment list \
  --assignee $(az containerapp show --name myapp --resource-group rg-myapp --query "identity.principalId" -o tsv)
```

---

### 2. RBAC рооро▒рпНро▒рпБроорпН роЕройрпБроородро┐роХро│рпН тЬУ

роЙроЩрпНроХро│рпН рокрпБро░ро┐родро▓рпИ роЪрпЛродро┐роХрпНроХро╡рпБроорпН:

- [ ] **Q1**: "Storage Blob Data Contributor" рокроЩрпНроХро┐ро▒рпНроХро╛рой Role ID роОройрпНрой?
  - **A**: `ba92f5b4-2d11-453d-a403-e96b0029c9fe`

- [ ] **Q2**: "Key Vault Secrets User" роОройрпНрой роЕройрпБроородро┐роХро│рпИ ро╡ро┤роЩрпНроХрпБроХро┐ро▒родрпБ?
  - **A**: ро░роХроЪро┐ропроЩрпНроХро│рпИ рокроЯро┐роХрпНроХ роороЯрпНроЯрпБроорпЗ (роЙро░рпБро╡ро╛роХрпНроХ, рокрпБродрпБрокрпНрокро┐роХрпНроХ, роЕро▓рпНро▓родрпБ роирпАроХрпНроХ роорпБроЯро┐ропро╛родрпБ)

- [ ] **Q3**: Azure SQL-роР роЕрогрпБроХ Container App-роХрпНроХрпБ роОрокрпНрокроЯро┐ роЕройрпБроородро┐ ро╡ро┤роЩрпНроХрпБро╡родрпБ?
  - **A**: "SQL DB Contributor
- [ ] **Q1**: Key Vault-роХрпНроХрпБ RBAC-роР access policies-роХрпНроХрпБ рокродро┐ро▓ро╛роХ роОрокрпНрокроЯро┐ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБро╡родрпБ?
  - **A**: Bicep-ро▓рпН `enableRbacAuthorization: true` роЕроорпИроХрпНроХро╡рпБроорпН

- [ ] **Q2**: Azure SDK роирпВро▓роХроЩрпНроХро│ро┐ро▓рпН managed identity authentication-роР роОродрпБ роХрпИропро╛ро│рпБроХро┐ро▒родрпБ?
  - **A**: `@azure/identity` рооро▒рпНро▒рпБроорпН `DefaultAzureCredential` class

- [ ] **Q3**: Key Vault ро░роХроЪро┐ропроЩрпНроХро│рпН cache-ро▓рпН роОро╡рпНро╡ро│ро╡рпБ роирпЗро░роорпН роЗро░рпБроХрпНроХрпБроорпН?
  - **A**: рокропройрпНрокро╛роЯрпНроЯро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН; роЙроЩрпНроХро│рпН роЪрпКроирпНрод cache strategy-роР роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН

**роХрпИроорпБро▒рпИропро╛роХ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН:**
```bash
# роХрпА ро╡ро╛ро▓рпНроЯрпН роЕрогрпБроХро▓рпИ роЪрпЛродро┐роХрпНроХро╡рпБроорпН
az keyvault secret show \
  --vault-name $KV_NAME \
  --name "OpenAI-ApiKey" \
  --query "value"

# RBAC роЗропроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родро╛ роОройрпНрокродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az keyvault show \
  --name $KV_NAME \
  --query "properties.enableRbacAuthorization"
# тЬЕ роОродро┐ро░рпНрокро╛ро░рпНрокрпНрокрпБ: роЙрогрпНроорпИ
```

---

## рокро╛родрпБроХро╛рокрпНрокрпБ роЪро┐ро▒роирпНрод роироЯрпИроорпБро▒рпИроХро│рпН

### тЬЕ роЪрпЖропрпНропро╡рпЗрогрпНроЯро┐ропродрпБ:

1. **роЙро▒рпНрокродрпНродро┐ропро┐ро▓рпН managed identity-роР роОрокрпНрокрпЛродрпБроорпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН**
   ```bicep
   identity: {
     type: 'SystemAssigned'
   }
   ```

2. **роХрпБро▒рпИроирпНрод privilege RBAC рокроЩрпНроХрпБ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН**
   - "Reader" рокроЩрпНроХрпБ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН
   - "Owner" роЕро▓рпНро▓родрпБ "Contributor" рокроЩрпНроХрпБ родрпЗро╡рпИропро╛ройро╛ро▓рпН роороЯрпНроЯрпБроорпЗ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН

3. **роорпВройрпНро▒ро╛роорпН родро░рокрпНрокрпБ роХрпАроХрпНроХро│рпИ Key Vault-ро▓рпН роЪрпЗрооро┐роХрпНроХро╡рпБроорпН**
   ```javascript
   const apiKey = await secretClient.getSecret('ThirdPartyApiKey');
   ```

4. **Audit logging-роР роЗропроХрпНроХро╡рпБроорпН**
   ```bicep
   diagnosticSettings: {
     logs: [{ category: 'AuditEvent', enabled: true }]
   }
   ```

5. **Development, staging, production-роХрпНроХрпБ родройро┐родрпНродройро┐ропро╛рой identity-роХро│рпИ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН**
   ```bash
   azd env new dev
   azd env new staging
   azd env new prod
   ```

6. **ро░роХроЪро┐ропроЩрпНроХро│рпИ роорпБро▒рпИропро╛роХ рооро╛ро▒рпНро▒ро╡рпБроорпН**
   - Key Vault ро░роХроЪро┐ропроЩрпНроХро│рпБроХрпНроХрпБ роХро╛ро▓ро╛ро╡родро┐ родрпЗродро┐роХро│рпИ роЕроорпИроХрпНроХро╡рпБроорпН
   - Azure Functions роорпВро▓роорпН рооро╛ро▒рпНро▒родрпНродрпИ родро╛ройро┐ропроЩрпНроХрооро╛роХрпНроХро╡рпБроорпН

### тЭМ роЪрпЖропрпНропроХрпНроХрпВроЯро╛родрпБ:

1. **ро░роХроЪро┐ропроЩрпНроХро│рпИ hardcode роЪрпЖропрпНропро╡рпЗрогрпНроЯро╛роорпН**
   ```javascript
   // тЭМ роорпЛроЪроорпН
   const apiKey = "sk-proj-xxxxxxxxxxxxx";
   ```

2. **роЙро▒рпНрокродрпНродро┐ропро┐ро▓рпН connection strings-роР рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯро╛роорпН**
   ```javascript
   // тЭМ роорпЛроЪроорпН
   BlobServiceClient.fromConnectionString(process.env.STORAGE_CONNECTION_STRING)
   ```

3. **роЕродро┐роХрооро╛рой роЕройрпБроородро┐роХро│рпИ ро╡ро┤роЩрпНроХ ро╡рпЗрогрпНроЯро╛роорпН**
   ```bicep
   // тЭМ BAD - too much access
   roleDefinitionId: 'Owner'
   
   // тЬЕ GOOD - least privilege
   roleDefinitionId: 'Storage Blob Data Reader'
   ```

4. **ро░роХроЪро┐ропроЩрпНроХро│рпИ рокродро┐ро╡рпБ роЪрпЖропрпНроп ро╡рпЗрогрпНроЯро╛роорпН**
   ```javascript
   // тЭМ роорпЛроЪроорпН
   console.log('API Key:', apiKey);
   
   // тЬЕ роиро▓рпНро▓родрпБ
   console.log('API Key retrieved successfully');
   ```

5. **роЙро▒рпНрокродрпНродро┐ identity-роХро│рпИ роЪрпВро┤ро▓рпНроХро│рпБроХрпНроХро┐роЯрпИропрпЗ рокроХро┐ро░ ро╡рпЗрогрпНроЯро╛роорпН**
   ```bicep
   // тЭМ BAD - same identity for dev and prod
   // тЬЕ GOOD - separate identities per environment
   ```

---

## роЪро┐роХрпНроХро▓рпН родрпАро░рпНро╡рпБ ро╡ро┤ро┐роХро╛роЯрпНроЯро┐

### роЪро┐роХрпНроХро▓рпН: Azure Storage-роР роЕрогрпБроХрпБроорпНрокрпЛродрпБ "Unauthorized"

**роЕро▒ро┐роХрпБро▒ро┐роХро│рпН:**
```
Error: Unauthorized (403)
AuthorizationPermissionMismatch: This request is not authorized to perform this operation
```

**роХро╛ро░рогроорпН:**

```bash
# роорпЗро▓ро╛рогрпНроорпИ роЕроЯрпИропро╛ро│роорпН роЗропроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родро╛ роОройрпНрокродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az containerapp show \
  --name myapp \
  --resource-group rg-myapp \
  --query "identity.type"
# тЬЕ роОродро┐ро░рпНрокро╛ро░рпНрокрпНрокрпБ: "SystemAssigned" роЕро▓рпНро▓родрпБ "UserAssigned"

# рокроЩрпНроХрпБ роТродрпБроХрпНроХрпАроЯрпБроХро│рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
PRINCIPAL_ID=$(az containerapp show --name myapp --resource-group rg-myapp --query "identity.principalId" -o tsv)
az role assignment list --assignee $PRINCIPAL_ID

# роОродро┐ро░рпНрокро╛ро░рпНрокрпНрокрпБ: "Storage Blob Data Contributor" роЕро▓рпНро▓родрпБ роЗродро▒рпНроХрпБ роЗрогрпИропро╛рой рокроЩрпНроХрпИ роХро╛рог ро╡рпЗрогрпНроЯрпБроорпН
```

**родрпАро░рпНро╡рпБроХро│рпН:**

1. **роЪро░ро┐ропро╛рой RBAC рокроЩрпНроХрпИ ро╡ро┤роЩрпНроХро╡рпБроорпН:**
```bash
STORAGE_ID=$(az storage account show --name mystorageaccount --resource-group rg-myapp --query "id" -o tsv)
az role assignment create \
  --assignee $PRINCIPAL_ID \
  --role "Storage Blob Data Contributor" \
  --scope $STORAGE_ID
```

2. **Propagation-роР роХро╛родрпНродро┐ро░рпБроХрпНроХро╡рпБроорпН (5-10 роиро┐рооро┐роЯроЩрпНроХро│рпН роЖроХро▓ро╛роорпН):**
```bash
# рокроЩрпНроХрпБ роТродрпБроХрпНроХрпАроЯрпНроЯрпБ роиро┐ро▓рпИропрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az role assignment list --assignee $PRINCIPAL_ID --scope $STORAGE_ID
```

3. **рокропройрпНрокро╛роЯрпНроЯрпБ роХрпБро▒ро┐ропрпАроЯрпБ роЪро░ро┐ропро╛рой credential-роР рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒родро╛ роОройрпНрокродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН:**
```javascript
// роирпАроЩрпНроХро│рпН DefaultAzureCredential рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒рпАро░рпНроХро│рпН роОройрпНрокродрпИ роЙро▒рпБродро┐рокрпНрокроЯрпБродрпНродрпБроЩрпНроХро│рпН
const credential = new DefaultAzureCredential();
```

---

### роЪро┐роХрпНроХро▓рпН: Key Vault роЕрогрпБроХро▓рпН рооро▒рпБроХрпНроХрокрпНрокроЯрпНроЯродрпБ

**роЕро▒ро┐роХрпБро▒ро┐роХро│рпН:**
```
Error: Forbidden (403)
The user, group or application does not have secrets get permission
```

**роХро╛ро░рогроорпН:**

```bash
# роХрпА ро╡ро╛ро▓рпНроЯрпН RBAC роЗропроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ роОройрпНрокродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az keyvault show \
  --name $KV_NAME \
  --query "properties.enableRbacAuthorization"
# тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ: роЙрогрпНроорпИ

# рокроЩрпНроХрпБ роТродрпБроХрпНроХрпАроЯрпБроХро│рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az role assignment list \
  --assignee $PRINCIPAL_ID \
  --scope /subscriptions/{sub-id}/resourceGroups/rg-myapp/providers/Microsoft.KeyVault/vaults/$KV_NAME
```

**родрпАро░рпНро╡рпБроХро│рпН:**

1. **Key Vault-ро▓рпН RBAC-роР роЗропроХрпНроХро╡рпБроорпН:**
```bash
az keyvault update \
  --name $KV_NAME \
  --enable-rbac-authorization true
```

2. **Key Vault Secrets User рокроЩрпНроХрпИ ро╡ро┤роЩрпНроХро╡рпБроорпН:**
```bash
KV_ID=$(az keyvault show --name $KV_NAME --query "id" -o tsv)
az role assignment create \
  --assignee $PRINCIPAL_ID \
  --role "Key Vault Secrets User" \
  --scope $KV_ID
```

---

### роЪро┐роХрпНроХро▓рпН: DefaultAzureCredential роЙро│рпНро│рпВро░ро┐ро▓рпН родрпЛро▓рпНро╡ро┐

**роЕро▒ро┐роХрпБро▒ро┐роХро│рпН:**
```
Error: DefaultAzureCredential failed to retrieve a token
CredentialUnavailableError: No credential available
```

**роХро╛ро░рогроорпН:**

```bash
# роирпАроЩрпНроХро│рпН роЙро│рпНроирпБро┤рпИроирпНродрпБро│рпНро│рпАро░рпНроХро│ро╛ роОройрпНрокродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az account show

# Azure CLI роЕроЩрпНроХрпАроХро╛ро░роорпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az ad signed-in-user show
```

**родрпАро░рпНро╡рпБроХро│рпН:**

1. **Azure CLI-ро▓рпН роЙро│рпНроирпБро┤рпИропро╡рпБроорпН:**
```bash
az login
```

2. **Azure subscription-роР роЕроорпИроХрпНроХро╡рпБроорпН:**
```bash
az account set --subscription "Your Subscription Name"
```

3. **роЙро│рпНро│рпВро░рпН роорпЗроорпНрокро╛роЯрпНроЯро┐ро▒рпНроХро╛роХ, роЪрпВро┤ро▓рпН рооро╛ро▒ро┐роХро│рпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН:**
```bash
export AZURE_TENANT_ID="your-tenant-id"
export AZURE_CLIENT_ID="your-client-id"
export AZURE_CLIENT_SECRET="your-client-secret"
```

4. **роЕро▓рпНро▓родрпБ роЙро│рпНро│рпВро░ро┐ро▓рпН ро╡рпЗро▒рпБ credential-роР рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН:**
```javascript
const { DefaultAzureCredential, AzureCliCredential } = require('@azure/identity');

// роЙро│рпНро│рпВро░рпН роорпЗроорпНрокро╛роЯрпНроЯро┐ро▒рпНроХро╛рой AzureCliCredential роР рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН
const credential = process.env.NODE_ENV === 'production' 
  ? new DefaultAzureCredential()
  : new AzureCliCredential();
```

---

### роЪро┐роХрпНроХро▓рпН: Role assignment рокро░ро╡рпБро╡родро▒рпНроХрпБ роЕродро┐роХ роирпЗро░роорпН роОроЯрпБроХрпНроХро┐ро▒родрпБ

**роЕро▒ро┐роХрпБро▒ро┐роХро│рпН:**
- рокроЩрпНроХрпБ ро╡рпЖро▒рпНро▒ро┐роХро░рооро╛роХ ро╡ро┤роЩрпНроХрокрпНрокроЯрпНроЯродрпБ
- Still 403 рокро┐ро┤рпИроХро│рпН ро╡ро░рпБроХро┐ро▒родрпБ
- роЗроЯрпИроХрпНроХро┐роЯрпИ роЕрогрпБроХро▓рпН (роЪро┐ро▓ роирпЗро░роЩрпНроХро│ро┐ро▓рпН ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ро▒родрпБ, роЪро┐ро▓ роирпЗро░роЩрпНроХро│ро┐ро▓рпН роЗро▓рпНро▓рпИ)

**ро╡ро┐ро│роХрпНроХроорпН:**
Azure RBAC рооро╛ро▒рпНро▒роЩрпНроХро│рпН роЙро▓роХро│ро╡ро┐ро▓рпН рокро░ро╡ 5-10 роиро┐рооро┐роЯроЩрпНроХро│рпН роЖроХро▓ро╛роорпН.

**родрпАро░рпНро╡рпБ:**

```bash
# роХро╛родрпНродро┐ро░рпБроирпНродрпБ роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН
echo "Waiting for RBAC propagation..."
sleep 300  # 5 роиро┐рооро┐роЯроЩрпНроХро│рпН роХро╛родрпНродро┐ро░рпБроХрпНроХро╡рпБроорпН

# роЕрогрпБроХро▓рпИ роЪрпЛродро┐роХрпНроХро╡рпБроорпН
curl https://myapp.azurecontainerapps.io/upload

# роЗройрпНройрпБроорпН родрпЛро▓рпНро╡ро┐ропроЯрпИроирпНродро╛ро▓рпН, рокропройрпНрокро╛роЯрпНроЯрпИ роорпАрогрпНроЯрпБроорпН родрпКроЯроЩрпНроХро╡рпБроорпН
az containerapp revision restart \
  --name myapp \
  --resource-group rg-myapp
```

---

## роЪрпЖро▓ро╡рпБроХро│рпН рокро▒рпНро▒ро┐роп роХро░рпБродрпНродрпБроХрпНроХро│рпН

### Managed Identity роЪрпЖро▓ро╡рпБроХро│рпН

| ро╡ро│роорпН | роЪрпЖро▓ро╡рпБ |
|------|------|
| **Managed Identity** | ЁЯЖУ **роЗро▓ро╡роЪроорпН** - роХроЯрпНроЯрогроорпН роЗро▓рпНро▓рпИ |
| **RBAC Role Assignments** | ЁЯЖУ **роЗро▓ро╡роЪроорпН** - роХроЯрпНроЯрогроорпН роЗро▓рпНро▓рпИ |
| **Azure AD Token Requests** | ЁЯЖУ **роЗро▓ро╡роЪроорпН** - роЪрпЗро░рпНроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ |
| **Key Vault роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпН** | $0.03 10,000 роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпБроХрпНроХрпБ |
| **Key Vault роЪрпЗрооро┐рокрпНрокрпБ** | $0.024 ро░роХроЪро┐ропроорпН роТройрпНро▒рпБроХрпНроХрпБ рооро╛родродрпНродро┐ро▒рпНроХрпБ |

**Managed identity рокрогродрпНродрпИ роЪрпЗрооро┐роХрпНроХро┐ро▒родрпБ:**
- тЬЕ роЪрпЗро╡рпИ-to-роЪрпЗро╡рпИ authentication-роХрпНроХрпБ Key Vault роЪрпЖропро▓рпНрокро╛роЯрпБроХро│рпИ роирпАроХрпНроХрпБроХро┐ро▒родрпБ
- тЬЕ рокро╛родрпБроХро╛рокрпНрокрпБ роЪроорпНрокро╡роЩрпНроХро│рпИ роХрпБро▒рпИроХрпНроХро┐ро▒родрпБ (ро░роХроЪро┐ропроЩрпНроХро│рпН роХроЪро┐ропро╛рооро▓рпН)
- тЬЕ роЪрпЖропро▓рпНрокро╛роЯрпНроЯрпБ роЪрпБроорпИропрпИ роХрпБро▒рпИроХрпНроХро┐ро▒родрпБ (роХрпИропрпЗроЯрпБ рооро╛ро▒рпНро▒роорпН роЗро▓рпНро▓рпИ)

**рооро╛родро╛роирпНродро┐ро░ роЪрпЖро▓ро╡рпБроХро│рпН роТрокрпНрокрпАроЯрпБ (роЙродро╛ро░рогроорпН):**

| роЪрпВро┤ро▓рпН | Connection Strings | Managed Identity | роЪрпЗрооро┐рокрпНрокрпБ |
|-------|-------------------|-----------------|---------|
| роЪро┐ро▒ро┐роп рокропройрпНрокро╛роЯрпБ (1M роХрпЛро░ро┐роХрпНроХрпИроХро│рпН) | ~$50 (Key Vault + ops) | ~$0 | $50/рооро╛родроорпН |
| роироЯрпБродрпНродро░ рокропройрпНрокро╛роЯрпБ (10M роХрпЛро░ро┐роХрпНроХрпИроХро│рпН) | ~$200 | ~$0 | $200/рооро╛родроорпН |
| рокрпЖро░ро┐роп рокропройрпНрокро╛роЯрпБ (100M роХрпЛро░ро┐роХрпНроХрпИроХро│рпН) | ~$1,500 | ~$0 | $1,500/рооро╛родроорпН |

---

## роорпЗро▓рпБроорпН роЕро▒ро┐роХ

### роЕродро┐роХро╛ро░рокрпНрокрпВро░рпНро╡ роЖро╡рогроЩрпНроХро│рпН
- [Azure Managed Identity](https://learn.microsoft.com/entra/identity/managed-identities-azure-resources/overview)
- [Azure RBAC](https://learn.microsoft.com/azure/role-based-access-control/overview)
- [Azure Key Vault](https://learn.microsoft.com/azure/key-vault/general/overview)
- [DefaultAzureCredential](https://learn.microsoft.com/dotnet/api/azure.identity.defaultazurecredential)

### SDK роЖро╡рогроЩрпНроХро│рпН
- [@azure/identity (Node.js)](https://www.npmjs.com/package/@azure/identity)
- [Azure.Identity (C#)](https://www.nuget.org/packages/Azure.Identity/)
- [azure-identity (Python)](https://pypi.org/project/azure-identity/)

### роЗроирпНрод рокро╛роЯродрпНродро┐ро▓рпН роЕроЯрпБродрпНрод рокроЯро┐роХро│рпН
- тЖР роорпБроирпНродрпИропродрпБ: [Configuration Management](configuration.md)
- тЖТ роЕроЯрпБродрпНродродрпБ: [First Project](first-project.md)
- ЁЯПа [рокро╛роЯроорпН роорпБроХрокрпНрокрпБ](../../README.md)

### родрпКроЯро░рпНрокрпБроЯрпИроп роЙродро╛ро░рогроЩрпНроХро│рпН
- [Azure OpenAI Chat Example](../../../../examples/azure-openai-chat) - Azure OpenAI-роХрпНроХрпБ managed identity рокропройрпНрокроЯрпБродрпНродрпБроХро┐ро▒родрпБ
- [Microservices Example](../../../../examples/microservices) - рокро▓ роЪрпЗро╡рпИ authentication роорпБро▒рпИ

---

## роЪрпБро░рпБроХрпНроХроорпН

**роирпАроЩрпНроХро│рпН роХро▒рпНро▒рпБроХрпНроХрпКрогрпНроЯродрпБ:**
- тЬЕ роорпВройрпНро▒рпБ authentication роорпБро▒рпИ (connection strings, Key Vault, managed identity)
- тЬЕ AZD-ро▓рпН managed identity-роР роЗропроХрпНроХрпБро╡родрпБ рооро▒рпНро▒рпБроорпН роЕроорпИрокрпНрокродрпБ
- тЬЕ Azure роЪрпЗро╡рпИроХро│рпБроХрпНроХрпБ RBAC рокроЩрпНроХрпБ ро╡ро┤роЩрпНроХро▓рпН
- тЬЕ роорпВройрпНро▒ро╛роорпН родро░рокрпНрокрпБ ро░роХроЪро┐ропроЩрпНроХро│рпБроХрпНроХрпБ Key Vault роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ
- тЬЕ User-assigned рооро▒рпНро▒рпБроорпН system-assigned identity-роХро│рпН
- тЬЕ рокро╛родрпБроХро╛рокрпНрокрпБ роЪро┐ро▒роирпНрод роироЯрпИроорпБро▒рпИроХро│рпН рооро▒рпНро▒рпБроорпН роЪро┐роХрпНроХро▓рпН родрпАро░рпНро╡рпБ

**роорпБроХрпНроХро┐роп takeaway-роХро│рпН:**
1. **роЙро▒рпНрокродрпНродро┐ропро┐ро▓рпН managed identity-роР роОрокрпНрокрпЛродрпБроорпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН** - ро░роХроЪро┐ропроЩрпНроХро│рпН роЗро▓рпНро▓рпИ, родро╛ройро┐ропроЩрпНроХ рооро╛ро▒рпНро▒роорпН
2. **роХрпБро▒рпИроирпНрод privilege RBAC рокроЩрпНроХрпБ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН** - родрпЗро╡рпИропро╛рой роЕройрпБроородро┐роХро│рпИ роороЯрпНроЯрпБроорпЗ ро╡ро┤роЩрпНроХро╡рпБроорпН
3. **роорпВройрпНро▒ро╛роорпН родро░рокрпНрокрпБ роХрпАроХрпНроХро│рпИ Key Vault-ро▓рпН роЪрпЗрооро┐роХрпНроХро╡рпБроорпН** - роорпИропроХрооро╛родро╛рой ро░роХроЪро┐роп роорпЗро▓ро╛рогрпНроорпИ
4. **роЪрпВро┤ро▓рпНроХро│рпБроХрпНроХрпБ родройро┐родрпНродройро┐ропро╛рой identity-роХро│рпИ рокро┐ро░ро┐роХрпНроХро╡рпБроорпН** - Development, staging, production родройро┐роорпИрокрпНрокроЯрпБродрпНродро▓рпН
5. **Audit logging-роР роЗропроХрпНроХро╡рпБроорпН** - ропро╛ро░рпН роОройрпНрой роЕрогрпБроХро┐ройро╛ро░рпНроХро│рпН роОройрпНрокродрпИ роХрогрпНроХро╛рогро┐роХрпНроХро╡рпБроорпН

**роЕроЯрпБродрпНрод рокроЯро┐роХро│рпН:**
1. роорпЗро▓рпЗ роЙро│рпНро│ роироЯрпИроорпБро▒рпИ рокропро┐ро▒рпНроЪро┐роХро│рпИ роорпБроЯро┐роХрпНроХро╡рпБроорпН
2. Connection strings-роЗро░рпБроирпНродрпБ managed identity-роХрпНроХрпБ роТро░рпБ рокропройрпНрокро╛роЯрпНроЯрпИ рооро╛ро▒рпНро▒ро╡рпБроорпН
3. роорпБродро▓рпН AZD родро┐роЯрпНроЯродрпНродрпИ day one-ро▓рпН рокро╛родрпБроХро╛рокрпНрокрпБроЯройрпН роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН: [First Project](first-project.md)

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**роХрпБро▒ро┐рокрпНрокрпБ**:  
роЗроирпНрод роЖро╡рогроорпН AI роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ роЪрпЗро╡рпИ [Co-op Translator](https://github.com/Azure/co-op-translator) рокропройрпНрокроЯрпБродрпНродро┐ роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ. роиро╛роЩрпНроХро│рпН родрпБро▓рпНро▓ро┐ропродрпНродро┐ро▒рпНроХро╛роХ роорпБропро▒рпНроЪро┐роХрпНроХро┐ройрпНро▒рпЛроорпН, роЖройро╛ро▓рпН родро╛ройро┐ропроЩрпНроХро┐ роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБроХро│ро┐ро▓рпН рокро┐ро┤рпИроХро│рпН роЕро▓рпНро▓родрпБ родро╡ро▒рпБроХро│рпН роЗро░рпБроХрпНроХроХрпНроХрпВроЯрпБроорпН роОройрпНрокродрпИ роХро╡ройродрпНродро┐ро▓рпН роХрпКро│рпНро│ро╡рпБроорпН. роЕродройрпН родро╛ропрпНроорпКро┤ро┐ропро┐ро▓рпН роЙро│рпНро│ роЕроЪро▓рпН роЖро╡рогроорпН роЕродро┐роХро╛ро░рокрпНрокрпВро░рпНро╡ роЖродро╛ро░рооро╛роХ роХро░рпБродрокрпНрокроЯ ро╡рпЗрогрпНроЯрпБроорпН. роорпБроХрпНроХро┐ропрооро╛рой родроХро╡ро▓рпНроХро│рпБроХрпНроХрпБ, родрпКро┤ро┐ро▓рпНроорпБро▒рпИ рооройро┐род роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ рокро░ро┐роирпНродрпБро░рпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ. роЗроирпНрод роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБро╡родро╛ро▓рпН роПро▒рпНрокроЯрпБроорпН роОроирпНрод родро╡ро▒ро╛рой рокрпБро░ро┐родро▓рпНроХро│рпН роЕро▓рпНро▓родрпБ родро╡ро▒ро╛рой ро╡ро┐ро│роХрпНроХроЩрпНроХро│рпБроХрпНроХрпБ роиро╛роЩрпНроХро│рпН рокрпКро▒рпБрокрпНрокро▓рпНро▓.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->