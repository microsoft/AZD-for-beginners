# рокро▓ роорпБроХро╡ро░рпН роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ роорпБро▒рпИ

тП▒я╕П **роородро┐рокрпНрокро┐роЯрокрпНрокроЯрпНроЯ роирпЗро░роорпН**: 60-75 роиро┐рооро┐роЯроЩрпНроХро│рпН | ЁЯТ░ **роородро┐рокрпНрокро┐роЯрокрпНрокроЯрпНроЯ роЪрпЖро▓ро╡рпБ**: ~$100-300/рооро╛родроорпН | тнР **роЪро┐роХрпНроХро▓ро╛ройродрпБ**: роорпЗроорпНрокроЯрпНроЯродрпБ

**ЁЯУЪ роХро▒рпНро▒ро▓рпН рокро╛родрпИ:**
- тЖР роорпБроирпНродрпИропродрпБ: [родро┐ро▒ройрпН родро┐роЯрпНроЯрооро┐роЯро▓рпН](capacity-planning.md) - ро╡ро│ роЕро│ро╡рпАроЯрпБ рооро▒рпНро▒рпБроорпН ро╡ро┐ро░ро┐ро╡ро╛роХрпНроХ роЙродрпНродро┐роХро│рпН
- ЁЯОп **роирпАроЩрпНроХро│рпН роЗроЩрпНроХрпЗ**: рокро▓ роорпБроХро╡ро░рпН роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ роорпБро▒рпИ (роТро┤рпБроЩрпНроХроорпИрокрпНрокрпБ, родрпКроЯро░рпНрокрпБ, роиро┐ро▓рпИ роорпЗро▓ро╛рогрпНроорпИ)
- тЖТ роЕроЯрпБродрпНродродрпБ: [SKU родрпЗро░рпНро╡рпБ](sku-selection.md) - роЪро░ро┐ропро╛рой Azure роЪрпЗро╡рпИроХро│рпИродрпН родрпЗро░рпНроирпНродрпЖроЯрпБрокрпНрокродрпБ
- ЁЯПа [рокро╛роЯроирпЖро▒ро┐ роорпБроХрокрпНрокрпБ](../../README.md)

---

## роирпАроЩрпНроХро│рпН роОройрпНрой роХро▒рпНро▒рпБроХрпНроХрпКро│рпНро╡рпАро░рпНроХро│рпН

роЗроирпНрод рокро╛роЯродрпНродрпИ роорпБроЯро┐рокрпНрокродройрпН роорпВро▓роорпН, роирпАроЩрпНроХро│рпН:
- **рокро▓ роорпБроХро╡ро░рпН роХроЯрпНроЯроорпИрокрпНрокрпБ** роорпБро▒рпИроХро│рпИрокрпН рокрпБро░ро┐роирпНродрпБроХрпКро│рпНро╡рпАро░рпНроХро│рпН рооро▒рпНро▒рпБроорпН роЕро╡ро▒рпНро▒рпИрокрпН рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯро┐роп роирпЗро░родрпНродрпИ роЕро▒ро┐роирпНродрпБ роХрпКро│рпНро╡рпАро░рпНроХро│рпН
- **роТро┤рпБроЩрпНроХроорпИрокрпНрокрпБ роорпБро▒рпИроХро│рпИ** (роорпИропрокрпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯ, роорпИропрооро▒рпНро▒, роЕроЯрпБроХрпНроХрпБроорпБро▒рпИ) роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБроЩрпНроХро│рпН
- **роорпБроХро╡ро░рпН родрпКроЯро░рпНрокрпБ** роЙродрпНродро┐роХро│рпИ ро╡роЯро┐ро╡роорпИроХрпНроХро╡рпБроорпН (роТродрпНродро┐роЪрпИро╡рпБ, роЕроЪро┐роЩрпНроХрпНро░рпЛройро╕рпН, роиро┐роХро┤рпНро╡рпБ роЪро╛ро░рпНроирпНрод)
- **рокроХро┐ро░рокрпНрокроЯрпНроЯ роиро┐ро▓рпИропрпИ** ро╡ро┐роиро┐ропрпЛроХро┐роХрпНроХрокрпНрокроЯрпНроЯ роорпБроХро╡ро░рпНроХро│рпБроХрпНроХро┐роЯрпИропрпЗ роиро┐ро░рпНро╡роХро┐роХрпНроХро╡рпБроорпН
- AZD роЙроЯройрпН **рокро▓ роорпБроХро╡ро░рпН роЕроорпИрокрпНрокрпБроХро│рпИ** Azure-ро▓рпН рокро┐ро░роЪрпБро░ро┐роХрпНроХро╡рпБроорпН
- роЙрогрпНроорпИропро╛рой AI роЪрпВро┤ро▓рпНроХро│рпБроХрпНроХрпБ **роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ роорпБро▒рпИроХро│рпИ** рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН
- ро╡ро┐роиро┐ропрпЛроХро┐роХрпНроХрокрпНрокроЯрпНроЯ роорпБроХро╡ро░рпН роЕроорпИрокрпНрокрпБроХро│рпИ роХрогрпНроХро╛рогро┐роХрпНроХро╡рпБроорпН рооро▒рпНро▒рпБроорпН рокро┐ро┤рпИроХро│рпИ роЪро░ро┐роЪрпЖропрпНропро╡рпБроорпН

## рокро▓ роорпБроХро╡ро░рпН роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ роПройрпН роорпБроХрпНроХро┐ропроорпН

### рокро░ро┐рогро╛роороорпН: роТро▒рпНро▒рпИ роорпБроХро╡ро░ро┐ро▓ро┐ро░рпБроирпНродрпБ рокро▓ роорпБроХро╡ро░рпБроХрпНроХрпБ

**роТро▒рпНро▒рпИ роорпБроХро╡ро░рпН (роОро│ро┐роорпИропро╛ройродрпБ):**
```
User тЖТ Agent тЖТ Response
```
- тЬЕ рокрпБро░ро┐роирпНродрпБ роХрпКро│рпНро│ро╡рпБроорпН роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН роОро│ро┐родрпБ
- тЬЕ роОро│ро┐роп рокрогро┐роХро│рпБроХрпНроХрпБ ро╡рпЗроХрооро╛ройродрпБ
- тЭМ роТро▒рпНро▒рпИ рооро╛родро┐ро░ро┐ропро┐ройрпН родро┐ро▒ройрпНроХро│ро╛ро▓рпН роороЯрпНроЯрпБрокрпНрокроЯрпБродрпНродрокрпНрокроЯрпНроЯродрпБ
- тЭМ роЪро┐роХрпНроХро▓ро╛рой рокрогро┐роХро│рпИ роЗрогрпИрокропройрпНрокроЯрпБродрпНрод роорпБроЯро┐ропро╛родрпБ
- тЭМ роЪро┐ро▒рокрпНрокрпБ роЗро▓рпНро▓рпИ

**рокро▓ роорпБроХро╡ро░рпН роЕроорпИрокрпНрокрпБ (роорпЗроорпНрокроЯрпНроЯродрпБ):**
```
           тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
           тФВ OrchestratorтФВ
           тФФтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФШ
        тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
        тФВ         тФВ         тФВ
    тФМтФАтФАтФАтЦ╝тФАтФАтФР  тФМтФАтФАтЦ╝тФАтФАтФАтФР  тФМтФАтФАтЦ╝тФАтФАтФАтФАтФР
    тФВAgent1тФВ  тФВAgent2тФВ  тФВAgent3 тФВ
    тФВ(Plan)тФВ  тФВ(Code)тФВ  тФВ(Review)тФВ
    тФФтФАтФАтФАтФАтФАтФАтФШ  тФФтФАтФАтФАтФАтФАтФАтФШ  тФФтФАтФАтФАтФАтФАтФАтФАтФШ
```
- тЬЕ роХрпБро▒ро┐рокрпНрокро┐роЯрпНроЯ рокрогро┐роХро│рпБроХрпНроХрпБ роЪро┐ро▒рокрпНрокрпБ рокрпЖро▒рпНро▒ роорпБроХро╡ро░рпНроХро│рпН
- тЬЕ ро╡рпЗроХродрпНродро┐ро▒рпНроХро╛роХ роЗрогрпИ роЪрпЖропро▓рпНрокро╛роЯрпБ
- тЬЕ родрпКроХрпБродро┐ рооро▒рпНро▒рпБроорпН рокро░ро╛рооро░ро┐роХрпНроХроХрпНроХрпВроЯро┐ропродрпБ
- тЬЕ роЪро┐роХрпНроХро▓ро╛рой рокрогро┐роЪрпНроЪрпВро┤ро▓рпНроХро│ро┐ро▓рпН роЪро┐ро▒роирпНродродрпБ
- тЪая╕П роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ родро░рпНроХрпНроХроорпН родрпЗро╡рпИ

**роЙро░рпБро╡роХроорпН**: роТро▒рпНро▒рпИ роорпБроХро╡ро░рпН роОройрпНрокродрпБ роЕройрпИродрпНродрпБ рокрогро┐роХро│рпИропрпБроорпН роТро░рпЗ роирокро░рпН роЪрпЖропрпНро╡родрпБ рокрпЛройрпНро▒родрпБ. рокро▓ роорпБроХро╡ро░рпН роОройрпНрокродрпБ роТро╡рпНро╡рпКро░рпБ роЙро▒рпБрокрпНрокро┐ройро░рпБроорпН (роЖро░ро╛ропрпНроЪрпНроЪро┐ропро╛ро│ро░рпН, роХрпБро▒ро┐ропрпАроЯрпНроЯро╛ро│ро░рпН, роородро┐рокрпНрокрпАроЯрпНроЯро╛ро│ро░рпН, роОро┤рпБродрпНродро╛ро│ро░рпН) родройро┐родрпНродро┐ро▒ройрпНроХро│рпИроХрпН роХрпКрогрпНроЯ роХрпБро┤рпБро╡ро╛роХ ро╡рпЗро▓рпИ роЪрпЖропрпНро╡родрпБ рокрпЛройрпНро▒родрпБ.

---

## роорпБроХрпНроХро┐роп роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ роорпБро▒рпИроХро│рпН

### роорпБро▒рпИ 1: родрпКроЯро░рпНроЪрпНроЪро┐ропро╛рой роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ (роЪрпЖропро▓рпНроорпБро▒рпИ рокрпКро▒рпБрокрпНрокрпБ)

**роОрокрпНрокрпЛродрпБ рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН**: рокрогро┐роХро│рпН роХрпБро▒ро┐рокрпНрокро┐роЯрпНроЯ ро╡ро░ро┐роЪрпИропро┐ро▓рпН роорпБроЯро┐роХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН, роТро╡рпНро╡рпКро░рпБ роорпБроХро╡ро░рпБроорпН роорпБроирпНродрпИроп ро╡рпЖро│ро┐ропрпАроЯрпНроЯро┐ройрпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓рпН роЪрпЖропро▓рпНрокроЯ ро╡рпЗрогрпНроЯрпБроорпН.

```mermaid
sequenceDiagram
    participant User
    participant Orchestrator
    participant Agent1 as роЖро░ро╛ропрпНроЪрпНроЪро┐ роорпБроХро╡ро░рпН
    participant Agent2 as роОро┤рпБродрпНродро╛ро│ро░рпН роорпБроХро╡ро░рпН
    participant Agent3 as родро┐ро░рпБродрпНродрпБроорпН роорпБроХро╡ро░рпН
    
    User->>Orchestrator: "роР.роР рокро▒рпНро▒ро┐ роХроЯрпНроЯрпБро░рпИ роОро┤рпБродрпБроЩрпНроХро│рпН"
    Orchestrator->>Agent1: родро▓рпИрокрпНрокрпИ роЖро░ро╛ропрпБроЩрпНроХро│рпН
    Agent1-->>Orchestrator: роЖро░ро╛ропрпНроЪрпНроЪро┐ роорпБроЯро┐ро╡рпБроХро│рпН
    Orchestrator->>Agent2: ро╡ро░рпИро╡рпБ роОро┤рпБродрпБроЩрпНроХро│рпН (роЖро░ро╛ропрпНроЪрпНроЪро┐ропрпИ рокропройрпНрокроЯрпБродрпНродро┐)
    Agent2-->>Orchestrator: роХроЯрпНроЯрпБро░рпИ ро╡ро░рпИро╡рпБ
    Orchestrator->>Agent3: родро┐ро░рпБродрпНродро┐ роорпЗроорпНрокроЯрпБродрпНродрпБроЩрпНроХро│рпН
    Agent3-->>Orchestrator: роЗро▒рпБродро┐ роХроЯрпНроЯрпБро░рпИ
    Orchestrator-->>User: роорпЖро░рпБроХрпВроЯрпНроЯрокрпНрокроЯрпНроЯ роХроЯрпНроЯрпБро░рпИ
    
    Note over User,Agent3: родрпКроЯро░рпНроЪрпНроЪро┐ропро╛ройродрпБ: роТро╡рпНро╡рпКро░рпБ рокроЯро┐ропрпБроорпН роорпБроирпНродрпИропродрпИ роХро╛родрпНродро┐ро░рпБроХрпНроХро┐ро▒родрпБ
```
**роиройрпНроорпИроХро│рпН:**
- тЬЕ родрпЖро│ро┐ро╡ро╛рой родро░ро╡рпБрокрпН рокро╛ропрпНроЪрпНроЪро┐
- тЬЕ рокро┐ро┤рпИроХро│рпИ роЪро░ро┐роЪрпЖропрпНроп роОро│ро┐родрпБ
- тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХроХрпНроХрпВроЯро┐роп роЪрпЖропро▓рпНрокро╛роЯрпНроЯрпБ ро╡ро░ро┐роЪрпИ

**роорпБроЯрпБроХрпНроХроЩрпНроХро│рпН:**
- тЭМ роорпЖродрпБро╡ро╛роХ (роЗрогрпИ роЪрпЖропро▓рпНрокро╛роЯрпБ роЗро▓рпНро▓рпИ)
- тЭМ роТро░рпБ родрпЛро▓рпНро╡ро┐ роорпБро┤рпБ роЪроЩрпНроХро┐ро▓ро┐ропрпИродрпН родроЯрпБроХрпНроХро┐ро▒родрпБ
- тЭМ рокро░ро╕рпНрокро░ роЪро╛ро░рпНроирпНрод рокрогро┐роХро│рпИ роХрпИропро╛ро│ роорпБроЯро┐ропро╛родрпБ

**роЙродро╛ро░рог рокропройрпНрокро╛роЯрпБроХро│рпН:**
- роЙро│рпНро│роЯроХрпНроХ роЙро░рпБро╡ро╛роХрпНроХ роХрпБро┤ро╛ропрпН (роЖро░ро╛ропрпНроЪрпНроЪро┐ тЖТ роОро┤рпБродрпБродро▓рпН тЖТ родро┐ро░рпБродрпНродрпБродро▓рпН тЖТ ро╡рпЖро│ро┐ропро┐роЯрпБродро▓рпН)
- роХрпБро▒ро┐ропрпАроЯрпБ роЙро░рпБро╡ро╛роХрпНроХроорпН (родро┐роЯрпНроЯрооро┐роЯро▓рпН тЖТ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБродро▓рпН тЖТ роЪрпЛродройрпИ тЖТ рокро┐ро░роЪрпБро░роорпН)
- роЕро▒ро┐роХрпНроХрпИ роЙро░рпБро╡ро╛роХрпНроХроорпН (родро░ро╡рпБ роЪрпЗроХро░ро┐рокрпНрокрпБ тЖТ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ тЖТ роХро╛роЯрпНроЪро┐рокрпНрокроЯрпБродрпНродро▓рпН тЖТ роЪрпБро░рпБроХрпНроХроорпН)

---

### роорпБро▒рпИ 2: роЗрогрпИ роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ (Fan-Out/Fan-In)

**роОрокрпНрокрпЛродрпБ рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН**: роЪрпБропро╛родрпАрой рокрогро┐роХро│рпН роТро░рпЗ роирпЗро░родрпНродро┐ро▓рпН роЗропроЩрпНроХ роорпБроЯро┐ропрпБроорпН, роорпБроЯро┐ро╡рпБроХро│рпН роЗро▒рпБродро┐ропро┐ро▓рпН роЗрогрпИроХрпНроХрокрпНрокроЯ ро╡рпЗрогрпНроЯрпБроорпН.

```mermaid
graph TB
    User[рокропройро░рпН роХрпЛро░ро┐роХрпНроХрпИ]
    Orchestrator[роТро┤рпБроЩрпНроХрпБрокроЯрпБродрпНродрпБрокро╡ро░рпН]
    Agent1[роЖропрпНро╡рпБ роорпБроХро╡ро░рпН]
    Agent2[роЖро░ро╛ропрпНроЪрпНроЪро┐ роорпБроХро╡ро░рпН]
    Agent3[родро░ро╡рпБ роорпБроХро╡ро░рпН]
    Aggregator[роорпБроЯро┐ро╡рпБроХро│рпИ родрпКроХрпБрокрпНрокро╡ро░рпН]
    Response[роХро▓роирпНрод рокродро┐ро▓рпН]
    
    User --> Orchestrator
    Orchestrator --> Agent1
    Orchestrator --> Agent2
    Orchestrator --> Agent3
    Agent1 --> Aggregator
    Agent2 --> Aggregator
    Agent3 --> Aggregator
    Aggregator --> Response
    
    style Orchestrator fill:#2196F3,stroke:#1976D2,stroke-width:3px,color:#fff
    style Aggregator fill:#4CAF50,stroke:#388E3C,stroke-width:3px,color:#fff
```
**роиройрпНроорпИроХро│рпН:**
- тЬЕ ро╡рпЗроХрооро╛ройродрпБ (роЗрогрпИ роЪрпЖропро▓рпНрокро╛роЯрпБ)
- тЬЕ рокро┐ро┤рпИродрпН родро╛роЩрпНроХрпБроорпН (рокроХрпБродро┐ роорпБроЯро┐ро╡рпБроХро│рпН роПро▒рпНро▒рпБроХрпНроХрпКро│рпНро│родрпНродроХрпНроХро╡рпИ)
- тЬЕ роХрпБро╡ро┐ропро▓ро╛роХ рокро░ро╡рпБроХро┐ро▒родрпБ

**роорпБроЯрпБроХрпНроХроЩрпНроХро│рпН:**
- тЪая╕П роорпБроЯро┐ро╡рпБроХро│рпН ро╡ро░ро┐роЪрпИроорпБро▒рпИропро┐ро▓рпН ро╡ро░ро╛родрпБ
- тЪая╕П родрпКроХрпБрокрпНрокрпБ родро░рпНроХрпНроХроорпН родрпЗро╡рпИ
- тЪая╕П роЪро┐роХрпНроХро▓ро╛рой роиро┐ро▓рпИ роорпЗро▓ро╛рогрпНроорпИ

**роЙродро╛ро░рог рокропройрпНрокро╛роЯрпБроХро│рпН:**
- рокро▓ роорпВро▓ родро░ро╡рпБроХро│рпИ роЪрпЗроХро░ро┐родрпНродро▓рпН (APIроХро│рпН + родро░ро╡рпБродрпНродрпКроХрпБрокрпНрокрпБроХро│рпН + ро╡ро▓рпИродрпН родрпЗроЯро▓рпН)
- рокрпЛроЯрпНроЯро┐ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ (рокро▓ рооро╛родро┐ро░ро┐роХро│рпН родрпАро░рпНро╡рпБроХро│рпИ роЙро░рпБро╡ро╛роХрпНроХрпБроХро┐ройрпНро▒рой, роЪро┐ро▒роирпНродродрпБ родрпЗро░рпНроирпНродрпЖроЯрпБроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ)
- роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ роЪрпЗро╡рпИроХро│рпН (рокро▓ роорпКро┤ро┐роХро│ро┐ро▓рпН роТро░рпЗ роирпЗро░родрпНродро┐ро▓рпН роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХро╡рпБроорпН)

---

### роорпБро▒рпИ 3: роЕроЯрпБроХрпНроХрпБроорпБро▒рпИ роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ (роорпЗро▓ро╛ро│ро░рпН-родрпКро┤ро┐ро▓ро╛ро│ро┐)

**роОрокрпНрокрпЛродрпБ рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН**: родрпБрогрпИ рокрогро┐роХро│рпБроЯройрпН роХрпВроЯро┐роп роЪро┐роХрпНроХро▓ро╛рой рокрогро┐роЪрпНроЪрпВро┤ро▓рпНроХро│рпН, роТрокрпНрокроЯрпИрокрпНрокрпБ родрпЗро╡рпИ.

```mermaid
graph TB
    Master[рооро╛ро╕рпНроЯро░рпН роТро░рпНроХрпЖро╕рпНроЯрпНро░рпЗроЯрпНроЯро░рпН]
    Manager1[роЖро░ро╛ропрпНроЪрпНроЪро┐ роорпЗро▓ро╛ро│ро░рпН]
    Manager2[роЙро│рпНро│роЯроХрпНроХ роорпЗро▓ро╛ро│ро░рпН]
    W1[ро╡ро▓рпИродрпН родрпЗроЯрпБрокро╡ро░рпН]
    W2[роХро╛роХро┐род рокроХрпБрокрпНрокро╛ропрпНро╡ро╛ро│ро░рпН]
    W3[роОро┤рпБродрпНродро╛ро│ро░рпН]
    W4[родрпКроХрпБрокрпНрокро╛ро│ро░рпН]
    
    Master --> Manager1
    Master --> Manager2
    Manager1 --> W1
    Manager1 --> W2
    Manager2 --> W3
    Manager2 --> W4
    
    style Master fill:#FF9800,stroke:#F57C00,stroke-width:3px,color:#fff
    style Manager1 fill:#2196F3,stroke:#1976D2,stroke-width:2px,color:#fff
    style Manager2 fill:#2196F3,stroke:#1976D2,stroke-width:2px,color:#fff
```
**роиройрпНроорпИроХро│рпН:**
- тЬЕ роЪро┐роХрпНроХро▓ро╛рой рокрогро┐роЪрпНроЪрпВро┤ро▓рпНроХро│рпИ роХрпИропро╛ро│рпБроХро┐ро▒родрпБ
- тЬЕ родрпКроХрпБродро┐ рооро▒рпНро▒рпБроорпН рокро░ро╛рооро░ро┐роХрпНроХроХрпНроХрпВроЯро┐ропродрпБ
- тЬЕ родрпЖро│ро┐ро╡ро╛рой рокрпКро▒рпБрокрпНрокрпБродрпН роОро▓рпНро▓рпИроХро│рпН

**роорпБроЯрпБроХрпНроХроЩрпНроХро│рпН:**
- тЪая╕П роорпЗро▓рпБроорпН роЪро┐роХрпНроХро▓ро╛рой роХроЯрпНроЯроорпИрокрпНрокрпБ
- тЪая╕П роЕродро┐роХ родро╛роородроорпН (рокро▓ роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ роЕроЯрпБроХрпНроХрпБроХро│рпН)
- тЪая╕П роирпБрогрпНрогро┐роп роТро┤рпБроЩрпНроХроорпИрокрпНрокрпБ родрпЗро╡рпИ

**роЙродро╛ро░рог рокропройрпНрокро╛роЯрпБроХро│рпН:**
- роиро┐ро▒рпБро╡рой роЖро╡рог роЪрпЖропро▓ро╛роХрпНроХроорпН (ро╡роХрпИрокрпНрокроЯрпБродрпНродрпБродро▓рпН тЖТ ро╡ро┤ро┐рооро╛ро▒рпНро▒рпБ тЖТ роЪрпЖропро▓ро╛роХрпНроХроорпН тЖТ роХро╛рокрпНрокроХрокрпНрокроЯрпБродрпНродрпБродро▓рпН)
- рокро▓ роиро┐ро▓рпИ родро░ро╡рпБрокрпН роХрпБро┤ро╛ропрпНроХро│рпН (роЙроЯрпНроХрпКро│рпНроХ тЖТ роЪрпБродрпНродроорпН роЪрпЖропрпН тЖТ рооро╛ро▒рпНро▒рпБ тЖТ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпН тЖТ роЕро▒ро┐роХрпНроХрпИ)
- роЪро┐роХрпНроХро▓ро╛рой родро╛ройро┐ропроХрпНроХ рокрогро┐роЪрпНроЪрпВро┤ро▓рпНроХро│рпН (родро┐роЯрпНроЯрооро┐роЯро▓рпН тЖТ ро╡ро│ роТродрпБроХрпНроХрпАроЯрпБ тЖТ роЪрпЖропро▓рпНрокро╛роЯрпБ тЖТ роХрогрпНроХро╛рогро┐рокрпНрокрпБ)

---

### роорпБро▒рпИ 4: роиро┐роХро┤рпНро╡рпБ роЪро╛ро░рпНроирпНрод роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ (Publish-Subscribe)

**роОрокрпНрокрпЛродрпБ рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН**: роорпБроХро╡ро░рпНроХро│рпН роиро┐роХро┤рпНро╡рпБроХро│рпБроХрпНроХрпБ рокродро┐ро▓ро│ро┐роХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН, родро│ро░рпНро╡ро╛рой роЗрогрпИрокрпНрокрпБ ро╡ро┐ро░рпБроорпНрокрокрпНрокроЯрпБроХро┐ро▒родрпБ.

```mermaid
sequenceDiagram
    participant Agent1 as родро░ро╡рпБроХро│рпН роЪрпЗроХро░ро┐рокрпНрокро╡ро░рпН
    participant EventBus as Azure роЪрпЗро╡рпИ рокро╕рпН
    participant Agent2 as рокроХрпБрокрпНрокро╛ропрпНро╡ро╛ро│ро░рпН
    participant Agent3 as роЕро▒ро┐ро╡ро┐рокрпНрокро╛ро│ро░рпН
    participant Agent4 as роХро╛рокрпНрокроХрокрпНрокроЯрпБродрпНродрпБрокро╡ро░рпН
    
    Agent1->>EventBus: ро╡рпЖро│ро┐ропро┐роЯрпБ "родро░ро╡рпБ рокрпЖро▒рокрпНрокроЯрпНроЯродрпБ" роиро┐роХро┤рпНро╡рпБ
    EventBus->>Agent2: роЪроирпНродро╛: родро░ро╡рпБроХро│рпИ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЪрпЖропрпН
    EventBus->>Agent3: роЪроирпНродро╛: роЕро▒ро┐ро╡ро┐рокрпНрокрпБ роЕройрпБрокрпНрокрпБ
    EventBus->>Agent4: роЪроирпНродро╛: родро░ро╡рпБроХро│рпИ роХро╛рокрпНрокроХрокрпНрокроЯрпБродрпНродрпБ
    
    Note over Agent1,Agent4: роЕройрпИродрпНродрпБ роЪроирпНродро╛родро╛ро░ро░рпНроХро│рпБроорпН родройро┐родрпНродройро┐ропро╛роХ роЪрпЖропро▓рпНрокроЯрпБроХро┐ройрпНро▒ройро░рпН
    
    Agent2->>EventBus: ро╡рпЖро│ро┐ропро┐роЯрпБ "рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роорпБроЯро┐роирпНродродрпБ" роиро┐роХро┤рпНро╡рпБ
    EventBus->>Agent3: роЪроирпНродро╛: рокроХрпБрокрпНрокро╛ропрпНро╡рпБ роЕро▒ро┐роХрпНроХрпИропрпИ роЕройрпБрокрпНрокрпБ
```
**роиройрпНроорпИроХро│рпН:**
- тЬЕ роорпБроХро╡ро░рпНроХро│рпБроХрпНроХро┐роЯрпИропрпЗ родро│ро░рпНро╡ро╛рой роЗрогрпИрокрпНрокрпБ
- тЬЕ рокрпБродро┐роп роорпБроХро╡ро░рпНроХро│рпИроЪрпН роЪрпЗро░рпНроХрпНроХ роОро│ро┐родрпБ (ро╡рпЖро▒рпБроорпН роЪроирпНродро╛)
- тЬЕ роЕроЪро┐роЩрпНроХрпНро░рпЛройро╕рпН роЪрпЖропро▓ро╛роХрпНроХроорпН
- тЬЕ родро╛роЩрпНроХрпБроорпН (роЪрпЖропрпНродро┐ роиро┐ро▓рпИродрпНродройрпНроорпИ)

**роорпБроЯрпБроХрпНроХроЩрпНроХро│рпН:**
- тЪая╕П роЗро▒рпБродро┐ропро┐ро▓рпН роиро┐ро▓рпИродрпНродройрпНроорпИ
- тЪая╕П роЪро┐роХрпНроХро▓ро╛рой рокро┐ро┤рпИ роЪро░ро┐роЪрпЖропрпНродро▓рпН
- тЪая╕П роЪрпЖропрпНродро┐ ро╡ро░ро┐роЪрпИроорпБро▒рпИ роЪро╡ро╛ро▓рпНроХро│рпН

**роЙродро╛ро░рог рокропройрпНрокро╛роЯрпБроХро│рпН:**
- роирпЗро░роЯро┐ роХрогрпНроХро╛рогро┐рокрпНрокрпБ роЕроорпИрокрпНрокрпБроХро│рпН (роОроЪрпНроЪро░ро┐роХрпНроХрпИроХро│рпН, роЯро╛ро╖рпНрокрпЛро░рпНроЯрпБроХро│рпН, рокродро┐ро╡рпБроХро│рпН)
- рокро▓ роЪрпЗройро▓рпН роЕро▒ро┐ро╡ро┐рокрпНрокрпБроХро│рпН (рооро┐ройрпНройроЮрпНроЪро▓рпН, SMS, push, Slack)
- родро░ро╡рпБрокрпН роЪрпЖропро▓ро╛роХрпНроХ роХрпБро┤ро╛ропрпНроХро│рпН (роЕродрпЗ родро░ро╡ро┐ройрпН рокро▓ роирпБроХро░рпНро╡рпЛро░рпН)

---

### роорпБро▒рпИ 5: роТрокрпНрокрпБродро▓рпН роЕроЯро┐рокрпНрокроЯрпИропро┐ро▓ро╛рой роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ (Voting/Quorum)

**роОрокрпНрокрпЛродрпБ рокропройрпНрокроЯрпБродрпНрод ро╡рпЗрогрпНроЯрпБроорпН**: родрпКроЯро░рпНро╡родро▒рпНроХрпБ роорпБройрпН рокро▓ роорпБроХро╡ро░рпНроХро│ро┐роЯрооро┐ро░рпБроирпНродрпБ роТрокрпНрокрпБродро▓рпН родрпЗро╡рпИ.

```mermaid
graph TB
    Input[роЙро│рпНро│рпАроЯрпБ рокрогро┐ропрпИ]
    Agent1[роорпБроХро╡ро░рпН 1: GPT-4]
    Agent2[роорпБроХро╡ро░рпН 2: Claude]
    Agent3[роорпБроХро╡ро░рпН 3: Gemini]
    Voter[роТрокрпНрокрпБроородро┐ ро╡ро╛роХрпНроХро╛ро│ро░рпН]
    Output[роТрокрпНрокрпБроХрпНроХрпКрогрпНроЯ ро╡рпЖро│ро┐ропрпАроЯрпБ]
    
    Input --> Agent1
    Input --> Agent2
    Input --> Agent3
    Agent1 --> Voter
    Agent2 --> Voter
    Agent3 --> Voter
    Voter --> Output
    
    style Voter fill:#9C27B0,stroke:#7B1FA2,stroke-width:3px,color:#fff
```
**роиройрпНроорпИроХро│рпН:**
- тЬЕ роЕродро┐роХ родрпБро▓рпНро▓ро┐ропроорпН (рокро▓ роХро░рпБродрпНродрпБроХрпНроХро│рпН)
- тЬЕ рокро┐ро┤рпИродрпН родро╛роЩрпНроХрпБроорпН (роЪро┐ро▒рпБрокро╛ройрпНроорпИ родрпЛро▓рпНро╡ро┐роХро│рпН роПро▒рпНро▒рпБроХрпНроХрпКро│рпНро│родрпНродроХрпНроХро╡рпИ)
- тЬЕ родро░ роЙро▒рпБродро┐рокрпНрокро╛роЯрпБ роЙро│рпНро│роЯроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ

**роорпБроЯрпБроХрпНроХроЩрпНроХро│рпН:**
- тЭМ роЪрпЖро▓ро╡ро╛ройродрпБ (рокро▓ рооро╛родро┐ро░ро┐ роЕро┤рпИрокрпНрокрпБроХро│рпН)
- тЭМ роорпЖродрпБро╡ро╛роХ (роЕройрпИродрпНродрпБ роорпБроХро╡ро░рпНроХро│рпБроХрпНроХро╛роХ роХро╛родрпНродро┐ро░рпБроХрпНроХро┐ро▒родрпБ)
- тЪая╕П роорпЛродро▓рпН родрпАро░рпНро╡рпБ родрпЗро╡рпИ

**роЙродро╛ро░рог рокропройрпНрокро╛роЯрпБроХро│рпН:**
- роЙро│рпНро│роЯроХрпНроХ рооро┐родрооро╛роХрпНроХро▓рпН (рокро▓ рооро╛родро┐ро░ро┐роХро│рпН роЙро│рпНро│роЯроХрпНроХродрпНродрпИ роородро┐рокрпНрокрпАроЯрпБ роЪрпЖропрпНроХро┐ройрпНро▒рой)
- роХрпБро▒ро┐ропрпАроЯрпБ роородро┐рокрпНрокрпАроЯрпБ (рокро▓ ро▓ро┐рогрпНроЯро░рпНроХро│рпН/рокроХрпБрокрпНрокро╛ропрпНро╡ро╛ро│ро░рпНроХро│рпН)
- рооро░рпБродрпНродрпБро╡ роирпЛропро▒ро┐родро▓рпН (рокро▓ AI рооро╛родро┐ро░ро┐роХро│рпН, роиро┐рокрпБрогро░рпН роЪро░ро┐рокро╛ро░рпНрокрпНрокрпБ)

---

## роХроЯрпНроЯроорпИрокрпНрокрпБ роХрогрпНрогрпЛроЯрпНроЯроорпН

### роорпБро┤рпБроорпИропро╛рой рокро▓ роорпБроХро╡ро░рпН роЕроорпИрокрпНрокрпБ Azure-ро▓рпН

```mermaid
graph TB
    User[рокропройро░рпН/API роХро┐ро│рпИропройрпНроЯрпН]
    APIM[роЕроЪрпВро░рпН API роорпЗро▓ро╛рогрпНроорпИ]
    Orchestrator[роЖро░рпНроХрпЖро╕рпНроЯрпНро░рпЗроЯрпНроЯро░рпН роЪрпЗро╡рпИ<br/>роХрогрпНроЯрпЖропрпНройро░рпН роЖрокрпН]
    ServiceBus[роЕроЪрпВро░рпН роЪрпЗро╡рпИ рокро╕рпН<br/>роЗро╡рпЖрогрпНроЯрпН ро╣рокрпН]
    
    Agent1[роЖро░ро╛ропрпНроЪрпНроЪро┐ роПроЬрпЖройрпНроЯрпН<br/>роХрогрпНроЯрпЖропрпНройро░рпН роЖрокрпН]
    Agent2[роОро┤рпБродрпНродро╛ро│ро░рпН роПроЬрпЖройрпНроЯрпН<br/>роХрогрпНроЯрпЖропрпНройро░рпН роЖрокрпН]
    Agent3[роЖройро▓ро┐ро╕рпНроЯрпН роПроЬрпЖройрпНроЯрпН<br/>роХрогрпНроЯрпЖропрпНройро░рпН роЖрокрпН]
    Agent4[ро░ро┐ро╡ро┐ропрпВро╡ро░рпН роПроЬрпЖройрпНроЯрпН<br/>роХрогрпНроЯрпЖропрпНройро░рпН роЖрокрпН]
    
    CosmosDB[(роХро╛ро╕рпНроорпЛро╕рпН DB<br/>рокроХро┐ро░рокрпНрокроЯрпНроЯ роиро┐ро▓рпИ)]
    Storage[роЕроЪрпВро░рпН ро╕рпНроЯрпЛро░рпЗроЬрпН<br/>роХро▓рпИроХро│рпН]
    AppInsights[роЕрокрпНро│ро┐роХрпЗро╖ройрпН роЗройрпНроЪрпИроЯрпНро╕рпН<br/>роорпЛройро┐роЯрпНроЯро░ро┐роЩрпН]
    
    User --> APIM
    APIM --> Orchestrator
    
    Orchestrator --> ServiceBus
    ServiceBus --> Agent1
    ServiceBus --> Agent2
    ServiceBus --> Agent3
    ServiceBus --> Agent4
    
    Agent1 --> CosmosDB
    Agent2 --> CosmosDB
    Agent3 --> CosmosDB
    Agent4 --> CosmosDB
    
    Agent1 --> Storage
    Agent2 --> Storage
    Agent3 --> Storage
    Agent4 --> Storage
    
    Orchestrator -.-> AppInsights
    Agent1 -.-> AppInsights
    Agent2 -.-> AppInsights
    Agent3 -.-> AppInsights
    Agent4 -.-> AppInsights
    
    style Orchestrator fill:#FF9800,stroke:#F57C00,stroke-width:3px,color:#fff
    style ServiceBus fill:#9C27B0,stroke:#7B1FA2,stroke-width:3px,color:#fff
    style CosmosDB fill:#4CAF50,stroke:#388E3C,stroke-width:3px,color:#fff
```
**роорпБроХрпНроХро┐роп роХрпВро▒рпБроХро│рпН:**

| роХрпВро▒рпБ | роирпЛроХрпНроХроорпН | Azure роЪрпЗро╡рпИ |
|-----------|---------|---------------|
| **API Gateway** | роирпБро┤рпИро╡рпБ рокрпБро│рпНро│ро┐, ро╡ро┐роХро┐род ро╡ро░рпИропро▒рпИ, роЕроЩрпНроХрпАроХро╛ро░роорпН | API Management |
| **Orchestrator** | роорпБроХро╡ро░рпН рокрогро┐роЪрпНроЪрпВро┤ро▓рпНроХро│рпИ роТро░рпБроЩрпНроХро┐рогрпИроХрпНроХро┐ро▒родрпБ | Container Apps |
| **Message Queue** | роЕроЪро┐роЩрпНроХрпНро░рпЛройро╕рпН родрпКроЯро░рпНрокрпБ | Service Bus / Event Hubs |
| **Agents** | роЪро┐ро▒рокрпНрокрпБ рокрпЖро▒рпНро▒ AI родрпКро┤ро┐ро▓ро╛ро│ро░рпНроХро│рпН | Container Apps / Functions |
| **State Store** | рокроХро┐ро░рокрпНрокроЯрпНроЯ роиро┐ро▓рпИ, рокрогро┐роХро│рпИ роХрогрпНроХро╛рогро┐родрпНродро▓рпН | Cosmos DB |
| **Artifact Storage** | роЖро╡рогроЩрпНроХро│рпН, роорпБроЯро┐ро╡рпБроХро│рпН, рокродро┐ро╡рпБроХро│рпН | Blob Storage |
| **Monitoring** | ро╡ро┐роиро┐ропрпЛроХро┐роХрпНроХрокрпНрокроЯрпНроЯ роХрогрпНроХро╛рогро┐рокрпНрокрпБ, рокродро┐ро╡рпБроХро│рпН | Application Insights |

---

## роорпБройрпН родрпЗро╡рпИроХро│рпН

### родрпЗро╡рпИропро╛рой роХро░рпБро╡ро┐роХро│рпН

```bash
# Azure Developer CLI роР роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
azd version
# тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ: azd рокродро┐рокрпНрокрпБ 1.0.0 роЕро▓рпНро▓родрпБ роЕродро▒рпНроХрпБ роорпЗро▓рпН

# Azure CLI роР роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az --version
# тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ: azure-cli 2.50.0 роЕро▓рпНро▓родрпБ роЕродро▒рпНроХрпБ роорпЗро▓рпН

# Docker роР роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН (роЙро│рпНро│рпВро░рпН роЪрпЛродройрпИроХрпНроХро╛роХ)
docker --version
# тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпНроЯродрпБ: Docker рокродро┐рокрпНрокрпБ 20.10 роЕро▓рпНро▓родрпБ роЕродро▒рпНроХрпБ роорпЗро▓рпН
```

### Azure родрпЗро╡рпИроХро│рпН

- роЪрпЖропро▓ро┐ро▓рпН роЙро│рпНро│ Azure роЪроирпНродро╛
- роЙро░рпБро╡ро╛роХрпНроХ роЕройрпБроородро┐роХро│рпН:
  - Container Apps
  - Service Bus namespaces
  - Cosmos DB accounts
  - Storage accounts
  - Application Insights

### роЕро▒ро┐ро╡рпБ роорпБройрпН родрпЗро╡рпИроХро│рпН

роирпАроЩрпНроХро│рпН роорпБроЯро┐родрпНродро┐ро░рпБроХрпНроХ ро╡рпЗрогрпНроЯрпБроорпН:
- [роХроЯрпНроЯроорпИрокрпНрокрпБ роорпЗро▓ро╛рогрпНроорпИ](../getting-started/configuration.md)
- [роЕроЩрпНроХрпАроХро╛ро░роорпН & рокро╛родрпБроХро╛рокрпНрокрпБ](../getting-started/authsecurity.md)
- [роорпИроХрпНро░рпЛроЪрпЗро╡рпИроХро│рпН роЙродро╛ро░рогроорпН](../../../../examples/microservices)

---

## роЪрпЖропро▓рпНрокроЯрпБродрпНродро▓рпН ро╡ро┤ро┐роХро╛роЯрпНроЯро┐

### родро┐роЯрпНроЯ роЕроорпИрокрпНрокрпБ

```
multi-agent-system/
тФЬтФАтФА azure.yaml                    # AZD configuration
тФЬтФАтФА infra/
тФВ   тФЬтФАтФА main.bicep               # Main infrastructure
тФВ   тФЬтФАтФА core/
тФВ   тФВ   тФЬтФАтФА servicebus.bicep     # Message queue
тФВ   тФВ   тФЬтФАтФА cosmos.bicep         # State store
тФВ   тФВ   тФЬтФАтФА storage.bicep        # Artifact storage
тФВ   тФВ   тФФтФАтФА monitoring.bicep     # Application Insights
тФВ   тФФтФАтФА app/
тФВ       тФЬтФАтФА orchestrator.bicep   # Orchestrator service
тФВ       тФФтФАтФА agent.bicep          # Agent template
тФФтФАтФА src/
    тФЬтФАтФА orchestrator/            # Orchestration logic
    тФВ   тФЬтФАтФА app.py
    тФВ   тФЬтФАтФА workflows.py
    тФВ   тФФтФАтФА Dockerfile
    тФЬтФАтФА agents/
    тФВ   тФЬтФАтФА research/            # Research agent
    тФВ   тФЬтФАтФА writer/              # Writer agent
    тФВ   тФЬтФАтФА analyst/             # Analyst agent
    тФВ   тФФтФАтФА reviewer/            # Reviewer agent
    тФФтФАтФА shared/
        тФЬтФАтФА state_manager.py     # Shared state logic
        тФФтФАтФА message_handler.py   # Message handling
```

---

## рокро╛роЯроорпН 1: родрпКроЯро░рпНроЪрпНроЪро┐ропро╛рой роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ роорпБро▒рпИ

### роЪрпЖропро▓рпНрокроЯрпБродрпНродро▓рпН: роЙро│рпНро│роЯроХрпНроХ роЙро░рпБро╡ро╛роХрпНроХ роХрпБро┤ро╛ропрпН

роЖро░ро╛ропрпНроЪрпНроЪро┐ тЖТ роОро┤рпБродрпБродро▓рпН тЖТ родро┐ро░рпБродрпНродрпБродро▓рпН тЖТ ро╡рпЖро│ро┐ропро┐роЯрпБродро▓рпН роОройрпНро▒ родрпКроЯро░рпНроЪрпНроЪро┐ропро╛рой роХрпБро┤ро╛ропрпИ роЙро░рпБро╡ро╛роХрпНроХрпБро╡рпЛроорпН

### 1. AZD роХроЯрпНроЯроорпИрокрпНрокрпБ

**роХрпЛрокрпНрокрпБ: `azure.yaml`**

```yaml
name: content-pipeline
metadata:
  template: multi-agent-sequential@1.0.0

services:
  orchestrator:
    project: ./src/orchestrator
    language: python
    host: containerapp
  
  research-agent:
    project: ./src/agents/research
    language: python
    host: containerapp
  
  writer-agent:
    project: ./src/agents/writer
    language: python
    host: containerapp
  
  editor-agent:
    project: ./src/agents/editor
    language: python
    host: containerapp
```

### 2. роЙро│рпНроХроЯрпНроЯроорпИрокрпНрокрпБ: роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБроХрпНроХро╛рой Service Bus

**роХрпЛрокрпНрокрпБ: `infra/core/servicebus.bicep`**

```bicep
param name string
param location string
param tags object = {}

resource serviceBusNamespace 'Microsoft.ServiceBus/namespaces@2022-10-01-preview' = {
  name: name
  location: location
  tags: tags
  sku: {
    name: 'Standard'
    tier: 'Standard'
  }
  properties: {
    minimumTlsVersion: '1.2'
  }
}

// Queue for orchestrator тЖТ research agent
resource researchQueue 'Microsoft.ServiceBus/namespaces/queues@2022-10-01-preview' = {
  parent: serviceBusNamespace
  name: 'research-tasks'
  properties: {
    maxDeliveryCount: 3
    lockDuration: 'PT5M'
    deadLetteringOnMessageExpiration: true
  }
}

// Queue for research agent тЖТ writer agent
resource writerQueue 'Microsoft.ServiceBus/namespaces/queues@2022-10-01-preview' = {
  parent: serviceBusNamespace
  name: 'writer-tasks'
  properties: {
    maxDeliveryCount: 3
    lockDuration: 'PT5M'
  }
}

// Queue for writer agent тЖТ editor agent
resource editorQueue 'Microsoft.ServiceBus/namespaces/queues@2022-10-01-preview' = {
  parent: serviceBusNamespace
  name: 'editor-tasks'
  properties: {
    maxDeliveryCount: 3
    lockDuration: 'PT5M'
  }
}

output namespace string = serviceBusNamespace.name
output connectionString string = listKeys('${serviceBusNamespace.id}/AuthorizationRules/RootManageSharedAccessKey', serviceBusNamespace.apiVersion).primaryConnectionString
```

### 3. рокроХро┐ро░рокрпНрокроЯрпНроЯ роиро┐ро▓рпИ роорпЗро▓ро╛ро│ро░рпН

**роХрпЛрокрпНрокрпБ: `src/shared/state_manager.py`**

```python
from azure.cosmos import CosmosClient, PartitionKey
from datetime import datetime
import os

class StateManager:
    """Manages shared state across agents using Cosmos DB"""
    
    def __init__(self):
        endpoint = os.environ['COSMOS_ENDPOINT']
        key = os.environ['COSMOS_KEY']
        
        self.client = CosmosClient(endpoint, key)
        self.database = self.client.get_database_client('agent-state')
        self.container = self.database.get_container_client('tasks')
    
    def create_task(self, task_id: str, task_type: str, input_data: dict):
        """Create a new task"""
        task = {
            'id': task_id,
            'type': task_type,
            'status': 'pending',
            'input': input_data,
            'created_at': datetime.utcnow().isoformat(),
            'steps': []
        }
        self.container.create_item(task)
        return task
    
    def update_task_step(self, task_id: str, step_name: str, result: dict):
        """Update task with completed step"""
        task = self.container.read_item(task_id, partition_key=task_id)
        
        task['steps'].append({
            'name': step_name,
            'completed_at': datetime.utcnow().isoformat(),
            'result': result
        })
        
        self.container.replace_item(task_id, task)
        return task
    
    def complete_task(self, task_id: str, final_result: dict):
        """Mark task as complete"""
        task = self.container.read_item(task_id, partition_key=task_id)
        task['status'] = 'completed'
        task['result'] = final_result
        task['completed_at'] = datetime.utcnow().isoformat()
        self.container.replace_item(task_id, task)
        return task
    
    def get_task(self, task_id: str):
        """Retrieve task state"""
        return self.container.read_item(task_id, partition_key=task_id)
```

### 4. роТро┤рпБроЩрпНроХроорпИрокрпНрокрпБ роЪрпЗро╡рпИ

**роХрпЛрокрпНрокрпБ: `src/orchestrator/app.py`**

```python
from flask import Flask, request, jsonify
from azure.servicebus import ServiceBusClient, ServiceBusMessage
import json
import uuid
import os
from shared.state_manager import StateManager

app = Flask(__name__)
state_manager = StateManager()

# роЪрпЗро╡рпИ рокро╕рпН роЗрогрпИрокрпНрокрпБ
servicebus_connection_str = os.environ['SERVICEBUS_CONNECTION_STRING']
servicebus_client = ServiceBusClient.from_connection_string(servicebus_connection_str)

@app.route('/health', methods=['GET'])
def health():
    return jsonify({'status': 'healthy', 'service': 'orchestrator'})

@app.route('/create-content', methods=['POST'])
def create_content():
    """
    Sequential workflow: Research тЖТ Write тЖТ Edit тЖТ Publish
    """
    data = request.json
    topic = data.get('topic')
    
    if not topic:
        return jsonify({'error': 'Topic required'}), 400
    
    # рооро╛роиро┐ро▓роХрпН роХроЯрпИропро┐ро▓рпН рокрогро┐ропрпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН
    task_id = str(uuid.uuid4())
    task = state_manager.create_task(
        task_id=task_id,
        task_type='content_creation',
        input_data={'topic': topic}
    )
    
    # роЖро░ро╛ропрпНроЪрпНроЪро┐ роорпБроХро╡ро░рпБроХрпНроХрпБ роЪрпЖропрпНродро┐ропрпИ роЕройрпБрокрпНрокро╡рпБроорпН (роорпБродро▓рпН рокроЯро┐)
    sender = servicebus_client.get_queue_sender('research-tasks')
    message = ServiceBusMessage(
        body=json.dumps({
            'task_id': task_id,
            'topic': topic,
            'next_queue': 'writer-tasks'  # роорпБроЯро┐ро╡рпБроХро│рпИ роОроЩрпНроХрпБ роЕройрпБрокрпНрок ро╡рпЗрогрпНроЯрпБроорпН
        }),
        content_type='application/json'
    )
    
    with sender:
        sender.send_messages(message)
    
    return jsonify({
        'task_id': task_id,
        'status': 'started',
        'workflow': 'sequential',
        'steps': ['research', 'write', 'edit', 'publish'],
        'message': 'Content creation pipeline initiated'
    }), 202

@app.route('/task/<task_id>', methods=['GET'])
def get_task_status(task_id):
    """Check task status"""
    try:
        task = state_manager.get_task(task_id)
        return jsonify(task)
    except Exception as e:
        return jsonify({'error': str(e)}), 404

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

### 5. роЖро░ро╛ропрпНроЪрпНроЪро┐ роорпБроХро╡ро░рпН

**роХрпЛрокрпНрокрпБ: `src/agents/research/app.py`**

```python
from azure.servicebus import ServiceBusClient, ServiceBusMessage
from openai import AzureOpenAI
import json
import os
import time
from shared.state_manager import StateManager

# роХро┐ро│рпИропройрпНроЯрпБроХро│рпИ родрпКроЯроЩрпНроХро╡рпБроорпН
state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

openai_client = AzureOpenAI(
    api_key=os.environ['AZURE_OPENAI_API_KEY'],
    api_version="2024-02-01",
    azure_endpoint=os.environ['AZURE_OPENAI_ENDPOINT']
)

def process_research_task(message_data):
    """Process research request and pass to writer"""
    task_id = message_data['task_id']
    topic = message_data['topic']
    next_queue = message_data['next_queue']
    
    print(f"ЁЯФм Researching: {topic}")
    
    # роЖро░ро╛ропрпНроЪрпНроЪро┐роХрпНроХро╛роХ Azure OpenAI роР роЕро┤рпИроХрпНроХро╡рпБроорпН
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are a research assistant. Provide comprehensive research on the given topic."},
            {"role": "user", "content": f"Research this topic thoroughly: {topic}"}
        ],
        max_tokens=1500
    )
    
    research_results = response.choices[0].message.content
    
    # роиро┐ро▓рпИропрпИ рокрпБродрпБрокрпНрокро┐роХрпНроХро╡рпБроорпН
    state_manager.update_task_step(
        task_id=task_id,
        step_name='research',
        result={'research': research_results}
    )
    
    # роЕроЯрпБродрпНрод роорпБроХро╡ро░рпБроХрпНроХрпБ (роОро┤рпБродрпНродро╛ро│ро░рпН) роЕройрпБрокрпНрокро╡рпБроорпН
    sender = servicebus_client.get_queue_sender(next_queue)
    message = ServiceBusMessage(
        body=json.dumps({
            'task_id': task_id,
            'topic': topic,
            'research': research_results,
            'next_queue': 'editor-tasks'
        }),
        content_type='application/json'
    )
    
    with sender:
        sender.send_messages(message)
    
    print(f"тЬЕ Research complete for task {task_id}")

def main():
    """Listen to research queue"""
    receiver = servicebus_client.get_queue_receiver('research-tasks')
    
    print("ЁЯФм Research Agent started, listening for tasks...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_research_task(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"тЭМ Error processing message: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

### 6. роОро┤рпБродрпНродро╛ро│ро░рпН роорпБроХро╡ро░рпН

**роХрпЛрокрпНрокрпБ: `src/agents/writer/app.py`**

```python
from azure.servicebus import ServiceBusClient, ServiceBusMessage
from openai import AzureOpenAI
import json
import os
from shared.state_manager import StateManager

state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

openai_client = AzureOpenAI(
    api_key=os.environ['AZURE_OPENAI_API_KEY'],
    api_version="2024-02-01",
    azure_endpoint=os.environ['AZURE_OPENAI_ENDPOINT']
)

def process_writing_task(message_data):
    """Write article based on research"""
    task_id = message_data['task_id']
    topic = message_data['topic']
    research = message_data['research']
    next_queue = message_data['next_queue']
    
    print(f"тЬНя╕П Writing article: {topic}")
    
    # Azure OpenAI роР роЕро┤рпИродрпНродрпБ роХроЯрпНроЯрпБро░рпИ роОро┤рпБродро╡рпБроорпН
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are a professional writer. Write engaging, well-structured articles."},
            {"role": "user", "content": f"Based on this research:\n\n{research}\n\nWrite a comprehensive article about: {topic}"}
        ],
        max_tokens=2000
    )
    
    article_draft = response.choices[0].message.content
    
    # роиро┐ро▓рпИропрпИ рокрпБродрпБрокрпНрокро┐роХрпНроХро╡рпБроорпН
    state_manager.update_task_step(
        task_id=task_id,
        step_name='writing',
        result={'draft': article_draft}
    )
    
    # роЖроЪро┐ро░ро┐ропро░рпБроХрпНроХрпБ роЕройрпБрокрпНрокро╡рпБроорпН
    sender = servicebus_client.get_queue_sender(next_queue)
    message = ServiceBusMessage(
        body=json.dumps({
            'task_id': task_id,
            'topic': topic,
            'draft': article_draft
        }),
        content_type='application/json'
    )
    
    with sender:
        sender.send_messages(message)
    
    print(f"тЬЕ Article draft complete for task {task_id}")

def main():
    """Listen to writer queue"""
    receiver = servicebus_client.get_queue_receiver('writer-tasks')
    
    print("тЬНя╕П Writer Agent started, listening for tasks...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_writing_task(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"тЭМ Error: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

### 7. родро┐ро░рпБродрпНродрпБроиро░рпН роорпБроХро╡ро░рпН

**роХрпЛрокрпНрокрпБ: `src/agents/editor/app.py`**

```python
from azure.servicebus import ServiceBusClient
from openai import AzureOpenAI
import json
import os
from shared.state_manager import StateManager

state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

openai_client = AzureOpenAI(
    api_key=os.environ['AZURE_OPENAI_API_KEY'],
    api_version="2024-02-01",
    azure_endpoint=os.environ['AZURE_OPENAI_ENDPOINT']
)

def process_editing_task(message_data):
    """Edit and finalize article"""
    task_id = message_data['task_id']
    topic = message_data['topic']
    draft = message_data['draft']
    
    print(f"ЁЯУЭ Editing article: {topic}")
    
    # Azure OpenAI роР роЕро┤рпИроХрпНроХро╡рпБроорпН родро┐ро░рпБродрпНродро╡рпБроорпН
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are an expert editor. Improve grammar, clarity, and structure."},
            {"role": "user", "content": f"Edit and improve this article:\n\n{draft}"}
        ],
        max_tokens=2000
    )
    
    final_article = response.choices[0].message.content
    
    # рокрогро┐ропрпИ роорпБроЯро┐роирпНродродро╛роХ роХрпБро▒ро┐роХрпНроХро╡рпБроорпН
    state_manager.complete_task(
        task_id=task_id,
        final_result={
            'topic': topic,
            'final_article': final_article,
            'word_count': len(final_article.split())
        }
    )
    
    print(f"тЬЕ Article finalized for task {task_id}")

def main():
    """Listen to editor queue"""
    receiver = servicebus_client.get_queue_receiver('editor-tasks')
    
    print("ЁЯУЭ Editor Agent started, listening for tasks...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_editing_task(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"тЭМ Error: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

### 8. рокро┐ро░роЪрпБро░роорпН рооро▒рпНро▒рпБроорпН роЪрпЛродройрпИ

```bash
# родрпКроЯроЩрпНроХро╡рпБроорпН рооро▒рпНро▒рпБроорпН рокро┐ро░роЪрпБро░ро┐роХрпНроХро╡рпБроорпН
azd init
azd up

# роТро░рпНроХрпЖро╕рпНроЯрпНро░рпЗроЯрпНроЯро░рпН URL роР рокрпЖро▒ро╡рпБроорпН
ORCHESTRATOR_URL=$(azd env get-values | grep ORCHESTRATOR_URL | cut -d '=' -f2 | tr -d '"')

# роЙро│рпНро│роЯроХрпНроХродрпНродрпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН
curl -X POST $ORCHESTRATOR_URL/create-content \
  -H "Content-Type: application/json" \
  -d '{"topic": "The Future of AI in Healthcare"}'
```

**тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпБроорпН ро╡рпЖро│ро┐ропрпАроЯрпБ:**
```json
{
  "task_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "status": "started",
  "workflow": "sequential",
  "steps": ["research", "write", "edit", "publish"],
  "message": "Content creation pipeline initiated"
}
```

**рокрогро┐ропро┐ройрпН роорпБройрпНройрпЗро▒рпНро▒родрпНродрпИроЪрпН роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН:**
```bash
TASK_ID="a1b2c3d4-e5f6-7890-abcd-ef1234567890"
curl $ORCHESTRATOR_URL/task/$TASK_ID
```

**тЬЕ роОродро┐ро░рпНрокро╛ро░рпНроХрпНроХрокрпНрокроЯрпБроорпН ро╡рпЖро│ро┐ропрпАроЯрпБ (роорпБроЯро┐роХрпНроХрокрпНрокроЯрпНроЯродрпБ):**
```json
{
  "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "type": "content_creation",
  "status": "completed",
  "steps": [
    {
      "name": "research",
      "completed_at": "2025-11-19T10:30:00Z",
      "result": {"research": "..."}
    },
    {
      "name": "writing",
      "completed_at": "2025-11-19T10:32:00Z",
      "result": {"draft": "..."}
    }
  ],
  "result": {
    "topic": "The Future of AI in Healthcare",
    "final_article": "...",
    "word_count": 1500
  }
}
```

---

## рокро╛роЯроорпН 2: роЗрогрпИ роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ роорпБро▒рпИ

### роЪрпЖропро▓рпНрокроЯрпБродрпНродро▓рпН: рокро▓ роорпВро▓ роЖро░ро╛ропрпНроЪрпНроЪро┐ родрпКроХрпБрокрпНрокро╛ро│ро░рпН

рокро▓ роорпВро▓роЩрпНроХро│ро┐ро▓рпН роЗро░рпБроирпНродрпБ роТро░рпЗ роирпЗро░родрпНродро┐ро▓рпН родроХро╡ро▓рпНроХро│рпИ роЪрпЗроХро░ро┐роХрпНроХрпБроорпН роЗрогрпИ роЕроорпИрокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХрпБро╡рпЛроорпН.

### роЗрогрпИ роТро┤рпБроЩрпНроХроорпИрокрпНрокро╛ро│ро░рпН

**роХрпЛрокрпНрокрпБ: `src/orchestrator/parallel_workflow.py`**

```python
from flask import Flask, request, jsonify
from azure.servicebus import ServiceBusClient, ServiceBusMessage
import json
import uuid
import os
from shared.state_manager import StateManager

app = Flask(__name__)
state_manager = StateManager()

servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

@app.route('/research-parallel', methods=['POST'])
def research_parallel():
    """
    Parallel workflow: Multiple agents work simultaneously
    """
    data = request.json
    query = data.get('query')
    
    task_id = str(uuid.uuid4())
    task = state_manager.create_task(
        task_id=task_id,
        task_type='parallel_research',
        input_data={
            'query': query,
            'agents': ['web', 'academic', 'news', 'social']
        }
    )
    
    # рокроЩрпНроХрпБ ро╡рпЖро│ро┐ропрпЗро▒рпНро▒роорпН: роЕройрпИродрпНродрпБ роорпБроХро╡ро░рпНроХро│рпБроХрпНроХрпБроорпН роТро░рпЗ роирпЗро░родрпНродро┐ро▓рпН роЕройрпБрокрпНрокро╡рпБроорпН
    agents = [
        ('web-research-queue', 'web'),
        ('academic-research-queue', 'academic'),
        ('news-research-queue', 'news'),
        ('social-research-queue', 'social')
    ]
    
    for queue_name, agent_type in agents:
        sender = servicebus_client.get_queue_sender(queue_name)
        message = ServiceBusMessage(
            body=json.dumps({
                'task_id': task_id,
                'query': query,
                'agent_type': agent_type,
                'result_queue': 'aggregation-queue'
            }),
            content_type='application/json'
        )
        
        with sender:
            sender.send_messages(message)
    
    return jsonify({
        'task_id': task_id,
        'status': 'started',
        'workflow': 'parallel',
        'agents_dispatched': 4,
        'message': 'Parallel research initiated'
    }), 202

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

### родрпКроХрпБрокрпНрокрпБ родро░рпНроХрпНроХроорпН

**роХрпЛрокрпНрокрпБ: `src/agents/aggregator/app.py`**

```python
from azure.servicebus import ServiceBusClient
import json
import os
from collections import defaultdict
from shared.state_manager import StateManager

state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

# роТро╡рпНро╡рпКро░рпБ рокрогро┐роХрпНроХро╛рой роорпБроЯро┐ро╡рпБроХро│рпИ роХрогрпНроХро╛рогро┐роХрпНроХро╡рпБроорпН
task_results = defaultdict(list)
expected_agents = 4  # ро╡ро▓рпИ, роХро▓рпНро╡ро┐, роЪрпЖропрпНродро┐роХро│рпН, роЪроорпВроХ

def process_result(message_data):
    """Aggregate results from parallel agents"""
    task_id = message_data['task_id']
    agent_type = message_data['agent_type']
    result = message_data['result']
    
    # роорпБроЯро┐ро╡рпБроХро│рпИ роЪрпЗрооро┐роХрпНроХро╡рпБроорпН
    task_results[task_id].append({
        'agent': agent_type,
        'data': result
    })
    
    print(f"ЁЯУК Received result from {agent_type} agent ({len(task_results[task_id])}/{expected_agents})")
    
    # роЕройрпИродрпНродрпБ роорпБроХро╡ро░рпНроХро│рпБроорпН роорпБроЯро┐родрпНродродро╛ роОройрпНрокродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН (fan-in)
    if len(task_results[task_id]) == expected_agents:
        print(f"тЬЕ All agents completed for task {task_id}. Aggregating...")
        
        # роорпБроЯро┐ро╡рпБроХро│рпИ роЗрогрпИроХрпНроХро╡рпБроорпН
        aggregated = {
            'query': message_data['query'],
            'sources': task_results[task_id],
            'summary': generate_summary(task_results[task_id])
        }
        
        # роорпБроЯро┐роирпНродродрпБ роОройрпНро▒рпБ роХрпБро▒ро┐роХрпНроХро╡рпБроорпН
        state_manager.complete_task(task_id, aggregated)
        
        # роЪрпБродрпНродроорпН роЪрпЖропрпНропро╡рпБроорпН
        del task_results[task_id]
        
        print(f"тЬЕ Aggregation complete for task {task_id}")

def generate_summary(results):
    """Generate summary from all sources"""
    summaries = [r['data'].get('summary', '') for r in results]
    return '\n\n'.join(summaries)

def main():
    """Listen to aggregation queue"""
    receiver = servicebus_client.get_queue_receiver('aggregation-queue')
    
    print("ЁЯУК Aggregator started, listening for results...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_result(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"тЭМ Error: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

**роЗрогрпИ роорпБро▒рпИропро┐ройрпН роиройрпНроорпИроХро│рпН:**
- тЪб **4x ро╡рпЗроХрооро╛ройродрпБ** (роорпБроХро╡ро░рпНроХро│рпН роТро░рпЗ роирпЗро░родрпНродро┐ро▓рпН роЗропроЩрпНроХрпБроХро┐ройрпНро▒ройро░рпН)
- ЁЯФД **рокро┐ро┤рпИродрпН родро╛роЩрпНроХрпБроорпН** (рокроХрпБродро┐ роорпБроЯро┐ро╡рпБроХро│рпН роПро▒рпНро▒рпБроХрпНроХрпКро│рпНро│родрпНродроХрпНроХро╡рпИ)
- ЁЯУИ **роХрпБро╡ро┐ропро▓ро╛роХ рокро░ро╡рпБроХро┐ро▒родрпБ** (роорпБроХро╡ро░рпНроХро│рпИ роОро│ро┐родро╛роХроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН)

---

## роироЯрпИроорпБро▒рпИ рокропро┐ро▒рпНроЪро┐роХро│рпН

### рокропро┐ро▒рпНроЪро┐ 1: роирпЗро░роорпН роорпБроЯро┐ро╡рпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН тнРтнР (рооро┐родрооро╛ройродрпБ)

**роирпЛроХрпНроХроорпН**: родрпКроХрпБрокрпНрокро╛ро│ро░рпН роорпЖродрпБро╡ро╛роХ роЪрпЖропро▓рпНрокроЯрпБроорпН роорпБроХро╡ро░рпНроХро│рпБроХрпНроХро╛роХ роиро┐ро░роирпНродро░рооро╛роХ роХро╛родрпНродро┐ро░рпБроХрпНроХро╛рооро▓рпН роирпЗро░роорпН роорпБроЯро┐ро╡рпИроЪрпН роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН.

**роЕроЯро┐роХро│рпН**:

1. **родрпКроХрпБрокрпНрокро╛ро│ро░рпБроХрпНроХрпБ роирпЗро░роорпН роорпБроЯро┐ро╡рпБ роХрогрпНроХро╛рогро┐рокрпНрокрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:**

```python
from datetime import datetime, timedelta

task_timeouts = {}  # task_id -> роХро╛ро▓ро╛ро╡родро┐ роирпЗро░роорпН

def process_result(message_data):
    task_id = message_data['task_id']
    
    # роорпБродро▓рпН роорпБроЯро┐ро╡ро┐ро▓рпН роирпЗро░родрпНродрпИ роЕроорпИроХрпНроХро╡рпБроорпН
    if task_id not in task_timeouts:
        task_timeouts[task_id] = datetime.utcnow() + timedelta(seconds=30)
    
    task_results[task_id].append({
        'agent': message_data['agent_type'],
        'data': message_data['result']
    })
    
    # роорпБроЯро┐роирпНродродрпБ роЕро▓рпНро▓родрпБ роирпЗро░роорпН роорпБроЯро┐роирпНродродрпБ роОройрпНрокродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
    if len(task_results[task_id]) == expected_agents or \
       datetime.utcnow() > task_timeouts[task_id]:
        
        print(f"ЁЯУК Aggregating with {len(task_results[task_id])}/{expected_agents} results")
        
        aggregated = {
            'query': message_data['query'],
            'sources': task_results[task_id],
            'completed_agents': len(task_results[task_id]),
            'timed_out': len(task_results[task_id]) < expected_agents
        }
        
        state_manager.complete_task(task_id, aggregated)
        
        # роЪрпБродрпНродроорпН роЪрпЖропрпНропро╡рпБроорпН
        del task_results[task_id]
        del task_timeouts[task_id]
```

2. **роХро▒рпНрокройрпИ родро╛роородроЩрпНроХро│рпБроЯройрпН роЪрпЛродро┐роХрпНроХро╡рпБроорпН:**

```python
# роТро░рпБ роорпБроХро╡ро░ро┐ро▓рпН роорпЖродрпБро╡ро╛рой роЪрпЖропро▓ро╛роХрпНроХродрпНродрпИ роТродрпНродро┐роХрпИ роЪрпЖропрпНроп родро╛роородродрпНродрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН
import time
time.sleep(35)  # 30 ро╡ро┐ройро╛роЯро┐ роирпЗро░родрпНродрпИ роорпАро▒рпБроХро┐ро▒родрпБ
```

3. **рокро┐ро░роЪрпБро░роорпН роЪрпЖропрпНродрпБ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН:**

```bash
azd deploy aggregator

# рокрогро┐ропрпИ роЪрооро░рпНрокрпНрокро┐роХрпНроХро╡рпБроорпН
curl -X POST $ORCHESTRATOR_URL/research-parallel \
  -H "Content-Type: application/json" \
  -d '{"query": "AI safety research"}'

# 30 ро╡ро┐роиро╛роЯро┐роХро│рпН роХро┤ро┐родрпНродрпБ роорпБроЯро┐ро╡рпБроХро│рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
curl $ORCHESTRATOR_URL/task/$TASK_ID
```

**тЬЕ ро╡рпЖро▒рпНро▒ро┐ропро┐ройрпН роЕро│ро╡рпБроХрпЛро▓рпНроХро│рпН:**
- тЬЕ роорпБроХро╡ро░рпНроХро│рпН роорпБроЯро┐роХрпНроХро╛ро╡ро┐роЯрпНроЯро╛ро▓рпБроорпН 30 ро╡ро┐ройро╛роЯро┐роХро│ро┐ро▓рпН рокрогро┐ роорпБроЯро┐роХро┐ро▒родрпБ
- тЬЕ рокродро┐ро▓рпН рокроХрпБродро┐ роорпБроЯро┐ро╡рпБроХро│рпИ роХрпБро▒ро┐роХрпНроХро┐ро▒родрпБ (`"timed_out": true`)
- тЬЕ роХро┐роЯрпИроХрпНроХроХрпНроХрпВроЯро┐роп роорпБроЯро┐ро╡рпБроХро│рпН родро┐ро░рпБроорпНрокрпБроХро┐ройрпНро▒рой (4 роорпБроХро╡ро░рпНроХро│ро┐ро▓рпН 3)

**роирпЗро░роорпН**: 20-25 роиро┐рооро┐роЯроЩрпНроХро│рпН

---

### рокропро┐ро▒рпНроЪро┐ 2: роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐ родро░рпНроХрпНроХроорпН роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН тнРтнРтнР (роорпЗроорпНрокроЯрпНроЯродрпБ)

**роирпЛроХрпНроХроорпН**: родрпЛро▓рпНро╡ро┐ропроЯрпИроирпНрод роорпБроХро╡ро░рпН рокрогро┐роХро│рпИ роорпБро┤рпБроорпИропро╛роХ роорпБропро▒рпНроЪро┐роХрпНроХрпБроорпБройрпН родро╛ройро╛роХро╡рпЗ роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро╡рпБроорпН.

**роЕроЯро┐роХро│рпН**:

1. **роТро┤рпБроЩрпНроХроорпИрокрпНрокро╛ро│ро░рпБроХрпНроХрпБ роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐ роХрогрпНроХро╛рогро┐рокрпНрокрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:**

```python
from dataclasses import dataclass
from typing import Dict

@dataclass
class RetryConfig:
    max_retries: int = 3
    backoff_seconds: int = 5

retry_counts: Dict[str, int] = {}  # роЪрпЖропрпНродро┐_роЕроЯрпИропро╛ро│роорпН -> роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐ роОрогрпНрогро┐роХрпНроХрпИ

def send_with_retry(queue_name: str, message_data: dict, retry_config: RetryConfig):
    """Send message with retry metadata"""
    message_id = message_data.get('message_id', str(uuid.uuid4()))
    message_data['message_id'] = message_id
    message_data['retry_count'] = retry_counts.get(message_id, 0)
    message_data['max_retries'] = retry_config.max_retries
    
    sender = servicebus_client.get_queue_sender(queue_name)
    message = ServiceBusMessage(
        body=json.dumps(message_data),
        content_type='application/json',
        message_id=message_id
    )
    
    with sender:
        sender.send_messages(message)
```

2. **роорпБроХро╡ро░рпНроХро│рпБроХрпНроХрпБ роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐ роХрпИропро╛ро│ро┐ропрпИроЪрпН роЪрпЗро░рпНроХрпНроХро╡рпБроорпН:**

```python
def process_with_retry(message, receiver, process_func):
    """Process message with automatic retry on failure"""
    try:
        message_data = json.loads(str(message))
        
        # роЪрпЖропрпНродро┐ропрпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродрпБ
        process_func(message_data)
        
        # ро╡рпЖро▒рпНро▒ро┐ - роорпБроЯро┐роирпНродродрпБ
        receiver.complete_message(message)
        
    except Exception as e:
        message_id = message.message_id
        retry_count = message_data.get('retry_count', 0)
        max_retries = message_data.get('max_retries', 3)
        
        if retry_count < max_retries:
            # роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐: роХрпИро╡ро┐роЯро╡рпБроорпН рооро▒рпНро▒рпБроорпН роОрогрпНрогро┐роХрпНроХрпИ роЕродро┐роХро░ро┐роХрпНроХрокрпНрокроЯрпНроЯрпБ роорпАрогрпНроЯрпБроорпН ро╡ро░ро┐роЪрпИрокрпНрокроЯрпБродрпНродро╡рпБроорпН
            print(f"тЪая╕П Retry {retry_count + 1}/{max_retries} for message {message_id}")
            
            message_data['retry_count'] = retry_count + 1
            
            # роТро░рпЗ ро╡ро░ро┐роЪрпИроХрпНроХрпБ родро╛роородродрпНродрпБроЯройрпН родро┐ро░рпБрокрпНрокро┐ роЕройрпБрокрпНрокро╡рпБроорпН
            time.sleep(5 * (retry_count + 1))  # рокрпЖро░рпБроХрпНроХрооро╛рой рокро┐ройрпНро╡ро╛роЩрпНроХро▓рпН
            send_with_retry(queue_name, message_data, RetryConfig())
            
            receiver.complete_message(message)  # роорпБродройрпНроорпИропрпИ роирпАроХрпНроХро╡рпБроорпН
        else:
            # роЕродро┐роХрокроЯрпНроЪ роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХро│рпН роорпАро▒рокрпНрокроЯрпНроЯродрпБ - роЗро▒роирпНрод роХроЯро┐род ро╡ро░ро┐роЪрпИроХрпНроХрпБ роироХро░рпНродрпНродро╡рпБроорпН
            print(f"тЭМ Max retries exceeded for message {message_id}")
            receiver.dead_letter_message(
                message,
                reason="MaxRetriesExceeded",
                error_description=str(e)
            )
```

3. **рооро░рог роОро┤рпБродрпНродрпБ ро╡ро░ро┐роЪрпИропрпИ роХрогрпНроХро╛рогро┐роХрпНроХро╡рпБроорпН:**

```python
def monitor_dead_letters():
    """Check dead letter queue for failed messages"""
    receiver = servicebus_client.get_queue_receiver(
        'research-queue',
        sub_queue='deadletter'
    )
    
    with receiver:
        messages = receiver.receive_messages(max_wait_time=5)
        for message in messages:
            print(f"тШая╕П Dead letter: {message.message_id}")
            print(f"Reason: {message.dead_letter_reason}")
            print(f"Description: {message.dead_letter_error_description}")
```

**тЬЕ ро╡рпЖро▒рпНро▒ро┐ропро┐ройрпН роЕро│ро╡рпБроХрпЛро▓рпНроХро│рпН:**
- тЬЕ родрпЛро▓рпНро╡ро┐ропроЯрпИроирпНрод рокрогро┐роХро│рпН родро╛ройро╛роХро╡рпЗ роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХрпНроХро┐ройрпНро▒рой (3 роорпБро▒рпИ ро╡ро░рпИ)
- тЬЕ роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХро│рпБроХрпНроХрпБ роЗроЯрпИропро┐ро▓рпН роЕродро┐роХро░ро┐роХрпНроХрпБроорпН роЗроЯрпИро╡рпЖро│ро┐ (5s, 10s, 15s)
- тЬЕ роЕродро┐роХрокроЯрпНроЪ роорпБропро▒рпНроЪро┐роХро│рпБроХрпНроХрпБрокрпН рокро┐ро▒роХрпБ, роЪрпЖропрпНродро┐роХро│рпН рооро░рог роОро┤рпБродрпНродрпБ ро╡ро░ро┐роЪрпИроХрпНроХрпБ роЪрпЖро▓рпНроХро┐ройрпНро▒рой
- тЬЕ рооро░рог роОро┤рпБродрпНродрпБ ро╡ро░ро┐роЪрпИ роХрогрпНроХро╛рогро┐роХрпНроХрокрпНрокроЯро▓ро╛роорпН рооро▒рпНро▒рпБроорпН роорпАрогрпНроЯрпБроорпН роЗропроХрпНроХрокрпНрокроЯро▓ро╛роорпН

**роирпЗро░роорпН**: 30-40 роиро┐рооро┐роЯроЩрпНроХро│рпН

---

### рокропро┐ро▒рпНроЪро┐ 3: роЪрпБро▒рпНро▒рпБ роорпБро▒рпИропрпИ роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН тнРтнРтнР (роорпЗроорпНрокроЯрпНроЯродрпБ)

**роирпЛроХрпНроХроорпН**: родрпЛро▓рпНро╡ро┐ропроЯрпИроирпНрод роорпБроХро╡ро░рпНроХро│рпБроХрпНроХрпБ роХрпЛро░ро┐роХрпНроХрпИроХро│рпИ роиро┐ро▒рпБродрпНродрпБро╡родройрпН роорпВро▓роорпН рокро░ро╡ро▓ро╛рой родрпЛро▓рпНро╡ро┐роХро│рпИродрпН родроЯрпБроХрпНроХро╡рпБроорпН.

**роЕроЯро┐роХро│рпН**:

1. **роЪрпБро▒рпНро▒рпБ роорпБро▒рпИропро┐ройрпН ро╡роХрпБрокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН:**

```python
from enum import Enum
from datetime import datetime, timedelta

class CircuitState(Enum):
    CLOSED = "closed"      # роЪро╛родро╛ро░рог роЪрпЖропро▓рпНрокро╛роЯрпБ
    OPEN = "open"          # родрпЛро▓рпНро╡ро┐, роХрпЛро░ро┐роХрпНроХрпИроХро│рпИ роиро┐ро░ро╛роХро░ро┐роХрпНроХро╡рпБроорпН
    HALF_OPEN = "half_open"  # роорпАроЯрпНроХрокрпНрокроЯрпНроЯродро╛ роОрой роЪрпЛродройрпИ роЪрпЖропрпНроХ

class CircuitBreaker:
    def __init__(self, failure_threshold=5, timeout_seconds=60):
        self.failure_threshold = failure_threshold
        self.timeout_seconds = timeout_seconds
        self.failure_count = 0
        self.last_failure_time = None
        self.state = CircuitState.CLOSED
    
    def call(self, func):
        """Execute function with circuit breaker protection"""
        if self.state == CircuitState.OPEN:
            # роирпЗро░роорпН роорпБроЯро┐роирпНродродро╛ роОрой роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
            if datetime.utcnow() - self.last_failure_time > timedelta(seconds=self.timeout_seconds):
                self.state = CircuitState.HALF_OPEN
                print("ЁЯФД Circuit breaker: HALF_OPEN (testing)")
            else:
                raise Exception(f"Circuit breaker OPEN for agent. Try again in {self.timeout_seconds}s")
        
        try:
            result = func()
            
            # ро╡рпЖро▒рпНро▒ро┐
            if self.state == CircuitState.HALF_OPEN:
                self.state = CircuitState.CLOSED
                self.failure_count = 0
                print("тЬЕ Circuit breaker: CLOSED (recovered)")
            
            return result
            
        except Exception as e:
            self.failure_count += 1
            self.last_failure_time = datetime.utcnow()
            
            if self.failure_count >= self.failure_threshold:
                self.state = CircuitState.OPEN
                print(f"ЁЯФ┤ Circuit breaker: OPEN (too many failures)")
            
            raise e
```

2. **роорпБроХро╡ро░рпН роЕро┤рпИрокрпНрокрпБроХро│рпБроХрпНроХрпБ рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН:**

```python
# роТро░рпНроХрпЖро╕рпНроЯрпНро░рпЗроЯрпНроЯро░ро┐ро▓рпН
agent_circuits = {
    'web': CircuitBreaker(failure_threshold=5, timeout_seconds=60),
    'academic': CircuitBreaker(failure_threshold=5, timeout_seconds=60),
    'news': CircuitBreaker(failure_threshold=5, timeout_seconds=60),
    'social': CircuitBreaker(failure_threshold=5, timeout_seconds=60)
}

def send_to_agent(agent_type, message_data):
    """Send with circuit breaker protection"""
    circuit = agent_circuits[agent_type]
    
    try:
        circuit.call(lambda: send_message(agent_type, message_data))
    except Exception as e:
        print(f"тЪая╕П Skipping {agent_type} agent: {e}")
        # рооро▒рпНро▒ роПроЬрпЖройрпНроЯрпНроХро│рпБроЯройрпН родрпКроЯро░ро╡рпБроорпН
```

3. **роЪрпБро▒рпНро▒рпБ роорпБро▒рпИропрпИроЪрпН роЪрпЛродро┐роХрпНроХро╡рпБроорпН:**

```bash
# роорпАрогрпНроЯрпБроорпН роорпАрогрпНроЯрпБроорпН родрпЛро▓рпНро╡ро┐роХро│рпИ роЪро┐роорпБро▓рпЗроЯрпН роЪрпЖропрпНропро╡рпБроорпН (роТро░рпБ роорпБроХро╡ро░ро┐ропрпИ роиро┐ро▒рпБродрпНродро╡рпБроорпН)
az containerapp stop --name web-research-agent --resource-group rg-agents

# рокро▓ роХрпЛро░ро┐роХрпНроХрпИроХро│рпИ роЕройрпБрокрпНрокро╡рпБроорпН
for i in {1..10}; do
  curl -X POST $ORCHESTRATOR_URL/research-parallel \
    -H "Content-Type: application/json" \
    -d '{"query": "test query '$i'"}'
  sleep 2
done

# рокродро┐ро╡рпБроХро│рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН - 5 родрпЛро▓рпНро╡ро┐роХро│рпБроХрпНроХрпБрокрпН рокро┐ро▒роХрпБ роЪрпБро▒рпНро▒рпБ родро┐ро▒роХрпНроХрокрпНрокроЯрпНроЯродрпИ роХро╛рог ро╡рпЗрогрпНроЯрпБроорпН
azd logs orchestrator --tail 50
```

**тЬЕ ро╡рпЖро▒рпНро▒ро┐ропро┐ройрпН роЕро│ро╡рпБроХрпЛро▓рпНроХро│рпН:**
- тЬЕ 5 родрпЛро▓рпНро╡ро┐роХро│рпБроХрпНроХрпБрокрпН рокро┐ро▒роХрпБ, роЪрпБро▒рпНро▒рпБ родро┐ро▒роХрпНроХро┐ро▒родрпБ (роХрпЛро░ро┐роХрпНроХрпИроХро│рпИ роиро┐ро░ро╛роХро░ро┐роХрпНроХро┐ро▒родрпБ)
- тЬЕ 60 ро╡ро┐ройро╛роЯро┐роХро│рпБроХрпНроХрпБрокрпН рокро┐ро▒роХрпБ, роЪрпБро▒рпНро▒рпБ рокро╛родро┐ родро┐ро▒роХрпНроХро┐ро▒родрпБ (роорпАроЯрпНрокрпБ роЪрпЛродро┐роХрпНроХро┐ро▒родрпБ)
- тЬЕ рооро▒рпНро▒ роорпБроХро╡ро░рпНроХро│рпН роЪро╛родро╛ро░рогрооро╛роХ ро╡рпЗро▓рпИ роЪрпЖропрпНроХро┐ройрпНро▒ройро░рпН
- тЬЕ роорпБроХро╡ро░рпН роорпАроЯрпНроХрпБроорпНрокрпЛродрпБ роЪрпБро▒рпНро▒рпБ родро╛ройро╛роХро╡рпЗ роорпВроЯрпБроХро┐ро▒родрпБ

**роирпЗро░роорпН**: 40-50 роиро┐рооро┐роЯроЩрпНроХро│рпН

---

## роХрогрпНроХро╛рогро┐рокрпНрокрпБ рооро▒рпНро▒рпБроорпН рокро┐ро┤рпИ роЪро░ро┐роЪрпЖропрпНродро▓рпН

### Application Insights роЙроЯройрпН ро╡ро┐роиро┐ропрпЛроХро┐роХрпНроХрокрпНрокроЯрпНроЯ роХрогрпНроХро╛рогро┐рокрпНрокрпБ

**роХрпЛрокрпНрокрпБ: `src/shared/tracing.py`**

```python
from opencensus.ext.azure.log_exporter import AzureLogHandler
from opencensus.ext.azure.trace_exporter import AzureExporter
from opencensus.trace import config_integration
from opencensus.trace.tracer import Tracer
from opencensus.trace.samplers import AlwaysOnSampler
import logging
import os

# роХрогрпНроХро╛рогро┐рокрпНрокрпИ роЕроорпИроХрпНроХро╡рпБроорпН
config_integration.trace_integrations(['requests', 'logging'])

connection_string = os.environ.get('APPLICATIONINSIGHTS_CONNECTION_STRING')

# роЯро┐ро░рпЗроЪро░рпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН
tracer = Tracer(
    exporter=AzureExporter(connection_string=connection_string),
    sampler=AlwaysOnSampler()
)

# рокродро┐ро╡рпБ роЪрпЖропрпНропро▓рпИ роЕроорпИроХрпНроХро╡рпБроорпН
logger = logging.getLogger(__name__)
logger.addHandler(AzureLogHandler(connection_string=connection_string))
logger.setLevel(logging.INFO)

def trace_agent_call(agent_name, task_id, operation):
    """Trace agent operations"""
    with tracer.span(name=f'{agent_name}.{operation}') as span:
        span.add_attribute('agent', agent_name)
        span.add_attribute('task_id', task_id)
        span.add_attribute('operation', operation)
        
        try:
            result = operation()
            span.add_attribute('status', 'success')
            return result
        except Exception as e:
            span.add_attribute('status', 'error')
            span.add_attribute('error', str(e))
            raise
```

### Application Insights роХрпЗро│рпНро╡ро┐роХро│рпН

**рокро▓ роорпБроХро╡ро░рпН рокрогро┐роЪрпНроЪрпВро┤ро▓рпНроХро│рпИ роХрогрпНроХро╛рогро┐роХрпНроХро╡рпБроорпН:**

```kusto
// Trace complete workflow for a task
traces
| where customDimensions.task_id == "a1b2c3d4-..."
| project timestamp, message, customDimensions.agent, customDimensions.operation
| order by timestamp asc
```

**роорпБроХро╡ро░рпН роЪрпЖропро▓рпНродро┐ро▒ройрпН роТрокрпНрокрпАроЯрпБ:**

```kusto
// Compare agent execution times
dependencies
| where name contains "agent"
| summarize 
    avg_duration = avg(duration),
    p95_duration = percentile(duration, 95),
    count = count()
  by agent = tostring(customDimensions.agent)
| order by avg_duration desc
```

**родрпЛро▓рпНро╡ро┐ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ:**

```kusto
// Find which agents fail most
exceptions
| where customDimensions.agent != ""
| summarize 
    failure_count = count(),
    unique_errors = dcount(outerMessage)
  by agent = tostring(customDimensions.agent)
| order by failure_count desc
```

---

## роЪрпЖро▓ро╡рпБ рокроХрпБрокрпНрокро╛ропрпНро╡рпБ

### рокро▓ роорпБроХро╡ро░рпН роЕроорпИрокрпНрокрпБ роЪрпЖро▓ро╡рпБроХро│рпН (рооро╛родро╛роирпНродро┐ро░ роородро┐рокрпНрокрпАроЯрпБроХро│рпН)

| роХрпВро▒рпБ | роХроЯрпНроЯроорпИрокрпНрокрпБ | роЪрпЖро▓ро╡рпБ |
|-----------|--------------|------|
| **Orchestrator** | 1 Container App (1 vCPU, 2GB) | $30-50 |
| **4 Agents** | 4 Container Apps (0.5 vCPU, 1GB each) | $60-120 |
| **Service Bus** | Standard tier, 10M messages | $10-20 |
| **Cosmos DB** | Serverless, 5GB storage, 1M RUs | $25-50 |
| **Blob Storage** | 10GB storage, 100K operations
## рокро┐ро┤рпИродрпНродро┐ро░рпБродрпНрод ро╡ро┤ро┐роХро╛роЯрпНроЯро┐

### рокро┐ро░роЪрпНроЪро┐ройрпИ: роЪрпЖропрпНродро┐роХро│рпН ро╡ро░ро┐роЪрпИропро┐ро▓рпН роЪро┐роХрпНроХро┐ропрпБро│рпНро│рой

**роЕро▒ро┐роХрпБро▒ро┐роХро│рпН:**
- роЪрпЖропрпНродро┐роХро│рпН ро╡ро░ро┐роЪрпИропро┐ро▓рпН роЪрпЗро░рпНроирпНродрпБ роХрпКрогрпНроЯрпЗ роЗро░рпБроХрпНроХро┐ройрпНро▒рой
- роорпБроХро╡ро░рпНроХро│рпН роЪрпЖропро▓рпНрокроЯро╡ро┐ро▓рпНро▓рпИ
- рокрогро┐ропро┐ройрпН роиро┐ро▓рпИ "pending" роЖроХро╡рпЗ роЙро│рпНро│родрпБ

**роХрогро┐рокрпНрокрпБроХро│рпН:**
```bash
# ро╡ро░ро┐роЪрпИропро┐ройрпН роЖро┤родрпНродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
az servicebus queue show \
  --namespace-name mybus \
  --name research-tasks \
  --query "countDetails"

# роорпБроХро╡ро░ро┐ройрпН роЖро░рпЛроХрпНроХро┐ропродрпНродрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
azd logs research-agent --tail 50
```

**родрпАро░рпНро╡рпБроХро│рпН:**

1. **роорпБроХро╡ро░рпН рокро┐ро░родро┐роХро│рпИ роЕродро┐роХро░ро┐роХрпНроХро╡рпБроорпН:**
   ```bash
   az containerapp update \
     --name research-agent \
     --min-replicas 3 \
     --max-replicas 10
   ```

2. **Dead letter ро╡ро░ро┐роЪрпИропрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН:**
   ```bash
   az servicebus queue show \
     --namespace-name mybus \
     --name research-tasks \
     --query "countDetails.deadLetterMessageCount"
   ```

---

### рокро┐ро░роЪрпНроЪро┐ройрпИ: рокрогро┐ роирпЗро░роорпН роорпБроЯро┐ро╡роЯрпИропро╛рооро▓рпН/роорпБроЯро┐ро╡роЯрпИропро╡ро┐ро▓рпНро▓рпИ

**роЕро▒ро┐роХрпБро▒ро┐роХро│рпН:**
- рокрогро┐ропро┐ройрпН роиро┐ро▓рпИ "in_progress" роЖроХро╡рпЗ роЙро│рпНро│родрпБ
- роЪро┐ро▓ роорпБроХро╡ро░рпНроХро│рпН роорпБроЯро┐роХрпНроХро┐ройрпНро▒ройро░рпН, рооро▒рпНро▒ро╡ро░рпНроХро│рпН роорпБроЯро┐ропро╡ро┐ро▓рпНро▓рпИ
- роОроирпНрод рокро┐ро┤рпИ роЪрпЖропрпНродро┐роХро│рпБроорпН роЗро▓рпНро▓рпИ

**роХрогро┐рокрпНрокрпБроХро│рпН:**
```bash
# рокрогро┐ропро┐ройрпН роиро┐ро▓рпИропрпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
curl $ORCHESTRATOR_URL/task/$TASK_ID

# рокропройрпНрокро╛роЯрпНроЯрпБ роЙро│рпНро│рпАроЯрпБроХро│рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН
# роХрпЗро│рпНро╡ро┐ропрпИ роЗропроХрпНроХро╡рпБроорпН: traces | where customDimensions.task_id == "..."
```

**родрпАро░рпНро╡рпБроХро│рпН:**

1. **Aggregator-ро▓рпН timeout роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН (Exercise 1)**

2. **роорпБроХро╡ро░рпН родрпЛро▓рпНро╡ро┐роХро│рпИ роЪро░ро┐рокро╛ро░рпНроХрпНроХро╡рпБроорпН:**
   ```bash
   azd logs --follow | grep "ERROR\|FAIL"
   ```

3. **роЕройрпИродрпНродрпБ роорпБроХро╡ро░рпНроХро│рпБроорпН роЗропроЩрпНроХрпБроХро┐ро▒родро╛ роОройрпНрокродрпИ роЙро▒рпБродро┐роЪрпЖропрпНропро╡рпБроорпН:**
   ```bash
   az containerapp list \
     --resource-group rg-agents \
     --query "[].{name:name, status:properties.runningStatus}"
   ```

---

## роорпЗро▓рпБроорпН роЕро▒ро┐роХ

### роЕродро┐роХро╛ро░рокрпНрокрпВро░рпНро╡ роЖро╡рогроЩрпНроХро│рпН
- [Azure Service Bus](https://learn.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview)
- [Cosmos DB](https://learn.microsoft.com/azure/cosmos-db/introduction)
- [Container Apps DAPR](https://learn.microsoft.com/azure/container-apps/dapr-overview)
- [Multi-Agent Design Patterns](https://learn.microsoft.com/azure/architecture/guide/ai/multi-agent-systems)

### роЗроирпНрод рокро╛роЯродрпНродро┐ро▓рпН роЕроЯрпБродрпНрод рокроЯро┐роХро│рпН
- тЖР роорпБроирпНродрпИропродрпБ: [родро┐ро▒ройрпН родро┐роЯрпНроЯрооро┐роЯро▓рпН](capacity-planning.md)
- тЖТ роЕроЯрпБродрпНродродрпБ: [SKU родрпЗро░рпНро╡рпБ](sku-selection.md)
- ЁЯПа [рокро╛роЯроорпН роорпБроХрокрпНрокрпБ](../../README.md)

### родрпКроЯро░рпНрокрпБроЯрпИроп роЙродро╛ро░рогроЩрпНроХро│рпН
- [Microservices Example](../../../../examples/microservices) - роЪрпЗро╡рпИ родрпКроЯро░рпНрокрпБ роорпБро▒рпИроорпИроХро│рпН
- [Azure OpenAI Example](../../../../examples/azure-openai-chat) - AI роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ

---

## роЪрпБро░рпБроХрпНроХроорпН

**роирпАроЩрпНроХро│рпН роХро▒рпНро▒рпБроХрпНроХрпКрогрпНроЯродрпБ:**
- тЬЕ роРроирпНродрпБ роТро░рпБроЩрпНроХро┐рогрпИрокрпНрокрпБ роорпБро▒рпИроорпИроХро│рпН (родрпКроЯро░рпНроЪрпНроЪро┐, роЗрогрпИ, роорпЗро▓ро╛рогрпНроорпИ, роиро┐роХро┤рпНро╡рпБ роЪро╛ро░рпНроирпНрод, роТрокрпНрокрпБродро▓рпН)
- тЬЕ Azure-ро▓рпН рокро▓ роорпБроХро╡ро░рпН роХроЯрпНроЯроорпИрокрпНрокрпБ (Service Bus, Cosmos DB, Container Apps)
- тЬЕ рокроХро┐ро░рокрпНрокроЯрпНроЯ роорпБроХро╡ро░рпНроХро│рпБроХрпНроХро┐роЯрпИропрпЗ роиро┐ро▓рпИ роорпЗро▓ро╛рогрпНроорпИ
- тЬЕ Timeout роХрпИропро╛ро│рпБродро▓рпН, роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХро│рпН, рооро▒рпНро▒рпБроорпН circuit breakers
- тЬЕ рокроХро┐ро░рокрпНрокроЯрпНроЯ роЕроорпИрокрпНрокрпБроХро│рпИ роХрогрпНроХро╛рогро┐родрпНродро▓рпН рооро▒рпНро▒рпБроорпН рокро┐ро┤рпИродрпНродро┐ро░рпБродрпНродроорпН
- тЬЕ роЪрпЖро▓ро╡рпБроХрпН роХрпБро▒рпИрокрпНрокрпБродрпН родро┐роЯрпНроЯроЩрпНроХро│рпН

**роорпБроХрпНроХро┐роп роХрпБро▒ро┐рокрпНрокрпБроХро│рпН:**
1. **роЪро░ро┐ропро╛рой роорпБро▒рпИроорпИропрпИ родрпЗро░рпНро╡рпБ роЪрпЖропрпНропро╡рпБроорпН** - роТро┤рпБроЩрпНроХроорпИроХрпНроХрокрпНрокроЯрпНроЯ рокрогро┐роХро│рпБроХрпНроХрпБ родрпКроЯро░рпНроЪрпНроЪро┐, ро╡рпЗроХродрпНродро┐ро▒рпНроХро╛роХ роЗрогрпИ, роирпЖроХро┐ро┤рпНро╡рпБродрпНродройрпНроорпИроХрпНроХро╛роХ роиро┐роХро┤рпНро╡рпБ роЪро╛ро░рпНроирпНродродрпБ
2. **роиро┐ро▓рпИропрпИ роХро╡ройрооро╛роХ роорпЗро▓ро╛рогрпНроорпИ роЪрпЖропрпНропро╡рпБроорпН** - рокроХро┐ро░рокрпНрокроЯрпНроЯ роиро┐ро▓рпИроХрпНроХрпБ Cosmos DB роЕро▓рпНро▓родрпБ роЗродро▒рпНроХрпБ роЗрогрпИропро╛ройродрпИрокрпН рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН
3. **родрпЛро▓рпНро╡ро┐роХро│рпИ роиройрпНроХрпБ роХрпИропро╛ро│ро╡рпБроорпН** - Timeouts, роорпАрогрпНроЯрпБроорпН роорпБропро▒рпНроЪро┐роХро│рпН, circuit breakers, dead letter ро╡ро░ро┐роЪрпИроХро│рпН
4. **роЕройрпИродрпНродрпИропрпБроорпН роХрогрпНроХро╛рогро┐роХрпНроХро╡рпБроорпН** - рокроХро┐ро░рокрпНрокроЯрпНроЯ tracing рокро┐ро┤рпИродрпНродро┐ро░рпБродрпНродродрпНродро┐ро▒рпНроХрпБ роорпБроХрпНроХро┐ропроорпН
5. **роЪрпЖро▓ро╡рпБроХро│рпИ роорпЗроорпНрокроЯрпБродрпНродро╡рпБроорпН** - рокрпВроЬрпНропродрпНродро┐ро▒рпНроХрпБ роЕро│ро╡ро┐роЯро╡рпБроорпН, serverless рокропройрпНрокроЯрпБродрпНродро╡рпБроорпН, caching роЪрпЖропро▓рпНрокроЯрпБродрпНродро╡рпБроорпН

**роЕроЯрпБродрпНрод рокроЯро┐роХро│рпН:**
1. роироЯрпИроорпБро▒рпИ рокропро┐ро▒рпНроЪро┐роХро│рпИ роорпБроЯро┐роХрпНроХро╡рпБроорпН
2. роЙроЩрпНроХро│рпН рокропройрпНрокро╛роЯрпНроЯро┐ро▒рпНроХро╛рой рокро▓ роорпБроХро╡ро░рпН роЕроорпИрокрпНрокрпИ роЙро░рпБро╡ро╛роХрпНроХро╡рпБроорпН
3. роЪрпЖропро▓рпНродро┐ро▒ройрпН рооро▒рпНро▒рпБроорпН роЪрпЖро▓ро╡рпБроХро│рпИ роорпЗроорпНрокроЯрпБродрпНрод [SKU родрпЗро░рпНро╡рпБ](sku-selection.md) рокроЯро┐роХрпНроХро╡рпБроорпН

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**роХрпБро▒ро┐рокрпНрокрпБ**:  
роЗроирпНрод роЖро╡рогроорпН AI роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ роЪрпЗро╡рпИ [Co-op Translator](https://github.com/Azure/co-op-translator) рокропройрпНрокроЯрпБродрпНродро┐ роорпКро┤ро┐рокрпЖропро░рпНроХрпНроХрокрпНрокроЯрпНроЯрпБро│рпНро│родрпБ. роиро╛роЩрпНроХро│рпН родрпБро▓рпНро▓ро┐ропродрпНродро┐ро▒рпНроХро╛роХ роорпБропро▒рпНроЪро┐роХрпНроХро┐ро▒рпЛроорпН, роЖройро╛ро▓рпН родро╛ройро┐ропроЩрпНроХро┐ роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБроХро│ро┐ро▓рпН рокро┐ро┤рпИроХро│рпН роЕро▓рпНро▓родрпБ родро╡ро▒рпБроХро│рпН роЗро░рпБроХрпНроХроХрпНроХрпВроЯрпБроорпН роОройрпНрокродрпИ роХро╡ройродрпНродро┐ро▓рпН роХрпКро│рпНро│ро╡рпБроорпН. роЕродройрпН родро╛ропрпНроорпКро┤ро┐ропро┐ро▓рпН роЙро│рпНро│ роорпВро▓ роЖро╡рогроорпН роЕродро┐роХро╛ро░рокрпНрокрпВро░рпНро╡ роЖродро╛ро░рооро╛роХ роХро░рпБродрокрпНрокроЯ ро╡рпЗрогрпНроЯрпБроорпН. роорпБроХрпНроХро┐ропрооро╛рой родроХро╡ро▓рпНроХро│рпБроХрпНроХрпБ, родрпКро┤ро┐ро▓рпНроорпБро▒рпИ рооройро┐род роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпБ рокро░ро┐роирпНродрпБро░рпИроХрпНроХрокрпНрокроЯрпБроХро┐ро▒родрпБ. роЗроирпНрод роорпКро┤ро┐рокрпЖропро░рпНрокрпНрокрпИрокрпН рокропройрпНрокроЯрпБродрпНродрпБро╡родро╛ро▓рпН роПро▒рпНрокроЯрпБроорпН роОроирпНрод родро╡ро▒ро╛рой рокрпБро░ро┐родро▓рпНроХро│рпН роЕро▓рпНро▓родрпБ родро╡ро▒ро╛рой ро╡ро┐ро│роХрпНроХроЩрпНроХро│рпБроХрпНроХрпБ роиро╛роЩрпНроХро│рпН рокрпКро▒рпБрокрпНрокро▓рпНро▓.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->