# рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рд╕рдордиреНрд╡рдп рдкреИрдЯрд░реНрди

тП▒я╕П **рдЕрдиреБрдорд╛рдирд┐рдд рд╕рдордп**: 60-75 рдорд┐рдирдЯ | ЁЯТ░ **рдЕрдиреБрдорд╛рдирд┐рдд рд▓рд╛рдЧрдд**: ~$100-300/рдорд╛рд╣ | тнР **рдЬрдЯрд┐рд▓рддрд╛**: рдЙрдиреНрдирдд

**ЁЯУЪ рд╕реАрдЦрдиреЗ рдХрд╛ рдорд╛рд░реНрдЧ:**
- тЖР рдкрд┐рдЫрд▓рд╛: [рдХреНрд╖рдорддрд╛ рдпреЛрдЬрдирд╛](capacity-planning.md) - рд╕рдВрд╕рд╛рдзрди рдЖрдХрд╛рд░ рдФрд░ рд╕реНрдХреЗрд▓рд┐рдВрдЧ рд░рдгрдиреАрддрд┐рдпрд╛рдБ
- ЁЯОп **рдЖрдк рдпрд╣рд╛рдБ рд╣реИрдВ**: рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рд╕рдордиреНрд╡рдп рдкреИрдЯрд░реНрди (рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрд╢рди, рд╕рдВрдЪрд╛рд░, рд╕реНрдерд┐рддрд┐ рдкреНрд░рдмрдВрдзрди)
- тЖТ рдЕрдЧрд▓рд╛: [SKU рдЪрдпрди](sku-selection.md) - рд╕рд╣реА Azure рд╕реЗрд╡рд╛рдУрдВ рдХрд╛ рдЪрдпрди
- ЁЯПа [рдХреЛрд░реНрд╕ рд╣реЛрдо](../../README.md)

---

## рдЖрдк рдХреНрдпрд╛ рд╕реАрдЦреЗрдВрдЧреЗ

рдЗрд╕ рдкрд╛рда рдХреЛ рдкреВрд░рд╛ рдХрд░рдХреЗ, рдЖрдк:
- **рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░** рдкреИрдЯрд░реНрди рдХреЛ рд╕рдордЭреЗрдВрдЧреЗ рдФрд░ рдЙрдирдХрд╛ рдЙрдкрдпреЛрдЧ рдХрдм рдХрд░рдирд╛ рд╣реИ
- **рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрд╢рди рдкреИрдЯрд░реНрди** (рдХреЗрдВрджреНрд░реАрдХреГрдд, рд╡рд┐рдХреЗрдВрджреНрд░реАрдХреГрдд, рдкрджрд╛рдиреБрдХреНрд░рдорд┐рдд) рд▓рд╛рдЧреВ рдХрд░реЗрдВрдЧреЗ
- **рдПрдЬреЗрдВрдЯ рд╕рдВрдЪрд╛рд░** рд░рдгрдиреАрддрд┐рдпрд╛рдБ рдбрд┐рдЬрд╝рд╛рдЗрди рдХрд░реЗрдВрдЧреЗ (рд╕рд┐рдВрдХреНрд░реЛрдирд╕, рдЕрд╕рд┐рдВрдХреНрд░реЛрдирд╕, рдЗрд╡реЗрдВрдЯ-рдбреНрд░рд┐рд╡рди)
- рд╡рд┐рддрд░рд┐рдд рдПрдЬреЗрдВрдЯреЛрдВ рдХреЗ рдмреАрдЪ **рд╕рд╛рдЭрд╛ рд╕реНрдерд┐рддрд┐** рдкреНрд░рдмрдВрдзрд┐рдд рдХрд░реЗрдВрдЧреЗ
- Azure рдкрд░ **рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рд╕рд┐рд╕реНрдЯрдо** рддреИрдирд╛рдд рдХрд░реЗрдВрдЧреЗ
- рд╡рд╛рд╕реНрддрд╡рд┐рдХ рджреБрдирд┐рдпрд╛ рдХреЗ AI рдкрд░рд┐рджреГрд╢реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП **рд╕рдордиреНрд╡рдп рдкреИрдЯрд░реНрди** рд▓рд╛рдЧреВ рдХрд░реЗрдВрдЧреЗ
- рд╡рд┐рддрд░рд┐рдд рдПрдЬреЗрдВрдЯ рд╕рд┐рд╕реНрдЯрдо рдХреА рдирд┐рдЧрд░рд╛рдиреА рдФрд░ рдбрд┐рдмрдЧ рдХрд░реЗрдВрдЧреЗ

## рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рд╕рдордиреНрд╡рдп рдХреНрдпреЛрдВ рдорд╣рддреНрд╡рдкреВрд░реНрдг рд╣реИ

### рд╡рд┐рдХрд╛рд╕: рд╕рд┐рдВрдЧрд▓ рдПрдЬреЗрдВрдЯ рд╕реЗ рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рддрдХ

**рд╕рд┐рдВрдЧрд▓ рдПрдЬреЗрдВрдЯ (рд╕рд░рд▓):**
```
User тЖТ Agent тЖТ Response
```
- тЬЕ рд╕рдордЭрдиреЗ рдФрд░ рд▓рд╛рдЧреВ рдХрд░рдиреЗ рдореЗрдВ рдЖрд╕рд╛рди
- тЬЕ рд╕рд░рд▓ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рддреЗрдЬрд╝
- тЭМ рдПрдХ рдореЙрдбрд▓ рдХреА рд╕реАрдорд╛рдУрдВ рддрдХ рд╕реАрдорд┐рдд
- тЭМ рдЬрдЯрд┐рд▓ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕рдорд╛рдирд╛рдВрддрд░ рдореЗрдВ рдирд╣реАрдВ рдХрд░ рд╕рдХрддрд╛
- тЭМ рдХреЛрдИ рд╡рд┐рд╢реЗрд╖рдЬреНрдЮрддрд╛ рдирд╣реАрдВ

**рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рд╕рд┐рд╕реНрдЯрдо (рдЙрдиреНрдирдд):**
```
           тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
           тФВ OrchestratorтФВ
           тФФтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФШ
        тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
        тФВ         тФВ         тФВ
    тФМтФАтФАтФАтЦ╝тФАтФАтФР  тФМтФАтФАтЦ╝тФАтФАтФАтФР  тФМтФАтФАтЦ╝тФАтФАтФАтФАтФР
    тФВAgent1тФВ  тФВAgent2тФВ  тФВAgent3 тФВ
    тФВ(Plan)тФВ  тФВ(Code)тФВ  тФВ(Review)тФВ
    тФФтФАтФАтФАтФАтФАтФАтФШ  тФФтФАтФАтФАтФАтФАтФАтФШ  тФФтФАтФАтФАтФАтФАтФАтФАтФШ
```
- тЬЕ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рд░реНрдпреЛрдВ рдХреЗ рд▓рд┐рдП рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рдПрдЬреЗрдВрдЯ
- тЬЕ рдЧрддрд┐ рдХреЗ рд▓рд┐рдП рд╕рдорд╛рдирд╛рдВрддрд░ рдирд┐рд╖реНрдкрд╛рджрди
- тЬЕ рдореЙрдбреНрдпреВрд▓рд░ рдФрд░ рдмрдирд╛рдП рд░рдЦрдиреЗ рдпреЛрдЧреНрдп
- тЬЕ рдЬрдЯрд┐рд▓ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдореЗрдВ рдмреЗрд╣рддрд░
- тЪая╕П рд╕рдордиреНрд╡рдп рддрд░реНрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ

**рдЙрджрд╛рд╣рд░рдг**: рд╕рд┐рдВрдЧрд▓ рдПрдЬреЗрдВрдЯ рдПрдХ рд╡реНрдпрдХреНрддрд┐ рдХреА рддрд░рд╣ рд╣реИ рдЬреЛ рд╕рднреА рдХрд╛рд░реНрдп рдХрд░рддрд╛ рд╣реИред рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рдПрдХ рдЯреАрдо рдХреА рддрд░рд╣ рд╣реИ рдЬрд╣рд╛рдБ рдкреНрд░рддреНрдпреЗрдХ рд╕рджрд╕реНрдп рдХреЗ рдкрд╛рд╕ рд╡рд┐рд╢реЗрд╖ рдХреМрд╢рд▓ рд╣реЛрддреЗ рд╣реИрдВ (рд╢реЛрдзрдХрд░реНрддрд╛, рдХреЛрдбрд░, рд╕рдореАрдХреНрд╖рдХ, рд▓реЗрдЦрдХ) рдФрд░ рд╡реЗ рдорд┐рд▓рдХрд░ рдХрд╛рдо рдХрд░рддреЗ рд╣реИрдВред

---

## рдореБрдЦреНрдп рд╕рдордиреНрд╡рдп рдкреИрдЯрд░реНрди

### рдкреИрдЯрд░реНрди 1: рдЕрдиреБрдХреНрд░рдорд┐рдХ рд╕рдордиреНрд╡рдп (рдЬрд┐рдореНрдореЗрджрд╛рд░реА рдХреА рд╢реНрд░реГрдВрдЦрд▓рд╛)

**рдХрдм рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**: рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреНрд░рдо рдореЗрдВ рдкреВрд░рд╛ рдХрд░рдирд╛ рдЪрд╛рд╣рд┐рдП, рдкреНрд░рддреНрдпреЗрдХ рдПрдЬреЗрдВрдЯ рдкрд┐рдЫрд▓реЗ рдЖрдЙрдЯрдкреБрдЯ рдкрд░ рдирд┐рд░реНрдорд╛рдг рдХрд░рддрд╛ рд╣реИред

```mermaid
sequenceDiagram
    participant User
    participant Orchestrator
    participant Agent1 as рд╢реЛрдз рдПрдЬреЗрдВрдЯ
    participant Agent2 as рд▓реЗрдЦрдХ рдПрдЬреЗрдВрдЯ
    participant Agent3 as рд╕рдВрдкрд╛рджрдХ рдПрдЬреЗрдВрдЯ
    
    User->>Orchestrator: "рдПрдЖрдИ рдкрд░ рд▓реЗрдЦ рд▓рд┐рдЦреЗрдВ"
    Orchestrator->>Agent1: рд╡рд┐рд╖рдп рдкрд░ рд╢реЛрдз рдХрд░реЗрдВ
    Agent1-->>Orchestrator: рд╢реЛрдз рдкрд░рд┐рдгрд╛рдо
    Orchestrator->>Agent2: рдкреНрд░рд╛рд░реВрдк рд▓рд┐рдЦреЗрдВ (рд╢реЛрдз рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рддреЗ рд╣реБрдП)
    Agent2-->>Orchestrator: рдкреНрд░рд╛рд░реВрдк рд▓реЗрдЦ
    Orchestrator->>Agent3: рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ рдФрд░ рд╕реБрдзрд╛рд░реЗрдВ
    Agent3-->>Orchestrator: рдЕрдВрддрд┐рдо рд▓реЗрдЦ
    Orchestrator-->>User: рдкрд░рд┐рд╖реНрдХреГрдд рд▓реЗрдЦ
    
    Note over User,Agent3: рдХреНрд░рдорд┐рдХ: рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рдг рдкрд┐рдЫрд▓реЗ рдХреЗ рд▓рд┐рдП рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддрд╛ рд╣реИ
```
**рд▓рд╛рдн:**
- тЬЕ рд╕реНрдкрд╖реНрдЯ рдбреЗрдЯрд╛ рдкреНрд░рд╡рд╛рд╣
- тЬЕ рдбрд┐рдмрдЧ рдХрд░рдирд╛ рдЖрд╕рд╛рди
- тЬЕ рдирд┐рд╖реНрдкрд╛рджрди рдХреНрд░рдо рдкреВрд░реНрд╡рд╛рдиреБрдорд╛рди рдпреЛрдЧреНрдп

**рд╕реАрдорд╛рдПрдБ:**
- тЭМ рдзреАрдорд╛ (рдХреЛрдИ рд╕рдорд╛рдирд╛рдВрддрд░рддрд╛ рдирд╣реАрдВ)
- тЭМ рдПрдХ рд╡рд┐рдлрд▓рддрд╛ рдкреВрд░реА рд╢реНрд░реГрдВрдЦрд▓рд╛ рдХреЛ рд░реЛрдХ рджреЗрддреА рд╣реИ
- тЭМ рдкрд░рд╕реНрдкрд░ рдирд┐рд░реНрднрд░ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕рдВрднрд╛рд▓ рдирд╣реАрдВ рд╕рдХрддрд╛

**рдЙрджрд╛рд╣рд░рдг рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЗ:**
- рд╕рд╛рдордЧреНрд░реА рдирд┐рд░реНрдорд╛рдг рдкрд╛рдЗрдкрд▓рд╛рдЗрди (рд╢реЛрдз тЖТ рд▓рд┐рдЦреЗрдВ тЖТ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ тЖТ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░реЗрдВ)
- рдХреЛрдб рдЬрдирд░реЗрд╢рди (рдпреЛрдЬрдирд╛ тЖТ рдХрд╛рд░реНрдпрд╛рдиреНрд╡рд┐рдд рдХрд░реЗрдВ тЖТ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ тЖТ рддреИрдирд╛рдд рдХрд░реЗрдВ)
- рд░рд┐рдкреЛрд░реНрдЯ рдЬрдирд░реЗрд╢рди (рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣ тЖТ рд╡рд┐рд╢реНрд▓реЗрд╖рдг тЖТ рд╡рд┐рдЬрд╝реБрдЕрд▓рд╛рдЗрдЬрд╝реЗрд╢рди тЖТ рд╕рд╛рд░рд╛рдВрд╢)

---

### рдкреИрдЯрд░реНрди 2: рд╕рдорд╛рдирд╛рдВрддрд░ рд╕рдордиреНрд╡рдп (рдлреИрди-рдЖрдЙрдЯ/рдлреИрди-рдЗрди)

**рдХрдм рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**: рд╕реНрд╡рддрдВрддреНрд░ рдХрд╛рд░реНрдп рдПрдХ рд╕рд╛рде рдЪрд▓ рд╕рдХрддреЗ рд╣реИрдВ, рдкрд░рд┐рдгрд╛рдо рдЕрдВрдд рдореЗрдВ рд╕рдВрдпреЛрдЬрд┐рдд рд╣реЛрддреЗ рд╣реИрдВред

```mermaid
graph TB
    User[рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛ рдЕрдиреБрд░реЛрдз]
    Orchestrator[рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░]
    Agent1[рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдПрдЬреЗрдВрдЯ]
    Agent2[рдЕрдиреБрд╕рдВрдзрд╛рди рдПрдЬреЗрдВрдЯ]
    Agent3[рдбреЗрдЯрд╛ рдПрдЬреЗрдВрдЯ]
    Aggregator[рдкрд░рд┐рдгрд╛рдо рд╕рдореЗрдХрдХ]
    Response[рд╕рдВрдпреБрдХреНрдд рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛]
    
    User --> Orchestrator
    Orchestrator --> Agent1
    Orchestrator --> Agent2
    Orchestrator --> Agent3
    Agent1 --> Aggregator
    Agent2 --> Aggregator
    Agent3 --> Aggregator
    Aggregator --> Response
    
    style Orchestrator fill:#2196F3,stroke:#1976D2,stroke-width:3px,color:#fff
    style Aggregator fill:#4CAF50,stroke:#388E3C,stroke-width:3px,color:#fff
```
**рд▓рд╛рдн:**
- тЬЕ рддреЗрдЬрд╝ (рд╕рдорд╛рдирд╛рдВрддрд░ рдирд┐рд╖реНрдкрд╛рджрди)
- тЬЕ рджреЛрд╖-рд╕рд╣рд┐рд╖реНрдгреБ (рдЖрдВрд╢рд┐рдХ рдкрд░рд┐рдгрд╛рдо рд╕реНрд╡реАрдХрд╛рд░реНрдп)
- тЬЕ рдХреНрд╖реИрддрд┐рдЬ рд░реВрдк рд╕реЗ рд╕реНрдХреЗрд▓реЗрдмрд▓

**рд╕реАрдорд╛рдПрдБ:**
- тЪая╕П рдкрд░рд┐рдгрд╛рдо рдХреНрд░рдо рд╕реЗ рдмрд╛рд╣рд░ рдЖ рд╕рдХрддреЗ рд╣реИрдВ
- тЪая╕П рд╕рдореЗрдХрди рддрд░реНрдХ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ
- тЪая╕П рдЬрдЯрд┐рд▓ рд╕реНрдерд┐рддрд┐ рдкреНрд░рдмрдВрдзрди

**рдЙрджрд╛рд╣рд░рдг рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЗ:**
- рдорд▓реНрдЯреА-рд╕реЛрд░реНрд╕ рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣ (APIs + рдбреЗрдЯрд╛рдмреЗрд╕ + рд╡реЗрдм рд╕реНрдХреНрд░реИрдкрд┐рдВрдЧ)
- рдкреНрд░рддрд┐рд╕реНрдкрд░реНрдзрд╛рддреНрдордХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг (рдХрдИ рдореЙрдбрд▓ рд╕рдорд╛рдзрд╛рди рдЙрддреНрдкрдиреНрди рдХрд░рддреЗ рд╣реИрдВ, рд╕рд░реНрд╡рд╢реНрд░реЗрд╖реНрда рдЪреБрдирд╛ рдЬрд╛рддрд╛ рд╣реИ)
- рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛рдПрдБ (рдПрдХ рд╕рд╛рде рдХрдИ рднрд╛рд╖рд╛рдУрдВ рдореЗрдВ рдЕрдиреБрд╡рд╛рдж)

---

### рдкреИрдЯрд░реНрди 3: рдкрджрд╛рдиреБрдХреНрд░рдорд┐рдд рд╕рдордиреНрд╡рдп (рдореИрдиреЗрдЬрд░-рд╡рд░реНрдХрд░)

**рдХрдм рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**: рдЬрдЯрд┐рд▓ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдЬрд┐рд╕рдореЗрдВ рдЙрдк-рдХрд╛рд░реНрдп рд╣реЛрддреЗ рд╣реИрдВ, рдкреНрд░рддрд┐рдирд┐рдзрд┐рддреНрд╡ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

```mermaid
graph TB
    Master[рдорд╛рд╕реНрдЯрд░ рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░]
    Manager1[рдЕрдиреБрд╕рдВрдзрд╛рди рдкреНрд░рдмрдВрдзрдХ]
    Manager2[рд╕рд╛рдордЧреНрд░реА рдкреНрд░рдмрдВрдзрдХ]
    W1[рд╡реЗрдм рд╕реНрдХреНрд░реИрдкрд░]
    W2[рдкреЗрдкрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдХ]
    W3[рд▓реЗрдЦрдХ]
    W4[рд╕рдВрдкрд╛рджрдХ]
    
    Master --> Manager1
    Master --> Manager2
    Manager1 --> W1
    Manager1 --> W2
    Manager2 --> W3
    Manager2 --> W4
    
    style Master fill:#FF9800,stroke:#F57C00,stroke-width:3px,color:#fff
    style Manager1 fill:#2196F3,stroke:#1976D2,stroke-width:2px,color:#fff
    style Manager2 fill:#2196F3,stroke:#1976D2,stroke-width:2px,color:#fff
```
**рд▓рд╛рдн:**
- тЬЕ рдЬрдЯрд┐рд▓ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХреЛ рд╕рдВрднрд╛рд▓рддрд╛ рд╣реИ
- тЬЕ рдореЙрдбреНрдпреВрд▓рд░ рдФрд░ рдмрдирд╛рдП рд░рдЦрдиреЗ рдпреЛрдЧреНрдп
- тЬЕ рд╕реНрдкрд╖реНрдЯ рдЬрд┐рдореНрдореЗрджрд╛рд░реА рд╕реАрдорд╛рдПрдБ

**рд╕реАрдорд╛рдПрдБ:**
- тЪая╕П рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░
- тЪая╕П рдЙрдЪреНрдЪ рд╡рд┐рд▓рдВрдмрддрд╛ (рдХрдИ рд╕рдордиреНрд╡рдп рдкрд░рддреЗрдВ)
- тЪая╕П рдкрд░рд┐рд╖реНрдХреГрдд рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрд╢рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ

**рдЙрджрд╛рд╣рд░рдг рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЗ:**
- рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЬрд╝ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдкреНрд░рд╕рдВрд╕реНрдХрд░рдг (рд╡рд░реНрдЧреАрдХреГрдд рдХрд░реЗрдВ тЖТ рд░реВрдЯ рдХрд░реЗрдВ тЖТ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░реЗрдВ тЖТ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░реЗрдВ)
- рдорд▓реНрдЯреА-рд╕реНрдЯреЗрдЬ рдбреЗрдЯрд╛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди (рдЗрдирдЬреЗрд╕реНрдЯ тЖТ рд╕рд╛рдл рдХрд░реЗрдВ тЖТ рдЯреНрд░рд╛рдВрд╕рдлреЙрд░реНрдо рдХрд░реЗрдВ тЖТ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ тЖТ рд░рд┐рдкреЛрд░реНрдЯ рдХрд░реЗрдВ)
- рдЬрдЯрд┐рд▓ рдСрдЯреЛрдореЗрд╢рди рд╡рд░реНрдХрдлрд╝реНрд▓реЛ (рдпреЛрдЬрдирд╛ тЖТ рд╕рдВрд╕рд╛рдзрди рдЖрд╡рдВрдЯрди тЖТ рдирд┐рд╖реНрдкрд╛рджрди тЖТ рдирд┐рдЧрд░рд╛рдиреА)

---

### рдкреИрдЯрд░реНрди 4: рдЗрд╡реЗрдВрдЯ-рдбреНрд░рд┐рд╡рди рд╕рдордиреНрд╡рдп (рдкрдмреНрд▓рд┐рд╢-рд╕рдмреНрд╕рдХреНрд░рд╛рдЗрдм)

**рдХрдм рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**: рдПрдЬреЗрдВрдЯреЛрдВ рдХреЛ рдШрдЯрдирд╛рдУрдВ рдкрд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреЗрдиреЗ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИ, рдвреАрд▓рд╛ рдпреБрдЧреНрдорди рд╡рд╛рдВрдЫрдиреАрдп рд╣реЛрддрд╛ рд╣реИред

```mermaid
sequenceDiagram
    participant Agent1 as рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╛рд╣рдХ
    participant EventBus as рдПрдЬрд╝реНрдпреЛрд░ рд╕рд░реНрд╡рд┐рд╕ рдмрд╕
    participant Agent2 as рд╡рд┐рд╢реНрд▓реЗрд╖рдХ
    participant Agent3 as рд╕реВрдЪрдирд╛рджрд╛рддрд╛
    participant Agent4 as рд╕рдВрдЧреНрд░рд╣рдХрд░реНрддрд╛
    
    Agent1->>EventBus: рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░реЗрдВ "рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд рд╣реБрдЖ" рдШрдЯрдирд╛
    EventBus->>Agent2: рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрдВ: рдбреЗрдЯрд╛ рдХрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░реЗрдВ
    EventBus->>Agent3: рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрдВ: рд╕реВрдЪрдирд╛ рднреЗрдЬреЗрдВ
    EventBus->>Agent4: рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрдВ: рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░реЗрдВ
    
    Note over Agent1,Agent4: рд╕рднреА рд╕рджрд╕реНрдп рд╕реНрд╡рддрдВрддреНрд░ рд░реВрдк рд╕реЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░рддреЗ рд╣реИрдВ
    
    Agent2->>EventBus: рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░реЗрдВ "рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдкреВрд░реНрдг" рдШрдЯрдирд╛
    EventBus->>Agent3: рд╕рджрд╕реНрдпрддрд╛ рд▓реЗрдВ: рд╡рд┐рд╢реНрд▓реЗрд╖рдг рд░рд┐рдкреЛрд░реНрдЯ рднреЗрдЬреЗрдВ
```
**рд▓рд╛рдн:**
- тЬЕ рдПрдЬреЗрдВрдЯреЛрдВ рдХреЗ рдмреАрдЪ рдвреАрд▓рд╛ рдпреБрдЧреНрдорди
- тЬЕ рдирдП рдПрдЬреЗрдВрдЯ рдЬреЛрдбрд╝рдирд╛ рдЖрд╕рд╛рди (рдмрд╕ рд╕рдмреНрд╕рдХреНрд░рд╛рдЗрдм рдХрд░реЗрдВ)
- тЬЕ рдЕрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ
- тЬЕ рд▓рдЪреАрд▓рд╛ (рд╕рдВрджреЗрд╢ рд╕реНрдерд╛рдпрд┐рддреНрд╡)

**рд╕реАрдорд╛рдПрдБ:**
- тЪая╕П рдЗрд╡реЗрдВрдЯреБрдЕрд▓ рдХрдВрд╕рд┐рд╕реНрдЯреЗрдВрд╕реА
- тЪая╕П рдЬрдЯрд┐рд▓ рдбрд┐рдмрдЧрд┐рдВрдЧ
- тЪая╕П рд╕рдВрджреЗрд╢ рдХреНрд░рдо рдЪреБрдиреМрддрд┐рдпрд╛рдБ

**рдЙрджрд╛рд╣рд░рдг рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЗ:**
- рд░реАрдпрд▓-рдЯрд╛рдЗрдо рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо (рдЕрд▓рд░реНрдЯ, рдбреИрд╢рдмреЛрд░реНрдб, рд▓реЙрдЧреНрд╕)
- рдорд▓реНрдЯреА-рдЪреИрдирд▓ рд╕реВрдЪрдирд╛рдПрдБ (рдИрдореЗрд▓, SMS, рдкреБрд╢, рд╕реНрд▓реИрдХ)
- рдбреЗрдЯрд╛ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рдкрд╛рдЗрдкрд▓рд╛рдЗрди (рдПрдХ рд╣реА рдбреЗрдЯрд╛ рдХреЗ рдХрдИ рдЙрдкрднреЛрдХреНрддрд╛)

---

### рдкреИрдЯрд░реНрди 5: рд╕рд╣рдорддрд┐-рдЖрдзрд╛рд░рд┐рдд рд╕рдордиреНрд╡рдп (рд╡реЛрдЯрд┐рдВрдЧ/рдХреНрд╡реЛрд░рдо)

**рдХрдм рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**: рдЖрдЧреЗ рдмрдврд╝рдиреЗ рд╕реЗ рдкрд╣рд▓реЗ рдХрдИ рдПрдЬреЗрдВрдЯреЛрдВ рд╕реЗ рд╕рд╣рдорддрд┐ рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛ рд╣реЛрддреА рд╣реИред

```mermaid
graph TB
    Input[рдЗрдирдкреБрдЯ рдХрд╛рд░реНрдп]
    Agent1[рдПрдЬреЗрдВрдЯ 1: GPT-4]
    Agent2[рдПрдЬреЗрдВрдЯ 2: Claude]
    Agent3[рдПрдЬреЗрдВрдЯ 3: Gemini]
    Voter[рд╕рд╣рдорддрд┐ рдорддрджрд╛рддрд╛]
    Output[рд╕рд╣рдорддрд┐ рдЖрдЙрдЯрдкреБрдЯ]
    
    Input --> Agent1
    Input --> Agent2
    Input --> Agent3
    Agent1 --> Voter
    Agent2 --> Voter
    Agent3 --> Voter
    Voter --> Output
    
    style Voter fill:#9C27B0,stroke:#7B1FA2,stroke-width:3px,color:#fff
```
**рд▓рд╛рдн:**
- тЬЕ рдЙрдЪреНрдЪ рд╕рдЯреАрдХрддрд╛ (рдХрдИ рд░рд╛рдп)
- тЬЕ рджреЛрд╖-рд╕рд╣рд┐рд╖реНрдгреБ (рдЕрд▓реНрдкрд╕рдВрдЦреНрдпрдХ рд╡рд┐рдлрд▓рддрд╛рдПрдБ рд╕реНрд╡реАрдХрд╛рд░реНрдп)
- тЬЕ рдЧреБрдгрд╡рддреНрддрд╛ рдЖрд╢реНрд╡рд╛рд╕рди рдЕрдВрддрд░реНрдирд┐рд╣рд┐рдд

**рд╕реАрдорд╛рдПрдБ:**
- тЭМ рдорд╣рдВрдЧрд╛ (рдХрдИ рдореЙрдбрд▓ рдХреЙрд▓)
- тЭМ рдзреАрдорд╛ (рд╕рднреА рдПрдЬреЗрдВрдЯреЛрдВ рдХреА рдкреНрд░рддреАрдХреНрд╖рд╛)
- тЪая╕П рд╕рдВрдШрд░реНрд╖ рд╕рдорд╛рдзрд╛рди рдХреА рдЖрд╡рд╢реНрдпрдХрддрд╛

**рдЙрджрд╛рд╣рд░рдг рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЗ:**
- рд╕рд╛рдордЧреНрд░реА рдореЙрдбрд░реЗрд╢рди (рдХрдИ рдореЙрдбрд▓ рд╕рд╛рдордЧреНрд░реА рдХреА рд╕рдореАрдХреНрд╖рд╛ рдХрд░рддреЗ рд╣реИрдВ)
- рдХреЛрдб рд╕рдореАрдХреНрд╖рд╛ (рдХрдИ рд▓рд┐рдВрдЯрд░реНрд╕/рдПрдирд╛рд▓рд╛рдЗрдЬрд╝рд░)
- рдЪрд┐рдХрд┐рддреНрд╕рд╛ рдирд┐рджрд╛рди (рдХрдИ AI рдореЙрдбрд▓, рд╡рд┐рд╢реЗрд╖рдЬреНрдЮ рд╕рддреНрдпрд╛рдкрди)

---

## рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рдЕрд╡рд▓реЛрдХрди

### Azure рдкрд░ рдкреВрд░реНрдг рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рд╕рд┐рд╕реНрдЯрдо

```mermaid
graph TB
    User[рдЙрдкрдпреЛрдЧрдХрд░реНрддрд╛/API рдХреНрд▓рд╛рдЗрдВрдЯ]
    APIM[рдПрдЬрд╝реНрдпреЛрд░ API рдкреНрд░рдмрдВрдзрди]
    Orchestrator[рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░ рд╕реЗрд╡рд╛<br/>рдХрдВрдЯреЗрдирд░ рдРрдк]
    ServiceBus[рдПрдЬрд╝реНрдпреЛрд░ рд╕реЗрд╡рд╛ рдмрд╕<br/>рдЗрд╡реЗрдВрдЯ рд╣рдм]
    
    Agent1[рдЕрдиреБрд╕рдВрдзрд╛рди рдПрдЬреЗрдВрдЯ<br/>рдХрдВрдЯреЗрдирд░ рдРрдк]
    Agent2[рд▓реЗрдЦрдХ рдПрдЬреЗрдВрдЯ<br/>рдХрдВрдЯреЗрдирд░ рдРрдк]
    Agent3[рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рдПрдЬреЗрдВрдЯ<br/>рдХрдВрдЯреЗрдирд░ рдРрдк]
    Agent4[рд╕рдореАрдХреНрд╖рдХ рдПрдЬреЗрдВрдЯ<br/>рдХрдВрдЯреЗрдирд░ рдРрдк]
    
    CosmosDB[(рдХреЙрд╕рдореЙрд╕ DB<br/>рд╕рд╛рдЭрд╛ рд╕реНрдерд┐рддрд┐)]
    Storage[рдПрдЬрд╝реНрдпреЛрд░ рд╕реНрдЯреЛрд░реЗрдЬ<br/>рдХреГрддрд┐рдпрд╛рдВ]
    AppInsights[рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕<br/>рдирд┐рдЧрд░рд╛рдиреА]
    
    User --> APIM
    APIM --> Orchestrator
    
    Orchestrator --> ServiceBus
    ServiceBus --> Agent1
    ServiceBus --> Agent2
    ServiceBus --> Agent3
    ServiceBus --> Agent4
    
    Agent1 --> CosmosDB
    Agent2 --> CosmosDB
    Agent3 --> CosmosDB
    Agent4 --> CosmosDB
    
    Agent1 --> Storage
    Agent2 --> Storage
    Agent3 --> Storage
    Agent4 --> Storage
    
    Orchestrator -.-> AppInsights
    Agent1 -.-> AppInsights
    Agent2 -.-> AppInsights
    Agent3 -.-> AppInsights
    Agent4 -.-> AppInsights
    
    style Orchestrator fill:#FF9800,stroke:#F57C00,stroke-width:3px,color:#fff
    style ServiceBus fill:#9C27B0,stroke:#7B1FA2,stroke-width:3px,color:#fff
    style CosmosDB fill:#4CAF50,stroke:#388E3C,stroke-width:3px,color:#fff
```
**рдореБрдЦреНрдп рдШрдЯрдХ:**

| рдШрдЯрдХ | рдЙрджреНрджреЗрд╢реНрдп | Azure рд╕реЗрд╡рд╛ |
|-----------|---------|---------------|
| **API рдЧреЗрдЯрд╡реЗ** | рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреБ, рджрд░ рд╕реАрдорд┐рдд рдХрд░рдирд╛, рдкреНрд░рдорд╛рдгреАрдХрд░рдг | API рдкреНрд░рдмрдВрдзрди |
| **рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░** | рдПрдЬреЗрдВрдЯ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдХрд╛ рд╕рдордиреНрд╡рдп рдХрд░рддрд╛ рд╣реИ | рдХрдВрдЯреЗрдирд░ рдРрдкреНрд╕ |
| **рд╕рдВрджреЗрд╢ рдХрддрд╛рд░** | рдЕрд╕рд┐рдВрдХреНрд░реЛрдирд╕ рд╕рдВрдЪрд╛рд░ | рд╕рд░реНрд╡рд┐рд╕ рдмрд╕ / рдЗрд╡реЗрдВрдЯ рд╣рдмреНрд╕ |
| **рдПрдЬреЗрдВрдЯреНрд╕** | рд╡рд┐рд╢реЗрд╖ AI рдХрд╛рд░реНрдпрдХрд░реНрддрд╛ | рдХрдВрдЯреЗрдирд░ рдРрдкреНрд╕ / рдлрдВрдХреНрд╢рдиреНрд╕ |
| **рд╕реНрдЯреЗрдЯ рд╕реНрдЯреЛрд░** | рд╕рд╛рдЭрд╛ рд╕реНрдерд┐рддрд┐, рдХрд╛рд░реНрдп рдЯреНрд░реИрдХрд┐рдВрдЧ | рдХреЙрд╕рдореЙрд╕ DB |
| **рдЖрд░реНрдЯрд┐рдлреИрдХреНрдЯ рд╕реНрдЯреЛрд░реЗрдЬ** | рджрд╕реНрддрд╛рд╡реЗрдЬрд╝, рдкрд░рд┐рдгрд╛рдо, рд▓реЙрдЧреНрд╕ | рдмреНрд▓реЙрдм рд╕реНрдЯреЛрд░реЗрдЬ |
| **рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ** | рд╡рд┐рддрд░рд┐рдд рдЯреНрд░реЗрд╕рд┐рдВрдЧ, рд▓реЙрдЧреНрд╕ | рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕ |

---

## рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ

### рдЖрд╡рд╢реНрдпрдХ рдЙрдкрдХрд░рдг

```bash
# Azure Developer CLI рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ
azd version
# тЬЕ рдЕрдкреЗрдХреНрд╖рд┐рдд: azd рд╕рдВрд╕реНрдХрд░рдг 1.0.0 рдпрд╛ рдЙрдЪреНрдЪрддрд░

# Azure CLI рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ
az --version
# тЬЕ рдЕрдкреЗрдХреНрд╖рд┐рдд: azure-cli 2.50.0 рдпрд╛ рдЙрдЪреНрдЪрддрд░

# Docker рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ (рд╕реНрдерд╛рдиреАрдп рдкрд░реАрдХреНрд╖рдг рдХреЗ рд▓рд┐рдП)
docker --version
# тЬЕ рдЕрдкреЗрдХреНрд╖рд┐рдд: Docker рд╕рдВрд╕реНрдХрд░рдг 20.10 рдпрд╛ рдЙрдЪреНрдЪрддрд░
```

### Azure рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ

- рд╕рдХреНрд░рд┐рдп Azure рд╕рджрд╕реНрдпрддрд╛
- рдирд┐рдореНрдирд▓рд┐рдЦрд┐рдд рдмрдирд╛рдиреЗ рдХреА рдЕрдиреБрдорддрд┐:
  - рдХрдВрдЯреЗрдирд░ рдРрдкреНрд╕
  - рд╕рд░реНрд╡рд┐рд╕ рдмрд╕ рдирд╛рдорд╕реНрдерд╛рди
  - рдХреЙрд╕рдореЙрд╕ DB рдЦрд╛рддреЗ
  - рд╕реНрдЯреЛрд░реЗрдЬ рдЦрд╛рддреЗ
  - рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕

### рдЬреНрдЮрд╛рди рдЖрд╡рд╢реНрдпрдХрддрд╛рдПрдБ

рдЖрдкрдиреЗ рдкреВрд░рд╛ рдХрд░ рд▓рд┐рдпрд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП:
- [рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди рдкреНрд░рдмрдВрдзрди](../getting-started/configuration.md)
- [рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдФрд░ рд╕реБрд░рдХреНрд╖рд╛](../getting-started/authsecurity.md)
- [рдорд╛рдЗрдХреНрд░реЛрд╕рд░реНрд╡рд┐рд╕реЗрдЬ рдЙрджрд╛рд╣рд░рдг](../../../../examples/microservices)

---

## рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди рдЧрд╛рдЗрдб

### рдкреНрд░реЛрдЬреЗрдХреНрдЯ рд╕рдВрд░рдЪрдирд╛

```
multi-agent-system/
тФЬтФАтФА azure.yaml                    # AZD configuration
тФЬтФАтФА infra/
тФВ   тФЬтФАтФА main.bicep               # Main infrastructure
тФВ   тФЬтФАтФА core/
тФВ   тФВ   тФЬтФАтФА servicebus.bicep     # Message queue
тФВ   тФВ   тФЬтФАтФА cosmos.bicep         # State store
тФВ   тФВ   тФЬтФАтФА storage.bicep        # Artifact storage
тФВ   тФВ   тФФтФАтФА monitoring.bicep     # Application Insights
тФВ   тФФтФАтФА app/
тФВ       тФЬтФАтФА orchestrator.bicep   # Orchestrator service
тФВ       тФФтФАтФА agent.bicep          # Agent template
тФФтФАтФА src/
    тФЬтФАтФА orchestrator/            # Orchestration logic
    тФВ   тФЬтФАтФА app.py
    тФВ   тФЬтФАтФА workflows.py
    тФВ   тФФтФАтФА Dockerfile
    тФЬтФАтФА agents/
    тФВ   тФЬтФАтФА research/            # Research agent
    тФВ   тФЬтФАтФА writer/              # Writer agent
    тФВ   тФЬтФАтФА analyst/             # Analyst agent
    тФВ   тФФтФАтФА reviewer/            # Reviewer agent
    тФФтФАтФА shared/
        тФЬтФАтФА state_manager.py     # Shared state logic
        тФФтФАтФА message_handler.py   # Message handling
```

---

## рдкрд╛рда 1: рдЕрдиреБрдХреНрд░рдорд┐рдХ рд╕рдордиреНрд╡рдп рдкреИрдЯрд░реНрди

### рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди: рд╕рд╛рдордЧреНрд░реА рдирд┐рд░реНрдорд╛рдг рдкрд╛рдЗрдкрд▓рд╛рдЗрди

рдЖрдЗрдП рдПрдХ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рдмрдирд╛рдПрдВ: рд╢реЛрдз тЖТ рд▓рд┐рдЦреЗрдВ тЖТ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░реЗрдВ тЖТ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░реЗрдВ

### 1. AZD рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди

**рдлрд╝рд╛рдЗрд▓: `azure.yaml`**

```yaml
name: content-pipeline
metadata:
  template: multi-agent-sequential@1.0.0

services:
  orchestrator:
    project: ./src/orchestrator
    language: python
    host: containerapp
  
  research-agent:
    project: ./src/agents/research
    language: python
    host: containerapp
  
  writer-agent:
    project: ./src/agents/writer
    language: python
    host: containerapp
  
  editor-agent:
    project: ./src/agents/editor
    language: python
    host: containerapp
```

### 2. рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░: рд╕рдордиреНрд╡рдп рдХреЗ рд▓рд┐рдП рд╕рд░реНрд╡рд┐рд╕ рдмрд╕

**рдлрд╝рд╛рдЗрд▓: `infra/core/servicebus.bicep`**

```bicep
param name string
param location string
param tags object = {}

resource serviceBusNamespace 'Microsoft.ServiceBus/namespaces@2022-10-01-preview' = {
  name: name
  location: location
  tags: tags
  sku: {
    name: 'Standard'
    tier: 'Standard'
  }
  properties: {
    minimumTlsVersion: '1.2'
  }
}

// Queue for orchestrator тЖТ research agent
resource researchQueue 'Microsoft.ServiceBus/namespaces/queues@2022-10-01-preview' = {
  parent: serviceBusNamespace
  name: 'research-tasks'
  properties: {
    maxDeliveryCount: 3
    lockDuration: 'PT5M'
    deadLetteringOnMessageExpiration: true
  }
}

// Queue for research agent тЖТ writer agent
resource writerQueue 'Microsoft.ServiceBus/namespaces/queues@2022-10-01-preview' = {
  parent: serviceBusNamespace
  name: 'writer-tasks'
  properties: {
    maxDeliveryCount: 3
    lockDuration: 'PT5M'
  }
}

// Queue for writer agent тЖТ editor agent
resource editorQueue 'Microsoft.ServiceBus/namespaces/queues@2022-10-01-preview' = {
  parent: serviceBusNamespace
  name: 'editor-tasks'
  properties: {
    maxDeliveryCount: 3
    lockDuration: 'PT5M'
  }
}

output namespace string = serviceBusNamespace.name
output connectionString string = listKeys('${serviceBusNamespace.id}/AuthorizationRules/RootManageSharedAccessKey', serviceBusNamespace.apiVersion).primaryConnectionString
```

### 3. рд╕рд╛рдЭрд╛ рд╕реНрдерд┐рддрд┐ рдкреНрд░рдмрдВрдзрдХ

**рдлрд╝рд╛рдЗрд▓: `src/shared/state_manager.py`**

```python
from azure.cosmos import CosmosClient, PartitionKey
from datetime import datetime
import os

class StateManager:
    """Manages shared state across agents using Cosmos DB"""
    
    def __init__(self):
        endpoint = os.environ['COSMOS_ENDPOINT']
        key = os.environ['COSMOS_KEY']
        
        self.client = CosmosClient(endpoint, key)
        self.database = self.client.get_database_client('agent-state')
        self.container = self.database.get_container_client('tasks')
    
    def create_task(self, task_id: str, task_type: str, input_data: dict):
        """Create a new task"""
        task = {
            'id': task_id,
            'type': task_type,
            'status': 'pending',
            'input': input_data,
            'created_at': datetime.utcnow().isoformat(),
            'steps': []
        }
        self.container.create_item(task)
        return task
    
    def update_task_step(self, task_id: str, step_name: str, result: dict):
        """Update task with completed step"""
        task = self.container.read_item(task_id, partition_key=task_id)
        
        task['steps'].append({
            'name': step_name,
            'completed_at': datetime.utcnow().isoformat(),
            'result': result
        })
        
        self.container.replace_item(task_id, task)
        return task
    
    def complete_task(self, task_id: str, final_result: dict):
        """Mark task as complete"""
        task = self.container.read_item(task_id, partition_key=task_id)
        task['status'] = 'completed'
        task['result'] = final_result
        task['completed_at'] = datetime.utcnow().isoformat()
        self.container.replace_item(task_id, task)
        return task
    
    def get_task(self, task_id: str):
        """Retrieve task state"""
        return self.container.read_item(task_id, partition_key=task_id)
```

### 4. рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░ рд╕реЗрд╡рд╛

**рдлрд╝рд╛рдЗрд▓: `src/orchestrator/app.py`**

```python
from flask import Flask, request, jsonify
from azure.servicebus import ServiceBusClient, ServiceBusMessage
import json
import uuid
import os
from shared.state_manager import StateManager

app = Flask(__name__)
state_manager = StateManager()

# рд╕реЗрд╡рд╛ рдмрд╕ рдХрдиреЗрдХреНрд╢рди
servicebus_connection_str = os.environ['SERVICEBUS_CONNECTION_STRING']
servicebus_client = ServiceBusClient.from_connection_string(servicebus_connection_str)

@app.route('/health', methods=['GET'])
def health():
    return jsonify({'status': 'healthy', 'service': 'orchestrator'})

@app.route('/create-content', methods=['POST'])
def create_content():
    """
    Sequential workflow: Research тЖТ Write тЖТ Edit тЖТ Publish
    """
    data = request.json
    topic = data.get('topic')
    
    if not topic:
        return jsonify({'error': 'Topic required'}), 400
    
    # рд░рд╛рдЬреНрдп рд╕реНрдЯреЛрд░ рдореЗрдВ рдХрд╛рд░реНрдп рдмрдирд╛рдПрдВ
    task_id = str(uuid.uuid4())
    task = state_manager.create_task(
        task_id=task_id,
        task_type='content_creation',
        input_data={'topic': topic}
    )
    
    # рдЕрдиреБрд╕рдВрдзрд╛рди рдПрдЬреЗрдВрдЯ рдХреЛ рд╕рдВрджреЗрд╢ рднреЗрдЬреЗрдВ (рдкрд╣рд▓рд╛ рдХрджрдо)
    sender = servicebus_client.get_queue_sender('research-tasks')
    message = ServiceBusMessage(
        body=json.dumps({
            'task_id': task_id,
            'topic': topic,
            'next_queue': 'writer-tasks'  # рдкрд░рд┐рдгрд╛рдо рдХрд╣рд╛рдВ рднреЗрдЬреЗрдВ
        }),
        content_type='application/json'
    )
    
    with sender:
        sender.send_messages(message)
    
    return jsonify({
        'task_id': task_id,
        'status': 'started',
        'workflow': 'sequential',
        'steps': ['research', 'write', 'edit', 'publish'],
        'message': 'Content creation pipeline initiated'
    }), 202

@app.route('/task/<task_id>', methods=['GET'])
def get_task_status(task_id):
    """Check task status"""
    try:
        task = state_manager.get_task(task_id)
        return jsonify(task)
    except Exception as e:
        return jsonify({'error': str(e)}), 404

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

### 5. рд╢реЛрдз рдПрдЬреЗрдВрдЯ

**рдлрд╝рд╛рдЗрд▓: `src/agents/research/app.py`**

```python
from azure.servicebus import ServiceBusClient, ServiceBusMessage
from openai import AzureOpenAI
import json
import os
import time
from shared.state_manager import StateManager

# рдХреНрд▓рд╛рдЗрдВрдЯреНрд╕ рдХреЛ рдкреНрд░рд╛рд░рдВрдн рдХрд░реЗрдВ
state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

openai_client = AzureOpenAI(
    api_key=os.environ['AZURE_OPENAI_API_KEY'],
    api_version="2024-02-01",
    azure_endpoint=os.environ['AZURE_OPENAI_ENDPOINT']
)

def process_research_task(message_data):
    """Process research request and pass to writer"""
    task_id = message_data['task_id']
    topic = message_data['topic']
    next_queue = message_data['next_queue']
    
    print(f"ЁЯФм Researching: {topic}")
    
    # рд╢реЛрдз рдХреЗ рд▓рд┐рдП Azure OpenAI рдХреЛ рдХреЙрд▓ рдХрд░реЗрдВ
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are a research assistant. Provide comprehensive research on the given topic."},
            {"role": "user", "content": f"Research this topic thoroughly: {topic}"}
        ],
        max_tokens=1500
    )
    
    research_results = response.choices[0].message.content
    
    # рд╕реНрдерд┐рддрд┐ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ
    state_manager.update_task_step(
        task_id=task_id,
        step_name='research',
        result={'research': research_results}
    )
    
    # рдЕрдЧрд▓реЗ рдПрдЬреЗрдВрдЯ (рд▓реЗрдЦрдХ) рдХреЛ рднреЗрдЬреЗрдВ
    sender = servicebus_client.get_queue_sender(next_queue)
    message = ServiceBusMessage(
        body=json.dumps({
            'task_id': task_id,
            'topic': topic,
            'research': research_results,
            'next_queue': 'editor-tasks'
        }),
        content_type='application/json'
    )
    
    with sender:
        sender.send_messages(message)
    
    print(f"тЬЕ Research complete for task {task_id}")

def main():
    """Listen to research queue"""
    receiver = servicebus_client.get_queue_receiver('research-tasks')
    
    print("ЁЯФм Research Agent started, listening for tasks...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_research_task(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"тЭМ Error processing message: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

### 6. рд▓реЗрдЦрдХ рдПрдЬреЗрдВрдЯ

**рдлрд╝рд╛рдЗрд▓: `src/agents/writer/app.py`**

```python
from azure.servicebus import ServiceBusClient, ServiceBusMessage
from openai import AzureOpenAI
import json
import os
from shared.state_manager import StateManager

state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

openai_client = AzureOpenAI(
    api_key=os.environ['AZURE_OPENAI_API_KEY'],
    api_version="2024-02-01",
    azure_endpoint=os.environ['AZURE_OPENAI_ENDPOINT']
)

def process_writing_task(message_data):
    """Write article based on research"""
    task_id = message_data['task_id']
    topic = message_data['topic']
    research = message_data['research']
    next_queue = message_data['next_queue']
    
    print(f"тЬНя╕П Writing article: {topic}")
    
    # Azure OpenAI рдХреЛ рд▓реЗрдЦ рд▓рд┐рдЦрдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХрд░реЗрдВ
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are a professional writer. Write engaging, well-structured articles."},
            {"role": "user", "content": f"Based on this research:\n\n{research}\n\nWrite a comprehensive article about: {topic}"}
        ],
        max_tokens=2000
    )
    
    article_draft = response.choices[0].message.content
    
    # рд╕реНрдерд┐рддрд┐ рдЕрдкрдбреЗрдЯ рдХрд░реЗрдВ
    state_manager.update_task_step(
        task_id=task_id,
        step_name='writing',
        result={'draft': article_draft}
    )
    
    # рд╕рдВрдкрд╛рджрдХ рдХреЛ рднреЗрдЬреЗрдВ
    sender = servicebus_client.get_queue_sender(next_queue)
    message = ServiceBusMessage(
        body=json.dumps({
            'task_id': task_id,
            'topic': topic,
            'draft': article_draft
        }),
        content_type='application/json'
    )
    
    with sender:
        sender.send_messages(message)
    
    print(f"тЬЕ Article draft complete for task {task_id}")

def main():
    """Listen to writer queue"""
    receiver = servicebus_client.get_queue_receiver('writer-tasks')
    
    print("тЬНя╕П Writer Agent started, listening for tasks...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_writing_task(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"тЭМ Error: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

### 7. рд╕рдВрдкрд╛рджрдХ рдПрдЬреЗрдВрдЯ

**рдлрд╝рд╛рдЗрд▓: `src/agents/editor/app.py`**

```python
from azure.servicebus import ServiceBusClient
from openai import AzureOpenAI
import json
import os
from shared.state_manager import StateManager

state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

openai_client = AzureOpenAI(
    api_key=os.environ['AZURE_OPENAI_API_KEY'],
    api_version="2024-02-01",
    azure_endpoint=os.environ['AZURE_OPENAI_ENDPOINT']
)

def process_editing_task(message_data):
    """Edit and finalize article"""
    task_id = message_data['task_id']
    topic = message_data['topic']
    draft = message_data['draft']
    
    print(f"ЁЯУЭ Editing article: {topic}")
    
    # Azure OpenAI рдХреЛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рдХреЙрд▓ рдХрд░реЗрдВ
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are an expert editor. Improve grammar, clarity, and structure."},
            {"role": "user", "content": f"Edit and improve this article:\n\n{draft}"}
        ],
        max_tokens=2000
    )
    
    final_article = response.choices[0].message.content
    
    # рдХрд╛рд░реНрдп рдХреЛ рдкреВрд░реНрдг рдХреЗ рд░реВрдк рдореЗрдВ рдЪрд┐рд╣реНрдирд┐рдд рдХрд░реЗрдВ
    state_manager.complete_task(
        task_id=task_id,
        final_result={
            'topic': topic,
            'final_article': final_article,
            'word_count': len(final_article.split())
        }
    )
    
    print(f"тЬЕ Article finalized for task {task_id}")

def main():
    """Listen to editor queue"""
    receiver = servicebus_client.get_queue_receiver('editor-tasks')
    
    print("ЁЯУЭ Editor Agent started, listening for tasks...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_editing_task(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"тЭМ Error: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

### 8. рддреИрдирд╛рдд рдХрд░реЗрдВ рдФрд░ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ

```bash
# рдкреНрд░рд╛рд░рдВрдн рдХрд░реЗрдВ рдФрд░ рддреИрдирд╛рдд рдХрд░реЗрдВ
azd init
azd up

# рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░ URL рдкреНрд░рд╛рдкреНрдд рдХрд░реЗрдВ
ORCHESTRATOR_URL=$(azd env get-values | grep ORCHESTRATOR_URL | cut -d '=' -f2 | tr -d '"')

# рд╕рд╛рдордЧреНрд░реА рдмрдирд╛рдПрдВ
curl -X POST $ORCHESTRATOR_URL/create-content \
  -H "Content-Type: application/json" \
  -d '{"topic": "The Future of AI in Healthcare"}'
```

**тЬЕ рдЕрдкреЗрдХреНрд╖рд┐рдд рдЖрдЙрдЯрдкреБрдЯ:**
```json
{
  "task_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "status": "started",
  "workflow": "sequential",
  "steps": ["research", "write", "edit", "publish"],
  "message": "Content creation pipeline initiated"
}
```

**рдХрд╛рд░реНрдп рдкреНрд░рдЧрддрд┐ рдХреА рдЬрд╛рдБрдЪ рдХрд░реЗрдВ:**
```bash
TASK_ID="a1b2c3d4-e5f6-7890-abcd-ef1234567890"
curl $ORCHESTRATOR_URL/task/$TASK_ID
```

**тЬЕ рдЕрдкреЗрдХреНрд╖рд┐рдд рдЖрдЙрдЯрдкреБрдЯ (рдкреВрд░реНрдг):**
```json
{
  "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "type": "content_creation",
  "status": "completed",
  "steps": [
    {
      "name": "research",
      "completed_at": "2025-11-19T10:30:00Z",
      "result": {"research": "..."}
    },
    {
      "name": "writing",
      "completed_at": "2025-11-19T10:32:00Z",
      "result": {"draft": "..."}
    }
  ],
  "result": {
    "topic": "The Future of AI in Healthcare",
    "final_article": "...",
    "word_count": 1500
  }
}
```

---

## рдкрд╛рда 2: рд╕рдорд╛рдирд╛рдВрддрд░ рд╕рдордиреНрд╡рдп рдкреИрдЯрд░реНрди

### рдХрд╛рд░реНрдпрд╛рдиреНрд╡рдпрди: рдорд▓реНрдЯреА-рд╕реЛрд░реНрд╕ рд░рд┐рд╕рд░реНрдЪ рдПрдЧреНрд░реАрдЧреЗрдЯрд░

рдЖрдЗрдП рдПрдХ рд╕рдорд╛рдирд╛рдВрддрд░ рдкреНрд░рдгрд╛рд▓реА рдмрдирд╛рдПрдВ рдЬреЛ рдПрдХ рд╕рд╛рде рдХрдИ рд╕реНрд░реЛрддреЛрдВ рд╕реЗ рдЬрд╛рдирдХрд╛рд░реА рдПрдХрддреНрд░ рдХрд░рддреА рд╣реИред

### рд╕рдорд╛рдирд╛рдВрддрд░ рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░

**рдлрд╝рд╛рдЗрд▓: `src/orchestrator/parallel_workflow.py`**

```python
from flask import Flask, request, jsonify
from azure.servicebus import ServiceBusClient, ServiceBusMessage
import json
import uuid
import os
from shared.state_manager import StateManager

app = Flask(__name__)
state_manager = StateManager()

servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

@app.route('/research-parallel', methods=['POST'])
def research_parallel():
    """
    Parallel workflow: Multiple agents work simultaneously
    """
    data = request.json
    query = data.get('query')
    
    task_id = str(uuid.uuid4())
    task = state_manager.create_task(
        task_id=task_id,
        task_type='parallel_research',
        input_data={
            'query': query,
            'agents': ['web', 'academic', 'news', 'social']
        }
    )
    
    # рдлреИрди-рдЖрдЙрдЯ: рд╕рднреА рдПрдЬреЗрдВрдЯреЛрдВ рдХреЛ рдПрдХ рд╕рд╛рде рднреЗрдЬреЗрдВ
    agents = [
        ('web-research-queue', 'web'),
        ('academic-research-queue', 'academic'),
        ('news-research-queue', 'news'),
        ('social-research-queue', 'social')
    ]
    
    for queue_name, agent_type in agents:
        sender = servicebus_client.get_queue_sender(queue_name)
        message = ServiceBusMessage(
            body=json.dumps({
                'task_id': task_id,
                'query': query,
                'agent_type': agent_type,
                'result_queue': 'aggregation-queue'
            }),
            content_type='application/json'
        )
        
        with sender:
            sender.send_messages(message)
    
    return jsonify({
        'task_id': task_id,
        'status': 'started',
        'workflow': 'parallel',
        'agents_dispatched': 4,
        'message': 'Parallel research initiated'
    }), 202

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

### рд╕рдореЗрдХрди рддрд░реНрдХ

**рдлрд╝рд╛рдЗрд▓: `src/agents/aggregator/app.py`**

```python
from azure.servicebus import ServiceBusClient
import json
import os
from collections import defaultdict
from shared.state_manager import StateManager

state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

# рдкреНрд░рддреНрдпреЗрдХ рдХрд╛рд░реНрдп рдХреЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдЯреНрд░реИрдХ рдХрд░реЗрдВ
task_results = defaultdict(list)
expected_agents = 4  # рд╡реЗрдм, рд╢реИрдХреНрд╖рдгрд┐рдХ, рд╕рдорд╛рдЪрд╛рд░, рд╕рд╛рдорд╛рдЬрд┐рдХ

def process_result(message_data):
    """Aggregate results from parallel agents"""
    task_id = message_data['task_id']
    agent_type = message_data['agent_type']
    result = message_data['result']
    
    # рдкрд░рд┐рдгрд╛рдо рд╕рдВрдЧреНрд░рд╣реАрдд рдХрд░реЗрдВ
    task_results[task_id].append({
        'agent': agent_type,
        'data': result
    })
    
    print(f"ЁЯУК Received result from {agent_type} agent ({len(task_results[task_id])}/{expected_agents})")
    
    # рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдХреНрдпрд╛ рд╕рднреА рдПрдЬреЗрдВрдЯреНрд╕ рдиреЗ рдкреВрд░рд╛ рдХрд┐рдпрд╛ (рдлреИрди-рдЗрди)
    if len(task_results[task_id]) == expected_agents:
        print(f"тЬЕ All agents completed for task {task_id}. Aggregating...")
        
        # рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдорд┐рд▓рд╛рдПрдВ
        aggregated = {
            'query': message_data['query'],
            'sources': task_results[task_id],
            'summary': generate_summary(task_results[task_id])
        }
        
        # рдкреВрд░реНрдг рдЪрд┐рд╣реНрдирд┐рдд рдХрд░реЗрдВ
        state_manager.complete_task(task_id, aggregated)
        
        # рд╕рд╛рдл рдХрд░реЗрдВ
        del task_results[task_id]
        
        print(f"тЬЕ Aggregation complete for task {task_id}")

def generate_summary(results):
    """Generate summary from all sources"""
    summaries = [r['data'].get('summary', '') for r in results]
    return '\n\n'.join(summaries)

def main():
    """Listen to aggregation queue"""
    receiver = servicebus_client.get_queue_receiver('aggregation-queue')
    
    print("ЁЯУК Aggregator started, listening for results...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_result(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"тЭМ Error: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

**рд╕рдорд╛рдирд╛рдВрддрд░ рдкреИрдЯрд░реНрди рдХреЗ рд▓рд╛рдн:**
- тЪб **4x рддреЗрдЬрд╝** (рдПрдЬреЗрдВрдЯ рдПрдХ рд╕рд╛рде рдЪрд▓рддреЗ рд╣реИрдВ)
- ЁЯФД **рджреЛрд╖-рд╕рд╣рд┐рд╖реНрдгреБ** (рдЖрдВрд╢рд┐рдХ рдкрд░рд┐рдгрд╛рдо рд╕реНрд╡реАрдХрд╛рд░реНрдп)
- ЁЯУИ **рд╕реНрдХреЗрд▓реЗрдмрд▓** (рдЖрд╕рд╛рдиреА рд╕реЗ рдЕрдзрд┐рдХ рдПрдЬреЗрдВрдЯ рдЬреЛрдбрд╝реЗрдВ)

---

## рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдЕрднреНрдпрд╛рд╕

### рдЕрднреНрдпрд╛рд╕ 1: рдЯрд╛рдЗрдордЖрдЙрдЯ рд╣реИрдВрдбрд▓рд┐рдВрдЧ рдЬреЛрдбрд╝реЗрдВ тнРтнР (рдордзреНрдпрдо)

**рд▓рдХреНрд╖реНрдп**: рдЯрд╛рдЗрдордЖрдЙрдЯ рддрд░реНрдХ рд▓рд╛рдЧреВ рдХрд░реЗрдВ рддрд╛рдХрд┐ рдПрдЧреНрд░реАрдЧреЗрдЯрд░ рдзреАрдореЗ рдПрдЬреЗрдВрдЯреЛрдВ рдХреЗ рд▓рд┐рдП рд╣рдореЗрд╢рд╛ рдЗрдВрддрдЬрд╛рд░ рди рдХрд░реЗред

**рдЪрд░рдг**:

1. **рдПрдЧреНрд░реАрдЧреЗрдЯрд░ рдореЗрдВ рдЯрд╛рдЗрдордЖрдЙрдЯ рдЯреНрд░реИрдХрд┐рдВрдЧ рдЬреЛрдбрд╝реЗрдВ:**

```python
from datetime import datetime, timedelta

task_timeouts = {}  # рдХрд╛рд░реНрдп_рдЖрдИрдбреА -> рд╕рдорд╛рдкреНрддрд┐_рд╕рдордп

def process_result(message_data):
    task_id = message_data['task_id']
    
    # рдкрд╣рд▓реЗ рдкрд░рд┐рдгрд╛рдо рдкрд░ рд╕рдордп рд╕реАрдорд╛ рд╕реЗрдЯ рдХрд░реЗрдВ
    if task_id not in task_timeouts:
        task_timeouts[task_id] = datetime.utcnow() + timedelta(seconds=30)
    
    task_results[task_id].append({
        'agent': message_data['agent_type'],
        'data': message_data['result']
    })
    
    # рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рдкреВрд░рд╛ рд╣реБрдЖ рд╣реИ рдпрд╛ рд╕рдордп рд╕рдорд╛рдкреНрдд рд╣реЛ рдЧрдпрд╛ рд╣реИ
    if len(task_results[task_id]) == expected_agents or \
       datetime.utcnow() > task_timeouts[task_id]:
        
        print(f"ЁЯУК Aggregating with {len(task_results[task_id])}/{expected_agents} results")
        
        aggregated = {
            'query': message_data['query'],
            'sources': task_results[task_id],
            'completed_agents': len(task_results[task_id]),
            'timed_out': len(task_results[task_id]) < expected_agents
        }
        
        state_manager.complete_task(task_id, aggregated)
        
        # рд╕рдлрд╛рдИ рдХрд░реЗрдВ
        del task_results[task_id]
        del task_timeouts[task_id]
```

2. **рдХреГрддреНрд░рд┐рдо рд╡рд┐рд▓рдВрдм рдХреЗ рд╕рд╛рде рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ:**

```python
# рдПрдХ рдПрдЬреЗрдВрдЯ рдореЗрдВ рдзреАрдореА рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХреЛ рдЕрдиреБрдХрд░рдг рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП рд╡рд┐рд▓рдВрдм рдЬреЛрдбрд╝реЗрдВ
import time
time.sleep(35)  # 30-рд╕реЗрдХрдВрдб рдХреА рд╕рдордп рд╕реАрдорд╛ рд╕реЗ рдЕрдзрд┐рдХ
```

3. **рддреИрдирд╛рдд рдХрд░реЗрдВ рдФрд░ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░реЗрдВ:**

```bash
azd deploy aggregator

# рдХрд╛рд░реНрдп рд╕рдмрдорд┐рдЯ рдХрд░реЗрдВ
curl -X POST $ORCHESTRATOR_URL/research-parallel \
  -H "Content-Type: application/json" \
  -d '{"query": "AI safety research"}'

# 30 рд╕реЗрдХрдВрдб рдХреЗ рдмрд╛рдж рдкрд░рд┐рдгрд╛рдо рдЬрд╛рдВрдЪреЗрдВ
curl $ORCHESTRATOR_URL/task/$TASK_ID
```

**тЬЕ рд╕рдлрд▓рддрд╛ рдорд╛рдирджрдВрдб:**
- тЬЕ рдХрд╛рд░реНрдп 30 рд╕реЗрдХрдВрдб рдХреЗ рдмрд╛рдж рдкреВрд░рд╛ рд╣реЛрддрд╛ рд╣реИ рднрд▓реЗ рд╣реА рдПрдЬреЗрдВрдЯ рдЕрдзреВрд░рд╛ рд╣реЛ
- тЬЕ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рдЖрдВрд╢рд┐рдХ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдЗрдВрдЧрд┐рдд рдХрд░рддреА рд╣реИ (`"timed_out": true`)
- тЬЕ рдЙрдкрд▓рдмреНрдз рдкрд░рд┐рдгрд╛рдо рд▓реМрдЯрд╛рдП рдЬрд╛рддреЗ рд╣реИрдВ (4 рдореЗрдВ рд╕реЗ 3 рдПрдЬреЗрдВрдЯ)

**рд╕рдордп**: 20-25 рдорд┐рдирдЯ

---

### рдЕрднреНрдпрд╛рд╕ 2: рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рддрд░реНрдХ рд▓рд╛рдЧреВ рдХрд░реЗрдВ тнРтнРтнР (рдЙрдиреНрдирдд)

**рд▓рдХреНрд╖реНрдп**: рд╡рд┐рдлрд▓ рдПрдЬреЗрдВрдЯ рдХрд╛рд░реНрдпреЛрдВ рдХреЛ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдХрд░реЗрдВред

**рдЪрд░рдг**:

1. **рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░ рдореЗрдВ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдЯреНрд░реИрдХрд┐рдВрдЧ рдЬреЛрдбрд╝реЗрдВ:**

```python
from dataclasses import dataclass
from typing import Dict

@dataclass
class RetryConfig:
    max_retries: int = 3
    backoff_seconds: int = 5

retry_counts: Dict[str, int] = {}  # рд╕рдВрджреЗрд╢_рдЖрдИрдбреА -> рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕_рдЧрдгрдирд╛

def send_with_retry(queue_name: str, message_data: dict, retry_config: RetryConfig):
    """Send message with retry metadata"""
    message_id = message_data.get('message_id', str(uuid.uuid4()))
    message_data['message_id'] = message_id
    message_data['retry_count'] = retry_counts.get(message_id, 0)
    message_data['max_retries'] = retry_config.max_retries
    
    sender = servicebus_client.get_queue_sender(queue_name)
    message = ServiceBusMessage(
        body=json.dumps(message_data),
        content_type='application/json',
        message_id=message_id
    )
    
    with sender:
        sender.send_messages(message)
```

2. **рдПрдЬреЗрдВрдЯреНрд╕ рдореЗрдВ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рд╣реИрдВрдбрд▓рд░ рдЬреЛрдбрд╝реЗрдВ:**

```python
def process_with_retry(message, receiver, process_func):
    """Process message with automatic retry on failure"""
    try:
        message_data = json.loads(str(message))
        
        # рд╕рдВрджреЗрд╢ рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░реЗрдВ
        process_func(message_data)
        
        # рд╕рдлрд▓рддрд╛ - рдкреВрд░реНрдг
        receiver.complete_message(message)
        
    except Exception as e:
        message_id = message.message_id
        retry_count = message_data.get('retry_count', 0)
        max_retries = message_data.get('max_retries', 3)
        
        if retry_count < max_retries:
            # рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕: рдЫреЛрдбрд╝реЗрдВ рдФрд░ рдмрдврд╝реА рд╣реБрдИ рдЧрд┐рдирддреА рдХреЗ рд╕рд╛рде рдкреБрдирдГ рдХрддрд╛рд░ рдореЗрдВ рдбрд╛рд▓реЗрдВ
            print(f"тЪая╕П Retry {retry_count + 1}/{max_retries} for message {message_id}")
            
            message_data['retry_count'] = retry_count + 1
            
            # рджреЗрд░реА рдХреЗ рд╕рд╛рде рдЙрд╕реА рдХрддрд╛рд░ рдореЗрдВ рд╡рд╛рдкрд╕ рднреЗрдЬреЗрдВ
            time.sleep(5 * (retry_count + 1))  # рдШрд╛рддрд╛рдВрдХреАрдп рдмреИрдХрдСрдл
            send_with_retry(queue_name, message_data, RetryConfig())
            
            receiver.complete_message(message)  # рдореВрд▓ рдХреЛ рд╣рдЯрд╛рдПрдВ
        else:
            # рдЕрдзрд┐рдХрддрдо рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдкрд╛рд░ рд╣реЛ рдЧрдпрд╛ - рдореГрдд рдкрддреНрд░ рдХрддрд╛рд░ рдореЗрдВ рд╕реНрдерд╛рдирд╛рдВрддрд░рд┐рдд рдХрд░реЗрдВ
            print(f"тЭМ Max retries exceeded for message {message_id}")
            receiver.dead_letter_message(
                message,
                reason="MaxRetriesExceeded",
                error_description=str(e)
            )
```

3. **рдбреЗрдб рд▓реЗрдЯрд░ рдХрддрд╛рд░ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВ:**

```python
def monitor_dead_letters():
    """Check dead letter queue for failed messages"""
    receiver = servicebus_client.get_queue_receiver(
        'research-queue',
        sub_queue='deadletter'
    )
    
    with receiver:
        messages = receiver.receive_messages(max_wait_time=5)
        for message in messages:
            print(f"тШая╕П Dead letter: {message.message_id}")
            print(f"Reason: {message.dead_letter_reason}")
            print(f"Description: {message.dead_letter_error_description}")
```

**тЬЕ рд╕рдлрд▓рддрд╛ рдорд╛рдирджрдВрдб:**
- тЬЕ рд╡рд┐рдлрд▓ рдХрд╛рд░реНрдп рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ (3 рдмрд╛рд░ рддрдХ)
- тЬЕ рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЗ рдмреАрдЪ рдПрдХреНрд╕рдкреЛрдиреЗрдВрд╢рд┐рдпрд▓ рдмреИрдХрдСрдл (5s, 10s, 15s)
- тЬЕ рдЕрдзрд┐рдХрддрдо рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕реЛрдВ рдХреЗ рдмрд╛рдж, рд╕рдВрджреЗрд╢ рдбреЗрдб рд▓реЗрдЯрд░ рдХрддрд╛рд░ рдореЗрдВ рдЬрд╛рддреЗ рд╣реИрдВ
- тЬЕ рдбреЗрдб рд▓реЗрдЯрд░ рдХрддрд╛рд░ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдФрд░ рдкреБрдирдГ рдЪрд▓рд╛рдпрд╛ рдЬрд╛ рд╕рдХрддрд╛ рд╣реИ

**рд╕рдордп**: 30-40 рдорд┐рдирдЯ

---

### рдЕрднреНрдпрд╛рд╕ 3: рд╕рд░реНрдХрд┐рдЯ рдмреНрд░реЗрдХрд░ рд▓рд╛рдЧреВ рдХрд░реЗрдВ тнРтнРтнР (рдЙрдиреНрдирдд)

**рд▓рдХреНрд╖реНрдп**: рд╡рд┐рдлрд▓ рдПрдЬреЗрдВрдЯреЛрдВ рдХреЛ рдЕрдиреБрд░реЛрдз рднреЗрдЬрдиреЗ рд╕реЗ рд░реЛрдХрдХрд░ рдХреИрд╕реНрдХреЗрдбрд┐рдВрдЧ рд╡рд┐рдлрд▓рддрд╛рдУрдВ рдХреЛ рд░реЛрдХреЗрдВред

**рдЪрд░рдг**:

1. **рд╕рд░реНрдХрд┐рдЯ рдмреНрд░реЗрдХрд░ рдХреНрд▓рд╛рд╕ рдмрдирд╛рдПрдВ:**

```python
from enum import Enum
from datetime import datetime, timedelta

class CircuitState(Enum):
    CLOSED = "closed"      # рд╕рд╛рдорд╛рдиреНрдп рд╕рдВрдЪрд╛рд▓рди
    OPEN = "open"          # рд╡рд┐рдлрд▓, рдЕрдиреБрд░реЛрдзреЛрдВ рдХреЛ рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░реЗрдВ
    HALF_OPEN = "half_open"  # рдкрд░реАрдХреНрд╖рдг рдХрд░ рд░рд╣реЗ рд╣реИрдВ рдХрд┐ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рд╣реБрдЖ

class CircuitBreaker:
    def __init__(self, failure_threshold=5, timeout_seconds=60):
        self.failure_threshold = failure_threshold
        self.timeout_seconds = timeout_seconds
        self.failure_count = 0
        self.last_failure_time = None
        self.state = CircuitState.CLOSED
    
    def call(self, func):
        """Execute function with circuit breaker protection"""
        if self.state == CircuitState.OPEN:
            # рдЬрд╛рдВрдЪреЗрдВ рдХрд┐ рд╕рдордп рд╕реАрдорд╛ рд╕рдорд╛рдкреНрдд рд╣реБрдИ
            if datetime.utcnow() - self.last_failure_time > timedelta(seconds=self.timeout_seconds):
                self.state = CircuitState.HALF_OPEN
                print("ЁЯФД Circuit breaker: HALF_OPEN (testing)")
            else:
                raise Exception(f"Circuit breaker OPEN for agent. Try again in {self.timeout_seconds}s")
        
        try:
            result = func()
            
            # рд╕рдлрд▓рддрд╛
            if self.state == CircuitState.HALF_OPEN:
                self.state = CircuitState.CLOSED
                self.failure_count = 0
                print("тЬЕ Circuit breaker: CLOSED (recovered)")
            
            return result
            
        except Exception as e:
            self.failure_count += 1
            self.last_failure_time = datetime.utcnow()
            
            if self.failure_count >= self.failure_threshold:
                self.state = CircuitState.OPEN
                print(f"ЁЯФ┤ Circuit breaker: OPEN (too many failures)")
            
            raise e
```

2. **рдПрдЬреЗрдВрдЯ рдХреЙрд▓реНрд╕ рдкрд░ рд▓рд╛рдЧреВ рдХрд░реЗрдВ:**

```python
# рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░ рдореЗрдВ
agent_circuits = {
    'web': CircuitBreaker(failure_threshold=5, timeout_seconds=60),
    'academic': CircuitBreaker(failure_threshold=5, timeout_seconds=60),
    'news': CircuitBreaker(failure_threshold=5, timeout_seconds=60),
    'social': CircuitBreaker(failure_threshold=5, timeout_seconds=60)
}

def send_to_agent(agent_type, message_data):
    """Send with circuit breaker protection"""
    circuit = agent_circuits[agent_type]
    
    try:
        circuit.call(lambda: send_message(agent_type, message_data))
    except Exception as e:
        print(f"тЪая╕П Skipping {agent_type} agent: {e}")
        # рдЕрдиреНрдп рдПрдЬреЗрдВрдЯреЛрдВ рдХреЗ рд╕рд╛рде рдЬрд╛рд░реА рд░рдЦреЗрдВ
```

3. **рд╕рд░реНрдХрд┐рдЯ рдмреНрд░реЗрдХрд░ рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░реЗрдВ:**

```bash
# рдмрд╛рд░-рдмрд╛рд░ рд╡рд┐рдлрд▓рддрд╛рдУрдВ рдХрд╛ рдЕрдиреБрдХрд░рдг рдХрд░реЗрдВ (рдПрдХ рдПрдЬреЗрдВрдЯ рдХреЛ рд░реЛрдХреЗрдВ)
az containerapp stop --name web-research-agent --resource-group rg-agents

# рдХрдИ рдЕрдиреБрд░реЛрдз рднреЗрдЬреЗрдВ
for i in {1..10}; do
  curl -X POST $ORCHESTRATOR_URL/research-parallel \
    -H "Content-Type: application/json" \
    -d '{"query": "test query '$i'"}'
  sleep 2
done

# рд▓реЙрдЧ рдЬрд╛рдВрдЪреЗрдВ - 5 рд╡рд┐рдлрд▓рддрд╛рдУрдВ рдХреЗ рдмрд╛рдж рд╕рд░реНрдХрд┐рдЯ рдЦреБрд▓рд╛ рд╣реЛрдирд╛ рдЪрд╛рд╣рд┐рдП
azd logs orchestrator --tail 50
```

**тЬЕ рд╕рдлрд▓рддрд╛ рдорд╛рдирджрдВрдб:**
- тЬЕ 5 рд╡рд┐рдлрд▓рддрд╛рдУрдВ рдХреЗ рдмрд╛рдж, рд╕рд░реНрдХрд┐рдЯ рдЦреБрд▓рддрд╛ рд╣реИ (рдЕрдиреБрд░реЛрдз рдЕрд╕реНрд╡реАрдХрд╛рд░ рдХрд░рддрд╛ рд╣реИ)
- тЬЕ 60 рд╕реЗрдХрдВрдб рдХреЗ рдмрд╛рдж, рд╕рд░реНрдХрд┐рдЯ рдЖрдзрд╛-рдЦреБрд▓рд╛ рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ (рд░рд┐рдХрд╡рд░реА рдХрд╛ рдкрд░реАрдХреНрд╖рдг рдХрд░рддрд╛ рд╣реИ)
- тЬЕ рдЕрдиреНрдп рдПрдЬреЗрдВрдЯ рд╕рд╛рдорд╛рдиреНрдп рд░реВрдк рд╕реЗ рдХрд╛рдо рдХрд░рдирд╛ рдЬрд╛рд░реА рд░рдЦрддреЗ рд╣реИрдВ
- тЬЕ рдПрдЬреЗрдВрдЯ рдХреЗ рдареАрдХ рд╣реЛрдиреЗ рдкрд░ рд╕рд░реНрдХрд┐рдЯ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рд░реВрдк рд╕реЗ рдмрдВрдж рд╣реЛ рдЬрд╛рддрд╛ рд╣реИ

**рд╕рдордп**: 40-50 рдорд┐рдирдЯ

---

## рдирд┐рдЧрд░рд╛рдиреА рдФрд░ рдбрд┐рдмрдЧрд┐рдВрдЧ

### рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕ рдХреЗ рд╕рд╛рде рд╡рд┐рддрд░рд┐рдд рдЯреНрд░реЗрд╕рд┐рдВрдЧ

**рдлрд╝рд╛рдЗрд▓: `src/shared/tracing.py`**

```python
from opencensus.ext.azure.log_exporter import AzureLogHandler
from opencensus.ext.azure.trace_exporter import AzureExporter
from opencensus.trace import config_integration
from opencensus.trace.tracer import Tracer
from opencensus.trace.samplers import AlwaysOnSampler
import logging
import os

# рдЯреНрд░реЗрд╕рд┐рдВрдЧ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ
config_integration.trace_integrations(['requests', 'logging'])

connection_string = os.environ.get('APPLICATIONINSIGHTS_CONNECTION_STRING')

# рдЯреНрд░реЗрд╕рд░ рдмрдирд╛рдПрдВ
tracer = Tracer(
    exporter=AzureExporter(connection_string=connection_string),
    sampler=AlwaysOnSampler()
)

# рд▓реЙрдЧрд┐рдВрдЧ рдХреЙрдиреНрдлрд╝рд┐рдЧрд░ рдХрд░реЗрдВ
logger = logging.getLogger(__name__)
logger.addHandler(AzureLogHandler(connection_string=connection_string))
logger.setLevel(logging.INFO)

def trace_agent_call(agent_name, task_id, operation):
    """Trace agent operations"""
    with tracer.span(name=f'{agent_name}.{operation}') as span:
        span.add_attribute('agent', agent_name)
        span.add_attribute('task_id', task_id)
        span.add_attribute('operation', operation)
        
        try:
            result = operation()
            span.add_attribute('status', 'success')
            return result
        except Exception as e:
            span.add_attribute('status', 'error')
            span.add_attribute('error', str(e))
            raise
```

### рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕ рдХреНрд╡реЗрд░реАрдЬрд╝

**рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдЯреНрд░реИрдХ рдХрд░реЗрдВ:**

```kusto
// Trace complete workflow for a task
traces
| where customDimensions.task_id == "a1b2c3d4-..."
| project timestamp, message, customDimensions.agent, customDimensions.operation
| order by timestamp asc
```

**рдПрдЬреЗрдВрдЯ рдкреНрд░рджрд░реНрд╢рди рддреБрд▓рдирд╛:**

```kusto
// Compare agent execution times
dependencies
| where name contains "agent"
| summarize 
    avg_duration = avg(duration),
    p95_duration = percentile(duration, 95),
    count = count()
  by agent = tostring(customDimensions.agent)
| order by avg_duration desc
```

**рд╡рд┐рдлрд▓рддрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

```kusto
// Find which agents fail most
exceptions
| where customDimensions.agent != ""
| summarize 
    failure_count = count(),
    unique_errors = dcount(outerMessage)
  by agent = tostring(customDimensions.agent)
| order by failure_count desc
```

---

## рд▓рд╛рдЧрдд рд╡рд┐рд╢реНрд▓реЗрд╖рдг

### рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рд╕рд┐рд╕реНрдЯрдо рд▓рд╛рдЧрдд (рдорд╛рд╕рд┐рдХ рдЕрдиреБрдорд╛рди)

| рдШрдЯрдХ | рдХреЙрдиреНрдлрд╝рд┐рдЧрд░реЗрд╢рди | рд▓рд╛рдЧрдд |
|-----------|--------------|------|
| **рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░** | 1 рдХрдВрдЯреЗрдирд░ рдРрдк (1 vCPU, 2GB) | $30-50 |
| **4 рдПрдЬреЗрдВрдЯреНрд╕** | 4 рдХрдВрдЯреЗрдирд░ рдРрдкреНрд╕ (0.5 vCPU, 1GB рдкреНрд░рддреНрдпреЗрдХ) | $60-120 |
| **рд╕рд░реНрд╡рд┐рд╕ рдмрд╕** | рдорд╛рдирдХ рд╕реНрддрд░, 10M рд╕рдВрджреЗрд╢ | $10-20 |
| **рдХреЙрд╕рдореЙрд╕ DB** | рд╕рд░реНрд╡рд░рд▓реЗрд╕, 5GB рд╕реНрдЯреЛрд░реЗрдЬ, 1M RUs | $25-50 |
| **рдмреНрд▓реЙрдм рд╕реНрдЯреЛрд░реЗрдЬ** | 10GB рд╕реНрдЯреЛрд░реЗрдЬ, 100K рдСрдкрд░реЗрд╢рдиреНрд╕ | $5-10 |
| **рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕** | 5GB рдЗрдирдЬреЗрд╢рди | $10-15 |
| **Azure OpenAI** | GPT-4, 10M рдЯреЛрдХрдиреНрд╕ | $100-300 |
| **рдХреБрд▓** | | **$240-565/рдорд╛рд╣** |

### рд▓рд╛рдЧрдд рдЕрдиреБрдХреВрд▓рди рд░рдгрдиреАрддрд┐рдпрд╛рдБ

1. **рдЬрд╣рд╛рдБ рд╕рдВрднрд╡ рд╣реЛ, рд╕рд░реНрд╡рд░рд▓реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:**
   ```bicep
   // Cosmos DB serverless (no minimum cost)
   properties: {
     databaseAccountOfferType: 'Standard'
     capabilities: [{ name: 'EnableServerless' }]
   }
   ```

2. **рдПрдЬреЗрдВрдЯреНрд╕ рдХреЛ рдирд┐рд╖реНрдХреНрд░рд┐рдп рд╣реЛрдиреЗ рдкрд░ рд╢реВрдиреНрдп рдкрд░ рд╕реНрдХреЗрд▓ рдХрд░реЗрдВ:**
   ```bicep
   scale: {
     minReplicas: 0  // Scale to zero when no messages
     maxReplicas: 10
   }
   ```

3. **рд╕рд░реНрд╡рд┐рд╕ рдмрд╕ рдХреЗ рд▓рд┐рдП рдмреИрдЪрд┐рдВрдЧ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ:**
   ```python
   # рд╕рдВрджреЗрд╢реЛрдВ рдХреЛ рдмреИрдЪреЛрдВ рдореЗрдВ рднреЗрдЬреЗрдВ (рд╕рд╕реНрддрд╛)
   sender.send_messages([message1, message2, message3])
   ```

4. **рдЕрдХреНрд╕рд░ рдЙрдкрдпреЛрдЧ рдХрд┐рдП рдЬрд╛рдиреЗ рд╡рд╛рд▓реЗ рдкрд░рд┐рдгрд╛рдореЛрдВ рдХреЛ рдХреИрд╢ рдХрд░реЗрдВ:**
   ```python
   # Azure рдХреИрд╢ рдХреЗ рд▓рд┐рдП Redis рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
   if cache.exists(query_hash):
       return cache.get(query_hash)
   ```

---

## рд╕рд░реНрд╡реЛрддреНрддрдо рдкреНрд░рдерд╛рдПрдБ

### тЬЕ рдХрд░реЗрдВ:

1. **рдЗрдбреЗрдордкреЛрдЯреЗрдВрдЯ рдСрдкрд░реЗрд╢рдиреНрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**
   ```python
   # рдПрдЬреЗрдВрдЯ рд╕реБрд░рдХреНрд╖рд┐рдд рд░реВрдк рд╕реЗ рдПрдХ рд╣реА рд╕рдВрджреЗрд╢ рдХреЛ рдХрдИ рдмрд╛рд░ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░ рд╕рдХрддрд╛ рд╣реИ
   def process_task(task_id):
       if state_manager.task_exists(task_id):
           print(f"Task {task_id} already processed, skipping")
           return
       # рдХрд╛рд░реНрдп рдХреЛ рд╕рдВрд╕рд╛рдзрд┐рдд рдХрд░реЗрдВ...
   ```

2. **рд╡реНрдпрд╛рдкрдХ рд▓реЙрдЧрд┐рдВрдЧ рд▓рд╛рдЧреВ рдХрд░реЗрдВ**
   ```python
   logger.info(f"Agent: {agent_name}, Task: {task_id}, Action: {action}")
   ```

3. **рд╕рдВрдмрдВрдз рдЖрдИрдбреА рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ**
   ```python
   # рдкреВрд░реЗ рд╡рд░реНрдХрдлрд╝реНрд▓реЛ рдореЗрдВ task_id рдкрд╛рд╕ рдХрд░реЗрдВ
   message_data = {
       'task_id': task_id,  # рдХреЛрд░рд┐рд▓реЗрд╢рди рдЖрдИрдбреА
       'timestamp': datetime.utcnow().isoformat()
   }
   ```

4. **рд╕рдВрджреЗрд╢ TTL (рдЯрд╛рдЗрдо-рдЯреВ-рд▓рд╛рдЗрд╡) рд╕реЗрдЯ рдХрд░реЗрдВ**
   ```bicep
   properties: {
     defaultMessageTimeToLive: 'PT1H'  // 1 hour max
   }
   ```

5. **рдбреЗрдб рд▓реЗрдЯрд░ рдХрддрд╛рд░реЛрдВ рдХреА рдирд┐рдЧрд░рд╛рдиреА рдХрд░реЗрдВ**
   ```python
   # рдЕрд╕рдлрд▓ рд╕рдВрджреЗрд╢реЛрдВ рдХреА рдирд┐рдпрдорд┐рдд рдирд┐рдЧрд░рд╛рдиреА
   monitor_dead_letters()
   ```

### тЭМ рди рдХрд░реЗрдВ:

1. **рдкрд░рд┐рдкрддреНрд░ рдирд┐рд░реНрднрд░рддрд╛рдПрдБ рди рдмрдирд╛рдПрдВ**
   ```python
   # тЭМ рдЦрд░рд╛рдм: рдПрдЬреЗрдВрдЯ A тЖТ рдПрдЬреЗрдВрдЯ B тЖТ рдПрдЬреЗрдВрдЯ A (рдЕрдирдВрдд рд▓реВрдк)
   # тЬЕ рдЕрдЪреНрдЫрд╛: рд╕реНрдкрд╖реНрдЯ рдирд┐рд░реНрджреЗрд╢рд┐рдд рдПрд╕рд╛рдЗрдХреНрд▓рд┐рдХ рдЧреНрд░рд╛рдл (DAG) рдкрд░рд┐рднрд╛рд╖рд┐рдд рдХрд░реЗрдВ
   ```

2. **рдПрдЬреЗрдВрдЯ рдереНрд░реЗрдбреНрд╕ рдХреЛ рдмреНрд▓реЙрдХ рди рдХрд░реЗрдВ**

## рд╕рдорд╕реНрдпрд╛ рдирд┐рд╡рд╛рд░рдг рдЧрд╛рдЗрдб

### рд╕рдорд╕реНрдпрд╛: рд╕рдВрджреЗрд╢ рдХрддрд╛рд░ рдореЗрдВ рдЕрдЯрдХреЗ рд╣реБрдП рд╣реИрдВ

**рд▓рдХреНрд╖рдг:**
- рд╕рдВрджреЗрд╢ рдХрддрд╛рд░ рдореЗрдВ рдЬрдорд╛ рд╣реЛ рд░рд╣реЗ рд╣реИрдВ
- рдПрдЬреЗрдВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдирд╣реАрдВ рдХрд░ рд░рд╣реЗ рд╣реИрдВ
- рдХрд╛рд░реНрдп рдХреА рд╕реНрдерд┐рддрд┐ "pending" рдкрд░ рдЕрдЯрдХреА рд╣реБрдИ рд╣реИ

**рдирд┐рджрд╛рди:**
```bash
# рдХрддрд╛рд░ рдХреА рдЧрд╣рд░рд╛рдИ рдЬрд╛рдВрдЪреЗрдВ
az servicebus queue show \
  --namespace-name mybus \
  --name research-tasks \
  --query "countDetails"

# рдПрдЬреЗрдВрдЯ рдХреА рд╕реНрдерд┐рддрд┐ рдЬрд╛рдВрдЪреЗрдВ
azd logs research-agent --tail 50
```

**рд╕рдорд╛рдзрд╛рди:**

1. **рдПрдЬреЗрдВрдЯ рдкреНрд░рддрд┐рдХреГрддрд┐рдпреЛрдВ рдХреА рд╕рдВрдЦреНрдпрд╛ рдмрдврд╝рд╛рдПрдВ:**
   ```bash
   az containerapp update \
     --name research-agent \
     --min-replicas 3 \
     --max-replicas 10
   ```

2. **рдбреЗрдб рд▓реЗрдЯрд░ рдХрддрд╛рд░ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:**
   ```bash
   az servicebus queue show \
     --namespace-name mybus \
     --name research-tasks \
     --query "countDetails.deadLetterMessageCount"
   ```

---

### рд╕рдорд╕реНрдпрд╛: рдХрд╛рд░реНрдп рдХрд╛ рдЯрд╛рдЗрдордЖрдЙрдЯ/рдХрднреА рдкреВрд░рд╛ рдирд╣реАрдВ рд╣реЛрддрд╛

**рд▓рдХреНрд╖рдг:**
- рдХрд╛рд░реНрдп рдХреА рд╕реНрдерд┐рддрд┐ "in_progress" рдкрд░ рдмрдиреА рд░рд╣рддреА рд╣реИ
- рдХреБрдЫ рдПрдЬреЗрдВрдЯ рдХрд╛рд░реНрдп рдкреВрд░рд╛ рдХрд░рддреЗ рд╣реИрдВ, рдХреБрдЫ рдирд╣реАрдВ
- рдХреЛрдИ рддреНрд░реБрдЯрд┐ рд╕рдВрджреЗрд╢ рдирд╣реАрдВ

**рдирд┐рджрд╛рди:**
```bash
# рдХрд╛рд░реНрдп рдХреА рд╕реНрдерд┐рддрд┐ рдЬрд╛рдВрдЪреЗрдВ
curl $ORCHESTRATOR_URL/task/$TASK_ID

# рдПрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕ рдЬрд╛рдВрдЪреЗрдВ
# рдХреНрд╡реЗрд░реА рдЪрд▓рд╛рдПрдВ: traces | where customDimensions.task_id == "..."
```

**рд╕рдорд╛рдзрд╛рди:**

1. **рдПрдЧреНрд░реАрдЧреЗрдЯрд░ рдореЗрдВ рдЯрд╛рдЗрдордЖрдЙрдЯ рд▓рд╛рдЧреВ рдХрд░реЗрдВ (рдЕрднреНрдпрд╛рд╕ 1)**

2. **рдПрдЬреЗрдВрдЯ рд╡рд┐рдлрд▓рддрд╛рдУрдВ рдХреА рдЬрд╛рдВрдЪ рдХрд░реЗрдВ:**
   ```bash
   azd logs --follow | grep "ERROR\|FAIL"
   ```

3. **рд╕реБрдирд┐рд╢реНрдЪрд┐рдд рдХрд░реЗрдВ рдХрд┐ рд╕рднреА рдПрдЬреЗрдВрдЯ рдЪрд▓ рд░рд╣реЗ рд╣реИрдВ:**
   ```bash
   az containerapp list \
     --resource-group rg-agents \
     --query "[].{name:name, status:properties.runningStatus}"
   ```

---

## рдЕрдзрд┐рдХ рдЬрд╛рдиреЗрдВ

### рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝
- [Azure Service Bus](https://learn.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview)
- [Cosmos DB](https://learn.microsoft.com/azure/cosmos-db/introduction)
- [Container Apps DAPR](https://learn.microsoft.com/azure/container-apps/dapr-overview)
- [Multi-Agent Design Patterns](https://learn.microsoft.com/azure/architecture/guide/ai/multi-agent-systems)

### рдЗрд╕ рдкрд╛рдареНрдпрдХреНрд░рдо рдореЗрдВ рдЕрдЧрд▓реЗ рдЪрд░рдг
- тЖР рдкрд┐рдЫрд▓рд╛: [рдХреНрд╖рдорддрд╛ рдпреЛрдЬрдирд╛](capacity-planning.md)
- тЖТ рдЕрдЧрд▓рд╛: [SKU рдЪрдпрди](sku-selection.md)
- ЁЯПа [рдкрд╛рдареНрдпрдХреНрд░рдо рд╣реЛрдо](../../README.md)

### рд╕рдВрдмрдВрдзрд┐рдд рдЙрджрд╛рд╣рд░рдг
- [рдорд╛рдЗрдХреНрд░реЛрд╕рд░реНрд╡рд┐рд╕реЗрдЬ рдЙрджрд╛рд╣рд░рдг](../../../../examples/microservices) - рд╕реЗрд╡рд╛ рд╕рдВрдЪрд╛рд░ рдкреИрдЯрд░реНрди
- [Azure OpenAI рдЙрджрд╛рд╣рд░рдг](../../../../examples/azure-openai-chat) - рдПрдЖрдИ рдПрдХреАрдХрд░рдг

---

## рд╕рд╛рд░рд╛рдВрд╢

**рдЖрдкрдиреЗ рд╕реАрдЦрд╛:**
- тЬЕ рдкрд╛рдВрдЪ рд╕рдордиреНрд╡рдп рдкреИрдЯрд░реНрди (рдХреНрд░рдорд┐рдХ, рд╕рдорд╛рдирд╛рдВрддрд░, рдкрджрд╛рдиреБрдХреНрд░рдорд┐рдд, рдШрдЯрдирд╛-рдЪрд╛рд▓рд┐рдд, рд╕рд╣рдорддрд┐)
- тЬЕ Azure рдкрд░ рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ (Service Bus, Cosmos DB, Container Apps)
- тЬЕ рд╡рд┐рддрд░рд┐рдд рдПрдЬреЗрдВрдЯреЛрдВ рдХреЗ рдмреАрдЪ рд░рд╛рдЬреНрдп рдкреНрд░рдмрдВрдзрди
- тЬЕ рдЯрд╛рдЗрдордЖрдЙрдЯ рд╣реИрдВрдбрд▓рд┐рдВрдЧ, рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕, рдФрд░ рд╕рд░реНрдХрд┐рдЯ рдмреНрд░реЗрдХрд░
- тЬЕ рд╡рд┐рддрд░рд┐рдд рд╕рд┐рд╕реНрдЯрдо рдХреА рдирд┐рдЧрд░рд╛рдиреА рдФрд░ рдбрд┐рдмрдЧрд┐рдВрдЧ
- тЬЕ рд▓рд╛рдЧрдд рдЕрдиреБрдХреВрд▓рди рд░рдгрдиреАрддрд┐рдпрд╛рдБ

**рдореБрдЦреНрдп рдмрд╛рддреЗрдВ:**
1. **рд╕рд╣реА рдкреИрдЯрд░реНрди рдЪреБрдиреЗрдВ** - рдХреНрд░рдорд┐рдХ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдХреЗ рд▓рд┐рдП, рд╕рдорд╛рдирд╛рдВрддрд░ рдЧрддрд┐ рдХреЗ рд▓рд┐рдП, рдШрдЯрдирд╛-рдЪрд╛рд▓рд┐рдд рд▓рдЪреАрд▓рд╛рдкрди рдХреЗ рд▓рд┐рдП
2. **рд░рд╛рдЬреНрдп рдХрд╛ рд╕рд╛рд╡рдзрд╛рдиреАрдкреВрд░реНрд╡рдХ рдкреНрд░рдмрдВрдзрди рдХрд░реЗрдВ** - рд╕рд╛рдЭрд╛ рд░рд╛рдЬреНрдп рдХреЗ рд▓рд┐рдП Cosmos DB рдпрд╛ рд╕рдорд╛рди рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ
3. **рд╡рд┐рдлрд▓рддрд╛рдУрдВ рдХреЛ рдХреБрд╢рд▓рддрд╛ рд╕реЗ рд╕рдВрднрд╛рд▓реЗрдВ** - рдЯрд╛рдЗрдордЖрдЙрдЯ, рдкреБрдирдГ рдкреНрд░рдпрд╛рд╕, рд╕рд░реНрдХрд┐рдЯ рдмреНрд░реЗрдХрд░, рдбреЗрдб рд▓реЗрдЯрд░ рдХрддрд╛рд░реЗрдВ
4. **рд╕рдм рдХреБрдЫ рдореЙрдирд┐рдЯрд░ рдХрд░реЗрдВ** - рдбрд┐рд╕реНрдЯреНрд░реАрдмреНрдпреВрдЯреЗрдб рдЯреНрд░реЗрд╕рд┐рдВрдЧ рдбрд┐рдмрдЧрд┐рдВрдЧ рдХреЗ рд▓рд┐рдП рдЖрд╡рд╢реНрдпрдХ рд╣реИ
5. **рд▓рд╛рдЧрдд рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░реЗрдВ** - рд╢реВрдиреНрдп рддрдХ рд╕реНрдХреЗрд▓ рдХрд░реЗрдВ, рд╕рд░реНрд╡рд░рд▓реЗрд╕ рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░реЗрдВ, рдХреИрд╢рд┐рдВрдЧ рд▓рд╛рдЧреВ рдХрд░реЗрдВ

**рдЕрдЧрд▓реЗ рдЪрд░рдг:**
1. рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рдЕрднреНрдпрд╛рд╕ рдкреВрд░рд╛ рдХрд░реЗрдВ
2. рдЕрдкрдиреЗ рдЙрдкрдпреЛрдЧ рдХреЗ рдорд╛рдорд▓реЗ рдХреЗ рд▓рд┐рдП рдорд▓реНрдЯреА-рдПрдЬреЗрдВрдЯ рд╕рд┐рд╕реНрдЯрдо рдмрдирд╛рдПрдВ
3. рдкреНрд░рджрд░реНрд╢рди рдФрд░ рд▓рд╛рдЧрдд рдХреЛ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдиреЗ рдХреЗ рд▓рд┐рдП [SKU рдЪрдпрди](sku-selection.md) рдХрд╛ рдЕрдзреНрдпрдпрди рдХрд░реЗрдВ

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рдпрд╣ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ AI рдЕрдиреБрд╡рд╛рдж рд╕реЗрд╡рд╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рдХрд╛ рдЙрдкрдпреЛрдЧ рдХрд░рдХреЗ рдЕрдиреБрд╡рд╛рджрд┐рдд рдХрд┐рдпрд╛ рдЧрдпрд╛ рд╣реИред рдЬрдмрдХрд┐ рд╣рдо рд╕рдЯреАрдХрддрд╛ рдХреЗ рд▓рд┐рдП рдкреНрд░рдпрд╛рд╕ рдХрд░рддреЗ рд╣реИрдВ, рдХреГрдкрдпрд╛ рдзреНрдпрд╛рди рджреЗрдВ рдХрд┐ рд╕реНрд╡рдЪрд╛рд▓рд┐рдд рдЕрдиреБрд╡рд╛рдж рдореЗрдВ рддреНрд░реБрдЯрд┐рдпрд╛рдВ рдпрд╛ рдЕрд╢реБрджреНрдзрд┐рдпрд╛рдВ рд╣реЛ рд╕рдХрддреА рд╣реИрдВред рдореВрд▓ рднрд╛рд╖рд╛ рдореЗрдВ рджрд╕реНрддрд╛рд╡реЗрдЬрд╝ рдХреЛ рдЖрдзрд┐рдХрд╛рд░рд┐рдХ рд╕реНрд░реЛрдд рдорд╛рдирд╛ рдЬрд╛рдирд╛ рдЪрд╛рд╣рд┐рдПред рдорд╣рддреНрд╡рдкреВрд░реНрдг рдЬрд╛рдирдХрд╛рд░реА рдХреЗ рд▓рд┐рдП, рдкреЗрд╢реЗрд╡рд░ рдорд╛рдирд╡ рдЕрдиреБрд╡рд╛рдж рдХреА рд╕рд┐рдлрд╛рд░рд┐рд╢ рдХреА рдЬрд╛рддреА рд╣реИред рдЗрд╕ рдЕрдиреБрд╡рд╛рдж рдХреЗ рдЙрдкрдпреЛрдЧ рд╕реЗ рдЙрддреНрдкрдиреНрди рдХрд┐рд╕реА рднреА рдЧрд▓рддрдлрд╣рдореА рдпрд╛ рдЧрд▓рдд рд╡реНрдпрд╛рдЦреНрдпрд╛ рдХреЗ рд▓рд┐рдП рд╣рдо рдЙрддреНрддрд░рджрд╛рдпреА рдирд╣реАрдВ рд╣реИрдВред
<!-- CO-OP TRANSLATOR DISCLAIMER END -->