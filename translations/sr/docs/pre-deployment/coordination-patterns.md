# –®–∞–±–ª–æ–Ω–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–µ –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞

‚è±Ô∏è **–ü—Ä–æ—Ü–µ—ö–µ–Ω–æ –≤—Ä–µ–º–µ**: 60-75 –º–∏–Ω—É—Ç–∞ | üí∞ **–ü—Ä–æ—Ü–µ—ö–µ–Ω–∏ —Ç—Ä–æ—à–∞–∫**: ~$100-300/–º–µ—Å–µ—á–Ω–æ | ‚≠ê **–ö–æ–º–ø–ª–µ–∫—Å–Ω–æ—Å—Ç**: –ù–∞–ø—Ä–µ–¥–Ω–æ

**üìö –ü—É—Ç —É—á–µ—ö–∞:**
- ‚Üê –ü—Ä–µ—Ç—Ö–æ–¥–Ω–æ: [–ü–ª–∞–Ω–∏—Ä–∞—ö–µ –∫–∞–ø–∞—Ü–∏—Ç–µ—Ç–∞](capacity-planning.md) - –°—Ç—Ä–∞—Ç–µ–≥–∏—ò–µ –∑–∞ –æ–¥—Ä–µ—í–∏–≤–∞—ö–µ —Ä–µ—Å—É—Ä—Å–∞ –∏ —Å–∫–∞–ª–∏—Ä–∞—ö–µ
- üéØ **–û–≤–¥–µ —Å—Ç–µ**: –®–∞–±–ª–æ–Ω–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–µ –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞ (–û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—ò–∞, –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—ò–∞, —É–ø—Ä–∞–≤—ô–∞—ö–µ —Å—Ç–∞—ö–µ–º)
- ‚Üí –°–ª–µ–¥–µ—õ–µ: [–ò–∑–±–æ—Ä SKU](sku-selection.md) - –û–¥–∞–±–∏—Ä –ø—Ä–∞–≤–∏—Ö Azure —É—Å–ª—É–≥–∞
- üè† [–ü–æ—á–µ—Ç–Ω–∞ —Å—Ç—Ä–∞–Ω–∞ –∫—É—Ä—Å–∞](../../README.md)

---

## –®—Ç–∞ —õ–µ—Ç–µ –Ω–∞—É—á–∏—Ç–∏

–ó–∞–≤—Ä—à–µ—Ç–∫–æ–º –æ–≤–µ –ª–µ–∫—Ü–∏—ò–µ, –Ω–∞—É—á–∏—õ–µ—Ç–µ:
- –†–∞–∑—É–º–µ–≤–∞—ö–µ **–∞—Ä—Ö–∏—Ç–µ–∫—Ç–æ–Ω—Å–∫–∏—Ö —à–∞–±–ª–æ–Ω–∞ –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞** –∏ –∫–∞–¥–∞ –∏—Ö –∫–æ—Ä–∏—Å—Ç–∏—Ç–∏
- –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò—É **—à–∞–±–ª–æ–Ω–∞ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—ò–µ** (—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–∞, –¥–µ—Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–∞, —Ö–∏—ò–µ—Ä–∞—Ä—Ö–∏—ò—Å–∫–∞)
- –î–∏–∑–∞—ò–Ω —Å—Ç—Ä–∞—Ç–µ–≥–∏—ò–∞ **–∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—ò–µ –∞–≥–µ–Ω–∞—Ç–∞** (—Å–∏–Ω—Ö—Ä–æ–Ω–∞, –∞—Å–∏–Ω—Ö—Ä–æ–Ω–∞, –∑–∞—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –¥–æ–≥–∞—í–∞—ò–∏–º–∞)
- –£–ø—Ä–∞–≤—ô–∞—ö–µ **–∑–∞—ò–µ–¥–Ω–∏—á–∫–∏–º —Å—Ç–∞—ö–µ–º** –º–µ—í—É –¥–∏—Å—Ç—Ä–∏–±—É–∏—Ä–∞–Ω–∏–º –∞–≥–µ–Ω—Ç–∏–º–∞
- –î–µ–ø–ª–æ—ò–æ–≤–∞—ö–µ **—Å–∏—Å—Ç–µ–º–∞ –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞** –Ω–∞ Azure —É–∑ AZD
- –ü—Ä–∏–º–µ–Ω–∞ **—à–∞–±–ª–æ–Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–µ** –∑–∞ —Ä–µ–∞–ª–Ω–µ AI —Å—Ü–µ–Ω–∞—Ä–∏—ò–µ
- –ü—Ä–∞—õ–µ—ö–µ –∏ –æ—Ç–∫–ª–∞—ö–∞—ö–µ –≥—Ä–µ—à–∞–∫–∞ —É –¥–∏—Å—Ç—Ä–∏–±—É–∏—Ä–∞–Ω–∏–º —Å–∏—Å—Ç–µ–º–∏–º–∞ –∞–≥–µ–Ω–∞—Ç–∞

## –ó–∞—à—Ç–æ —ò–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–∞ –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞ –≤–∞–∂–Ω–∞

### –ï–≤–æ–ª—É—Ü–∏—ò–∞: –û–¥ —ò–µ–¥–Ω–æ–≥ –∞–≥–µ–Ω—Ç–∞ –¥–æ –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞

**–à–µ–¥–∞–Ω –∞–≥–µ–Ω—Ç (–à–µ–¥–Ω–æ—Å—Ç–∞–≤–Ω–æ):**
```
User ‚Üí Agent ‚Üí Response
```
- ‚úÖ –õ–∞–∫–æ –∑–∞ —Ä–∞–∑—É–º–µ–≤–∞—ö–µ –∏ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò—É
- ‚úÖ –ë—Ä–∑–æ –∑–∞ —ò–µ–¥–Ω–æ—Å—Ç–∞–≤–Ω–µ –∑–∞–¥–∞—Ç–∫–µ
- ‚ùå –û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏–º–∞ —ò–µ–¥–Ω–æ–≥ –º–æ–¥–µ–ª–∞
- ‚ùå –ù–µ –º–æ–∂–µ –ø–∞—Ä–∞–ª–µ–ª–∏–∑–æ–≤–∞—Ç–∏ —Å–ª–æ–∂–µ–Ω–µ –∑–∞–¥–∞—Ç–∫–µ
- ‚ùå –ù–µ–º–∞ —Å–ø–µ—Ü–∏—ò–∞–ª–∏–∑–∞—Ü–∏—ò–µ

**–°–∏—Å—Ç–µ–º –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞ (–ù–∞–ø—Ä–µ–¥–Ω–æ):**
```
           ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
           ‚îÇ Orchestrator‚îÇ
           ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îº‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ         ‚îÇ         ‚îÇ
    ‚îå‚îÄ‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îê  ‚îå‚îÄ‚îÄ‚ñº‚îÄ‚îÄ‚îÄ‚îÄ‚îê
    ‚îÇAgent1‚îÇ  ‚îÇAgent2‚îÇ  ‚îÇAgent3 ‚îÇ
    ‚îÇ(Plan)‚îÇ  ‚îÇ(Code)‚îÇ  ‚îÇ(Review)‚îÇ
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò  ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```
- ‚úÖ –°–ø–µ—Ü–∏—ò–∞–ª–∏–∑–æ–≤–∞–Ω–∏ –∞–≥–µ–Ω—Ç–∏ –∑–∞ –æ–¥—Ä–µ—í–µ–Ω–µ –∑–∞–¥–∞—Ç–∫–µ
- ‚úÖ –ü–∞—Ä–∞–ª–µ–ª–Ω–æ –∏–∑–≤—Ä—à–∞–≤–∞—ö–µ –∑–∞ –±—Ä–∑–∏–Ω—É
- ‚úÖ –ú–æ–¥—É–ª–∞—Ä–Ω–æ –∏ –ª–∞–∫–æ –∑–∞ –æ–¥—Ä–∂–∞–≤–∞—ö–µ
- ‚úÖ –ë–æ—ô–µ –∑–∞ —Å–ª–æ–∂–µ–Ω–µ —Ä–∞–¥–Ω–µ —Ç–æ–∫–æ–≤–µ
- ‚ö†Ô∏è –ó–∞—Ö—Ç–µ–≤–∞ –ª–æ–≥–∏–∫—É –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–µ

**–ê–Ω–∞–ª–æ–≥–∏—ò–∞**: –à–µ–¥–∞–Ω –∞–≥–µ–Ω—Ç —ò–µ –∫–∞–æ —ò–µ–¥–Ω–∞ –æ—Å–æ–±–∞ –∫–æ—ò–∞ —Ä–∞–¥–∏ —Å–≤–µ –∑–∞–¥–∞—Ç–∫–µ. –°–∏—Å—Ç–µ–º –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞ —ò–µ –∫–∞–æ —Ç–∏–º –≥–¥–µ —Å–≤–∞–∫–∏ —á–ª–∞–Ω –∏–º–∞ —Å–ø–µ—Ü–∏—ò–∞–ª–∏–∑–æ–≤–∞–Ω–µ –≤–µ—à—Ç–∏–Ω–µ (–∏—Å—Ç—Ä–∞–∂–∏–≤–∞—á, –ø—Ä–æ–≥—Ä–∞–º–µ—Ä, —Ä–µ—Ü–µ–Ω–∑–µ–Ω—Ç, –ø–∏—Å–∞—Ü) –∏ —Ä–∞–¥–∏ –∑–∞—ò–µ–¥–Ω–æ.

---

## –û—Å–Ω–æ–≤–Ω–∏ —à–∞–±–ª–æ–Ω–∏ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–µ

### –®–∞–±–ª–æ–Ω 1: –°–µ–∫–≤–µ–Ω—Ü–∏—ò–∞–ª–Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–∞ (–õ–∞–Ω–∞—Ü –æ–¥–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç–∏)

**–ö–∞–¥–∞ –∫–æ—Ä–∏—Å—Ç–∏—Ç–∏**: –ó–∞–¥–∞—Ü–∏ –º–æ—Ä–∞—ò—É –±–∏—Ç–∏ –∑–∞–≤—Ä—à–µ–Ω–∏ —É –æ–¥—Ä–µ—í–µ–Ω–æ–º —Ä–µ–¥–æ—Å–ª–µ–¥—É, —Å–≤–∞–∫–∏ –∞–≥–µ–Ω—Ç –≥—Ä–∞–¥–∏ –Ω–∞ –ø—Ä–µ—Ç—Ö–æ–¥–Ω–æ–º –∏–∑–ª–∞–∑—É.

```mermaid
sequenceDiagram
    participant User
    participant Orchestrator
    participant Agent1 as –ò—Å—Ç—Ä–∞–∂–∏–≤–∞—á–∫–∏ –∞–≥–µ–Ω—Ç
    participant Agent2 as –ü–∏—Å–∞—Ü –∞–≥–µ–Ω—Ç
    participant Agent3 as –£—Ä–µ–¥–Ω–∏–∫ –∞–≥–µ–Ω—Ç
    
    User->>Orchestrator: "–ù–∞–ø–∏—à–∏ —á–ª–∞–Ω–∞–∫ –æ –≤–µ—à—Ç–∞—á–∫–æ—ò –∏–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ü–∏—ò–∏"
    Orchestrator->>Agent1: –ò—Å—Ç—Ä–∞–∂–∏ —Ç–µ–º—É
    Agent1-->>Orchestrator: –†–µ–∑—É–ª—Ç–∞—Ç–∏ –∏—Å—Ç—Ä–∞–∂–∏–≤–∞—ö–∞
    Orchestrator->>Agent2: –ù–∞–ø–∏—à–∏ –Ω–∞—Ü—Ä—Ç (–∫–æ—Ä–∏—Å—Ç–µ—õ–∏ –∏—Å—Ç—Ä–∞–∂–∏–≤–∞—ö–µ)
    Agent2-->>Orchestrator: –ù–∞—Ü—Ä—Ç —á–ª–∞–Ω–∫–∞
    Orchestrator->>Agent3: –£—Ä–µ–¥–∏ –∏ –ø–æ–±–æ—ô—à–∞—ò
    Agent3-->>Orchestrator: –ö–æ–Ω–∞—á–∞–Ω —á–ª–∞–Ω–∞–∫
    Orchestrator-->>User: –£—Ä–µ—í–µ–Ω —á–ª–∞–Ω–∞–∫
    
    Note over User,Agent3: –°–µ–∫–≤–µ–Ω—Ü–∏—ò–∞–ª–Ω–æ: –°–≤–∞–∫–∏ –∫–æ—Ä–∞–∫ —á–µ–∫–∞ –ø—Ä–µ—Ç—Ö–æ–¥–Ω–∏
```
**–ü—Ä–µ–¥–Ω–æ—Å—Ç–∏:**
- ‚úÖ –à–∞—Å–∞–Ω —Ç–æ–∫ –ø–æ–¥–∞—Ç–∞–∫–∞
- ‚úÖ –õ–∞–∫–æ –∑–∞ –æ—Ç–∫–ª–∞—ö–∞—ö–µ –≥—Ä–µ—à–∞–∫–∞
- ‚úÖ –ü—Ä–µ–¥–≤–∏–¥—ô–∏–≤ —Ä–µ–¥–æ—Å–ª–µ–¥ –∏–∑–≤—Ä—à–∞–≤–∞—ö–∞

**–û–≥—Ä–∞–Ω–∏—á–µ—ö–∞:**
- ‚ùå –°–ø–æ—Ä–∏—ò–µ (–Ω–µ–º–∞ –ø–∞—Ä–∞–ª–µ–ª–∏–∑–º–∞)
- ‚ùå –à–µ–¥–∞–Ω –Ω–µ—É—Å–ø–µ—Ö –±–ª–æ–∫–∏—Ä–∞ —Ü–µ–æ –ª–∞–Ω–∞—Ü
- ‚ùå –ù–µ –º–æ–∂–µ –æ–±—Ä–∞–¥–∏—Ç–∏ –º–µ—í—É–∑–∞–≤–∏—Å–Ω–µ –∑–∞–¥–∞—Ç–∫–µ

**–ü—Ä–∏–º–µ—Ä–∏ —É–ø–æ—Ç—Ä–µ–±–µ:**
- –†–∞–¥–Ω–∏ —Ç–æ–∫ –∑–∞ –∫—Ä–µ–∏—Ä–∞—ö–µ —Å–∞–¥—Ä–∂–∞—ò–∞ (–∏—Å—Ç—Ä–∞–∂–∏–≤–∞—ö–µ ‚Üí –ø–∏—Å–∞—ö–µ ‚Üí —É—Ä–µ—í–∏–≤–∞—ö–µ ‚Üí –æ–±—ò–∞–≤—ô–∏–≤–∞—ö–µ)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—ò–∞ –∫–æ–¥–∞ (–ø–ª–∞–Ω–∏—Ä–∞—ö–µ ‚Üí –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò–∞ ‚Üí —Ç–µ—Å—Ç–∏—Ä–∞—ö–µ ‚Üí –¥–µ–ø–ª–æ—ò–æ–≤–∞—ö–µ)
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—ò–∞ –∏–∑–≤–µ—à—Ç–∞—ò–∞ (–ø—Ä–∏–∫—É–ø—ô–∞—ö–µ –ø–æ–¥–∞—Ç–∞–∫–∞ ‚Üí –∞–Ω–∞–ª–∏–∑–∞ ‚Üí –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—ò–∞ ‚Üí —Ä–µ–∑–∏–º–µ)

---

### –®–∞–±–ª–æ–Ω 2: –ü–∞—Ä–∞–ª–µ–ª–Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–∞ (Fan-Out/Fan-In)

**–ö–∞–¥–∞ –∫–æ—Ä–∏—Å—Ç–∏—Ç–∏**: –ù–µ–∑–∞–≤–∏—Å–Ω–∏ –∑–∞–¥–∞—Ü–∏ –º–æ–≥—É —Å–µ –∏–∑–≤—Ä—à–∞–≤–∞—Ç–∏ –∏—Å—Ç–æ–≤—Ä–µ–º–µ–Ω–æ, —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ —Å–µ –∫–æ–º–±–∏–Ω—É—ò—É –Ω–∞ –∫—Ä–∞—ò—É.

```mermaid
graph TB
    User[–ö–æ—Ä–∏—Å–Ω–∏—á–∫–∏ –ó–∞—Ö—Ç–µ–≤]
    Orchestrator[–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä]
    Agent1[–ê–Ω–∞–ª–∏—Ç–∏—á–∫–∏ –ê–≥–µ–Ω—Å]
    Agent2[–ò—Å—Ç—Ä–∞–∂–∏–≤–∞—á–∫–∏ –ê–≥–µ–Ω—Å]
    Agent3[–ê–≥–µ–Ω—Å –∑–∞ –ü–æ–¥–∞—Ü–∏]
    Aggregator[–ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –†–µ–∑—É–ª—Ç–∞—Ç–∞]
    Response[–ö–æ–º–±–∏–Ω–æ–≤–∞–Ω–∏ –û–¥–≥–æ–≤–æ—Ä]
    
    User --> Orchestrator
    Orchestrator --> Agent1
    Orchestrator --> Agent2
    Orchestrator --> Agent3
    Agent1 --> Aggregator
    Agent2 --> Aggregator
    Agent3 --> Aggregator
    Aggregator --> Response
    
    style Orchestrator fill:#2196F3,stroke:#1976D2,stroke-width:3px,color:#fff
    style Aggregator fill:#4CAF50,stroke:#388E3C,stroke-width:3px,color:#fff
```
**–ü—Ä–µ–¥–Ω–æ—Å—Ç–∏:**
- ‚úÖ –ë—Ä–∑–æ (–ø–∞—Ä–∞–ª–µ–ª–Ω–æ –∏–∑–≤—Ä—à–∞–≤–∞—ö–µ)
- ‚úÖ –û—Ç–ø–æ—Ä–Ω–æ –Ω–∞ –≥—Ä–µ—à–∫–µ (–¥–µ–ª–∏–º–∏—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ —Å—É –ø—Ä–∏—Ö–≤–∞—Ç—ô–∏–≤–∏)
- ‚úÖ –•–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª–Ω–æ —Å–∫–∞–ª–∞–±–∏–ª–Ω–æ

**–û–≥—Ä–∞–Ω–∏—á–µ—ö–∞:**
- ‚ö†Ô∏è –†–µ–∑—É–ª—Ç–∞—Ç–∏ –º–æ–≥—É —Å—Ç–∏—õ–∏ –≤–∞–Ω —Ä–µ–¥–∞
- ‚ö†Ô∏è –ü–æ—Ç—Ä–µ–±–Ω–∞ –ª–æ–≥–∏–∫–∞ –∑–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—ò—É
- ‚ö†Ô∏è –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ —É–ø—Ä–∞–≤—ô–∞—ö–µ —Å—Ç–∞—ö–µ–º

**–ü—Ä–∏–º–µ—Ä–∏ —É–ø–æ—Ç—Ä–µ–±–µ:**
- –ü—Ä–∏–∫—É–ø—ô–∞—ö–µ –ø–æ–¥–∞—Ç–∞–∫–∞ –∏–∑ –≤–∏—à–µ –∏–∑–≤–æ—Ä–∞ (API-—ò–∏ + –±–∞–∑–µ –ø–æ–¥–∞—Ç–∞–∫–∞ + –≤–µ–± —Å–∫—Ä–µ–ø–∏–Ω–≥)
- –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–∞ –∞–Ω–∞–ª–∏–∑–∞ (–≤–∏—à–µ –º–æ–¥–µ–ª–∞ –≥–µ–Ω–µ—Ä–∏—à–µ —Ä–µ—à–µ—ö–∞, –Ω–∞—ò–±–æ—ô–µ —Å–µ –±–∏—Ä–∞)
- –£—Å–ª—É–≥–µ –ø—Ä–µ–≤–æ—í–µ—ö–∞ (–ø—Ä–µ–≤–æ—í–µ—ö–µ –Ω–∞ –≤–∏—à–µ —ò–µ–∑–∏–∫–∞ –∏—Å—Ç–æ–≤—Ä–µ–º–µ–Ω–æ)

---

### –®–∞–±–ª–æ–Ω 3: –•–∏—ò–µ—Ä–∞—Ä—Ö–∏—ò—Å–∫–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–∞ (–ú–µ–Ω–∞—ü–µ—Ä-–†–∞–¥–Ω–∏–∫)

**–ö–∞–¥–∞ –∫–æ—Ä–∏—Å—Ç–∏—Ç–∏**: –°–ª–æ–∂–µ–Ω–∏ —Ä–∞–¥–Ω–∏ —Ç–æ–∫–æ–≤–∏ —Å–∞ –ø–æ–¥–∑–∞–¥–∞—Ç—Ü–∏–º–∞, –ø–æ—Ç—Ä–µ–±–Ω–∞ –¥–µ–ª–µ–≥–∞—Ü–∏—ò–∞.

```mermaid
graph TB
    Master[–ì–ª–∞–≤–Ω–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä]
    Manager1[–ú–µ–Ω–∞—ü–µ—Ä –∏—Å—Ç—Ä–∞–∂–∏–≤–∞—ö–∞]
    Manager2[–ú–µ–Ω–∞—ü–µ—Ä —Å–∞–¥—Ä–∂–∞—ò–∞]
    W1[–í–µ–± —Å–∫—Ä–µ–ø–µ—Ä]
    W2[–ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä —Ä–∞–¥–æ–≤–∞]
    W3[–ü–∏—Å–∞—Ü]
    W4[–£—Ä–µ–¥–Ω–∏–∫]
    
    Master --> Manager1
    Master --> Manager2
    Manager1 --> W1
    Manager1 --> W2
    Manager2 --> W3
    Manager2 --> W4
    
    style Master fill:#FF9800,stroke:#F57C00,stroke-width:3px,color:#fff
    style Manager1 fill:#2196F3,stroke:#1976D2,stroke-width:2px,color:#fff
    style Manager2 fill:#2196F3,stroke:#1976D2,stroke-width:2px,color:#fff
```
**–ü—Ä–µ–¥–Ω–æ—Å—Ç–∏:**
- ‚úÖ –û–±—Ä–∞—í—É—ò–µ —Å–ª–æ–∂–µ–Ω–µ —Ä–∞–¥–Ω–µ —Ç–æ–∫–æ–≤–µ
- ‚úÖ –ú–æ–¥—É–ª–∞—Ä–Ω–æ –∏ –ª–∞–∫–æ –∑–∞ –æ–¥—Ä–∂–∞–≤–∞—ö–µ
- ‚úÖ –à–∞—Å–Ω–µ –≥—Ä–∞–Ω–∏—Ü–µ –æ–¥–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç–∏

**–û–≥—Ä–∞–Ω–∏—á–µ—ö–∞:**
- ‚ö†Ô∏è –ö–æ–º–ø–ª–µ–∫—Å–Ω–∏—ò–∞ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- ‚ö†Ô∏è –í–µ—õ–∞ –ª–∞—Ç–µ–Ω—Ü–∏—ò–∞ (–≤–∏—à–µ —Å–ª–æ—ò–µ–≤–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–µ)
- ‚ö†Ô∏è –ó–∞—Ö—Ç–µ–≤–∞ —Å–æ—Ñ–∏—Å—Ç–∏—Ü–∏—Ä–∞–Ω—É –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—ò—É

**–ü—Ä–∏–º–µ—Ä–∏ —É–ø–æ—Ç—Ä–µ–±–µ:**
- –û–±—Ä–∞–¥–∞ –¥–æ–∫—É–º–µ–Ω–∞—Ç–∞ —É –ø—Ä–µ–¥—É–∑–µ—õ—É (–∫–ª–∞—Å–∏—Ñ–∏–∫–∞—Ü–∏—ò–∞ ‚Üí —Ä—É—Ç–∏—Ä–∞—ö–µ ‚Üí –æ–±—Ä–∞–¥–∞ ‚Üí –∞—Ä—Ö–∏–≤–∏—Ä–∞—ö–µ)
- –í–∏—à–µ—Å—Ç–µ–ø–µ–Ω–∏ —Ç–æ–∫–æ–≤–∏ –ø–æ–¥–∞—Ç–∞–∫–∞ (–ø—Ä–∏–∫—É–ø—ô–∞—ö–µ ‚Üí —á–∏—à—õ–µ—ö–µ ‚Üí —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏—ò–∞ ‚Üí –∞–Ω–∞–ª–∏–∑–∞ ‚Üí –∏–∑–≤–µ—à—Ç–∞—ò)
- –°–ª–æ–∂–µ–Ω–∏ —Ä–∞–¥–Ω–∏ —Ç–æ–∫–æ–≤–∏ –∞—É—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—ò–µ (–ø–ª–∞–Ω–∏—Ä–∞—ö–µ ‚Üí –∞–ª–æ–∫–∞—Ü–∏—ò–∞ —Ä–µ—Å—É—Ä—Å–∞ ‚Üí –∏–∑–≤—Ä—à–µ—ö–µ ‚Üí –ø—Ä–∞—õ–µ—ö–µ)

---

### –®–∞–±–ª–æ–Ω 4: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–∞ –∑–∞—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –¥–æ–≥–∞—í–∞—ò–∏–º–∞ (Publish-Subscribe)

**–ö–∞–¥–∞ –∫–æ—Ä–∏—Å—Ç–∏—Ç–∏**: –ê–≥–µ–Ω—Ç–∏ —Ç—Ä–µ–±–∞ –¥–∞ —Ä–µ–∞–≥—É—ò—É –Ω–∞ –¥–æ–≥–∞—í–∞—ò–µ, –ø–æ–∂–µ—ô–Ω–æ —ò–µ —Å–ª–∞–±–æ –ø–æ–≤–µ–∑–∏–≤–∞—ö–µ.

```mermaid
sequenceDiagram
    participant Agent1 as –ü—Ä–∏–∫—É–ø—ô–∞—á –ø–æ–¥–∞—Ç–∞–∫–∞
    participant EventBus as Azure Service Bus
    participant Agent2 as –ê–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä
    participant Agent3 as –û–±–∞–≤–µ—à—Ç–∞–≤–∞—á
    participant Agent4 as –ê—Ä—Ö–∏–≤–∞—Ç–æ—Ä
    
    Agent1->>EventBus: –û–±—ò–∞–≤–∏ –¥–æ–≥–∞—í–∞—ò "–ü—Ä–∏–º—ô–µ–Ω–∏–ü–æ–¥–∞—Ü–∏"
    EventBus->>Agent2: –ü—Ä–µ—Ç–ø–ª–∞—Ç–∞: –ê–Ω–∞–ª–∏–∑–∏—Ä–∞—ò –ø–æ–¥–∞—Ç–∫–µ
    EventBus->>Agent3: –ü—Ä–µ—Ç–ø–ª–∞—Ç–∞: –ü–æ—à–∞—ô–∏ –æ–±–∞–≤–µ—à—Ç–µ—ö–µ
    EventBus->>Agent4: –ü—Ä–µ—Ç–ø–ª–∞—Ç–∞: –ê—Ä—Ö–∏–≤–∏—Ä–∞—ò –ø–æ–¥–∞—Ç–∫–µ
    
    Note over Agent1,Agent4: –°–≤–∏ –ø—Ä–µ—Ç–ø–ª–∞—Ç–Ω–∏—Ü–∏ –æ–±—Ä–∞—í—É—ò—É –Ω–µ–∑–∞–≤–∏—Å–Ω–æ
    
    Agent2->>EventBus: –û–±—ò–∞–≤–∏ –¥–æ–≥–∞—í–∞—ò "–ê–Ω–∞–ª–∏–∑–∞–ó–∞–≤—Ä—à–µ–Ω–∞"
    EventBus->>Agent3: –ü—Ä–µ—Ç–ø–ª–∞—Ç–∞: –ü–æ—à–∞—ô–∏ –∏–∑–≤–µ—à—Ç–∞—ò –∞–Ω–∞–ª–∏–∑–µ
```
**–ü—Ä–µ–¥–Ω–æ—Å—Ç–∏:**
- ‚úÖ –°–ª–∞–±–æ –ø–æ–≤–µ–∑–∏–≤–∞—ö–µ –∏–∑–º–µ—í—É –∞–≥–µ–Ω–∞—Ç–∞
- ‚úÖ –õ–∞–∫–æ –¥–æ–¥–∞–≤–∞—ö–µ –Ω–æ–≤–∏—Ö –∞–≥–µ–Ω–∞—Ç–∞ (—Å–∞–º–æ —Å–µ –ø—Ä–µ—Ç–ø–ª–∞—Ç–µ)
- ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–∞ –æ–±—Ä–∞–¥–∞
- ‚úÖ –û—Ç–ø–æ—Ä–Ω–æ (–ø–µ—Ä–∑–∏—Å—Ç–µ–Ω—Ü–∏—ò–∞ –ø–æ—Ä—É–∫–∞)

**–û–≥—Ä–∞–Ω–∏—á–µ—ö–∞:**
- ‚ö†Ô∏è –ö–æ–Ω–∑–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç –Ω–∞ –∫—Ä–∞—ò—É
- ‚ö†Ô∏è –ö–æ–º–ø–ª–µ–∫—Å–Ω–æ –æ—Ç–∫–ª–∞—ö–∞—ö–µ –≥—Ä–µ—à–∞–∫–∞
- ‚ö†Ô∏è –ò–∑–∞–∑–æ–≤–∏ —É —Ä–µ–¥–æ—Å–ª–µ–¥—É –ø–æ—Ä—É–∫–∞

**–ü—Ä–∏–º–µ—Ä–∏ —É–ø–æ—Ç—Ä–µ–±–µ:**
- –°–∏—Å—Ç–µ–º–∏ –∑–∞ –ø—Ä–∞—õ–µ—ö–µ —É —Ä–µ–∞–ª–Ω–æ–º –≤—Ä–µ–º–µ–Ω—É (—É–ø–æ–∑–æ—Ä–µ—ö–∞, –∫–æ–Ω—Ç—Ä–æ–ª–Ω–µ —Ç–∞–±–ª–µ, –ª–æ–≥–æ–≤–∏)
- –û–±–∞–≤–µ—à—Ç–µ—ö–∞ –Ω–∞ –≤–∏—à–µ –∫–∞–Ω–∞–ª–∞ (–µ-–ø–æ—à—Ç–∞, SMS, push, Slack)
- –¢–æ–∫–æ–≤–∏ –æ–±—Ä–∞–¥–µ –ø–æ–¥–∞—Ç–∞–∫–∞ (–≤–∏—à–µ –ø–æ—Ç—Ä–æ—à–∞—á–∞ –∏—Å—Ç–∏—Ö –ø–æ–¥–∞—Ç–∞–∫–∞)

---

### –®–∞–±–ª–æ–Ω 5: –ö–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–∞ –∑–∞—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∫–æ–Ω—Å–µ–Ω–∑—É—Å—É (–ì–ª–∞—Å–∞—ö–µ/–ö–≤–æ—Ä—É–º)

**–ö–∞–¥–∞ –∫–æ—Ä–∏—Å—Ç–∏—Ç–∏**: –ü–æ—Ç—Ä–µ–±–∞–Ω —ò–µ –¥–æ–≥–æ–≤–æ—Ä –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞ –ø—Ä–µ –Ω–∞—Å—Ç–∞–≤–∫–∞.

```mermaid
graph TB
    Input[–£–Ω–æ—Å –ó–∞–¥–∞—Ç–∫–∞]
    Agent1[–ê–≥–µ–Ω—Ç 1: GPT-4]
    Agent2[–ê–≥–µ–Ω—Ç 2: Claude]
    Agent3[–ê–≥–µ–Ω—Ç 3: Gemini]
    Voter[–ö–æ–Ω—Å–µ–Ω–∑—É—Å –ì–ª–∞—Å–∞—á]
    Output[–°–∞–≥–ª–∞—Å–∞–Ω –ò–∑–ª–∞–∑]
    
    Input --> Agent1
    Input --> Agent2
    Input --> Agent3
    Agent1 --> Voter
    Agent2 --> Voter
    Agent3 --> Voter
    Voter --> Output
    
    style Voter fill:#9C27B0,stroke:#7B1FA2,stroke-width:3px,color:#fff
```
**–ü—Ä–µ–¥–Ω–æ—Å—Ç–∏:**
- ‚úÖ –í–µ—õ–∞ —Ç–∞—á–Ω–æ—Å—Ç (–≤–∏—à–µ –º–∏—à—ô–µ—ö–∞)
- ‚úÖ –û—Ç–ø–æ—Ä–Ω–æ –Ω–∞ –≥—Ä–µ—à–∫–µ (–ø—Ä–∏—Ö–≤–∞—Ç—ô–∏–≤–∏ –º–∞—ö–∏–Ω—Å–∫–∏ –Ω–µ—É—Å–ø–µ—Å–∏)
- ‚úÖ –£–≥—Ä–∞—í–µ–Ω–æ –æ—Å–∏–≥—É—Ä–∞—ö–µ –∫–≤–∞–ª–∏—Ç–µ—Ç–∞

**–û–≥—Ä–∞–Ω–∏—á–µ—ö–∞:**
- ‚ùå –°–∫—É–ø–æ (–≤–∏—à–µ –ø–æ–∑–∏–≤–∞ –º–æ–¥–µ–ª–∞)
- ‚ùå –°–ø–æ—Ä–∏—ò–µ (—á–µ–∫–∞—ö–µ —Å–≤–∏—Ö –∞–≥–µ–Ω–∞—Ç–∞)
- ‚ö†Ô∏è –ü–æ—Ç—Ä–µ–±–Ω–æ —Ä–µ—à–∞–≤–∞—ö–µ –∫–æ–Ω—Ñ–ª–∏–∫–∞—Ç–∞

**–ü—Ä–∏–º–µ—Ä–∏ —É–ø–æ—Ç—Ä–µ–±–µ:**
- –ú–æ–¥–µ—Ä–∞—Ü–∏—ò–∞ —Å–∞–¥—Ä–∂–∞—ò–∞ (–≤–∏—à–µ –º–æ–¥–µ–ª–∞ –ø—Ä–µ–≥–ª–µ–¥–∞ —Å–∞–¥—Ä–∂–∞—ò)
- –ü—Ä–µ–≥–ª–µ–¥ –∫–æ–¥–∞ (–≤–∏—à–µ –ª–∏–Ω—Ç–µ—Ä–∞/–∞–Ω–∞–ª–∏–∑–∞—Ç–æ—Ä–∞)
- –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∞ –¥–∏—ò–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ (–≤–∏—à–µ AI –º–æ–¥–µ–ª–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—ò–∞ —Å—Ç—Ä—É—á—ö–∞–∫–∞)

---

## –ü—Ä–µ–≥–ª–µ–¥ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ

### –ö–æ–º–ø–ª–µ—Ç–∞–Ω —Å–∏—Å—Ç–µ–º –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞ –Ω–∞ Azure

```mermaid
graph TB
    User[–ö–æ—Ä–∏—Å–Ω–∏–∫/API –ö–ª–∏—ò–µ–Ω—Ç]
    APIM[Azure API –ú–µ–Ω–∞—ü–º–µ–Ω—Ç]
    Orchestrator[–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä –°–µ—Ä–≤–∏—Å<br/>–ö–æ–Ω—Ç–µ—ò–Ω–µ—Ä –ê–ø–ª–∏–∫–∞—Ü–∏—ò–∞]
    ServiceBus[Azure –°–µ—Ä–≤–∏—Å–Ω–∞ –ú—Ä–µ–∂–∞<br/>–ï–≤–µ–Ω—Ç –•–∞–±]
    
    Agent1[–ò—Å—Ç—Ä–∞–∂–∏–≤–∞—á –ê–≥–µ–Ω—Ç<br/>–ö–æ–Ω—Ç–µ—ò–Ω–µ—Ä –ê–ø–ª–∏–∫–∞—Ü–∏—ò–∞]
    Agent2[–ü–∏—Å–∞—Ü –ê–≥–µ–Ω—Ç<br/>–ö–æ–Ω—Ç–µ—ò–Ω–µ—Ä –ê–ø–ª–∏–∫–∞—Ü–∏—ò–∞]
    Agent3[–ê–Ω–∞–ª–∏—Ç–∏—á–∞—Ä –ê–≥–µ–Ω—Ç<br/>–ö–æ–Ω—Ç–µ—ò–Ω–µ—Ä –ê–ø–ª–∏–∫–∞—Ü–∏—ò–∞]
    Agent4[–†–µ—Ü–µ–Ω–∑–µ–Ω—Ç –ê–≥–µ–Ω—Ç<br/>–ö–æ–Ω—Ç–µ—ò–Ω–µ—Ä –ê–ø–ª–∏–∫–∞—Ü–∏—ò–∞]
    
    CosmosDB[(Cosmos DB<br/>–ó–∞—ò–µ–¥–Ω–∏—á–∫–æ –°—Ç–∞—ö–µ)]
    Storage[Azure –°–∫–ª–∞–¥–∏—à—Ç–µ<br/>–ê—Ä—Ç–µ—Ñ–∞–∫—Ç–∏]
    AppInsights[–ê–ø–ª–∏–∫–∞—Ü–∏–æ–Ω–∏ –ò–Ω—Å–∞—ò—Ç—Å<br/>–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥]
    
    User --> APIM
    APIM --> Orchestrator
    
    Orchestrator --> ServiceBus
    ServiceBus --> Agent1
    ServiceBus --> Agent2
    ServiceBus --> Agent3
    ServiceBus --> Agent4
    
    Agent1 --> CosmosDB
    Agent2 --> CosmosDB
    Agent3 --> CosmosDB
    Agent4 --> CosmosDB
    
    Agent1 --> Storage
    Agent2 --> Storage
    Agent3 --> Storage
    Agent4 --> Storage
    
    Orchestrator -.-> AppInsights
    Agent1 -.-> AppInsights
    Agent2 -.-> AppInsights
    Agent3 -.-> AppInsights
    Agent4 -.-> AppInsights
    
    style Orchestrator fill:#FF9800,stroke:#F57C00,stroke-width:3px,color:#fff
    style ServiceBus fill:#9C27B0,stroke:#7B1FA2,stroke-width:3px,color:#fff
    style CosmosDB fill:#4CAF50,stroke:#388E3C,stroke-width:3px,color:#fff
```
**–ö—ô—É—á–Ω–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–µ:**

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ | –°–≤—Ä—Ö–∞ | Azure —É—Å–ª—É–≥–∞ |
|------------|-------|--------------|
| **API Gateway** | –£–ª–∞–∑–Ω–∞ —Ç–∞—á–∫–∞, –æ–≥—Ä–∞–Ω–∏—á–µ—ö–µ –±—Ä–∑–∏–Ω–µ, –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—ò–∞ | API Management |
| **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä** | –ö–æ–æ—Ä–¥–∏–Ω–∏—Ä–∞ —Ä–∞–¥–Ω–µ —Ç–æ–∫–æ–≤–µ –∞–≥–µ–Ω–∞—Ç–∞ | Container Apps |
| **–†–µ–¥ –ø–æ—Ä—É–∫–∞** | –ê—Å–∏–Ω—Ö—Ä–æ–Ω–∞ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—ò–∞ | Service Bus / Event Hubs |
| **–ê–≥–µ–Ω—Ç–∏** | –°–ø–µ—Ü–∏—ò–∞–ª–∏–∑–æ–≤–∞–Ω–∏ AI —Ä–∞–¥–Ω–∏—Ü–∏ | Container Apps / Functions |
| **–°–∫–ª–∞–¥–∏—à—Ç–µ —Å—Ç–∞—ö–∞** | –ó–∞—ò–µ–¥–Ω–∏—á–∫–æ —Å—Ç–∞—ö–µ, –ø—Ä–∞—õ–µ—ö–µ –∑–∞–¥–∞—Ç–∞–∫–∞ | Cosmos DB |
| **–°–∫–ª–∞–¥–∏—à—Ç–µ –∞—Ä—Ç–µ—Ñ–∞–∫–∞—Ç–∞** | –î–æ–∫—É–º–µ–Ω—Ç–∏, —Ä–µ–∑—É–ª—Ç–∞—Ç–∏, –ª–æ–≥–æ–≤–∏ | Blob Storage |
| **–ü—Ä–∞—õ–µ—ö–µ** | –î–∏—Å—Ç—Ä–∏–±—É–∏—Ä–∞–Ω–æ –ø—Ä–∞—õ–µ—ö–µ, –ª–æ–≥–æ–≤–∏ | Application Insights |

---

## –ü—Ä–µ–¥—É—Å–ª–æ–≤–∏

### –ü–æ—Ç—Ä–µ–±–Ω–∏ –∞–ª–∞—Ç–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç–µ Azure Developer CLI
azd version
# ‚úÖ –û—á–µ–∫—É—ò–µ —Å–µ: azd –≤–µ—Ä–∑–∏—ò–∞ 1.0.0 –∏–ª–∏ –Ω–æ–≤–∏—ò–∞

# –ü—Ä–æ–≤–µ—Ä–∏—Ç–µ Azure CLI
az --version
# ‚úÖ –û—á–µ–∫—É—ò–µ —Å–µ: azure-cli 2.50.0 –∏–ª–∏ –Ω–æ–≤–∏—ò–∞

# –ü—Ä–æ–≤–µ—Ä–∏—Ç–µ Docker (–∑–∞ –ª–æ–∫–∞–ª–Ω–æ —Ç–µ—Å—Ç–∏—Ä–∞—ö–µ)
docker --version
# ‚úÖ –û—á–µ–∫—É—ò–µ —Å–µ: Docker –≤–µ—Ä–∑–∏—ò–∞ 20.10 –∏–ª–∏ –Ω–æ–≤–∏—ò–∞
```

### Azure –∑–∞—Ö—Ç–µ–≤–∏

- –ê–∫—Ç–∏–≤–Ω–∞ Azure –ø—Ä–µ—Ç–ø–ª–∞—Ç–∞
- –î–æ–∑–≤–æ–ª–µ –∑–∞ –∫—Ä–µ–∏—Ä–∞—ö–µ:
  - Container Apps
  - Service Bus namespaces
  - Cosmos DB –Ω–∞–ª–æ–≥–∞
  - –°–∫–ª–∞–¥–∏—à–Ω–∏—Ö –Ω–∞–ª–æ–≥–∞
  - Application Insights

### –ü—Ä–µ–¥–∑–Ω–∞—ö–∞

–¢—Ä–µ–±–∞–ª–æ –±–∏ –¥–∞ —Å—Ç–µ –∑–∞–≤—Ä—à–∏–ª–∏:
- [–£–ø—Ä–∞–≤—ô–∞—ö–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—ò–æ–º](../getting-started/configuration.md)
- [–ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—ò–∞ –∏ –±–µ–∑–±–µ–¥–Ω–æ—Å—Ç](../getting-started/authsecurity.md)
- [–ü—Ä–∏–º–µ—Ä –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞](../../../../examples/microservices)

---

## –í–æ–¥–∏—á –∑–∞ –∏–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò—É

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ—ò–µ–∫—Ç–∞

```
multi-agent-system/
‚îú‚îÄ‚îÄ azure.yaml                    # AZD configuration
‚îú‚îÄ‚îÄ infra/
‚îÇ   ‚îú‚îÄ‚îÄ main.bicep               # Main infrastructure
‚îÇ   ‚îú‚îÄ‚îÄ core/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ servicebus.bicep     # Message queue
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ cosmos.bicep         # State store
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ storage.bicep        # Artifact storage
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ monitoring.bicep     # Application Insights
‚îÇ   ‚îî‚îÄ‚îÄ app/
‚îÇ       ‚îú‚îÄ‚îÄ orchestrator.bicep   # Orchestrator service
‚îÇ       ‚îî‚îÄ‚îÄ agent.bicep          # Agent template
‚îî‚îÄ‚îÄ src/
    ‚îú‚îÄ‚îÄ orchestrator/            # Orchestration logic
    ‚îÇ   ‚îú‚îÄ‚îÄ app.py
    ‚îÇ   ‚îú‚îÄ‚îÄ workflows.py
    ‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile
    ‚îú‚îÄ‚îÄ agents/
    ‚îÇ   ‚îú‚îÄ‚îÄ research/            # Research agent
    ‚îÇ   ‚îú‚îÄ‚îÄ writer/              # Writer agent
    ‚îÇ   ‚îú‚îÄ‚îÄ analyst/             # Analyst agent
    ‚îÇ   ‚îî‚îÄ‚îÄ reviewer/            # Reviewer agent
    ‚îî‚îÄ‚îÄ shared/
        ‚îú‚îÄ‚îÄ state_manager.py     # Shared state logic
        ‚îî‚îÄ‚îÄ message_handler.py   # Message handling
```

---

## –õ–µ–∫—Ü–∏—ò–∞ 1: –®–∞–±–ª–æ–Ω —Å–µ–∫–≤–µ–Ω—Ü–∏—ò–∞–ª–Ω–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–µ

### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò–∞: –†–∞–¥–Ω–∏ —Ç–æ–∫ –∑–∞ –∫—Ä–µ–∏—Ä–∞—ö–µ —Å–∞–¥—Ä–∂–∞—ò–∞

–•–∞—ò–¥–µ –¥–∞ –∏–∑–≥—Ä–∞–¥–∏–º–æ —Å–µ–∫–≤–µ–Ω—Ü–∏—ò–∞–ª–Ω–∏ —Ä–∞–¥–Ω–∏ —Ç–æ–∫: –ò—Å—Ç—Ä–∞–∂–∏–≤–∞—ö–µ ‚Üí –ü–∏—Å–∞—ö–µ ‚Üí –£—Ä–µ—í–∏–≤–∞—ö–µ ‚Üí –û–±—ò–∞–≤—ô–∏–≤–∞—ö–µ

### 1. AZD –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—ò–∞

**–§–∞—ò–ª: `azure.yaml`**

```yaml
name: content-pipeline
metadata:
  template: multi-agent-sequential@1.0.0

services:
  orchestrator:
    project: ./src/orchestrator
    language: python
    host: containerapp
  
  research-agent:
    project: ./src/agents/research
    language: python
    host: containerapp
  
  writer-agent:
    project: ./src/agents/writer
    language: python
    host: containerapp
  
  editor-agent:
    project: ./src/agents/editor
    language: python
    host: containerapp
```

### 2. –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞: Service Bus –∑–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò—É

**–§–∞—ò–ª: `infra/core/servicebus.bicep`**

```bicep
param name string
param location string
param tags object = {}

resource serviceBusNamespace 'Microsoft.ServiceBus/namespaces@2022-10-01-preview' = {
  name: name
  location: location
  tags: tags
  sku: {
    name: 'Standard'
    tier: 'Standard'
  }
  properties: {
    minimumTlsVersion: '1.2'
  }
}

// Queue for orchestrator ‚Üí research agent
resource researchQueue 'Microsoft.ServiceBus/namespaces/queues@2022-10-01-preview' = {
  parent: serviceBusNamespace
  name: 'research-tasks'
  properties: {
    maxDeliveryCount: 3
    lockDuration: 'PT5M'
    deadLetteringOnMessageExpiration: true
  }
}

// Queue for research agent ‚Üí writer agent
resource writerQueue 'Microsoft.ServiceBus/namespaces/queues@2022-10-01-preview' = {
  parent: serviceBusNamespace
  name: 'writer-tasks'
  properties: {
    maxDeliveryCount: 3
    lockDuration: 'PT5M'
  }
}

// Queue for writer agent ‚Üí editor agent
resource editorQueue 'Microsoft.ServiceBus/namespaces/queues@2022-10-01-preview' = {
  parent: serviceBusNamespace
  name: 'editor-tasks'
  properties: {
    maxDeliveryCount: 3
    lockDuration: 'PT5M'
  }
}

output namespace string = serviceBusNamespace.name
output connectionString string = listKeys('${serviceBusNamespace.id}/AuthorizationRules/RootManageSharedAccessKey', serviceBusNamespace.apiVersion).primaryConnectionString
```

### 3. –ú–µ–Ω–∞—ü–µ—Ä –∑–∞—ò–µ–¥–Ω–∏—á–∫–æ–≥ —Å—Ç–∞—ö–∞

**–§–∞—ò–ª: `src/shared/state_manager.py`**

```python
from azure.cosmos import CosmosClient, PartitionKey
from datetime import datetime
import os

class StateManager:
    """Manages shared state across agents using Cosmos DB"""
    
    def __init__(self):
        endpoint = os.environ['COSMOS_ENDPOINT']
        key = os.environ['COSMOS_KEY']
        
        self.client = CosmosClient(endpoint, key)
        self.database = self.client.get_database_client('agent-state')
        self.container = self.database.get_container_client('tasks')
    
    def create_task(self, task_id: str, task_type: str, input_data: dict):
        """Create a new task"""
        task = {
            'id': task_id,
            'type': task_type,
            'status': 'pending',
            'input': input_data,
            'created_at': datetime.utcnow().isoformat(),
            'steps': []
        }
        self.container.create_item(task)
        return task
    
    def update_task_step(self, task_id: str, step_name: str, result: dict):
        """Update task with completed step"""
        task = self.container.read_item(task_id, partition_key=task_id)
        
        task['steps'].append({
            'name': step_name,
            'completed_at': datetime.utcnow().isoformat(),
            'result': result
        })
        
        self.container.replace_item(task_id, task)
        return task
    
    def complete_task(self, task_id: str, final_result: dict):
        """Mark task as complete"""
        task = self.container.read_item(task_id, partition_key=task_id)
        task['status'] = 'completed'
        task['result'] = final_result
        task['completed_at'] = datetime.utcnow().isoformat()
        self.container.replace_item(task_id, task)
        return task
    
    def get_task(self, task_id: str):
        """Retrieve task state"""
        return self.container.read_item(task_id, partition_key=task_id)
```

### 4. –°–µ—Ä–≤–∏—Å –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞

**–§–∞—ò–ª: `src/orchestrator/app.py`**

```python
from flask import Flask, request, jsonify
from azure.servicebus import ServiceBusClient, ServiceBusMessage
import json
import uuid
import os
from shared.state_manager import StateManager

app = Flask(__name__)
state_manager = StateManager()

# –í–µ–∑–∞ —Å–∞ —Å–µ—Ä–≤–∏—Å–Ω–∏–º –∞—É—Ç–æ–±—É—Å–æ–º
servicebus_connection_str = os.environ['SERVICEBUS_CONNECTION_STRING']
servicebus_client = ServiceBusClient.from_connection_string(servicebus_connection_str)

@app.route('/health', methods=['GET'])
def health():
    return jsonify({'status': 'healthy', 'service': 'orchestrator'})

@app.route('/create-content', methods=['POST'])
def create_content():
    """
    Sequential workflow: Research ‚Üí Write ‚Üí Edit ‚Üí Publish
    """
    data = request.json
    topic = data.get('topic')
    
    if not topic:
        return jsonify({'error': 'Topic required'}), 400
    
    # –ö—Ä–µ–∏—Ä–∞—ò –∑–∞–¥–∞—Ç–∞–∫ —É —Å–∫–ª–∞–¥–∏—à—Ç—É —Å—Ç–∞—ö–∞
    task_id = str(uuid.uuid4())
    task = state_manager.create_task(
        task_id=task_id,
        task_type='content_creation',
        input_data={'topic': topic}
    )
    
    # –ü–æ—à–∞—ô–∏ –ø–æ—Ä—É–∫—É –∏—Å—Ç—Ä–∞–∂–∏–≤–∞—á–∫–æ–º –∞–≥–µ–Ω—Ç—É (–ø—Ä–≤–∏ –∫–æ—Ä–∞–∫)
    sender = servicebus_client.get_queue_sender('research-tasks')
    message = ServiceBusMessage(
        body=json.dumps({
            'task_id': task_id,
            'topic': topic,
            'next_queue': 'writer-tasks'  # –ì–¥–µ –ø–æ—Å–ª–∞—Ç–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–µ
        }),
        content_type='application/json'
    )
    
    with sender:
        sender.send_messages(message)
    
    return jsonify({
        'task_id': task_id,
        'status': 'started',
        'workflow': 'sequential',
        'steps': ['research', 'write', 'edit', 'publish'],
        'message': 'Content creation pipeline initiated'
    }), 202

@app.route('/task/<task_id>', methods=['GET'])
def get_task_status(task_id):
    """Check task status"""
    try:
        task = state_manager.get_task(task_id)
        return jsonify(task)
    except Exception as e:
        return jsonify({'error': str(e)}), 404

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

### 5. –ê–≥–µ–Ω—Ç–∏ –∑–∞ –∏—Å—Ç—Ä–∞–∂–∏–≤–∞—ö–µ

**–§–∞—ò–ª: `src/agents/research/app.py`**

```python
from azure.servicebus import ServiceBusClient, ServiceBusMessage
from openai import AzureOpenAI
import json
import os
import time
from shared.state_manager import StateManager

# –ò–Ω–∏—Ü–∏—ò–∞–ª–∏–∑—É—ò –∫–ª–∏—ò–µ–Ω—Ç–µ
state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

openai_client = AzureOpenAI(
    api_key=os.environ['AZURE_OPENAI_API_KEY'],
    api_version="2024-02-01",
    azure_endpoint=os.environ['AZURE_OPENAI_ENDPOINT']
)

def process_research_task(message_data):
    """Process research request and pass to writer"""
    task_id = message_data['task_id']
    topic = message_data['topic']
    next_queue = message_data['next_queue']
    
    print(f"üî¨ Researching: {topic}")
    
    # –ü–æ–∑–æ–≤–∏ Azure OpenAI –∑–∞ –∏—Å—Ç—Ä–∞–∂–∏–≤–∞—ö–µ
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are a research assistant. Provide comprehensive research on the given topic."},
            {"role": "user", "content": f"Research this topic thoroughly: {topic}"}
        ],
        max_tokens=1500
    )
    
    research_results = response.choices[0].message.content
    
    # –ê–∂—É—Ä–∏—Ä–∞—ò —Å—Ç–∞—ö–µ
    state_manager.update_task_step(
        task_id=task_id,
        step_name='research',
        result={'research': research_results}
    )
    
    # –ü–æ—à–∞—ô–∏ —Å–ª–µ–¥–µ—õ–µ–º –∞–≥–µ–Ω—Ç—É (–ø–∏—Å—Ü—É)
    sender = servicebus_client.get_queue_sender(next_queue)
    message = ServiceBusMessage(
        body=json.dumps({
            'task_id': task_id,
            'topic': topic,
            'research': research_results,
            'next_queue': 'editor-tasks'
        }),
        content_type='application/json'
    )
    
    with sender:
        sender.send_messages(message)
    
    print(f"‚úÖ Research complete for task {task_id}")

def main():
    """Listen to research queue"""
    receiver = servicebus_client.get_queue_receiver('research-tasks')
    
    print("üî¨ Research Agent started, listening for tasks...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_research_task(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"‚ùå Error processing message: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

### 6. –ê–≥–µ–Ω—Ç–∏ –∑–∞ –ø–∏—Å–∞—ö–µ

**–§–∞—ò–ª: `src/agents/writer/app.py`**

```python
from azure.servicebus import ServiceBusClient, ServiceBusMessage
from openai import AzureOpenAI
import json
import os
from shared.state_manager import StateManager

state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

openai_client = AzureOpenAI(
    api_key=os.environ['AZURE_OPENAI_API_KEY'],
    api_version="2024-02-01",
    azure_endpoint=os.environ['AZURE_OPENAI_ENDPOINT']
)

def process_writing_task(message_data):
    """Write article based on research"""
    task_id = message_data['task_id']
    topic = message_data['topic']
    research = message_data['research']
    next_queue = message_data['next_queue']
    
    print(f"‚úçÔ∏è Writing article: {topic}")
    
    # –ü–æ–∑–æ–≤–∏—Ç–µ Azure OpenAI –¥–∞ –Ω–∞–ø–∏—à–µ —á–ª–∞–Ω–∞–∫
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are a professional writer. Write engaging, well-structured articles."},
            {"role": "user", "content": f"Based on this research:\n\n{research}\n\nWrite a comprehensive article about: {topic}"}
        ],
        max_tokens=2000
    )
    
    article_draft = response.choices[0].message.content
    
    # –ê–∂—É—Ä–∏—Ä–∞—ò—Ç–µ —Å—Ç–∞—ö–µ
    state_manager.update_task_step(
        task_id=task_id,
        step_name='writing',
        result={'draft': article_draft}
    )
    
    # –ü–æ—à–∞—ô–∏—Ç–µ —É—Ä–µ–¥–Ω–∏–∫—É
    sender = servicebus_client.get_queue_sender(next_queue)
    message = ServiceBusMessage(
        body=json.dumps({
            'task_id': task_id,
            'topic': topic,
            'draft': article_draft
        }),
        content_type='application/json'
    )
    
    with sender:
        sender.send_messages(message)
    
    print(f"‚úÖ Article draft complete for task {task_id}")

def main():
    """Listen to writer queue"""
    receiver = servicebus_client.get_queue_receiver('writer-tasks')
    
    print("‚úçÔ∏è Writer Agent started, listening for tasks...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_writing_task(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"‚ùå Error: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

### 7. –ê–≥–µ–Ω—Ç–∏ –∑–∞ —É—Ä–µ—í–∏–≤–∞—ö–µ

**–§–∞—ò–ª: `src/agents/editor/app.py`**

```python
from azure.servicebus import ServiceBusClient
from openai import AzureOpenAI
import json
import os
from shared.state_manager import StateManager

state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

openai_client = AzureOpenAI(
    api_key=os.environ['AZURE_OPENAI_API_KEY'],
    api_version="2024-02-01",
    azure_endpoint=os.environ['AZURE_OPENAI_ENDPOINT']
)

def process_editing_task(message_data):
    """Edit and finalize article"""
    task_id = message_data['task_id']
    topic = message_data['topic']
    draft = message_data['draft']
    
    print(f"üìù Editing article: {topic}")
    
    # –ü–æ–∑–æ–≤–∏ Azure OpenAI –∑–∞ —É—Ä–µ—í–∏–≤–∞—ö–µ
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are an expert editor. Improve grammar, clarity, and structure."},
            {"role": "user", "content": f"Edit and improve this article:\n\n{draft}"}
        ],
        max_tokens=2000
    )
    
    final_article = response.choices[0].message.content
    
    # –û–∑–Ω–∞—á–∏ –∑–∞–¥–∞—Ç–∞–∫ –∫–∞–æ –∑–∞–≤—Ä—à–µ–Ω
    state_manager.complete_task(
        task_id=task_id,
        final_result={
            'topic': topic,
            'final_article': final_article,
            'word_count': len(final_article.split())
        }
    )
    
    print(f"‚úÖ Article finalized for task {task_id}")

def main():
    """Listen to editor queue"""
    receiver = servicebus_client.get_queue_receiver('editor-tasks')
    
    print("üìù Editor Agent started, listening for tasks...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_editing_task(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"‚ùå Error: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

### 8. –î–µ–ø–ª–æ—ò–æ–≤–∞—ö–µ –∏ —Ç–µ—Å—Ç–∏—Ä–∞—ö–µ

```bash
# –ò–Ω–∏—Ü–∏—ò–∞–ª–∏–∑—É—ò –∏ —Ä–∞—Å–ø–æ—Ä–µ–¥–∏
azd init
azd up

# –ü—Ä–µ—É–∑–º–∏ URL –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä–∞
ORCHESTRATOR_URL=$(azd env get-values | grep ORCHESTRATOR_URL | cut -d '=' -f2 | tr -d '"')

# –ö—Ä–µ–∏—Ä–∞—ò —Å–∞–¥—Ä–∂–∞—ò
curl -X POST $ORCHESTRATOR_URL/create-content \
  -H "Content-Type: application/json" \
  -d '{"topic": "The Future of AI in Healthcare"}'
```

**‚úÖ –û—á–µ–∫–∏–≤–∞–Ω–∏ –∏–∑–ª–∞–∑:**
```json
{
  "task_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "status": "started",
  "workflow": "sequential",
  "steps": ["research", "write", "edit", "publish"],
  "message": "Content creation pipeline initiated"
}
```

**–ü—Ä–æ–≤–µ—Ä–∞ –Ω–∞–ø—Ä–µ—Ç–∫–∞ –∑–∞–¥–∞—Ç–∫–∞:**
```bash
TASK_ID="a1b2c3d4-e5f6-7890-abcd-ef1234567890"
curl $ORCHESTRATOR_URL/task/$TASK_ID
```

**‚úÖ –û—á–µ–∫–∏–≤–∞–Ω–∏ –∏–∑–ª–∞–∑ (–∑–∞–≤—Ä—à–µ–Ω–æ):**
```json
{
  "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "type": "content_creation",
  "status": "completed",
  "steps": [
    {
      "name": "research",
      "completed_at": "2025-11-19T10:30:00Z",
      "result": {"research": "..."}
    },
    {
      "name": "writing",
      "completed_at": "2025-11-19T10:32:00Z",
      "result": {"draft": "..."}
    }
  ],
  "result": {
    "topic": "The Future of AI in Healthcare",
    "final_article": "...",
    "word_count": 1500
  }
}
```

---

## –õ–µ–∫—Ü–∏—ò–∞ 2: –®–∞–±–ª–æ–Ω –ø–∞—Ä–∞–ª–µ–ª–Ω–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–µ

### –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò–∞: –ê–≥—Ä–µ–≥–∞—Ç–æ—Ä –∑–∞ –∏—Å—Ç—Ä–∞–∂–∏–≤–∞—ö–µ –∏–∑ –≤–∏—à–µ –∏–∑–≤–æ—Ä–∞

–•–∞—ò–¥–µ –¥–∞ –∏–∑–≥—Ä–∞–¥–∏–º–æ –ø–∞—Ä–∞–ª–µ–ª–Ω–∏ —Å–∏—Å—Ç–µ–º –∫–æ—ò–∏ –∏—Å—Ç–æ–≤—Ä–µ–º–µ–Ω–æ –ø—Ä–∏–∫—É–ø—ô–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—ò–µ –∏–∑ –≤–∏—à–µ –∏–∑–≤–æ—Ä–∞.

### –ü–∞—Ä–∞–ª–µ–ª–Ω–∏ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä

**–§–∞—ò–ª: `src/orchestrator/parallel_workflow.py`**

```python
from flask import Flask, request, jsonify
from azure.servicebus import ServiceBusClient, ServiceBusMessage
import json
import uuid
import os
from shared.state_manager import StateManager

app = Flask(__name__)
state_manager = StateManager()

servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

@app.route('/research-parallel', methods=['POST'])
def research_parallel():
    """
    Parallel workflow: Multiple agents work simultaneously
    """
    data = request.json
    query = data.get('query')
    
    task_id = str(uuid.uuid4())
    task = state_manager.create_task(
        task_id=task_id,
        task_type='parallel_research',
        input_data={
            'query': query,
            'agents': ['web', 'academic', 'news', 'social']
        }
    )
    
    # –§–∞–Ω-–∞—É—Ç: –ü–æ—à–∞—ô–∏ —Å–≤–∏–º –∞–≥–µ–Ω—Ç–∏–º–∞ –∏—Å—Ç–æ–≤—Ä–µ–º–µ–Ω–æ
    agents = [
        ('web-research-queue', 'web'),
        ('academic-research-queue', 'academic'),
        ('news-research-queue', 'news'),
        ('social-research-queue', 'social')
    ]
    
    for queue_name, agent_type in agents:
        sender = servicebus_client.get_queue_sender(queue_name)
        message = ServiceBusMessage(
            body=json.dumps({
                'task_id': task_id,
                'query': query,
                'agent_type': agent_type,
                'result_queue': 'aggregation-queue'
            }),
            content_type='application/json'
        )
        
        with sender:
            sender.send_messages(message)
    
    return jsonify({
        'task_id': task_id,
        'status': 'started',
        'workflow': 'parallel',
        'agents_dispatched': 4,
        'message': 'Parallel research initiated'
    }), 202

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

### –õ–æ–≥–∏–∫–∞ –∞–≥—Ä–µ–≥–∞—Ü–∏—ò–µ

**–§–∞—ò–ª: `src/agents/aggregator/app.py`**

```python
from azure.servicebus import ServiceBusClient
import json
import os
from collections import defaultdict
from shared.state_manager import StateManager

state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

# –ü—Ä–∞—Ç–∏—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–µ –ø–æ –∑–∞–¥–∞—Ç–∫—É
task_results = defaultdict(list)
expected_agents = 4  # –≤–µ–±, –∞–∫–∞–¥–µ–º—Å–∫–∏, –≤–µ—Å—Ç–∏, –¥—Ä—É—à—Ç–≤–µ–Ω–æ

def process_result(message_data):
    """Aggregate results from parallel agents"""
    task_id = message_data['task_id']
    agent_type = message_data['agent_type']
    result = message_data['result']
    
    # –°–∞—á—É–≤–∞—ò—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç
    task_results[task_id].append({
        'agent': agent_type,
        'data': result
    })
    
    print(f"üìä Received result from {agent_type} agent ({len(task_results[task_id])}/{expected_agents})")
    
    # –ü—Ä–æ–≤–µ—Ä–∏—Ç–µ –¥–∞ –ª–∏ —Å—É —Å–≤–∏ –∞–≥–µ–Ω—Ç–∏ –∑–∞–≤—Ä—à–∏–ª–∏ (—Ñ–∞–Ω-–∏–Ω)
    if len(task_results[task_id]) == expected_agents:
        print(f"‚úÖ All agents completed for task {task_id}. Aggregating...")
        
        # –ö–æ–º–±–∏–Ω—É—ò—Ç–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–µ
        aggregated = {
            'query': message_data['query'],
            'sources': task_results[task_id],
            'summary': generate_summary(task_results[task_id])
        }
        
        # –û–∑–Ω–∞—á–∏—Ç–µ –∫–∞–æ –∑–∞–≤—Ä—à–µ–Ω–æ
        state_manager.complete_task(task_id, aggregated)
        
        # –û—á–∏—Å—Ç–∏—Ç–µ
        del task_results[task_id]
        
        print(f"‚úÖ Aggregation complete for task {task_id}")

def generate_summary(results):
    """Generate summary from all sources"""
    summaries = [r['data'].get('summary', '') for r in results]
    return '\n\n'.join(summaries)

def main():
    """Listen to aggregation queue"""
    receiver = servicebus_client.get_queue_receiver('aggregation-queue')
    
    print("üìä Aggregator started, listening for results...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_result(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"‚ùå Error: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

**–ü—Ä–µ–¥–Ω–æ—Å—Ç–∏ –ø–∞—Ä–∞–ª–µ–ª–Ω–æ–≥ —à–∞–±–ª–æ–Ω–∞:**
- ‚ö° **4x –±—Ä–∂–µ** (–∞–≥–µ–Ω—Ç–∏ —Ä–∞–¥–µ –∏—Å—Ç–æ–≤—Ä–µ–º–µ–Ω–æ)
- üîÑ **–û—Ç–ø–æ—Ä–Ω–æ –Ω–∞ –≥—Ä–µ—à–∫–µ** (–¥–µ–ª–∏–º–∏—á–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ —Å—É –ø—Ä–∏—Ö–≤–∞—Ç—ô–∏–≤–∏)
- üìà **–°–∫–∞–ª–∞–±–∏–ª–Ω–æ** (–ª–∞–∫–æ –¥–æ–¥–∞–≤–∞—ö–µ –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞)

---

## –ü—Ä–∞–∫—Ç–∏—á–Ω–µ –≤–µ–∂–±–µ

### –í–µ–∂–±–∞ 1: –î–æ–¥–∞–≤–∞—ö–µ –ª–æ–≥–∏–∫–µ –∑–∞ –≤—Ä–µ–º–µ–Ω—Å–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ—ö–µ ‚≠ê‚≠ê (–°—Ä–µ–¥—ö–µ)

**–¶–∏—ô**: –ò–º–ø–ª–µ–º–µ–Ω—Ç–∏—Ä–∞—ò—Ç–µ –ª–æ–≥–∏–∫—É –≤—Ä–µ–º–µ–Ω—Å–∫–æ–≥ –æ–≥—Ä–∞–Ω–∏—á–µ—ö–∞ —Ç–∞–∫–æ –¥–∞ –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä –Ω–µ —á–µ–∫–∞ –ø—Ä–µ–¥—É–≥–æ –Ω–∞ —Å–ø–æ—Ä–µ –∞–≥–µ–Ω—Ç–µ.

**–ö–æ—Ä–∞—Ü–∏**:

1. **–î–æ–¥–∞—ò—Ç–µ –ø—Ä–∞—õ–µ—ö–µ –≤—Ä–µ–º–µ–Ω—Å–∫–æ–≥ –æ–≥—Ä–∞–Ω–∏—á–µ—ö–∞ —É –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä:**

```python
from datetime import datetime, timedelta

task_timeouts = {}  # task_id -> –≤—Ä–µ–º–µ –∏—Å—Ç–µ–∫–∞

def process_result(message_data):
    task_id = message_data['task_id']
    
    # –ü–æ—Å—Ç–∞–≤–∏ –≤—Ä–µ–º–µ–Ω—Å–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ—ö–µ –Ω–∞ –ø—Ä–≤–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç
    if task_id not in task_timeouts:
        task_timeouts[task_id] = datetime.utcnow() + timedelta(seconds=30)
    
    task_results[task_id].append({
        'agent': message_data['agent_type'],
        'data': message_data['result']
    })
    
    # –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞ –ª–∏ —ò–µ –∑–∞–≤—Ä—à–µ–Ω–æ –ò–õ–ò –∏—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º–µ
    if len(task_results[task_id]) == expected_agents or \
       datetime.utcnow() > task_timeouts[task_id]:
        
        print(f"üìä Aggregating with {len(task_results[task_id])}/{expected_agents} results")
        
        aggregated = {
            'query': message_data['query'],
            'sources': task_results[task_id],
            'completed_agents': len(task_results[task_id]),
            'timed_out': len(task_results[task_id]) < expected_agents
        }
        
        state_manager.complete_task(task_id, aggregated)
        
        # –ß–∏—à—õ–µ—ö–µ
        del task_results[task_id]
        del task_timeouts[task_id]
```

2. **–¢–µ—Å—Ç–∏—Ä–∞—ò—Ç–µ —Å–∞ –≤–µ—à—Ç–∞—á–∫–∏–º –∫–∞—à—ö–µ—ö–∏–º–∞:**

```python
# –£ —ò–µ–¥–Ω–æ–º –∞–≥–µ–Ω—Ç—É, –¥–æ–¥–∞—ò—Ç–µ –∫–∞—à—ö–µ—ö–µ –¥–∞ —Å–∏–º—É–ª–∏—Ä–∞—Ç–µ —Å–ø–æ—Ä—É –æ–±—Ä–∞–¥—É
import time
time.sleep(35)  # –ü—Ä–µ–ª–∞–∑–∏ –≤—Ä–µ–º–µ–Ω—Å–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ—ö–µ –æ–¥ 30 —Å–µ–∫—É–Ω–¥–∏
```

3. **–î–µ–ø–ª–æ—ò–æ–≤–∞—ö–µ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—ò–∞:**

```bash
azd deploy aggregator

# –ü–æ–¥–Ω–µ—Å–∏ –∑–∞–¥–∞—Ç–∞–∫
curl -X POST $ORCHESTRATOR_URL/research-parallel \
  -H "Content-Type: application/json" \
  -d '{"query": "AI safety research"}'

# –ü—Ä–æ–≤–µ—Ä–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–µ –Ω–∞–∫–æ–Ω 30 —Å–µ–∫—É–Ω–¥–∏
curl $ORCHESTRATOR_URL/task/$TASK_ID
```

**‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏—ò—É–º–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ó–∞–¥–∞—Ç–∞–∫ —Å–µ –∑–∞–≤—Ä—à–∞–≤–∞ –Ω–∞–∫–æ–Ω 30 —Å–µ–∫—É–Ω–¥–∏ —á–∞–∫ –∏ –∞–∫–æ –∞–≥–µ–Ω—Ç–∏ –Ω–µ –∑–∞–≤—Ä—à–µ
- ‚úÖ –û–¥–≥–æ–≤–æ—Ä —É–∫–∞–∑—É—ò–µ –Ω–∞ –¥–µ–ª–∏–º–∏—á–Ω–µ —Ä–µ–∑—É–ª—Ç–∞—Ç–µ (`"timed_out": true`)
- ‚úÖ –î–æ—Å—Ç—É–ø–Ω–∏ —Ä–µ–∑—É–ª—Ç–∞—Ç–∏ —Å–µ –≤—Ä–∞—õ–∞—ò—É (3 –æ–¥ 4 –∞–≥–µ–Ω—Ç–∞)

**–í—Ä–µ–º–µ**: 20-25 –º–∏–Ω—É—Ç–∞

---

### –í–µ–∂–±–∞ 2: –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò–∞ –ª–æ–≥–∏–∫–µ –∑–∞ –ø–æ–Ω–æ–≤–Ω–∏ –ø–æ–∫—É—à–∞—ò ‚≠ê‚≠ê‚≠ê (–ù–∞–ø—Ä–µ–¥–Ω–æ)

**–¶–∏—ô**: –ê—É—Ç–æ–º–∞—Ç—Å–∫–∏ –ø–æ–Ω–æ–≤–∏—Ç–µ –∑–∞–¥–∞—Ç–∫–µ –∞–≥–µ–Ω—Ç–∞ –∫–æ—ò–∏ —Å—É –Ω–µ—É—Å–ø–µ–ª–∏ –ø—Ä–µ –Ω–µ–≥–æ —à—Ç–æ –æ–¥—É—Å—Ç–∞–Ω–µ—Ç–µ.

**–ö–æ—Ä–∞—Ü–∏**:

1. **–î–æ–¥–∞—ò—Ç–µ –ø—Ä–∞—õ–µ—ö–µ –ø–æ–Ω–æ–≤–Ω–∏—Ö –ø–æ–∫—É—à–∞—ò–∞ —É –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä:**

```python
from dataclasses import dataclass
from typing import Dict

@dataclass
class RetryConfig:
    max_retries: int = 3
    backoff_seconds: int = 5

retry_counts: Dict[str, int] = {}  # message_id -> –±—Ä–æ—ò_–ø–æ–∫—É—à–∞—ò–∞

def send_with_retry(queue_name: str, message_data: dict, retry_config: RetryConfig):
    """Send message with retry metadata"""
    message_id = message_data.get('message_id', str(uuid.uuid4()))
    message_data['message_id'] = message_id
    message_data['retry_count'] = retry_counts.get(message_id, 0)
    message_data['max_retries'] = retry_config.max_retries
    
    sender = servicebus_client.get_queue_sender(queue_name)
    message = ServiceBusMessage(
        body=json.dumps(message_data),
        content_type='application/json',
        message_id=message_id
    )
    
    with sender:
        sender.send_messages(message)
```

2. **–î–æ–¥–∞—ò—Ç–µ —Ö–µ–Ω–¥–ª–µ—Ä –∑–∞ –ø–æ–Ω–æ–≤–Ω–µ –ø–æ–∫—É—à–∞—ò–µ —É –∞–≥–µ–Ω—Ç–µ:**

```python
def process_with_retry(message, receiver, process_func):
    """Process message with automatic retry on failure"""
    try:
        message_data = json.loads(str(message))
        
        # –û–±—Ä–∞–¥–∏ –ø–æ—Ä—É–∫—É
        process_func(message_data)
        
        # –£—Å–ø–µ—Ö - –∑–∞–≤—Ä—à–µ–Ω–æ
        receiver.complete_message(message)
        
    except Exception as e:
        message_id = message.message_id
        retry_count = message_data.get('retry_count', 0)
        max_retries = message_data.get('max_retries', 3)
        
        if retry_count < max_retries:
            # –ü–æ–Ω–æ–≤–∏: –Ω–∞–ø—É—Å—Ç–∏ –∏ –ø–æ–Ω–æ–≤–æ —Å—Ç–∞–≤–∏ —É —Ä–µ–¥ —Å–∞ –ø–æ–≤–µ—õ–∞–Ω–∏–º –±—Ä–æ—ò–µ–º
            print(f"‚ö†Ô∏è Retry {retry_count + 1}/{max_retries} for message {message_id}")
            
            message_data['retry_count'] = retry_count + 1
            
            # –ü–æ—à–∞—ô–∏ –Ω–∞–∑–∞–¥ —É –∏—Å—Ç–∏ —Ä–µ–¥ —Å–∞ –∫–∞—à—ö–µ—ö–µ–º
            time.sleep(5 * (retry_count + 1))  # –ï–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏—ò–∞–ª–Ω–æ –æ–¥–ª–∞–≥–∞—ö–µ
            send_with_retry(queue_name, message_data, RetryConfig())
            
            receiver.complete_message(message)  # –£–∫–ª–æ–Ω–∏ –æ—Ä–∏–≥–∏–Ω–∞–ª
        else:
            # –ú–∞–∫—Å–∏–º–∞–ª–∞–Ω –±—Ä–æ—ò –ø–æ–∫—É—à–∞—ò–∞ –ø—Ä–µ–º–∞—à–µ–Ω - –ø—Ä–µ–º–µ—Å—Ç–∏ —É —Ä–µ–¥ –∑–∞ –Ω–µ–∏—Å–ø—Ä–∞–≤–Ω–µ –ø–æ—Ä—É–∫–µ
            print(f"‚ùå Max retries exceeded for message {message_id}")
            receiver.dead_letter_message(
                message,
                reason="MaxRetriesExceeded",
                error_description=str(e)
            )
```

3. **–ü—Ä–∞—Ç–∏—Ç–µ —Ä–µ–¥ –∑–∞ –Ω–µ—É—Å–ø–µ–ª–µ –ø–æ—Ä—É–∫–µ:**

```python
def monitor_dead_letters():
    """Check dead letter queue for failed messages"""
    receiver = servicebus_client.get_queue_receiver(
        'research-queue',
        sub_queue='deadletter'
    )
    
    with receiver:
        messages = receiver.receive_messages(max_wait_time=5)
        for message in messages:
            print(f"‚ò†Ô∏è Dead letter: {message.message_id}")
            print(f"Reason: {message.dead_letter_reason}")
            print(f"Description: {message.dead_letter_error_description}")
```

**‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏—ò—É–º–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ù–µ—É—Å–ø–µ–ª–∏ –∑–∞–¥–∞—Ü–∏ —Å–µ –∞—É—Ç–æ–º–∞—Ç—Å–∫–∏ –ø–æ–Ω–æ–≤–æ –ø–æ–∫—É—à–∞–≤–∞—ò—É (–¥–æ 3 –ø—É—Ç–∞)
- ‚úÖ –ï–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏—ò–∞–ª–Ω–æ –ø–æ–≤–µ—õ–∞—ö–µ –≤—Ä–µ–º–µ–Ω–∞ –∏–∑–º–µ—í—É –ø–æ–∫—É—à–∞—ò–∞ (5—Å, 10—Å, 15—Å)
- ‚úÖ –ù–∞–∫–æ–Ω –º–∞–∫—Å–∏–º–∞–ª–Ω–æ–≥ –±—Ä–æ—ò–∞ –ø–æ–∫—É—à–∞—ò–∞, –ø–æ—Ä—É–∫–µ –∏–¥—É —É —Ä–µ–¥ –∑–∞ –Ω–µ—É—Å–ø–µ–ª–µ –ø–æ—Ä—É–∫–µ
- ‚úÖ –†–µ–¥ –∑–∞ –Ω–µ—É—Å–ø–µ–ª–µ –ø–æ—Ä—É–∫–µ –º–æ–∂–µ —Å–µ –ø—Ä–∞—Ç–∏—Ç–∏ –∏ –ø–æ–Ω–æ–≤–æ –æ–±—Ä–∞–¥–∏—Ç–∏

**–í—Ä–µ–º–µ**: 30-40 –º–∏–Ω—É—Ç–∞

---

### –í–µ–∂–±–∞ 3: –ò–º–ø–ª–µ–º–µ–Ω—Ç–∞—Ü–∏—ò–∞ –ø—Ä–µ–∫–∏–¥–∞—á–∞ –∫—Ä—É–≥–∞ ‚≠ê‚≠ê‚≠ê (–ù–∞–ø—Ä–µ–¥–Ω–æ)

**–¶–∏—ô**: –°–ø—Ä–µ—á–∏—Ç–µ –∫–∞—Å–∫–∞–¥–Ω–µ –≥—Ä–µ—à–∫–µ –∑–∞—É—Å—Ç–∞–≤—ô–∞—ö–µ–º –∑–∞—Ö—Ç–µ–≤–∞ –∫–∞ –∞–≥–µ–Ω—Ç–∏–º–∞ –∫–æ—ò–∏ –Ω–µ —Ä–∞–¥–µ.

**–ö–æ—Ä–∞—Ü–∏**:

1. **–ö—Ä–µ–∏—Ä–∞—ò—Ç–µ –∫–ª–∞—Å—É –ø—Ä–µ–∫–∏–¥–∞—á–∞ –∫—Ä—É–≥–∞:**

```python
from enum import Enum
from datetime import datetime, timedelta

class CircuitState(Enum):
    CLOSED = "closed"      # –ù–æ—Ä–º–∞–ª–∞–Ω —Ä–∞–¥
    OPEN = "open"          # –ù–µ—É—Å–ø–µ—Ö, –æ–¥–±–∏—ò –∑–∞—Ö—Ç–µ–≤–µ
    HALF_OPEN = "half_open"  # –¢–µ—Å—Ç–∏—Ä–∞—ö–µ –¥–∞ –ª–∏ —ò–µ –æ–ø–æ—Ä–∞–≤—ô–µ–Ω–æ

class CircuitBreaker:
    def __init__(self, failure_threshold=5, timeout_seconds=60):
        self.failure_threshold = failure_threshold
        self.timeout_seconds = timeout_seconds
        self.failure_count = 0
        self.last_failure_time = None
        self.state = CircuitState.CLOSED
    
    def call(self, func):
        """Execute function with circuit breaker protection"""
        if self.state == CircuitState.OPEN:
            # –ü—Ä–æ–≤–µ—Ä–∏ –¥–∞ –ª–∏ —ò–µ –∏—Å—Ç–µ–∫–ª–æ –≤—Ä–µ–º–µ
            if datetime.utcnow() - self.last_failure_time > timedelta(seconds=self.timeout_seconds):
                self.state = CircuitState.HALF_OPEN
                print("üîÑ Circuit breaker: HALF_OPEN (testing)")
            else:
                raise Exception(f"Circuit breaker OPEN for agent. Try again in {self.timeout_seconds}s")
        
        try:
            result = func()
            
            # –£—Å–ø–µ—Ö
            if self.state == CircuitState.HALF_OPEN:
                self.state = CircuitState.CLOSED
                self.failure_count = 0
                print("‚úÖ Circuit breaker: CLOSED (recovered)")
            
            return result
            
        except Exception as e:
            self.failure_count += 1
            self.last_failure_time = datetime.utcnow()
            
            if self.failure_count >= self.failure_threshold:
                self.state = CircuitState.OPEN
                print(f"üî¥ Circuit breaker: OPEN (too many failures)")
            
            raise e
```

2. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –Ω–∞ –ø–æ–∑–∏–≤–µ –∞–≥–µ–Ω—Ç–∞:**

```python
# –£ –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä—É
agent_circuits = {
    'web': CircuitBreaker(failure_threshold=5, timeout_seconds=60),
    'academic': CircuitBreaker(failure_threshold=5, timeout_seconds=60),
    'news': CircuitBreaker(failure_threshold=5, timeout_seconds=60),
    'social': CircuitBreaker(failure_threshold=5, timeout_seconds=60)
}

def send_to_agent(agent_type, message_data):
    """Send with circuit breaker protection"""
    circuit = agent_circuits[agent_type]
    
    try:
        circuit.call(lambda: send_message(agent_type, message_data))
    except Exception as e:
        print(f"‚ö†Ô∏è Skipping {agent_type} agent: {e}")
        # –ù–∞—Å—Ç–∞–≤–∏—Ç–µ —Å–∞ –¥—Ä—É–≥–∏–º –∞–≥–µ–Ω—Ç–∏–º–∞
```

3. **–¢–µ—Å—Ç–∏—Ä–∞—ò—Ç–µ –ø—Ä–µ–∫–∏–¥–∞—á –∫—Ä—É–≥–∞:**

```bash
# –°–∏–º—É–ª–∏—Ä–∞—ò –ø–æ–Ω–æ–≤—ô–µ–Ω–µ –æ—Ç–∫–∞–∑–µ (–∑–∞—É—Å—Ç–∞–≤–∏ —ò–µ–¥–Ω–æ–≥ –∞–≥–µ–Ω—Ç–∞)
az containerapp stop --name web-research-agent --resource-group rg-agents

# –ü–æ—à–∞—ô–∏ –≤–∏—à–µ –∑–∞—Ö—Ç–µ–≤–∞
for i in {1..10}; do
  curl -X POST $ORCHESTRATOR_URL/research-parallel \
    -H "Content-Type: application/json" \
    -d '{"query": "test query '$i'"}'
  sleep 2
done

# –ü—Ä–æ–≤–µ—Ä–∏ –ª–æ–≥–æ–≤–µ - —Ç—Ä–µ–±–∞–ª–æ –±–∏ –¥–∞ –≤–∏–¥–∏—à –¥–∞ —ò–µ –∫—Ä—É–≥ –æ—Ç–≤–æ—Ä–µ–Ω –Ω–∞–∫–æ–Ω 5 –æ—Ç–∫–∞–∑–∞
azd logs orchestrator --tail 50
```

**‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏—ò—É–º–∏ —É—Å–ø–µ—Ö–∞:**
- ‚úÖ –ù–∞–∫–æ–Ω 5 –Ω–µ—É—Å–ø–µ—Ö–∞, –ø—Ä–µ–∫–∏–¥–∞—á —Å–µ –æ—Ç–≤–∞—Ä–∞ (–æ–¥–±–∏—ò–∞ –∑–∞—Ö—Ç–µ–≤–µ)
- ‚úÖ –ù–∞–∫–æ–Ω 60 —Å–µ–∫—É–Ω–¥–∏, –ø—Ä–µ–∫–∏–¥–∞—á —Å–µ –¥–µ–ª–∏–º–∏—á–Ω–æ –æ—Ç–≤–∞—Ä–∞ (—Ç–µ—Å—Ç–∏—Ä–∞ –æ–ø–æ—Ä–∞–≤–∞–∫)
- ‚úÖ –û—Å—Ç–∞–ª–∏ –∞–≥–µ–Ω—Ç–∏ –Ω–∞—Å—Ç–∞–≤—ô–∞—ò—É –Ω–æ—Ä–º–∞–ª–Ω–æ –¥–∞ —Ä–∞–¥–µ
- ‚úÖ –ü—Ä–µ–∫–∏–¥–∞—á —Å–µ –∞—É—Ç–æ–º–∞—Ç—Å–∫–∏ –∑–∞—Ç–≤–∞—Ä–∞ –∫–∞–¥–∞ —Å–µ –∞–≥–µ–Ω—Ç –æ–ø–æ—Ä–∞–≤–∏

**–í—Ä–µ–º–µ**: 40-50 –º–∏–Ω—É—Ç–∞

---

## –ü—Ä–∞—õ–µ—ö–µ –∏ –æ—Ç–∫–ª–∞—ö–∞—ö–µ –≥—Ä–µ—à–∞–∫–∞

### –î–∏—Å—Ç—Ä–∏–±—É–∏—Ä–∞–Ω–æ –ø—Ä–∞—õ–µ—ö–µ —É–∑ Application Insights

**–§–∞—ò–ª: `src/shared/tracing.py`**

```python
from opencensus.ext.azure.log_exporter import AzureLogHandler
from opencensus.ext.azure.trace_exporter import AzureExporter
from opencensus.trace import config_integration
from opencensus.trace.tracer import Tracer
from opencensus.trace.samplers import AlwaysOnSampler
import logging
import os

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—à–∏—Ç–µ –ø—Ä–∞—õ–µ—ö–µ
config_integration.trace_integrations(['requests', 'logging'])

connection_string = os.environ.get('APPLICATIONINSIGHTS_CONNECTION_STRING')

# –ö—Ä–µ–∏—Ä–∞—ò—Ç–µ —Ç—Ä–∞—Ü–µ—Ä
tracer = Tracer(
    exporter=AzureExporter(connection_string=connection_string),
    sampler=AlwaysOnSampler()
)

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∏—à–∏—Ç–µ –ª–æ–≥–æ–≤–∞—ö–µ
logger = logging.getLogger(__name__)
logger.addHandler(AzureLogHandler(connection_string=connection_string))
logger.setLevel(logging.INFO)

def trace_agent_call(agent_name, task_id, operation):
    """Trace agent operations"""
    with tracer.span(name=f'{agent_name}.{operation}') as span:
        span.add_attribute('agent', agent_name)
        span.add_attribute('task_id', task_id)
        span.add_attribute('operation', operation)
        
        try:
            result = operation()
            span.add_attribute('status', 'success')
            return result
        except Exception as e:
            span.add_attribute('status', 'error')
            span.add_attribute('error', str(e))
            raise
```

### –£–ø–∏—Ç–∏ –∑–∞ Application Insights

**–ü—Ä–∞—õ–µ—ö–µ —Ä–∞–¥–Ω–∏—Ö —Ç–æ–∫–æ–≤–∞ –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞:**

```kusto
// Trace complete workflow for a task
traces
| where customDimensions.task_id == "a1b2c3d4-..."
| project timestamp, message, customDimensions.agent, customDimensions.operation
| order by timestamp asc
```

**–ü–æ—Ä–µ—í–µ—ö–µ –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∏ –∞–≥–µ–Ω–∞—Ç–∞:**

```kusto
// Compare agent execution times
dependencies
| where name contains "agent"
| summarize 
    avg_duration = avg(duration),
    p95_duration = percentile(duration, 95),
    count = count()
  by agent = tostring(customDimensions.agent)
| order by avg_duration desc
```

**–ê–Ω–∞–ª–∏–∑–∞ –Ω–µ—É—Å–ø–µ—Ö–∞:**

```kusto
// Find which agents fail most
exceptions
| where customDimensions.agent != ""
| summarize 
    failure_count = count(),
    unique_errors = dcount(outerMessage)
  by agent = tostring(customDimensions.agent)
| order by failure_count desc
```

---

## –ê–Ω–∞–ª–∏–∑–∞ —Ç—Ä–æ—à–∫–æ–≤–∞

### –¢—Ä–æ—à–∫–æ–≤–∏ —Å–∏—Å—Ç–µ–º–∞ –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞ (–ú–µ—Å–µ—á–Ω–µ –ø—Ä–æ—Ü–µ–Ω–µ)

| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ | –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—ò–∞ | –¢—Ä–æ—à–∞–∫ |
|------------|---------------|--------|
| **–û—Ä–∫–µ—Å—Ç—Ä–∞—Ç–æ—Ä** | 1 Container App (1 vCPU, 2GB) | $30-50 |
| **4 –∞–≥–µ–Ω—Ç–∞** | 4 Container Apps (0.5 vCPU, 1GB —Å–≤–∞–∫–∏) | $60-120 |
| **Service Bus** | Standard tier, 10M –ø–æ—Ä—É–∫–∞ | $10-20 |
| **Cosmos DB** | Serverless, 5GB —Å–∫–ª–∞–¥–∏—à—Ç–∞, 1M RUs | $25-50 |
| **Blob Storage** | 10GB —Å–∫–ª–∞–¥–∏—à—Ç–∞, 100K –æ–ø–µ—Ä–∞—Ü–∏—ò–∞ | $5-10 |
| **Application Insights** | 5GB —É
## –í–æ–¥–∏—á –∑–∞ —Ä–µ—à–∞–≤–∞—ö–µ –ø—Ä–æ–±–ª–µ–º–∞

### –ü—Ä–æ–±–ª–µ–º: –ü–æ—Ä—É–∫–µ –∑–∞–≥–ª–∞–≤—ô–µ–Ω–µ —É —Ä–µ–¥—É

**–°–∏–º–ø—Ç–æ–º–∏:**
- –ü–æ—Ä—É–∫–µ —Å–µ –∞–∫—É–º—É–ª–∏—Ä–∞—ò—É —É —Ä–µ–¥—É
- –ê–≥–µ–Ω—Ç–∏ –Ω–µ –æ–±—Ä–∞—í—É—ò—É
- –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—Ç–∫–∞ –∑–∞–≥–ª–∞–≤—ô–µ–Ω –Ω–∞ "pending"

**–î–∏—ò–∞–≥–Ω–æ–∑–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç–µ –¥—É–±–∏–Ω—É —Ä–µ–¥–∞
az servicebus queue show \
  --namespace-name mybus \
  --name research-tasks \
  --query "countDetails"

# –ü—Ä–æ–≤–µ—Ä–∏—Ç–µ –∑–¥—Ä–∞–≤—ô–µ –∞–≥–µ–Ω—Ç–∞
azd logs research-agent --tail 50
```

**–†–µ—à–µ—ö–∞:**

1. **–ü–æ–≤–µ—õ–∞—ò—Ç–µ –±—Ä–æ—ò —Ä–µ–ø–ª–∏–∫–∞ –∞–≥–µ–Ω–∞—Ç–∞:**
   ```bash
   az containerapp update \
     --name research-agent \
     --min-replicas 3 \
     --max-replicas 10
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç–µ —Ä–µ–¥ –∑–∞ –º—Ä—Ç–≤–∞ —Å–ª–æ–≤–∞:**
   ```bash
   az servicebus queue show \
     --namespace-name mybus \
     --name research-tasks \
     --query "countDetails.deadLetterMessageCount"
   ```

---

### –ü—Ä–æ–±–ª–µ–º: –í—Ä–µ–º–µ –∏–∑–≤—Ä—à–µ—ö–∞ –∑–∞–¥–∞—Ç–∫–∞ –∏—Å—Ç–µ–∫–ª–æ/–Ω–∏–∫–∞–¥–∞ —Å–µ –Ω–µ –∑–∞–≤—Ä—à–∞–≤–∞

**–°–∏–º–ø—Ç–æ–º–∏:**
- –°—Ç–∞—Ç—É—Å –∑–∞–¥–∞—Ç–∫–∞ –æ—Å—Ç–∞—ò–µ "in_progress"
- –ù–µ–∫–∏ –∞–≥–µ–Ω—Ç–∏ –∑–∞–≤—Ä—à–∞–≤–∞—ò—É, –¥—Ä—É–≥–∏ –Ω–µ
- –ù–µ–º–∞ –ø–æ—Ä—É–∫–∞ –æ –≥—Ä–µ—à—Ü–∏

**–î–∏—ò–∞–≥–Ω–æ–∑–∞:**
```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç–µ —Å—Ç–∞—ö–µ –∑–∞–¥–∞—Ç–∫–∞
curl $ORCHESTRATOR_URL/task/$TASK_ID

# –ü—Ä–æ–≤–µ—Ä–∏—Ç–µ Application Insights
# –ü–æ–∫—Ä–µ–Ω–∏—Ç–µ —É–ø–∏—Ç: traces | where customDimensions.task_id == "..."
```

**–†–µ—à–µ—ö–∞:**

1. **–ü—Ä–∏–º–µ–Ω–∏—Ç–µ –≤—Ä–µ–º–µ–Ω—Å–∫–æ –æ–≥—Ä–∞–Ω–∏—á–µ—ö–µ —É –∞–≥—Ä–µ–≥–∞—Ç–æ—Ä—É (–í–µ–∂–±–∞ 1)**

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç–µ –Ω–µ—É—Å–ø–µ—Ö–µ –∞–≥–µ–Ω–∞—Ç–∞:**
   ```bash
   azd logs --follow | grep "ERROR\|FAIL"
   ```

3. **–ü–æ—Ç–≤—Ä–¥–∏—Ç–µ –¥–∞ —Å–≤–∏ –∞–≥–µ–Ω—Ç–∏ —Ä–∞–¥–µ:**
   ```bash
   az containerapp list \
     --resource-group rg-agents \
     --query "[].{name:name, status:properties.runningStatus}"
   ```

---

## –°–∞–∑–Ω–∞—ò—Ç–µ –≤–∏—à–µ

### –ó–≤–∞–Ω–∏—á–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—ò–∞
- [Azure Service Bus](https://learn.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview)
- [Cosmos DB](https://learn.microsoft.com/azure/cosmos-db/introduction)
- [Container Apps DAPR](https://learn.microsoft.com/azure/container-apps/dapr-overview)
- [Multi-Agent Design Patterns](https://learn.microsoft.com/azure/architecture/guide/ai/multi-agent-systems)

### –°–ª–µ–¥–µ—õ–∏ –∫–æ—Ä–∞—Ü–∏ —É –æ–≤–æ–º –∫—É—Ä—Å—É
- ‚Üê –ü—Ä–µ—Ç—Ö–æ–¥–Ω–æ: [–ü–ª–∞–Ω–∏—Ä–∞—ö–µ –∫–∞–ø–∞—Ü–∏—Ç–µ—Ç–∞](capacity-planning.md)
- ‚Üí –°–ª–µ–¥–µ—õ–µ: [–ò–∑–±–æ—Ä SKU](sku-selection.md)
- üè† [–ü–æ—á–µ—Ç–Ω–∞ —Å—Ç—Ä–∞–Ω–∞ –∫—É—Ä—Å–∞](../../README.md)

### –ü–æ–≤–µ–∑–∞–Ω–∏ –ø—Ä–∏–º–µ—Ä–∏
- [–ü—Ä–∏–º–µ—Ä –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞](../../../../examples/microservices) - –®–∞–±–ª–æ–Ω–∏ –∫–æ–º—É–Ω–∏–∫–∞—Ü–∏—ò–µ —Å–µ—Ä–≤–∏—Å–∞
- [–ü—Ä–∏–º–µ—Ä Azure OpenAI](../../../../examples/azure-openai-chat) - –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—ò–∞ –≤–µ—à—Ç–∞—á–∫–µ –∏–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ü–∏—ò–µ

---

## –†–µ–∑–∏–º–µ

**–ù–∞—É—á–∏–ª–∏ —Å—Ç–µ:**
- ‚úÖ –ü–µ—Ç —à–∞–±–ª–æ–Ω–∞ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ü–∏—ò–µ (—Å–µ–∫–≤–µ–Ω—Ü–∏—ò–∞–ª–Ω–∏, –ø–∞—Ä–∞–ª–µ–ª–Ω–∏, —Ö–∏—ò–µ—Ä–∞—Ä—Ö–∏—ò—Å–∫–∏, –∑–∞—Å–Ω–æ–≤–∞–Ω –Ω–∞ –¥–æ–≥–∞—í–∞—ò–∏–º–∞, –∫–æ–Ω—Å–µ–Ω–∑—É—Å)
- ‚úÖ –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É —Å–∞ –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞ –Ω–∞ Azure-—É (Service Bus, Cosmos DB, Container Apps)
- ‚úÖ –£–ø—Ä–∞–≤—ô–∞—ö–µ —Å—Ç–∞—ö–µ–º –º–µ—í—É –¥–∏—Å—Ç—Ä–∏–±—É–∏—Ä–∞–Ω–∏–º –∞–≥–µ–Ω—Ç–∏–º–∞
- ‚úÖ –†—É–∫–æ–≤–∞—ö–µ –≤—Ä–µ–º–µ–Ω—Å–∫–∏–º –æ–≥—Ä–∞–Ω–∏—á–µ—ö–∏–º–∞, –ø–æ–Ω–æ–≤–Ω–∏–º –ø–æ–∫—É—à–∞—ò–∏–º–∞ –∏ –ø—Ä–µ–∫–∏–¥–∞—á–∏–º–∞
- ‚úÖ –ü—Ä–∞—õ–µ—ö–µ –∏ –æ—Ç–∫–ª–∞—ö–∞—ö–µ –≥—Ä–µ—à–∞–∫–∞ —É –¥–∏—Å—Ç—Ä–∏–±—É–∏—Ä–∞–Ω–∏–º —Å–∏—Å—Ç–µ–º–∏–º–∞
- ‚úÖ –°—Ç—Ä–∞—Ç–µ–≥–∏—ò–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—ò–µ —Ç—Ä–æ—à–∫–æ–≤–∞

**–ö—ô—É—á–Ω–∏ –∑–∞–∫—ô—É—á—Ü–∏:**
1. **–ò–∑–∞–±–µ—Ä–∏—Ç–µ –ø—Ä–∞–≤–∏ —à–∞–±–ª–æ–Ω** - –°–µ–∫–≤–µ–Ω—Ü–∏—ò–∞–ª–Ω–∏ –∑–∞ —É—Ä–µ—í–µ–Ω–µ —Ç–æ–∫–æ–≤–µ —Ä–∞–¥–∞, –ø–∞—Ä–∞–ª–µ–ª–Ω–∏ –∑–∞ –±—Ä–∑–∏–Ω—É, –∑–∞—Å–Ω–æ–≤–∞–Ω –Ω–∞ –¥–æ–≥–∞—í–∞—ò–∏–º–∞ –∑–∞ —Ñ–ª–µ–∫—Å–∏–±–∏–ª–Ω–æ—Å—Ç
2. **–ü–∞–∂—ô–∏–≤–æ —É–ø—Ä–∞–≤—ô–∞—ò—Ç–µ —Å—Ç–∞—ö–µ–º** - –ö–æ—Ä–∏—Å—Ç–∏—Ç–µ Cosmos DB –∏–ª–∏ —Å–ª–∏—á–Ω–æ –∑–∞ –∑–∞—ò–µ–¥–Ω–∏—á–∫–æ —Å—Ç–∞—ö–µ
3. **–†—É–∫–æ–≤–∞—ö–µ –≥—Ä–µ—à–∫–∞–º–∞** - –í—Ä–µ–º–µ–Ω—Å–∫–∞ –æ–≥—Ä–∞–Ω–∏—á–µ—ö–∞, –ø–æ–Ω–æ–≤–Ω–∏ –ø–æ–∫—É—à–∞—ò–∏, –ø—Ä–µ–∫–∏–¥–∞—á–∏, —Ä–µ–¥–æ–≤–∏ –∑–∞ –º—Ä—Ç–≤–∞ —Å–ª–æ–≤–∞
4. **–ü—Ä–∞—Ç–∏—Ç–µ —Å–≤–µ** - –î–∏—Å—Ç—Ä–∏–±—É–∏—Ä–∞–Ω–æ –ø—Ä–∞—õ–µ—ö–µ —ò–µ –Ω–µ–æ–ø—Ö–æ–¥–Ω–æ –∑–∞ –æ—Ç–∫–ª–∞—ö–∞—ö–µ –≥—Ä–µ—à–∞–∫–∞
5. **–û–ø—Ç–∏–º–∏–∑—É—ò—Ç–µ —Ç—Ä–æ—à–∫–æ–≤–µ** - –°–∫–∞–ª–∏—Ä–∞—ö–µ –Ω–∞ –Ω—É–ª—É, –∫–æ—Ä–∏—à—õ–µ—ö–µ —Å–µ—Ä–≤–µ—Ä–ª–µ—Å —Ä–µ—à–µ—ö–∞, –ø—Ä–∏–º–µ–Ω–∞ –∫–µ—à–∏—Ä–∞—ö–∞

**–°–ª–µ–¥–µ—õ–∏ –∫–æ—Ä–∞—Ü–∏:**
1. –ó–∞–≤—Ä—à–∏—Ç–µ –ø—Ä–∞–∫—Ç–∏—á–Ω–µ –≤–µ–∂–±–µ
2. –ù–∞–ø—Ä–∞–≤–∏—Ç–µ —Å–∏—Å—Ç–µ–º —Å–∞ –≤–∏—à–µ –∞–≥–µ–Ω–∞—Ç–∞ –∑–∞ –≤–∞—à —Å–ª—É—á–∞—ò —É–ø–æ—Ç—Ä–µ–±–µ
3. –ü—Ä–æ—É—á–∏—Ç–µ [–ò–∑–±–æ—Ä SKU](sku-selection.md) –∑–∞ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—ò—É –ø–µ—Ä—Ñ–æ—Ä–º–∞–Ω—Å–∏ –∏ —Ç—Ä–æ—à–∫–æ–≤–∞

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**–û–¥—Ä–∏—Ü–∞—ö–µ –æ–¥ –æ–¥–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç–∏**:  
–û–≤–∞—ò –¥–æ–∫—É–º–µ–Ω—Ç —ò–µ –ø—Ä–µ–≤–µ–¥–µ–Ω –ø–æ–º–æ—õ—É —É—Å–ª—É–≥–µ –∑–∞ –ø—Ä–µ–≤–æ—í–µ—ö–µ –≤–µ—à—Ç–∞—á–∫–µ –∏–Ω—Ç–µ–ª–∏–≥–µ–Ω—Ü–∏—ò–µ [Co-op Translator](https://github.com/Azure/co-op-translator). –ò–∞–∫–æ –Ω–∞—Å—Ç–æ—ò–∏–º–æ –¥–∞ –æ–±–µ–∑–±–µ–¥–∏–º–æ —Ç–∞—á–Ω–æ—Å—Ç, –º–æ–ª–∏–º–æ –≤–∞—Å –¥–∞ –∏–º–∞—Ç–µ —É –≤–∏–¥—É –¥–∞ –∞—É—Ç–æ–º–∞—Ç—Å–∫–∏ –ø—Ä–µ–≤–æ–¥–∏ –º–æ–≥—É —Å–∞–¥—Ä–∂–∞—Ç–∏ –≥—Ä–µ—à–∫–µ –∏–ª–∏ –Ω–µ—Ç–∞—á–Ω–æ—Å—Ç–∏. –û—Ä–∏–≥–∏–Ω–∞–ª–Ω–∏ –¥–æ–∫—É–º–µ–Ω—Ç –Ω–∞ —ö–µ–≥–æ–≤–æ–º –∏–∑–≤–æ—Ä–Ω–æ–º —ò–µ–∑–∏–∫—É —Ç—Ä–µ–±–∞ —Å–º–∞—Ç—Ä–∞—Ç–∏ –∞—É—Ç–æ—Ä–∏—Ç–∞—Ç–∏–≤–Ω–∏–º –∏–∑–≤–æ—Ä–æ–º. –ó–∞ –∫—Ä–∏—Ç–∏—á–Ω–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—ò–µ –ø—Ä–µ–ø–æ—Ä—É—á—É—ò–µ —Å–µ –ø—Ä–æ—Ñ–µ—Å–∏–æ–Ω–∞–ª–Ω–∏ –ø—Ä–µ–≤–æ–¥ –æ–¥ —Å—Ç—Ä–∞–Ω–µ —ô—É–¥–∏. –ù–µ –ø—Ä–µ—É–∑–∏–º–∞–º–æ –æ–¥–≥–æ–≤–æ—Ä–Ω–æ—Å—Ç –∑–∞ –±–∏–ª–æ –∫–∞–∫–≤–∞ –ø–æ–≥—Ä–µ—à–Ω–∞ —Ç—É–º–∞—á–µ—ö–∞ –∏–ª–∏ –Ω–µ—Å–ø–æ—Ä–∞–∑—É–º–µ –∫–æ—ò–∏ –º–æ–≥—É –Ω–∞—Å—Ç–∞—Ç–∏ —É—Å–ª–µ–¥ –∫–æ—Ä–∏—à—õ–µ—ö–∞ –æ–≤–æ–≥ –ø—Ä–µ–≤–æ–¥–∞.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->