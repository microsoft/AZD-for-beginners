# рдХрдВрдЯреЗрдирд░ рдЕтАНреЕрдк рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯрдЪреЗ рдЙрджрд╛рд╣рд░рдгреЗ AZD рд╕рд╣

рдпрд╛ рдбрд┐рд░реЗрдХреНрдЯрд░реАрдордзреНрдпреЗ Azure Developer CLI (AZD) рд╡рд╛рдкрд░реВрди Azure Container Apps рд╡рд░ рдХрдВрдЯреЗрдирд░рд╛рдЗрдЬреНрдб рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдбрд┐рдкреНрд▓реЙрдп рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рд╡реНрдпрд╛рдкрдХ рдЙрджрд╛рд╣рд░рдгреЗ рджрд┐рд▓реА рдЖрд╣реЗрдд. рд╣реА рдЙрджрд╛рд╣рд░рдгреЗ рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЬрдЧрд╛рддреАрд▓ рдкреЕрдЯрд░реНрдиреНрд╕, рд╕рд░реНрд╡реЛрддреНрддрдо рдкрджреНрдзрддреА рдЖрдгрд┐ рдЙрддреНрдкрд╛рджрдирд╛рд╕рд╛рдареА рддрдпрд╛рд░ рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рдиреНрд╕ рджрд░реНрд╢рд╡рддрд╛рдд.

## ЁЯУЪ рд╡рд┐рд╖рдп рд╕реВрдЪреА

- [рдЖрдврд╛рд╡рд╛](../../../../examples/container-app)
- [рдкреВрд░реНрд╡рддрдпрд╛рд░реА](../../../../examples/container-app)
- [рдЬрд▓рдж рд╕реБрд░реБрд╡рд╛рдд рдЙрджрд╛рд╣рд░рдгреЗ](../../../../examples/container-app)
- [рдЙрддреНрдкрд╛рджрдирд╛рд╕рд╛рдареА рдЙрджрд╛рд╣рд░рдгреЗ](../../../../examples/container-app)
- [рдкреНрд░рдЧрдд рдкреЕрдЯрд░реНрдиреНрд╕](../../../../examples/container-app)
- [рд╕рд░реНрд╡реЛрддреНрддрдо рдкрджреНрдзрддреА](../../../../examples/container-app)

## рдЖрдврд╛рд╡рд╛

Azure Container Apps рд╣реЗ рдкреВрд░реНрдгрдкрдгреЗ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрд┐рдд рд╕рд░реНрд╡реНрд╣рд░рд▓реЗрд╕ рдХрдВрдЯреЗрдирд░ рдкреНрд▓реЕрдЯрдлреЙрд░реНрдо рдЖрд╣реЗ рдЬреЗ рддреБрдореНрд╣рд╛рд▓рд╛ рдорд╛рдпрдХреНрд░реЛрд╕рд░реНрд╡реНрд╣рд┐рд╕реЗрд╕ рдЖрдгрд┐ рдХрдВрдЯреЗрдирд░рд╛рдЗрдЬреНрдб рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рдиреНрд╕ рдЪрд╛рд▓рд╡рд┐рдгреНрдпрд╛рдЪреА рдкрд░рд╡рд╛рдирдЧреА рджреЗрддреЗ, рддреНрдпрд╛рд╕рд╛рдареА рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрд┐рдд рдХрд░рдгреНрдпрд╛рдЪреА рдЧрд░рдЬ рдирд╛рд╣реА. AZD рд╕рд╣ рдПрдХрддреНрд░рд┐рдд рдХреЗрд▓реНрдпрд╛рд╡рд░ рддреБрдореНрд╣рд╛рд▓рд╛ рдорд┐рд│рддреЗ:

- **рд╕реЛрдкреЗ рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ**: рдПрдХрд╛рдЪ рдХрдорд╛рдВрдбрдиреЗ рдХрдВрдЯреЗрдирд░реНрд╕ рдЖрдгрд┐ рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рдбрд┐рдкреНрд▓реЙрдп рдХрд░рд╛
- **рд╕реНрд╡рдпрдВрдЪрд▓рд┐рдд рд╕реНрдХреЗрд▓рд┐рдВрдЧ**: HTTP рдЯреНрд░реЕрдлрд┐рдХ рдХрд┐рдВрд╡рд╛ рдЗрд╡реНрд╣реЗрдВрдЯреНрд╕рд╡рд░ рдЖрдзрд╛рд░рд┐рдд рд╢реВрдиреНрдпрд╛рдкрд╛рд╕реВрди рд╕реНрдХреЗрд▓ рдЖрдЙрдЯ рдХрд░рд╛
- **рдПрдХрд╛рддреНрдорд┐рдХ рдиреЗрдЯрд╡рд░реНрдХрд┐рдВрдЧ**: рдЕрдВрдЧрднреВрдд рд╕реЗрд╡рд╛ рд╢реЛрдз рдЖрдгрд┐ рдЯреНрд░реЕрдлрд┐рдХ рд╡рд┐рднрд╛рдЬрди
- **рд╡реНрдпрд╡рд╕реНрдерд╛рдкрд┐рдд рдУрд│рдЦ**: Azure рд╕рдВрд╕рд╛рдзрдирд╛рдВрд╕рд╛рдареА рд╕реБрд░рдХреНрд╖рд┐рдд рдкреНрд░рдорд╛рдгреАрдХрд░рдг
- **рдЦрд░реНрдЪрд╛рдЪрд╛ рдСрдкреНрдЯрд┐рдорд╛рдпрдЭреЗрд╢рди**: рдлрдХреНрдд рд╡рд╛рдкрд░рд▓реЗрд▓реНрдпрд╛ рд╕рдВрд╕рд╛рдзрдирд╛рдВрд╕рд╛рдареА рдкреИрд╕реЗ рджреНрдпрд╛

## рдкреВрд░реНрд╡рддрдпрд╛рд░реА

рд╕реБрд░реБрд╡рд╛рдд рдХрд░рдгреНрдпрд╛рдкреВрд░реНрд╡реА, рдЦрд╛рддреНрд░реА рдХрд░рд╛ рдХреА рддреБрдордЪреНрдпрд╛рдХрдбреЗ рдЖрд╣реЗ:

```bash
# AZD рд╕реНрдерд╛рдкрдирд╛ рддрдкрд╛рд╕рд╛
azd version

# Azure CLI рддрдкрд╛рд╕рд╛
az version

# Docker рддрдкрд╛рд╕рд╛ (рдХрд╕реНрдЯрдо рдкреНрд░рддрд┐рдорд╛ рддрдпрд╛рд░ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА)
docker --version

# Azure рдордзреНрдпреЗ рд▓реЙрдЧрд┐рди рдХрд░рд╛
azd auth login
az login
```

**рдЖрд╡рд╢реНрдпрдХ Azure рд╕рдВрд╕рд╛рдзрдиреЗ:**
- рд╕рдХреНрд░рд┐рдп Azure рд╕рджрд╕реНрдпрддрд╛
- рд╕рдВрд╕рд╛рдзрди рдЧрдЯ рддрдпрд╛рд░ рдХрд░рдгреНрдпрд╛рдЪреА рдкрд░рд╡рд╛рдирдЧреА
- рдХрдВрдЯреЗрдирд░ рдЕтАНреЕрдкреНрд╕ рд╡рд╛рддрд╛рд╡рд░рдг рдкреНрд░рд╡реЗрд╢

## рдЬрд▓рдж рд╕реБрд░реБрд╡рд╛рдд рдЙрджрд╛рд╣рд░рдгреЗ

### 1. рд╕рд╛рдзрд╛ рд╡реЗрдм API (Python Flask)

Azure Container Apps рд╕рд╣ рдПрдХ рдореВрд▓рднреВрдд REST API рдбрд┐рдкреНрд▓реЙрдп рдХрд░рд╛.

**рдЙрджрд╛рд╣рд░рдг: Python Flask API**

```yaml
# azure.yaml
name: flask-api-demo
metadata:
  template: flask-api-demo@0.0.1-beta
services:
  api:
    project: ./src/api
    language: python
    host: containerapp
```

**рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рд╕реНрдЯреЗрдкреНрд╕:**

```bash
# рдЯреЗрдореНрдкрд▓реЗрдЯрдордзреВрди рдкреНрд░рд╛рд░рдВрдн рдХрд░рд╛
azd init --template todo-python-mongo

# рдкрд╛рдпрд╛рднреВрдд рд╕реБрд╡рд┐рдзрд╛ рддрдпрд╛рд░ рдХрд░рд╛ рдЖрдгрд┐ рддреИрдирд╛рдд рдХрд░рд╛
azd up

# рддреИрдирд╛рддреАрдЪреА рдЪрд╛рдЪрдгреА рдХрд░рд╛
azd show
curl $(azd show --output json | jq -r '.services.api.endpoint')/health
```

**рдореБрдЦреНрдп рд╡реИрд╢рд┐рд╖реНрдЯреНрдпреЗ:**
- 0 рддреЗ 10 рд░реЗрдкреНрд▓рд┐рдХрд╛рд╕ рдкрд░реНрдпрдВрдд рдСрдЯреЛ-рд╕реНрдХреЗрд▓рд┐рдВрдЧ
- рд╣реЗрд▓реНрде рдкреНрд░реЙрдмреНрд╕ рдЖрдгрд┐ рд▓рд┐рд╡реНрд╣рдиреЗрд╕ рдЪреЗрдХреНрд╕
- рдкрд░реНрдпрд╛рд╡рд░рдгреАрдп рд╡реНрд╣реЗрд░рд┐рдПрдмрд▓реНрд╕ рдЗрдВрдЬреЗрдХреНрд╢рди
- рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕ рдПрдХрддреНрд░реАрдХрд░рдг

### 2. Node.js Express API

MongoDB рдПрдХрддреНрд░реАрдХрд░рдгрд╛рд╕рд╣ Node.js рдмреЕрдХрдПрдВрдб рдбрд┐рдкреНрд▓реЙрдп рдХрд░рд╛.

```bash
# Node.js API рдЯреЗрдореНрдкрд▓реЗрдЯ рдкреНрд░рд╛рд░рдВрдн рдХрд░рд╛
azd init --template todo-nodejs-mongo

# рдкрд░реНрдпрд╛рд╡рд░рдгреАрдп рдЪрд▓ рдмрджрд▓ рдХреЙрдиреНрдлрд┐рдЧрд░ рдХрд░рд╛
azd env set DATABASE_NAME todosdb
azd env set COLLECTION_NAME todos

# рддреИрдирд╛рдд рдХрд░рд╛
azd up

# рд▓реЙрдЧреНрд╕ рдкрд╣рд╛
azd logs api
```

**рдЗрдиреНрдлреНрд░рд╛рд╕реНрдЯреНрд░рдХреНрдЪрд░ рд╣рд╛рдпрд▓рд╛рдЗрдЯреНрд╕:**
```bicep
// Bicep snippet from infra/main.bicep
resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'api-${resourceToken}'
  location: location
  properties: {
    managedEnvironmentId: containerEnv.id
    configuration: {
      ingress: {
        external: true
        targetPort: 3000
        transport: 'auto'
      }
      secrets: [
        {
          name: 'mongodb-connection'
          value: mongoConnection
        }
      ]
    }
    template: {
      containers: [
        {
          name: 'api'
          image: containerImage
          env: [
            {
              name: 'DATABASE_URL'
              secretRef: 'mongodb-connection'
            }
          ]
        }
      ]
      scale: {
        minReplicas: 0
        maxReplicas: 10
      }
    }
  }
}
```

### 3. рд╕реНрдЯреЕрдЯрд┐рдХ рдлреНрд░рдВрдЯрдПрдВрдб + API рдмреЕрдХрдПрдВрдб

React рдлреНрд░рдВрдЯрдПрдВрдб рдЖрдгрд┐ API рдмреЕрдХрдПрдВрдбрд╕рд╣ рдкреВрд░реНрдг-рд╕реНрдЯреЕрдХ рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдбрд┐рдкреНрд▓реЙрдп рдХрд░рд╛.

```bash
# рдкреВрд░реНрдг-рд╕реНрдЯреЕрдХ рдЯреЗрдореНрдкрд▓реЗрдЯ рдкреНрд░рд╛рд░рдВрдн рдХрд░рд╛
azd init --template todo-csharp-sql-swa-func

# рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рдкреБрдирд░рд╛рд╡рд▓реЛрдХрди рдХрд░рд╛
cat azure.yaml

# рджреЛрдиреНрд╣реА рд╕реЗрд╡рд╛ рддреИрдирд╛рдд рдХрд░рд╛
azd up

# рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдЙрдШрдбрд╛
azd show --output json | jq -r '.services.web.endpoint' | xargs start
```

## рдЙрддреНрдкрд╛рджрдирд╛рд╕рд╛рдареА рдЙрджрд╛рд╣рд░рдгреЗ

### рдЙрджрд╛рд╣рд░рдг 1: рдорд╛рдпрдХреНрд░реЛрд╕рд░реНрд╡реНрд╣рд┐рд╕реЗрд╕ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░

**рдкрд░рд┐рд╕реНрдерд┐рддреА**: рдЕрдиреЗрдХ рдорд╛рдпрдХреНрд░реЛрд╕рд░реНрд╡реНрд╣рд┐рд╕реЗрд╕рд╕рд╣ рдИ-рдХреЙрдорд░реНрд╕ рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рди

**рдбрд┐рд░реЗрдХреНрдЯрд░реА рд╕реНрдЯреНрд░рдХреНрдЪрд░:**
```
microservices-demo/
тФЬтФАтФА azure.yaml
тФЬтФАтФА infra/
тФВ   тФЬтФАтФА main.bicep
тФВ   тФЬтФАтФА app/
тФВ   тФВ   тФЬтФАтФА container-env.bicep
тФВ   тФВ   тФЬтФАтФА product-service.bicep
тФВ   тФВ   тФЬтФАтФА order-service.bicep
тФВ   тФВ   тФФтФАтФА payment-service.bicep
тФВ   тФФтФАтФА core/
тФВ       тФЬтФАтФА storage.bicep
тФВ       тФФтФАтФА database.bicep
тФФтФАтФА src/
    тФЬтФАтФА product-service/
    тФЬтФАтФА order-service/
    тФФтФАтФА payment-service/
```

**azure.yaml рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди:**
```yaml
name: microservices-ecommerce
services:
  product-service:
    project: ./src/product-service
    language: python
    host: containerapp
    
  order-service:
    project: ./src/order-service
    language: csharp
    host: containerapp
    
  payment-service:
    project: ./src/payment-service
    language: nodejs
    host: containerapp
```

**рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ:**
```bash
# рдкреНрд░рдХрд▓реНрдк рдкреНрд░рд╛рд░рдВрдн рдХрд░рд╛
azd init

# рдЙрддреНрдкрд╛рджрди рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗрдЯ рдХрд░рд╛
azd env new production

# рдЙрддреНрдкрд╛рджрди рд╕реЗрдЯрд┐рдВрдЧреНрдЬ рдХреЙрдиреНрдлрд┐рдЧрд░ рдХрд░рд╛
azd env set ENVIRONMENT production
azd env set MIN_REPLICAS 2
azd env set MAX_REPLICAS 50

# рд╕рд░реНрд╡ рд╕реЗрд╡рд╛ рддреИрдирд╛рдд рдХрд░рд╛
azd up

# рддреИрдирд╛рддреАрдЪреЗ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рд╛
azd monitor --overview
```

### рдЙрджрд╛рд╣рд░рдг 2: AI-рд╕рдХреНрд╖рдо рдХрдВрдЯреЗрдирд░ рдЕтАНреЕрдк

**рдкрд░рд┐рд╕реНрдерд┐рддреА**: Azure OpenAI рдПрдХрддреНрд░реАрдХрд░рдгрд╛рд╕рд╣ AI рдЪреЕрдЯ рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рди

**рдлрд╛рдЗрд▓: src/ai-chat/app.py**
```python
from flask import Flask, request, jsonify
from azure.identity import DefaultAzureCredential
from azure.keyvault.secrets import SecretClient
import openai

app = Flask(__name__)

# рд╕реБрд░рдХреНрд╖рд┐рдд рдкреНрд░рд╡реЗрд╢рд╛рд╕рд╛рдареА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрд┐рдд рдУрд│рдЦ рд╡рд╛рдкрд░рд╛
credential = DefaultAzureCredential()
vault_url = "https://{vault-name}.vault.azure.net"
client = SecretClient(vault_url=vault_url, credential=credential)

@app.route('/api/chat', methods=['POST'])
def chat():
    user_message = request.json.get('message')
    
    # рдХреА рд╡реНрд╣реЙрд▓реНрдЯрдордзреВрди OpenAI рдХреА рдорд┐рд│рд╡рд╛
    openai_key = client.get_secret("openai-api-key").value
    openai.api_key = openai_key
    
    response = openai.ChatCompletion.create(
        model="gpt-4",
        messages=[{"role": "user", "content": user_message}]
    )
    
    return jsonify({"response": response.choices[0].message.content})

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8000)
```

**рдлрд╛рдЗрд▓: azure.yaml**
```yaml
name: ai-chat-app
services:
  api:
    project: ./src/ai-chat
    language: python
    host: containerapp
```

**рдлрд╛рдЗрд▓: infra/main.bicep**
```bicep
param location string = resourceGroup().location
param environmentName string

var resourceToken = uniqueString(subscription().id, environmentName, location)

// Container Apps Environment
module containerEnv './app/container-env.bicep' = {
  name: 'container-env-${resourceToken}'
  params: {
    location: location
    environmentName: environmentName
  }
}

// Key Vault for secrets
resource keyVault 'Microsoft.KeyVault/vaults@2023-02-01' = {
  name: 'kv-${resourceToken}'
  location: location
  properties: {
    sku: {
      family: 'A'
      name: 'standard'
    }
    tenantId: subscription().tenantId
    enableRbacAuthorization: true
  }
}

// Container App with Managed Identity
module aiChatApp './app/container-app.bicep' = {
  name: 'ai-chat-app-${resourceToken}'
  params: {
    location: location
    environmentId: containerEnv.outputs.environmentId
    containerImage: 'your-registry.azurecr.io/ai-chat:latest'
    keyVaultName: keyVault.name
  }
}
```

**рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рдХрдорд╛рдВрдбреНрд╕:**
```bash
# рд╡рд╛рддрд╛рд╡рд░рдг рд╕реЗрдЯ рдХрд░рд╛
azd init --template ai-chat-app
azd env new dev

# рдУрдкрдирдПрдЖрдп рдХреЙрдиреНрдлрд┐рдЧрд░ рдХрд░рд╛
azd env set AZURE_OPENAI_ENDPOINT "https://your-openai.openai.azure.com/"
azd env set AZURE_OPENAI_DEPLOYMENT "gpt-4"

# рддреИрдирд╛рдд рдХрд░рд╛
azd up

# API рдЪрд╛рдЪрдгреА рдХрд░рд╛
curl -X POST $(azd show --output json | jq -r '.services.api.endpoint')/api/chat \
  -H "Content-Type: application/json" \
  -d '{"message": "Hello, how are you?"}'
```

### рдЙрджрд╛рд╣рд░рдг 3: рдмреЕрдХрдЧреНрд░рд╛рдЙрдВрдб рд╡рд░реНрдХрд░рд╕рд╣ рдХреНрдпреВ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ

**рдкрд░рд┐рд╕реНрдерд┐рддреА**: рдореЗрд╕реЗрдЬ рдХреНрдпреВрд╕рд╣ рдСрд░реНрдбрд░ рдкреНрд░реЛрд╕реЗрд╕рд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдо

**рдбрд┐рд░реЗрдХреНрдЯрд░реА рд╕реНрдЯреНрд░рдХреНрдЪрд░:**
```
queue-worker/
тФЬтФАтФА azure.yaml
тФЬтФАтФА infra/
тФВ   тФЬтФАтФА main.bicep
тФВ   тФЬтФАтФА app/
тФВ   тФВ   тФЬтФАтФА api.bicep
тФВ   тФВ   тФФтФАтФА worker.bicep
тФВ   тФФтФАтФА core/
тФВ       тФЬтФАтФА storage-queue.bicep
тФВ       тФФтФАтФА servicebus.bicep
тФФтФАтФА src/
    тФЬтФАтФА api/
    тФФтФАтФА worker/
```

**рдлрд╛рдЗрд▓: src/worker/processor.py**
```python
import os
from azure.storage.queue import QueueClient
from azure.identity import DefaultAzureCredential

def process_orders():
    credential = DefaultAzureCredential()
    queue_url = os.getenv('AZURE_QUEUE_URL')
    
    queue_client = QueueClient.from_queue_url(
        queue_url=queue_url,
        credential=credential
    )
    
    while True:
        messages = queue_client.receive_messages(max_messages=10)
        for message in messages:
            # рдСрд░реНрдбрд░ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░рд╛
            print(f"Processing order: {message.content}")
            
            # рд╕рдВрджреЗрд╢ рдкреВрд░реНрдг рдХрд░рд╛
            queue_client.delete_message(message)

if __name__ == '__main__':
    process_orders()
```

**рдлрд╛рдЗрд▓: azure.yaml**
```yaml
name: order-processing
services:
  api:
    project: ./src/api
    language: python
    host: containerapp
    
  worker:
    project: ./src/worker
    language: python
    host: containerapp
```

**рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ:**
```bash
# рдкреНрд░рд╛рд░рдВрдн рдХрд░рд╛
azd init

# рд░рд╛рдВрдЧреЗрдЪреНрдпрд╛ рд╕рдВрд░рдЪрдиреЗрд╕рд╣ рддреИрдирд╛рдд рдХрд░рд╛
azd up

# рд░рд╛рдВрдЧреЗрдЪреНрдпрд╛ рд▓рд╛рдВрдмреАрд╡рд░ рдЖрдзрд╛рд░рд┐рдд рдХрд╛рдордЧрд╛рд░рд╛рдЪрд╛ рдкреНрд░рдорд╛рдг рд╡рд╛рдврд╡рд╛
az containerapp update \
  --name worker \
  --resource-group rg-order-processing \
  --scale-rule-name queue-scaling \
  --scale-rule-type azure-queue \
  --scale-rule-metadata queueName=orders accountName=storageaccount
```

## рдкреНрд░рдЧрдд рдкреЕрдЯрд░реНрдиреНрд╕

### рдкреЕрдЯрд░реНрди 1: рдмреНрд▓реВ-рдЧреНрд░реАрди рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ

```bash
# рдирд╡реАрди рдкреБрдирд░рд╛рд╡рд▓реЛрдХрди рд╡рд╛рд╣рддреВрдХ рди рдХрд░рддрд╛ рддрдпрд╛рд░ рдХрд░рд╛
azd deploy api --revision-suffix blue --no-traffic

# рдирд╡реАрди рдкреБрдирд░рд╛рд╡рд▓реЛрдХрди рддрдкрд╛рд╕рд╛
curl https://api--blue.nicegrass-12345.eastus.azurecontainerapps.io/health

# рд╡рд╛рд╣рддреВрдХ рд╡рд┐рднрд╛рдЬрд┐рдд рдХрд░рд╛ (реиреж% рдирд┐рд│реНрдпрд╛, реореж% рд╡рд░реНрддрдорд╛рдирд╛рдХрдбреЗ)
az containerapp ingress traffic set \
  --name api \
  --resource-group rg-myapp \
  --revision-weight latest=80 blue=20

# рдкреВрд░реНрдгрдкрдгреЗ рдирд┐рд│реНрдпрд╛рдХрдбреЗ рд╡рд│рд╡рд╛
az containerapp ingress traffic set \
  --name api \
  --resource-group rg-myapp \
  --revision-weight blue=100
```

### рдкреЕрдЯрд░реНрди 2: AZD рд╕рд╣ рдХреЕрдирд░реА рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ

**рдлрд╛рдЗрд▓: .azure/dev/config.json**
```json
{
  "deploymentStrategy": "canary",
  "canary": {
    "initialTrafficPercentage": 10,
    "incrementPercentage": 10,
    "intervalMinutes": 5
  }
}
```

**рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рд╕реНрдХреНрд░рд┐рдкреНрдЯ:**
```bash
#!/bin/bash
# deploy-canary.sh

# рдирд╡реАрди рдЖрд╡реГрддреНрддреА 10% рдЯреНрд░реЕрдлрд┐рдХрд╕рд╣ рддреИрдирд╛рдд рдХрд░рд╛
azd deploy api --revision-mode multiple

# рдореЗрдЯреНрд░рд┐рдХреНрд╕ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рд╛
azd monitor --service api --duration 5m

# рдЯреНрд░реЕрдлрд┐рдХ рд╣рд│реВрд╣рд│реВ рд╡рд╛рдврд╡рд╛
for i in {20..100..10}; do
  echo "Increasing traffic to $i%"
  az containerapp revision set-traffic \
    --name api \
    --resource-group rg-myapp \
    --revision-weight latest=$i
  
  sleep 300  # 5 рдорд┐рдирд┐рдЯреЗ рдерд╛рдВрдмрд╛
done
```

### рдкреЕрдЯрд░реНрди 3: рдорд▓реНрдЯреА-рд░реАрдЬрди рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ

**рдлрд╛рдЗрд▓: azure.yaml**
```yaml
name: global-app
services:
  api:
    project: ./src/api
    language: python
    host: containerapp
    regions:
      - eastus
      - westeurope
      - southeastasia
```

**рдлрд╛рдЗрд▓: infra/multi-region.bicep**
```bicep
param regions array = ['eastus', 'westeurope', 'southeastasia']

module containerApps './app/container-app.bicep' = [for region in regions: {
  name: 'app-${region}'
  params: {
    location: region
    environmentName: environmentName
  }
}]

// Traffic Manager for global load balancing
resource trafficManager 'Microsoft.Network/trafficManagerProfiles@2022-04-01' = {
  name: 'tm-global-app'
  location: 'global'
  properties: {
    trafficRoutingMethod: 'Performance'
    endpoints: [for i in range(0, length(regions)): {
      name: 'endpoint-${regions[i]}'
      type: 'Microsoft.Network/trafficManagerProfiles/externalEndpoints'
      properties: {
        target: containerApps[i].outputs.fqdn
        endpointStatus: 'Enabled'
      }
    }]
  }
}
```

**рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ:**
```bash
# рд╕рд░реНрд╡ рдкреНрд░рджреЗрд╢рд╛рдВрдордзреНрдпреЗ рддреИрдирд╛рдд рдХрд░рд╛
azd up

# рдПрдВрдбрдкреЙрдЗрдВрдЯреНрд╕ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рд╛
azd show --output json | jq '.services.api.endpoints'
```

### рдкреЕрдЯрд░реНрди 4: Dapr рдПрдХрддреНрд░реАрдХрд░рдг

**рдлрд╛рдЗрд▓: infra/app/dapr-enabled.bicep**
```bicep
resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
  name: 'dapr-app'
  properties: {
    configuration: {
      dapr: {
        enabled: true
        appId: 'order-service'
        appPort: 8000
        appProtocol: 'http'
      }
    }
    template: {
      containers: [
        {
          name: 'app'
          image: containerImage
        }
      ]
    }
  }
}
```

**Dapr рд╕рд╣ рдЕтАНреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛрдб:**
```python
from flask import Flask
from dapr.clients import DaprClient

app = Flask(__name__)

@app.route('/orders', methods=['POST'])
def create_order():
    with DaprClient() as client:
        # рд╕реНрдерд┐рддреА рдЬрддрди рдХрд░рд╛
        client.save_state(
            store_name='statestore',
            key='order-123',
            value={'status': 'pending'}
        )
        
        # рдШрдЯрдирд╛ рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░рд╛
        client.publish_event(
            pubsub_name='pubsub',
            topic_name='orders',
            data={'orderId': '123'}
        )
    
    return {'status': 'created'}
```

## рд╕рд░реНрд╡реЛрддреНрддрдо рдкрджреНрдзрддреА

### 1. рд╕рдВрд╕рд╛рдзрдирд╛рдВрдЪреЗ рдЖрдпреЛрдЬрди

```bash
# рд╕реБрд╕рдВрдЧрдд рдирд╛рдордХрд░рдг рдкрджреНрдзрддреА рд╡рд╛рдкрд░рд╛
azd env set AZURE_ENV_NAME "myapp-prod"
azd env set AZURE_LOCATION "eastus"

# рдЦрд░реНрдЪ рдЯреНрд░реЕрдХрд┐рдВрдЧрд╕рд╛рдареА рд╕рдВрд╕рд╛рдзрдирд╛рдВрдирд╛ рдЯреЕрдЧ рдХрд░рд╛
azd env set AZURE_TAGS "Environment=Production,CostCenter=Engineering"
```

### 2. рд╕реБрд░рдХреНрд╖рд╛ рд╕рд░реНрд╡реЛрддреНрддрдо рдкрджреНрдзрддреА

```bicep
// Always use managed identity
resource containerApp 'Microsoft.App/containerApps@2023-05-01' = {
  identity: {
    type: 'SystemAssigned'
  }
}

// Store secrets in Key Vault
resource keyVault 'Microsoft.KeyVault/vaults@2023-02-01' = {
  properties: {
    enableRbacAuthorization: true
    networkAcls: {
      defaultAction: 'Deny'
      bypass: 'AzureServices'
    }
  }
}

// Use private endpoints
resource privateEndpoint 'Microsoft.Network/privateEndpoints@2023-04-01' = {
  properties: {
    subnet: {
      id: subnetId
    }
    privateLinkServiceConnections: [
      {
        name: 'containerapp-connection'
        properties: {
          privateLinkServiceId: containerApp.id
        }
      }
    ]
  }
}
```

### 3. рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдСрдкреНрдЯрд┐рдорд╛рдпрдЭреЗрд╢рди

```yaml
# azure.yaml with performance settings
services:
  api:
    project: ./src/api
    host: containerapp
    resources:
      cpu: 1.0
      memory: 2Gi
    scale:
      minReplicas: 2
      maxReplicas: 20
      rules:
        - name: http-rule
          http:
            concurrent: 100
```

### 4. рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ рдЖрдгрд┐ рдирд┐рд░реАрдХреНрд╖рдг

```bash
# рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдЕрдВрддрд░реНрджреГрд╖реНрдЯреА рд╕рдХреНрд╖рдо рдХрд░рд╛
azd env set APPLICATIONINSIGHTS_CONNECTION_STRING "InstrumentationKey=..."

# рд╡рд╛рд╕реНрддрд╡рд┐рдХ рд╡реЗрд│реЗрдд рд▓реЙрдЧреНрд╕ рдкрд╣рд╛
azd logs api --follow

# рдореЗрдЯреНрд░рд┐рдХреНрд╕рдЪреЗ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рд╛
azd monitor --service api

# рдЕрд▓рд░реНрдЯ рддрдпрд╛рд░ рдХрд░рд╛
az monitor metrics alert create \
  --name high-cpu-alert \
  --resource-group rg-myapp \
  --scopes $(azd show --output json | jq -r '.services.api.resourceId') \
  --condition "avg CPU > 80" \
  --description "Alert when CPU exceeds 80%"
```

### 5. рдЦрд░реНрдЪрд╛рдЪрд╛ рдСрдкреНрдЯрд┐рдорд╛рдпрдЭреЗрд╢рди

```bash
# рд╡рд╛рдкрд░рд╛рдд рдирд╕рддрд╛рдирд╛ рд╢реВрдиреНрдпрд╛рд╡рд░ рд╕реНрдХреЗрд▓ рдХрд░рд╛
az containerapp update \
  --name api \
  --resource-group rg-myapp \
  --min-replicas 0

# рдбреЗрд╡реНрд╣рд▓рдкрдореЗрдВрдЯ рд╡рд╛рддрд╛рд╡рд░рдгрд╛рд╕рд╛рдареА рд╕реНрдкреЙрдЯ рдЗрдВрд╕реНрдЯрдиреНрд╕реЗрд╕ рд╡рд╛рдкрд░рд╛
azd env set CONTAINER_APP_REPLICA_TYPE "Spot"

# рдмрдЬреЗрдЯ рдЕрд▓рд░реНрдЯ рд╕реЗрдЯ рдХрд░рд╛
az consumption budget create \
  --budget-name myapp-budget \
  --amount 100 \
  --time-grain Monthly \
  --threshold 80
```

### 6. CI/CD рдПрдХрддреНрд░реАрдХрд░рдг

**GitHub Actions рдЙрджрд╛рд╣рд░рдг:**
```yaml
name: Deploy to Azure Container Apps

on:
  push:
    branches: [main]

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      
      - name: Setup AZD
        uses: Azure/setup-azd@v1
      
      - name: Login to Azure
        run: |
          azd auth login --client-id ${{ secrets.AZURE_CLIENT_ID }} \
            --client-secret ${{ secrets.AZURE_CLIENT_SECRET }} \
            --tenant-id ${{ secrets.AZURE_TENANT_ID }}
      
      - name: Deploy
        run: azd up --no-prompt
        env:
          AZURE_ENV_NAME: ${{ secrets.AZURE_ENV_NAME }}
          AZURE_LOCATION: ${{ secrets.AZURE_LOCATION }}
```

## рд╕рд╛рдорд╛рдиреНрдп рдХрдорд╛рдВрдбреНрд╕ рд╕рдВрджрд░реНрдн

```bash
# рдирд╡реАрди рдХрдВрдЯреЗрдирд░ рдЕреЕрдк рдкреНрд░рдХрд▓реНрдк рдкреНрд░рд╛рд░рдВрдн рдХрд░рд╛
azd init --template <template-name>

# рдкрд╛рдпрд╛рднреВрдд рд╕реБрд╡рд┐рдзрд╛ рдЖрдгрд┐ рдЕреЕрдкреНрд▓рд┐рдХреЗрд╢рди рддреИрдирд╛рдд рдХрд░рд╛
azd up

# рдлрдХреНрдд рдЕреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдХреЛрдб рддреИрдирд╛рдд рдХрд░рд╛ (рдкрд╛рдпрд╛рднреВрдд рд╕реБрд╡рд┐рдзрд╛ рд╡рдЧрд│рд╛)
azd deploy

# рдлрдХреНрдд рдкрд╛рдпрд╛рднреВрдд рд╕реБрд╡рд┐рдзрд╛ рдкреНрд░рджрд╛рди рдХрд░рд╛
azd provision

# рддреИрдирд╛рдд рдХреЗрд▓реЗрд▓реНрдпрд╛ рд╕рдВрд╕рд╛рдзрдирд╛рдВрдЪреЗ рджреГрд╢реНрдп рдкрд╣рд╛
azd show

# рд▓реЙрдЧ рдкреНрд░рд╡рд╛рд╣рд┐рдд рдХрд░рд╛
azd logs <service-name> --follow

# рдЕреЕрдкреНрд▓рд┐рдХреЗрд╢рдирдЪреЗ рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рд╛
azd monitor --overview

# рд╕рдВрд╕рд╛рдзрдиреЗ рд╕рд╛рдл рдХрд░рд╛
azd down --force --purge
```

## рд╕рдорд╕реНрдпрд╛ рдирд┐рд░рд╛рдХрд░рдг

### рд╕рдорд╕реНрдпрд╛: рдХрдВрдЯреЗрдирд░ рд╕реБрд░реВ рд╣реЛрдгреНрдпрд╛рд╕ рдЕрдпрд╢рд╕реНрд╡реА

```bash
# рд▓реЙрдЧреНрд╕ рддрдкрд╛рд╕рд╛
azd logs api --tail 100

# рдХрдВрдЯреЗрдирд░ рдЗрд╡реНрд╣реЗрдВрдЯреНрд╕ рдкрд╣рд╛
az containerapp revision show \
  --name api \
  --resource-group rg-myapp \
  --revision latest

# рд╕реНрдерд╛рдирд┐рдХ рд╕реНрддрд░рд╛рд╡рд░ рдЪрд╛рдЪрдгреА рдХрд░рд╛
docker build -t api:local ./src/api
docker run -p 8000:8000 api:local
```

### рд╕рдорд╕реНрдпрд╛: рдХрдВрдЯреЗрдирд░ рдЕтАНреЕрдк рдПрдВрдбрдкреЙрдЗрдВрдЯрд╡рд░ рдкреНрд░рд╡реЗрд╢ рдХрд░реВ рд╢рдХрдд рдирд╛рд╣реА

```bash
# рдЗрдирдЧреНрд░реЗрд╕ рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рд╛
az containerapp show \
  --name api \
  --resource-group rg-myapp \
  --query properties.configuration.ingress

# рдЕрдВрддрд░реНрдЧрдд рдЗрдирдЧреНрд░реЗрд╕ рд╕рдХреНрд╖рдо рдЖрд╣реЗ рдХрд╛ рддреЗ рддрдкрд╛рд╕рд╛
az containerapp ingress update \
  --name api \
  --resource-group rg-myapp \
  --external true
```

### рд╕рдорд╕реНрдпрд╛: рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рд╕рдорд╕реНрдпрд╛

```bash
# рд╕рдВрд╕рд╛рдзрдирд╛рдВрдЪрд╛ рд╡рд╛рдкрд░ рддрдкрд╛рд╕рд╛
az monitor metrics list \
  --resource $(azd show --output json | jq -r '.services.api.resourceId') \
  --metric "CPUPercentage,MemoryPercentage"

# рд╕рдВрд╕рд╛рдзрдиреЗ рд╡рд╛рдврд╡рд╛
az containerapp update \
  --name api \
  --resource-group rg-myapp \
  --cpu 2.0 \
  --memory 4Gi
```

## рдЕрддрд┐рд░рд┐рдХреНрдд рд╕рдВрд╕рд╛рдзрдиреЗ рдЖрдгрд┐ рдЙрджрд╛рд╣рд░рдгреЗ
- [рдорд╛рдпрдХреНрд░реЛрд╕рд░реНрд╡реНрд╣рд┐рд╕реЗрд╕ рдЙрджрд╛рд╣рд░рдг](./microservices/README.md)
- [рд╕рд╛рдзреЗ Flash API рдЙрджрд╛рд╣рд░рдг](./simple-flask-api/README.md)
- [Azure Container Apps рджрд╕реНрддрдРрд╡рдЬ](https://learn.microsoft.com/azure/container-apps/)
- [AZD рдЯреЗрдореНрдкрд▓реЗрдЯреНрд╕ рдЧреЕрд▓рд░реА](https://azure.github.io/awesome-azd/)
- [рдХрдВрдЯреЗрдирд░ рдЕтАНреЕрдкреНрд╕ рдирдореБрдиреЗ](https://github.com/Azure-Samples/container-apps-samples)
- [Bicep рдЯреЗрдореНрдкрд▓реЗрдЯреНрд╕](https://learn.microsoft.com/azure/azure-resource-manager/bicep/)

## рдпреЛрдЧрджрд╛рди

рдирд╡реАрди рдХрдВрдЯреЗрдирд░ рдЕтАНреЕрдкреНрд╕ рдЙрджрд╛рд╣рд░рдгреЗ рдпреЛрдЧрджрд╛рди рджреЗрдгреНрдпрд╛рд╕рд╛рдареА:

1. рддреБрдордЪреНрдпрд╛ рдЙрджрд╛рд╣рд░рдгрд╛рд╕рд╣ рдирд╡реАрди рд╕рдмрдбрд┐рд░реЗрдХреНрдЯрд░реА рддрдпрд╛рд░ рдХрд░рд╛
2. рдкреВрд░реНрдг `azure.yaml`, `infra/`, рдЖрдгрд┐ `src/` рдлрд╛рдЗрд▓реНрд╕ рд╕рдорд╛рд╡рд┐рд╖реНрдЯ рдХрд░рд╛
3. рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рд╕реВрдЪрдирд╛ рдЕрд╕рд▓реЗрд▓реЗ рд╡реНрдпрд╛рдкрдХ README рдЬреЛрдбрд╛
4. `azd up` рд╕рд╣ рдбрд┐рдкреНрд▓реЙрдпрдореЗрдВрдЯ рдЪрд╛рдЪрдгреА рдХрд░рд╛
5. рдПрдХ рдкреБрд▓ рд░рд┐рдХреНрд╡реЗрд╕реНрдЯ рд╕рдмрдорд┐рдЯ рдХрд░рд╛

---

**рдорджрддреАрдЪреА рдЧрд░рдЬ рдЖрд╣реЗ?** рд╕рдорд░реНрдерди рдЖрдгрд┐ рдкреНрд░рд╢реНрдирд╛рдВрд╕рд╛рдареА [Microsoft Foundry Discord](https://discord.gg/microsoft-azure) рд╕рдореБрджрд╛рдпрд╛рдордзреНрдпреЗ рд╕рд╛рдореАрд▓ рд╡реНрд╣рд╛.

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рд╣рд╛ рджрд╕реНрддрдРрд╡рдЬ AI рднрд╛рд╖рд╛рдВрддрд░ рд╕реЗрд╡рд╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рд╡рд╛рдкрд░реВрди рднрд╛рд╖рд╛рдВрддрд░рд┐рдд рдХрд░рдгреНрдпрд╛рдд рдЖрд▓рд╛ рдЖрд╣реЗ. рдЖрдореНрд╣реА рдЕрдЪреВрдХрддреЗрд╕рд╛рдареА рдкреНрд░рдпрддреНрдирд╢реАрд▓ рдЕрд╕рд▓реЛ рддрд░реА, рдХреГрдкрдпрд╛рд╕ рд▓рдХреНрд╖рд╛рдд рдареЗрд╡рд╛ рдХреА рд╕реНрд╡рдпрдВрдЪрд▓рд┐рдд рднрд╛рд╖рд╛рдВрддрд░реЗ рддреНрд░реБрдЯреА рдХрд┐рдВрд╡рд╛ рдЕрдЪреВрдХрддреЗрдЪреНрдпрд╛ рдЕрднрд╛рд╡рд╛рдиреЗ рдпреБрдХреНрдд рдЕрд╕реВ рд╢рдХрддрд╛рдд. рдореВрд│ рднрд╛рд╖реЗрддреАрд▓ рджрд╕реНрддрдРрд╡рдЬ рд╣рд╛ рдЕрдзрд┐рдХреГрдд рд╕реНрд░реЛрдд рдорд╛рдирд▓рд╛ рдЬрд╛рд╡рд╛. рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рдорд╛рд╣рд┐рддреАрд╕рд╛рдареА, рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡реА рднрд╛рд╖рд╛рдВрддрд░рд╛рдЪреА рд╢рд┐рдлрд╛рд░рд╕ рдХреЗрд▓реА рдЬрд╛рддреЗ. рдпрд╛ рднрд╛рд╖рд╛рдВрддрд░рд╛рдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди рдЙрджреНрднрд╡рд▓реЗрд▓реНрдпрд╛ рдХреЛрдгрддреНрдпрд╛рд╣реА рдЧреИрд░рд╕рдордЬ рдХрд┐рдВрд╡рд╛ рдЪреБрдХреАрдЪреНрдпрд╛ рдЕрд░реНрдерд╛рд╕рд╛рдареА рдЖрдореНрд╣реА рдЬрдмрд╛рдмрджрд╛рд░ рд░рд╛рд╣рдгрд╛рд░ рдирд╛рд╣реА.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->