# рдорд▓реНрдЯреА-рдПрдЬрдВрдЯ рд╕рдордиреНрд╡рдп рдкрджреНрдзрддреА

тП▒я╕П **рдЕрдиреБрдорд╛рдирд┐рдд рд╡реЗрд│**: 60-75 рдорд┐рдирд┐рдЯреЗ | ЁЯТ░ **рдЕрдиреБрдорд╛рдирд┐рдд рдЦрд░реНрдЪ**: ~$100-300/рдорд╣рд┐рдирд╛ | тнР **рдЬрдЯрд┐рд▓рддрд╛**: рдкреНрд░рдЧрдд

**ЁЯУЪ рд╢рд┐рдХрдгреНрдпрд╛рдЪрд╛ рдорд╛рд░реНрдЧ:**
- тЖР рдорд╛рдЧреАрд▓: [рдХреНрд╖рдорддрд╛ рдирд┐рдпреЛрдЬрди](capacity-planning.md) - рд╕рдВрд╕рд╛рдзрди рдЖрдХрд╛рд░ рдЖрдгрд┐ рд╕реНрдХреЗрд▓рд┐рдВрдЧ рдзреЛрд░рдгреЗ
- ЁЯОп **рддреБрдореНрд╣реА рдпреЗрдереЗ рдЖрд╣рд╛рдд**: рдорд▓реНрдЯреА-рдПрдЬрдВрдЯ рд╕рдордиреНрд╡рдп рдкрджреНрдзрддреА (рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрд╢рди, рд╕рдВрд╡рд╛рдж, рд╕реНрдерд┐рддреА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди)
- тЖТ рдкреБрдвреЗ: [SKU рдирд┐рд╡рдб](sku-selection.md) - рдпреЛрдЧреНрдп Azure рд╕реЗрд╡рд╛ рдирд┐рд╡рдбрдгреЗ
- ЁЯПа [рдХреЛрд░реНрд╕ рд╣реЛрдо](../../README.md)

---

## рддреБрдореНрд╣реА рдХрд╛рдп рд╢рд┐рдХрд╛рд▓

рдпрд╛ рдзрдбреНрдпрд╛рдЪреЗ рдкреВрд░реНрдг рдХреЗрд▓реНрдпрд╛рд╡рд░, рддреБрдореНрд╣реА:
- **рдорд▓реНрдЯреА-рдПрдЬрдВрдЯ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░** рдкрджреНрдзрддреА рд╕рдордЬреВрди рдШреНрдпрд╛рд▓ рдЖрдгрд┐ рддреНрдпрд╛рдВрдЪрд╛ рд╡рд╛рдкрд░ рдХрдзреА рдХрд░рд╛рдпрдЪрд╛ рддреЗ рд╢рд┐рдХрд╛рд▓
- **рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрд╢рди рдкрджреНрдзрддреА** (рдХреЗрдВрджреНрд░реАрдХреГрдд, рд╡рд┐рдХреЗрдВрджреНрд░рд┐рдд, рд╢реНрд░реЗрдгреАрдмрджреНрдз) рдЕрдВрдорд▓рд╛рдд рдЖрдгрд╛рд▓
- **рдПрдЬрдВрдЯ рд╕рдВрд╡рд╛рдж** рдзреЛрд░рдгреЗ рдбрд┐рдЭрд╛рдЗрди рдХрд░рд╛рд▓ (рд╕рдордХрд╛рд▓реАрди, рдЕрд╕рдордХрд╛рд▓реАрди, рдЗрд╡реНрд╣реЗрдВрдЯ-рдбреНрд░рд┐рд╡реНрд╣рди)
- рд╡рд┐рддрд░рд┐рдд рдПрдЬрдВрдЯреНрд╕рдордзреНрдпреЗ **рд╕рд╛рдорд╛рдпрд┐рдХ рд╕реНрдерд┐рддреА** рд╡реНрдпрд╡рд╕реНрдерд╛рдкрд┐рдд рдХрд░рд╛рд▓
- AZD рд╕рд╣ Azure рд╡рд░ **рдорд▓реНрдЯреА-рдПрдЬрдВрдЯ рд╕рд┐рд╕реНрдЯрдореНрд╕** рддреИрдирд╛рдд рдХрд░рд╛рд▓
- рд╡рд╛рд╕реНрддрд╡рд┐рдХ рдЬрдЧрд╛рддреАрд▓ AI рдкрд░рд┐рд╕реНрдерд┐рддреАрд╕рд╛рдареА **рд╕рдордиреНрд╡рдп рдкрджреНрдзрддреА** рд▓рд╛рдЧреВ рдХрд░рд╛рд▓
- рд╡рд┐рддрд░рд┐рдд рдПрдЬрдВрдЯ рд╕рд┐рд╕реНрдЯрдореНрд╕рдЪреЗ рдирд┐рд░реАрдХреНрд╖рдг рдЖрдгрд┐ рдбреАрдмрдЧ рдХрд░рд╛рд▓

## рдорд▓реНрдЯреА-рдПрдЬрдВрдЯ рд╕рдордиреНрд╡рдп рдХрд╛ рдорд╣рддреНрддреНрд╡рд╛рдЪрд╛ рдЖрд╣реЗ

### рдЙрддреНрдХреНрд░рд╛рдВрддреА: рд╕рд┐рдВрдЧрд▓ рдПрдЬрдВрдЯрдкрд╛рд╕реВрди рдорд▓реНрдЯреА-рдПрдЬрдВрдЯрдкрд░реНрдпрдВрдд

**рд╕рд┐рдВрдЧрд▓ рдПрдЬрдВрдЯ (рд╕реЛрдкреЗ):**
```
User тЖТ Agent тЖТ Response
```
- тЬЕ рд╕рдордЬрд╛рдпрд▓рд╛ рдЖрдгрд┐ рдЕрдВрдорд▓рд╛рдд рдЖрдгрд╛рдпрд▓рд╛ рд╕реЛрдкреЗ
- тЬЕ рд╕рд╛рдзреНрдпрд╛ рдХрд╛рдорд╛рдВрд╕рд╛рдареА рдЬрд▓рдж
- тЭМ рдПрдХрд╛ рдореЙрдбреЗрд▓рдЪреНрдпрд╛ рдХреНрд╖рдорддреЗрдкреБрд░рддреЗ рдорд░реНрдпрд╛рджрд┐рдд
- тЭМ рдЬрдЯрд┐рд▓ рдХрд╛рдореЗ рд╕рдорд╛рдВрддрд░рд┐рдд рдХрд░реВ рд╢рдХрдд рдирд╛рд╣реА
- тЭМ рдХреЛрдгрддреАрд╣реА рд╡рд┐рд╢реЗрд╖рддрд╛ рдирд╛рд╣реА

**рдорд▓реНрдЯреА-рдПрдЬрдВрдЯ рд╕рд┐рд╕реНрдЯрдо (рдкреНрд░рдЧрдд):**
```
           тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
           тФВ OrchestratorтФВ
           тФФтФАтФАтФАтФАтФАтФАтФмтФАтФАтФАтФАтФАтФАтФШ
        тФМтФАтФАтФАтФАтФАтФАтФАтФАтФАтФ╝тФАтФАтФАтФАтФАтФАтФАтФАтФАтФР
        тФВ         тФВ         тФВ
    тФМтФАтФАтФАтЦ╝тФАтФАтФР  тФМтФАтФАтЦ╝тФАтФАтФАтФР  тФМтФАтФАтЦ╝тФАтФАтФАтФАтФР
    тФВAgent1тФВ  тФВAgent2тФВ  тФВAgent3 тФВ
    тФВ(Plan)тФВ  тФВ(Code)тФВ  тФВ(Review)тФВ
    тФФтФАтФАтФАтФАтФАтФАтФШ  тФФтФАтФАтФАтФАтФАтФАтФШ  тФФтФАтФАтФАтФАтФАтФАтФАтФШ
```
- тЬЕ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХрд╛рдорд╛рдВрд╕рд╛рдареА рд╡рд┐рд╢реЗрд╖ рдПрдЬрдВрдЯреНрд╕
- тЬЕ рдЧрддреАрд╕рд╛рдареА рд╕рдорд╛рдВрддрд░ рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреА
- тЬЕ рдореЙрдбреНрдпреВрд▓рд░ рдЖрдгрд┐ рджреЗрдЦрднрд╛рд▓ рдХрд░рдгреНрдпрд╛рдпреЛрдЧреНрдп
- тЬЕ рдЬрдЯрд┐рд▓ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣рд╛рдВрдордзреНрдпреЗ рдЪрд╛рдВрдЧрд▓реЗ
- тЪая╕П рд╕рдордиреНрд╡рдп рд▓реЙрдЬрд┐рдХ рдЖрд╡рд╢реНрдпрдХ

**рдЙрджрд╛рд╣рд░рдг**: рд╕рд┐рдВрдЧрд▓ рдПрдЬрдВрдЯ рдореНрд╣рдгрдЬреЗ рдПрдХ рд╡реНрдпрдХреНрддреА рд╕рд░реНрд╡ рдХрд╛рдореЗ рдХрд░рдд рдЖрд╣реЗ. рдорд▓реНрдЯреА-рдПрдЬрдВрдЯ рдореНрд╣рдгрдЬреЗ рдПрдХ рдЯреАрдо рдЬрд┐рдереЗ рдкреНрд░рддреНрдпреЗрдХ рд╕рджрд╕реНрдпрд╛рдХрдбреЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреМрд╢рд▓реНрдпреЗ рдЖрд╣реЗрдд (рд╕рдВрд╢реЛрдзрдХ, рдХреЛрдбрд░, рдкреБрдирд░рд╛рд╡рд▓реЛрдХрдХ, рд▓реЗрдЦрдХ) рдЖрдгрд┐ рддреЗ рдПрдХрддреНрд░ рдХрд╛рдо рдХрд░рддрд╛рдд.

---

## рдореБрдЦреНрдп рд╕рдордиреНрд╡рдп рдкрджреНрдзрддреА

### рдкрджреНрдзрдд 1: рдЕрдиреБрдХреНрд░рдорд┐рдХ рд╕рдордиреНрд╡рдп (рдЪреЗрди рдСрдл рд░рд┐рд╕реНрдкреЙрдиреНрд╕рд┐рдмрд┐рд▓рд┐рдЯреА)

**рдХрдзреА рд╡рд╛рдкрд░рд╛рдпрдЪреЗ**: рдХрд╛рдореЗ рд╡рд┐рд╢рд┐рд╖реНрдЯ рдХреНрд░рдорд╛рдиреЗ рдкреВрд░реНрдг рдХрд░рдгреЗ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ, рдкреНрд░рддреНрдпреЗрдХ рдПрдЬрдВрдЯ рдорд╛рдЧреАрд▓ рдЖрдЙрдЯрдкреБрдЯрд╡рд░ рдЖрдзрд╛рд░рд┐рдд рдЕрд╕рддреЛ.

```mermaid
sequenceDiagram
    participant User
    participant Orchestrator
    participant Agent1 as рд╕рдВрд╢реЛрдзрди рдПрдЬрдВрдЯ
    participant Agent2 as рд▓реЗрдЦрдХ рдПрдЬрдВрдЯ
    participant Agent3 as рд╕рдВрдкрд╛рджрдХ рдПрдЬрдВрдЯ
    
    User->>Orchestrator: "рдПрдЖрдпрдмрджреНрджрд▓ рд▓реЗрдЦ рд▓рд┐рд╣рд╛"
    Orchestrator->>Agent1: рд╡рд┐рд╖рдп рд╕рдВрд╢реЛрдзрди рдХрд░рд╛
    Agent1-->>Orchestrator: рд╕рдВрд╢реЛрдзрди рдкрд░рд┐рдгрд╛рдо
    Orchestrator->>Agent2: рдорд╕реБрджрд╛ рд▓рд┐рд╣рд╛ (рд╕рдВрд╢реЛрдзрди рд╡рд╛рдкрд░реВрди)
    Agent2-->>Orchestrator: рд▓реЗрдЦрд╛рдЪрд╛ рдорд╕реБрджрд╛
    Orchestrator->>Agent3: рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рд╛ рдЖрдгрд┐ рд╕реБрдзрд╛рд░рдгрд╛ рдХрд░рд╛
    Agent3-->>Orchestrator: рдЕрдВрддрд┐рдо рд▓реЗрдЦ
    Orchestrator-->>User: рдкрд░рд┐рд╖реНрдХреГрдд рд▓реЗрдЦ
    
    Note over User,Agent3: рдЕрдиреБрдХреНрд░рдорд┐рдХ: рдкреНрд░рддреНрдпреЗрдХ рдЪрд░рдг рдорд╛рдЧреАрд▓рд╕рд╛рдареА рдкреНрд░рддреАрдХреНрд╖рд╛ рдХрд░рддреЛ
```
**рдлрд╛рдпрджреЗ:**
- тЬЕ рд╕реНрдкрд╖реНрдЯ рдбреЗрдЯрд╛ рдкреНрд░рд╡рд╛рд╣
- тЬЕ рдбреАрдмрдЧ рдХрд░рд╛рдпрд▓рд╛ рд╕реЛрдкреЗ
- тЬЕ рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреА рдХреНрд░рдо рдЕрдВрджрд╛рдЬреЗ

**рдорд░реНрдпрд╛рджрд╛:**
- тЭМ рд╣рд│реВ (рдХреЛрдгрддреЗрд╣реА рд╕рдорд╛рдВрддрд░рддрд╛ рдирд╛рд╣реА)
- тЭМ рдПрдХ рдЕрдкрдпрд╢ рд╕рдВрдкреВрд░реНрдг рд╕рд╛рдЦрд│реА рдЕрдбрд╡рддреЗ
- тЭМ рдкрд░рд╕реНрдкрд░ рдЕрд╡рд▓рдВрдмрд┐рддреНрд╡ рдЕрд╕рд▓реЗрд▓реНрдпрд╛ рдХрд╛рдорд╛рдВрдирд╛ рд╣рд╛рддрд╛рд│реВ рд╢рдХрдд рдирд╛рд╣реА

**рдЙрджрд╛рд╣рд░рдг рд╡рд╛рдкрд░ рдкреНрд░рдХрд░рдгреЗ:**
- рд╕рд╛рдордЧреНрд░реА рдирд┐рд░реНрдорд┐рддреА рдкрд╛рдЗрдкрд▓рд╛рдЗрди (рд╕рдВрд╢реЛрдзрди тЖТ рд▓реЗрдЦрди тЖТ рд╕рдВрдкрд╛рджрди тЖТ рдкреНрд░рдХрд╛рд╢рди)
- рдХреЛрдб рдирд┐рд░реНрдорд┐рддреА (рдпреЛрдЬрдирд╛ тЖТ рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреА тЖТ рдЪрд╛рдЪрдгреА тЖТ рддреИрдирд╛рдд)
- рдЕрд╣рд╡рд╛рд▓ рдирд┐рд░реНрдорд┐рддреА (рдбреЗрдЯрд╛ рд╕рдВрдХрд▓рди тЖТ рд╡рд┐рд╢реНрд▓реЗрд╖рдг тЖТ рд╡реНрд╣рд┐рдЬреНрдпреБрдЕрд▓рд╛рдпрдЭреЗрд╢рди тЖТ рд╕рд╛рд░рд╛рдВрд╢)

---

### рдкрджреНрдзрдд 2: рд╕рдорд╛рдВрддрд░ рд╕рдордиреНрд╡рдп (рдлреЕрди-рдЖрдЙрдЯ/рдлреЕрди-рдЗрди)

**рдХрдзреА рд╡рд╛рдкрд░рд╛рдпрдЪреЗ**: рд╕реНрд╡рддрдВрддреНрд░ рдХрд╛рдореЗ рдПрдХрд╛рдЪ рд╡реЗрд│реА рдЪрд╛рд▓рд╡рддрд╛ рдпреЗрддрд╛рдд, рд╢реЗрд╡рдЯреА рдирд┐рдХрд╛рд▓ рдПрдХрддреНрд░ рдХреЗрд▓реЗ рдЬрд╛рддрд╛рдд.

```mermaid
graph TB
    User[рд╡рд╛рдкрд░рдХрд░реНрддрд╛ рд╡рд┐рдирдВрддреА]
    Orchestrator[рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░]
    Agent1[рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдПрдЬрдВрдЯ]
    Agent2[рд╕рдВрд╢реЛрдзрди рдПрдЬрдВрдЯ]
    Agent3[рдбреЗрдЯрд╛ рдПрдЬрдВрдЯ]
    Aggregator[рдкрд░рд┐рдгрд╛рдо рдПрдХрддреНрд░рд┐рдд рдХрд░рдгрд╛рд░рд╛]
    Response[рд╕рдВрдпреБрдХреНрдд рдкреНрд░рддрд┐рд╕рд╛рдж]
    
    User --> Orchestrator
    Orchestrator --> Agent1
    Orchestrator --> Agent2
    Orchestrator --> Agent3
    Agent1 --> Aggregator
    Agent2 --> Aggregator
    Agent3 --> Aggregator
    Aggregator --> Response
    
    style Orchestrator fill:#2196F3,stroke:#1976D2,stroke-width:3px,color:#fff
    style Aggregator fill:#4CAF50,stroke:#388E3C,stroke-width:3px,color:#fff
```
**рдлрд╛рдпрджреЗ:**
- тЬЕ рдЬрд▓рдж (рд╕рдорд╛рдВрддрд░ рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреА)
- тЬЕ рджреЛрд╖-рд╕рд╣рдирд╢реАрд▓ (рдЖрдВрд╢рд┐рдХ рдирд┐рдХрд╛рд▓ рд╕реНрд╡реАрдХрд╛рд░реНрдп)
- тЬЕ рдЖрдбрд╡реНрдпрд╛ рдкреНрд░рдорд╛рдгрд╛рдд рд╕реНрдХреЗрд▓ рд╣реЛрддреЗ

**рдорд░реНрдпрд╛рджрд╛:**
- тЪая╕П рдирд┐рдХрд╛рд▓ рдХреНрд░рдорд╛рдмрд╛рд╣реЗрд░ рдпреЗрдК рд╢рдХрддрд╛рдд
- тЪая╕П рдПрдХрддреНрд░реАрдХрд░рдг рд▓реЙрдЬрд┐рдХ рдЖрд╡рд╢реНрдпрдХ
- тЪая╕П рдЬрдЯрд┐рд▓ рд╕реНрдерд┐рддреА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди

**рдЙрджрд╛рд╣рд░рдг рд╡рд╛рдкрд░ рдкреНрд░рдХрд░рдгреЗ:**
- рдорд▓реНрдЯреА-рд╕реЛрд░реНрд╕ рдбреЗрдЯрд╛ рдЧреЛрд│рд╛ рдХрд░рдгреЗ (API + рдбреЗрдЯрд╛рдмреЗрд╕ + рд╡реЗрдм рд╕реНрдХреНрд░реЕрдкрд┐рдВрдЧ)
- рд╕реНрдкрд░реНрдзрд╛рддреНрдордХ рд╡рд┐рд╢реНрд▓реЗрд╖рдг (рдЕрдиреЗрдХ рдореЙрдбреЗрд▓реНрд╕ рд╕реЛрд▓реНрдпреВрд╢рдиреНрд╕ рддрдпрд╛рд░ рдХрд░рддрд╛рдд, рд╕рд░реНрд╡реЛрддреНрддрдо рдирд┐рд╡рдбрд▓реЗ рдЬрд╛рддреЗ)
- рднрд╛рд╖рд╛рдВрддрд░ рд╕реЗрд╡рд╛ (рдПрдХрд╛рдЪ рд╡реЗрд│реА рдЕрдиреЗрдХ рднрд╛рд╖рд╛рдВрдордзреНрдпреЗ рднрд╛рд╖рд╛рдВрддрд░)

---

### рдкрджреНрдзрдд 3: рд╢реНрд░реЗрдгреАрдмрджреНрдз рд╕рдордиреНрд╡рдп (рдореЕрдиреЗрдЬрд░-рд╡рд░реНрдХрд░)

**рдХрдзреА рд╡рд╛рдкрд░рд╛рдпрдЪреЗ**: рдЙрдк-рдХрд╛рдорд╛рдВрд╕рд╣ рдЬрдЯрд┐рд▓ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣, рдкреНрд░рддрд┐рдирд┐рдзреА рдЖрд╡рд╢реНрдпрдХ.

```mermaid
graph TB
    Master[рдореБрдЦреНрдп рд╕рдордиреНрд╡рдпрдХ]
    Manager1[рд╕рдВрд╢реЛрдзрди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ]
    Manager2[рд╕рд╛рдордЧреНрд░реА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ]
    W1[рд╡реЗрдм рд╕реНрдХреНрд░реЕрдкрд░]
    W2[рдкреЗрдкрд░ рд╡рд┐рд╢реНрд▓реЗрд╖рдХ]
    W3[рд▓реЗрдЦрдХ]
    W4[рд╕рдВрдкрд╛рджрдХ]
    
    Master --> Manager1
    Master --> Manager2
    Manager1 --> W1
    Manager1 --> W2
    Manager2 --> W3
    Manager2 --> W4
    
    style Master fill:#FF9800,stroke:#F57C00,stroke-width:3px,color:#fff
    style Manager1 fill:#2196F3,stroke:#1976D2,stroke-width:2px,color:#fff
    style Manager2 fill:#2196F3,stroke:#1976D2,stroke-width:2px,color:#fff
```
**рдлрд╛рдпрджреЗ:**
- тЬЕ рдЬрдЯрд┐рд▓ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рд╣рд╛рддрд╛рд│рддреЛ
- тЬЕ рдореЙрдбреНрдпреВрд▓рд░ рдЖрдгрд┐ рджреЗрдЦрднрд╛рд▓ рдХрд░рдгреНрдпрд╛рдпреЛрдЧреНрдп
- тЬЕ рд╕реНрдкрд╖реНрдЯ рдЬрдмрд╛рдмрджрд╛рд░реАрдЪреА рд╕реАрдорд╛

**рдорд░реНрдпрд╛рджрд╛:**
- тЪая╕П рдЕрдзрд┐рдХ рдЬрдЯрд┐рд▓ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░
- тЪая╕П рдЙрдЪреНрдЪ рд╡рд┐рд▓рдВрдмрддрд╛ (рдЕрдиреЗрдХ рд╕рдордиреНрд╡рдп рд╕реНрддрд░)
- тЪая╕П рдкреНрд░рдЧрдд рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрд╢рди рдЖрд╡рд╢реНрдпрдХ

**рдЙрджрд╛рд╣рд░рдг рд╡рд╛рдкрд░ рдкреНрд░рдХрд░рдгреЗ:**
- рдПрдВрдЯрд░рдкреНрд░рд╛рдЗрдЭ рджрд╕реНрддрдРрд╡рдЬ рдкреНрд░рдХреНрд░рд┐рдпрд╛ (рд╡рд░реНрдЧреАрдХреГрдд рдХрд░рд╛ тЖТ рдорд╛рд░реНрдЧ тЖТ рдкреНрд░рдХреНрд░рд┐рдпрд╛ тЖТ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рд╛)
- рдорд▓реНрдЯреА-рд╕реНрдЯреЗрдЬ рдбреЗрдЯрд╛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди (рдЖрдпрдПрдирдЬреЗрд╕реНрдЯ тЖТ рд╕реНрд╡рдЪреНрдЫ тЖТ рд░реВрдкрд╛рдВрддрд░рд┐рдд рдХрд░рд╛ тЖТ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рд╛ тЖТ рдЕрд╣рд╡рд╛рд▓)
- рдЬрдЯрд┐рд▓ рдСрдЯреЛрдореЗрд╢рди рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ (рдпреЛрдЬрдирд╛ тЖТ рд╕рдВрд╕рд╛рдзрди рд╡рд╛рдЯрдк тЖТ рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреА тЖТ рдирд┐рд░реАрдХреНрд╖рдг)

---

### рдкрджреНрдзрдд 4: рдЗрд╡реНрд╣реЗрдВрдЯ-рдбреНрд░рд┐рд╡реНрд╣рди рд╕рдордиреНрд╡рдп (рдкрдмреНрд▓рд┐рд╢-рд╕рдмрд╕реНрдХреНрд░рд╛рдЗрдм)

**рдХрдзреА рд╡рд╛рдкрд░рд╛рдпрдЪреЗ**: рдПрдЬрдВрдЯреНрд╕рдирд╛ рдЗрд╡реНрд╣реЗрдВрдЯреНрд╕рд╡рд░ рдкреНрд░рддрд┐рдХреНрд░рд┐рдпрд╛ рджреНрдпрд╛рдпрдЪреА рдЕрд╕рддреЗ, рд╕реИрд▓ рдХрдкрд▓рд┐рдВрдЧ рд╣рд╡реЗ рдЕрд╕рддреЗ.

```mermaid
sequenceDiagram
    participant Agent1 as рдбреЗрдЯрд╛ рд╕рдВрдХрд▓рдХ
    participant EventBus as Azure рд╕реЗрд╡рд╛ рдмрд╕
    participant Agent2 as рд╡рд┐рд╢реНрд▓реЗрд╖рдХ
    participant Agent3 as рд╕реВрдЪрдирд╛рджрд╛рддрд╛
    participant Agent4 as рд╕рдВрдЧреНрд░рд╣рдХрд░реНрддрд╛
    
    Agent1->>EventBus: рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░рд╛ "рдбреЗрдЯрд╛ рдкреНрд░рд╛рдкреНрдд" рдШрдЯрдирд╛
    EventBus->>Agent2: рд╕рджрд╕реНрдпрддрд╛ рдШреНрдпрд╛: рдбреЗрдЯрд╛ рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдХрд░рд╛
    EventBus->>Agent3: рд╕рджрд╕реНрдпрддрд╛ рдШреНрдпрд╛: рд╕реВрдЪрдирд╛ рдкрд╛рдард╡рд╛
    EventBus->>Agent4: рд╕рджрд╕реНрдпрддрд╛ рдШреНрдпрд╛: рдбреЗрдЯрд╛ рд╕рдВрдЧреНрд░рд╣рд┐рдд рдХрд░рд╛
    
    Note over Agent1,Agent4: рд╕рд░реНрд╡ рд╕рджрд╕реНрдп рд╕реНрд╡рддрдВрддреНрд░рдкрдгреЗ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░рддрд╛рдд
    
    Agent2->>EventBus: рдкреНрд░рдХрд╛рд╢рд┐рдд рдХрд░рд╛ "рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдкреВрд░реНрдг" рдШрдЯрдирд╛
    EventBus->>Agent3: рд╕рджрд╕реНрдпрддрд╛ рдШреНрдпрд╛: рд╡рд┐рд╢реНрд▓реЗрд╖рдг рдЕрд╣рд╡рд╛рд▓ рдкрд╛рдард╡рд╛
```
**рдлрд╛рдпрджреЗ:**
- тЬЕ рдПрдЬрдВрдЯреНрд╕рдордзреАрд▓ рд╕реИрд▓ рдХрдкрд▓рд┐рдВрдЧ
- тЬЕ рдирд╡реАрди рдПрдЬрдВрдЯреНрд╕ рд╕рд╣рдЬ рдЬреЛрдбрддрд╛ рдпреЗрддрд╛рдд (рдлрдХреНрдд рд╕рдмрд╕реНрдХреНрд░рд╛рдЗрдм рдХрд░рд╛)
- тЬЕ рдЕрд╕рдордХрд╛рд▓реАрди рдкреНрд░рдХреНрд░рд┐рдпрд╛
- тЬЕ рд▓рд╡рдЪрд┐рдХ (рд╕рдВрджреЗрд╢ рдЯрд┐рдХрд╡реВрди рдареЗрд╡рдгреЗ)

**рдорд░реНрдпрд╛рджрд╛:**
- тЪая╕П рд╢реЗрд╡рдЯреА рд╕реБрд╕рдВрдЧрддрддрд╛
- тЪая╕П рдЬрдЯрд┐рд▓ рдбреАрдмрдЧрд┐рдВрдЧ
- тЪая╕П рд╕рдВрджреЗрд╢ рдХреНрд░рдордмрджреНрдзрддреЗрдЪреА рдЖрд╡реНрд╣рд╛рдиреЗ

**рдЙрджрд╛рд╣рд░рдг рд╡рд╛рдкрд░ рдкреНрд░рдХрд░рдгреЗ:**
- рд░рд┐рдЕрд▓-рдЯрд╛рдЗрдо рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ рд╕рд┐рд╕реНрдЯрдореНрд╕ (рдЕрд▓рд░реНрдЯреНрд╕, рдбреЕрд╢рдмреЛрд░реНрдбреНрд╕, рд▓реЙрдЧреНрд╕)
- рдорд▓реНрдЯреА-рдЪреЕрдиреЗрд▓ рд╕реВрдЪрдирд╛ (рдИрдореЗрд▓, рдПрд╕рдПрдордПрд╕, рдкреБрд╢, рд╕реНрд▓реЕрдХ)
- рдбреЗрдЯрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдкрд╛рдЗрдкрд▓рд╛рдЗрди (рд╕рдорд╛рди рдбреЗрдЯрд╛рдЪреЗ рдЕрдиреЗрдХ рдЧреНрд░рд╛рд╣рдХ)

---

### рдкрджреНрдзрдд 5: рд╕рд╣рдорддреА-рдЖрдзрд╛рд░рд┐рдд рд╕рдордиреНрд╡рдп (рд╡реНрд╣реЛрдЯрд┐рдВрдЧ/рдХреНрд╡реЛрд░рдо)

**рдХрдзреА рд╡рд╛рдкрд░рд╛рдпрдЪреЗ**: рдкреБрдвреЗ рдЬрд╛рдгреНрдпрд╛рдкреВрд░реНрд╡реА рдЕрдиреЗрдХ рдПрдЬрдВрдЯреНрд╕рдХрдбреВрди рд╕рд╣рдорддреА рдЖрд╡рд╢реНрдпрдХ рдЕрд╕рддреЗ.

```mermaid
graph TB
    Input[рдЗрдирдкреБрдЯ рдХрд╛рд░реНрдп]
    Agent1[рдПрдЬрдВрдЯ 1: GPT-4]
    Agent2[рдПрдЬрдВрдЯ 2: Claude]
    Agent3[рдПрдЬрдВрдЯ 3: Gemini]
    Voter[рд╕рд╣рдорддреА рдорддрджрд╛рд░]
    Output[рд╕рд╣рдорддреАрдЪреЗ рдЖрдЙрдЯрдкреБрдЯ]
    
    Input --> Agent1
    Input --> Agent2
    Input --> Agent3
    Agent1 --> Voter
    Agent2 --> Voter
    Agent3 --> Voter
    Voter --> Output
    
    style Voter fill:#9C27B0,stroke:#7B1FA2,stroke-width:3px,color:#fff
```
**рдлрд╛рдпрджреЗ:**
- тЬЕ рдЙрдЪреНрдЪ рдЕрдЪреВрдХрддрд╛ (рдЕрдиреЗрдХ рдорддреЗ)
- тЬЕ рджреЛрд╖-рд╕рд╣рдирд╢реАрд▓ (рдЕрд▓реНрдкрд╕рдВрдЦреНрдпрд╛рдХ рдЕрдкрдпрд╢ рд╕реНрд╡реАрдХрд╛рд░реНрдп)
- тЬЕ рдЧреБрдгрд╡рддреНрддрд╛ рд╣рдореА рдЕрдВрдЧрднреВрдд

**рдорд░реНрдпрд╛рджрд╛:**
- тЭМ рдорд╣рд╛рдЧ (рдЕрдиреЗрдХ рдореЙрдбреЗрд▓ рдХреЙрд▓реНрд╕)
- тЭМ рд╣рд│реВ (рд╕рд░реНрд╡ рдПрдЬрдВрдЯреНрд╕рдЪреА рд╡рд╛рдЯ рдкрд╛рд╣рдгреЗ)
- тЪая╕П рд╕рдВрдШрд░реНрд╖ рдирд┐рд░рд╛рдХрд░рдг рдЖрд╡рд╢реНрдпрдХ

**рдЙрджрд╛рд╣рд░рдг рд╡рд╛рдкрд░ рдкреНрд░рдХрд░рдгреЗ:**
- рд╕рд╛рдордЧреНрд░реА рдореЙрдбрд░реЗрд╢рди (рдЕрдиреЗрдХ рдореЙрдбреЗрд▓реНрд╕ рд╕рд╛рдордЧреНрд░реА рдкреБрдирд░рд╛рд╡рд▓реЛрдХрди рдХрд░рддрд╛рдд)
- рдХреЛрдб рдкреБрдирд░рд╛рд╡рд▓реЛрдХрди (рдЕрдиреЗрдХ рд▓рд┐рдВрдЯрд░реНрд╕/рд╡рд┐рд╢реНрд▓реЗрд╖рдХ)
- рд╡реИрджреНрдпрдХреАрдп рдирд┐рджрд╛рди (рдЕрдиреЗрдХ AI рдореЙрдбреЗрд▓реНрд╕, рддрдЬреНрдЮ рдкрдбрддрд╛рд│рдгреА)

---

## рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ рд╡рд┐рд╣рдВрдЧрд╛рд╡рд▓реЛрдХрди

### Azure рд╡рд░ рдкреВрд░реНрдг рдорд▓реНрдЯреА-рдПрдЬрдВрдЯ рд╕рд┐рд╕реНрдЯрдо

```mermaid
graph TB
    User[рд╡рд╛рдкрд░рдХрд░реНрддрд╛/API рдХреНрд▓рд╛рдпрдВрдЯ]
    APIM[Azure API рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди]
    Orchestrator[рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░ рд╕реЗрд╡рд╛<br/>рдХрдВрдЯреЗрдирд░ рдЕреЕрдк]
    ServiceBus[Azure рд╕реЗрд╡рд╛ рдмрд╕<br/>рдЗрд╡реНрд╣реЗрдВрдЯ рд╣рдм]
    
    Agent1[рд╕рдВрд╢реЛрдзрди рдПрдЬрдВрдЯ<br/>рдХрдВрдЯреЗрдирд░ рдЕреЕрдк]
    Agent2[рд▓реЗрдЦрдХ рдПрдЬрдВрдЯ<br/>рдХрдВрдЯреЗрдирд░ рдЕреЕрдк]
    Agent3[рд╡рд┐рд╢реНрд▓реЗрд╖рдХ рдПрдЬрдВрдЯ<br/>рдХрдВрдЯреЗрдирд░ рдЕреЕрдк]
    Agent4[рдкреБрдирд░рд╛рд╡рд▓реЛрдХрдХ рдПрдЬрдВрдЯ<br/>рдХрдВрдЯреЗрдирд░ рдЕреЕрдк]
    
    CosmosDB[(рдХреЙрд╕рдореЙрд╕ DB<br/>рд╕рд╛рдорд╛рдпрд┐рдХ рд╕реНрдерд┐рддреА)]
    Storage[Azure рд╕реНрдЯреЛрд░реЗрдЬ<br/>рдХреГрддреА]
    AppInsights[рдЕреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕<br/>рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ]
    
    User --> APIM
    APIM --> Orchestrator
    
    Orchestrator --> ServiceBus
    ServiceBus --> Agent1
    ServiceBus --> Agent2
    ServiceBus --> Agent3
    ServiceBus --> Agent4
    
    Agent1 --> CosmosDB
    Agent2 --> CosmosDB
    Agent3 --> CosmosDB
    Agent4 --> CosmosDB
    
    Agent1 --> Storage
    Agent2 --> Storage
    Agent3 --> Storage
    Agent4 --> Storage
    
    Orchestrator -.-> AppInsights
    Agent1 -.-> AppInsights
    Agent2 -.-> AppInsights
    Agent3 -.-> AppInsights
    Agent4 -.-> AppInsights
    
    style Orchestrator fill:#FF9800,stroke:#F57C00,stroke-width:3px,color:#fff
    style ServiceBus fill:#9C27B0,stroke:#7B1FA2,stroke-width:3px,color:#fff
    style CosmosDB fill:#4CAF50,stroke:#388E3C,stroke-width:3px,color:#fff
```
**рдореБрдЦреНрдп рдШрдЯрдХ:**

| рдШрдЯрдХ | рдЙрджреНрджреЗрд╢ | Azure рд╕реЗрд╡рд╛ |
|------|--------|------------|
| **API рдЧреЗрдЯрд╡реЗ** | рдкреНрд░рд╡реЗрд╢ рдмрд┐рдВрджреВ, рджрд░ рдорд░реНрдпрд╛рджрд╛, рдкреНрд░рдорд╛рдгреАрдХрд░рдг | API рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди |
| **рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░** | рдПрдЬрдВрдЯ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рд╕рдордиреНрд╡рдпрд┐рдд рдХрд░рддреЛ | рдХрдВрдЯреЗрдирд░ рдЕреЕрдкреНрд╕ |
| **рд╕рдВрджреЗрд╢ рд░рд╛рдВрдЧ** | рдЕрд╕рдордХрд╛рд▓реАрди рд╕рдВрд╡рд╛рдж | рд╕рд░реНрд╡реНрд╣рд┐рд╕ рдмрд╕ / рдЗрд╡реНрд╣реЗрдВрдЯ рд╣рдмреНрд╕ |
| **рдПрдЬрдВрдЯреНрд╕** | рд╡рд┐рд╢реЗрд╖ AI рдХрд╛рдордЧрд╛рд░ | рдХрдВрдЯреЗрдирд░ рдЕреЕрдкреНрд╕ / рдлрдВрдХреНрд╢рдиреНрд╕ |
| **рд╕реНрдерд┐рддреА рд╕реНрдЯреЛрдЕрд░** | рд╕рд╛рдорд╛рдпрд┐рдХ рд╕реНрдерд┐рддреА, рдХрд╛рд░реНрдп рдЯреНрд░реЕрдХрд┐рдВрдЧ | рдХреЙрд╕рдореЙрд╕ DB |
| **рдЖрд░реНрдЯрд┐рдлреЕрдХреНрдЯ рд╕реНрдЯреЛрд░реЗрдЬ** | рджрд╕реНрддрдРрд╡рдЬ, рдирд┐рдХрд╛рд▓, рд▓реЙрдЧреНрд╕ | рдмреНрд▓реЙрдм рд╕реНрдЯреЛрд░реЗрдЬ |
| **рдореЙрдирд┐рдЯрд░рд┐рдВрдЧ** | рд╡рд┐рддрд░рд┐рдд рдЯреНрд░реЗрд╕рд┐рдВрдЧ, рд▓реЙрдЧреНрд╕ | рдЕреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕ |

---

## рдкреВрд░реНрд╡рдЕрдЯ

### рдЖрд╡рд╢реНрдпрдХ рд╕рд╛рдзрдиреЗ

```bash
# Azure Developer CLI рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рд╛
azd version
# тЬЕ рдЕрдкреЗрдХреНрд╖рд┐рдд: azd рдЖрд╡реГрддреНрддреА 1.0.0 рдХрд┐рдВрд╡рд╛ рдЙрдЪреНрдЪ

# Azure CLI рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рд╛
az --version
# тЬЕ рдЕрдкреЗрдХреНрд╖рд┐рдд: azure-cli 2.50.0 рдХрд┐рдВрд╡рд╛ рдЙрдЪреНрдЪ

# Docker рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рд╛ (рд╕реНрдерд╛рдирд┐рдХ рдЪрд╛рдЪрдгреАрд╕рд╛рдареА)
docker --version
# тЬЕ рдЕрдкреЗрдХреНрд╖рд┐рдд: Docker рдЖрд╡реГрддреНрддреА 20.10 рдХрд┐рдВрд╡рд╛ рдЙрдЪреНрдЪ
```

### Azure рдЖрд╡рд╢реНрдпрдХрддрд╛

- рд╕рдХреНрд░рд┐рдп Azure рд╕рджрд╕реНрдпрддрд╛
- рддрдпрд╛рд░ рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдкрд░рд╡рд╛рдирдЧреНрдпрд╛:
  - рдХрдВрдЯреЗрдирд░ рдЕреЕрдкреНрд╕
  - рд╕рд░реНрд╡реНрд╣рд┐рд╕ рдмрд╕ рдиреЗрдорд╕реНрдкреЗрд╕
  - рдХреЙрд╕рдореЙрд╕ DB рдЦрд╛рддреА
  - рд╕реНрдЯреЛрд░реЗрдЬ рдЦрд╛рддреА
  - рдЕреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕

### рдЬреНрдЮрд╛рди рдкреВрд░реНрд╡рдЕрдЯ

рддреБрдореНрд╣реА рдкреВрд░реНрдг рдХреЗрд▓реЗ рдкрд╛рд╣рд┐рдЬреЗ:
- [рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди](../getting-started/configuration.md)
- [рдкреНрд░рдорд╛рдгреАрдХрд░рдг рдЖрдгрд┐ рд╕реБрд░рдХреНрд╖рд╛](../getting-started/authsecurity.md)
- [рдорд╛рдпрдХреНрд░реЛрд╕рд░реНрд╡реНрд╣рд┐рд╕реЗрд╕ рдЙрджрд╛рд╣рд░рдг](../../../../examples/microservices)

---

## рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреА рдорд╛рд░реНрдЧрджрд░реНрд╢рдХ

### рдкреНрд░рдХрд▓реНрдк рд╕рдВрд░рдЪрдирд╛

```
multi-agent-system/
тФЬтФАтФА azure.yaml                    # AZD configuration
тФЬтФАтФА infra/
тФВ   тФЬтФАтФА main.bicep               # Main infrastructure
тФВ   тФЬтФАтФА core/
тФВ   тФВ   тФЬтФАтФА servicebus.bicep     # Message queue
тФВ   тФВ   тФЬтФАтФА cosmos.bicep         # State store
тФВ   тФВ   тФЬтФАтФА storage.bicep        # Artifact storage
тФВ   тФВ   тФФтФАтФА monitoring.bicep     # Application Insights
тФВ   тФФтФАтФА app/
тФВ       тФЬтФАтФА orchestrator.bicep   # Orchestrator service
тФВ       тФФтФАтФА agent.bicep          # Agent template
тФФтФАтФА src/
    тФЬтФАтФА orchestrator/            # Orchestration logic
    тФВ   тФЬтФАтФА app.py
    тФВ   тФЬтФАтФА workflows.py
    тФВ   тФФтФАтФА Dockerfile
    тФЬтФАтФА agents/
    тФВ   тФЬтФАтФА research/            # Research agent
    тФВ   тФЬтФАтФА writer/              # Writer agent
    тФВ   тФЬтФАтФА analyst/             # Analyst agent
    тФВ   тФФтФАтФА reviewer/            # Reviewer agent
    тФФтФАтФА shared/
        тФЬтФАтФА state_manager.py     # Shared state logic
        тФФтФАтФА message_handler.py   # Message handling
```

---

## рдзрдбрд╛ 1: рдЕрдиреБрдХреНрд░рдорд┐рдХ рд╕рдордиреНрд╡рдп рдкрджреНрдзрдд

### рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреА: рд╕рд╛рдордЧреНрд░реА рдирд┐рд░реНрдорд┐рддреА рдкрд╛рдЗрдкрд▓рд╛рдЗрди

рдЪрд▓рд╛ рдПрдХ рдЕрдиреБрдХреНрд░рдорд┐рдХ рдкрд╛рдЗрдкрд▓рд╛рдЗрди рддрдпрд╛рд░ рдХрд░реВрдпрд╛: рд╕рдВрд╢реЛрдзрди тЖТ рд▓реЗрдЦрди тЖТ рд╕рдВрдкрд╛рджрди тЖТ рдкреНрд░рдХрд╛рд╢рди

### 1. AZD рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди

**рдлрд╛рдЗрд▓: `azure.yaml`**

```yaml
name: content-pipeline
metadata:
  template: multi-agent-sequential@1.0.0

services:
  orchestrator:
    project: ./src/orchestrator
    language: python
    host: containerapp
  
  research-agent:
    project: ./src/agents/research
    language: python
    host: containerapp
  
  writer-agent:
    project: ./src/agents/writer
    language: python
    host: containerapp
  
  editor-agent:
    project: ./src/agents/editor
    language: python
    host: containerapp
```

### 2. рдкрд╛рдпрд╛рднреВрдд рд╕реБрд╡рд┐рдзрд╛: рд╕рдордиреНрд╡рдпрд╛рд╕рд╛рдареА рд╕рд░реНрд╡реНрд╣рд┐рд╕ рдмрд╕

**рдлрд╛рдЗрд▓: `infra/core/servicebus.bicep`**

```bicep
param name string
param location string
param tags object = {}

resource serviceBusNamespace 'Microsoft.ServiceBus/namespaces@2022-10-01-preview' = {
  name: name
  location: location
  tags: tags
  sku: {
    name: 'Standard'
    tier: 'Standard'
  }
  properties: {
    minimumTlsVersion: '1.2'
  }
}

// Queue for orchestrator тЖТ research agent
resource researchQueue 'Microsoft.ServiceBus/namespaces/queues@2022-10-01-preview' = {
  parent: serviceBusNamespace
  name: 'research-tasks'
  properties: {
    maxDeliveryCount: 3
    lockDuration: 'PT5M'
    deadLetteringOnMessageExpiration: true
  }
}

// Queue for research agent тЖТ writer agent
resource writerQueue 'Microsoft.ServiceBus/namespaces/queues@2022-10-01-preview' = {
  parent: serviceBusNamespace
  name: 'writer-tasks'
  properties: {
    maxDeliveryCount: 3
    lockDuration: 'PT5M'
  }
}

// Queue for writer agent тЖТ editor agent
resource editorQueue 'Microsoft.ServiceBus/namespaces/queues@2022-10-01-preview' = {
  parent: serviceBusNamespace
  name: 'editor-tasks'
  properties: {
    maxDeliveryCount: 3
    lockDuration: 'PT5M'
  }
}

output namespace string = serviceBusNamespace.name
output connectionString string = listKeys('${serviceBusNamespace.id}/AuthorizationRules/RootManageSharedAccessKey', serviceBusNamespace.apiVersion).primaryConnectionString
```

### 3. рд╕рд╛рдорд╛рдпрд┐рдХ рд╕реНрдерд┐рддреА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрдХ

**рдлрд╛рдЗрд▓: `src/shared/state_manager.py`**

```python
from azure.cosmos import CosmosClient, PartitionKey
from datetime import datetime
import os

class StateManager:
    """Manages shared state across agents using Cosmos DB"""
    
    def __init__(self):
        endpoint = os.environ['COSMOS_ENDPOINT']
        key = os.environ['COSMOS_KEY']
        
        self.client = CosmosClient(endpoint, key)
        self.database = self.client.get_database_client('agent-state')
        self.container = self.database.get_container_client('tasks')
    
    def create_task(self, task_id: str, task_type: str, input_data: dict):
        """Create a new task"""
        task = {
            'id': task_id,
            'type': task_type,
            'status': 'pending',
            'input': input_data,
            'created_at': datetime.utcnow().isoformat(),
            'steps': []
        }
        self.container.create_item(task)
        return task
    
    def update_task_step(self, task_id: str, step_name: str, result: dict):
        """Update task with completed step"""
        task = self.container.read_item(task_id, partition_key=task_id)
        
        task['steps'].append({
            'name': step_name,
            'completed_at': datetime.utcnow().isoformat(),
            'result': result
        })
        
        self.container.replace_item(task_id, task)
        return task
    
    def complete_task(self, task_id: str, final_result: dict):
        """Mark task as complete"""
        task = self.container.read_item(task_id, partition_key=task_id)
        task['status'] = 'completed'
        task['result'] = final_result
        task['completed_at'] = datetime.utcnow().isoformat()
        self.container.replace_item(task_id, task)
        return task
    
    def get_task(self, task_id: str):
        """Retrieve task state"""
        return self.container.read_item(task_id, partition_key=task_id)
```

### 4. рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░ рд╕реЗрд╡рд╛

**рдлрд╛рдЗрд▓: `src/orchestrator/app.py`**

```python
from flask import Flask, request, jsonify
from azure.servicebus import ServiceBusClient, ServiceBusMessage
import json
import uuid
import os
from shared.state_manager import StateManager

app = Flask(__name__)
state_manager = StateManager()

# рд╕реЗрд╡рд╛ рдмрд╕ рдХрдиреЗрдХреНрд╢рди
servicebus_connection_str = os.environ['SERVICEBUS_CONNECTION_STRING']
servicebus_client = ServiceBusClient.from_connection_string(servicebus_connection_str)

@app.route('/health', methods=['GET'])
def health():
    return jsonify({'status': 'healthy', 'service': 'orchestrator'})

@app.route('/create-content', methods=['POST'])
def create_content():
    """
    Sequential workflow: Research тЖТ Write тЖТ Edit тЖТ Publish
    """
    data = request.json
    topic = data.get('topic')
    
    if not topic:
        return jsonify({'error': 'Topic required'}), 400
    
    # рд░рд╛рдЬреНрдп рд╕реНрдЯреЛрдЕрд░рдордзреНрдпреЗ рдХрд╛рд░реНрдп рддрдпрд╛рд░ рдХрд░рд╛
    task_id = str(uuid.uuid4())
    task = state_manager.create_task(
        task_id=task_id,
        task_type='content_creation',
        input_data={'topic': topic}
    )
    
    # рд╕рдВрд╢реЛрдзрди рдПрдЬрдВрдЯрд▓рд╛ рд╕рдВрджреЗрд╢ рдкрд╛рдард╡рд╛ (рдкрд╣рд┐рд▓рд╛ рдЯрдкреНрдкрд╛)
    sender = servicebus_client.get_queue_sender('research-tasks')
    message = ServiceBusMessage(
        body=json.dumps({
            'task_id': task_id,
            'topic': topic,
            'next_queue': 'writer-tasks'  # рдкрд░рд┐рдгрд╛рдо рдХреБрдареЗ рдкрд╛рдард╡рд╛рдпрдЪреЗ
        }),
        content_type='application/json'
    )
    
    with sender:
        sender.send_messages(message)
    
    return jsonify({
        'task_id': task_id,
        'status': 'started',
        'workflow': 'sequential',
        'steps': ['research', 'write', 'edit', 'publish'],
        'message': 'Content creation pipeline initiated'
    }), 202

@app.route('/task/<task_id>', methods=['GET'])
def get_task_status(task_id):
    """Check task status"""
    try:
        task = state_manager.get_task(task_id)
        return jsonify(task)
    except Exception as e:
        return jsonify({'error': str(e)}), 404

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

### 5. рд╕рдВрд╢реЛрдзрди рдПрдЬрдВрдЯ

**рдлрд╛рдЗрд▓: `src/agents/research/app.py`**

```python
from azure.servicebus import ServiceBusClient, ServiceBusMessage
from openai import AzureOpenAI
import json
import os
import time
from shared.state_manager import StateManager

# рдХреНрд▓рд╛рдпрдВрдЯреНрд╕ рдкреНрд░рд╛рд░рдВрдн рдХрд░рд╛
state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

openai_client = AzureOpenAI(
    api_key=os.environ['AZURE_OPENAI_API_KEY'],
    api_version="2024-02-01",
    azure_endpoint=os.environ['AZURE_OPENAI_ENDPOINT']
)

def process_research_task(message_data):
    """Process research request and pass to writer"""
    task_id = message_data['task_id']
    topic = message_data['topic']
    next_queue = message_data['next_queue']
    
    print(f"ЁЯФм Researching: {topic}")
    
    # рд╕рдВрд╢реЛрдзрдирд╛рд╕рд╛рдареА Azure OpenAI рд▓рд╛ рдХреЙрд▓ рдХрд░рд╛
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are a research assistant. Provide comprehensive research on the given topic."},
            {"role": "user", "content": f"Research this topic thoroughly: {topic}"}
        ],
        max_tokens=1500
    )
    
    research_results = response.choices[0].message.content
    
    # рд╕реНрдерд┐рддреА рдЕрджреНрдпрддрдирд┐рдд рдХрд░рд╛
    state_manager.update_task_step(
        task_id=task_id,
        step_name='research',
        result={'research': research_results}
    )
    
    # рдкреБрдвреАрд▓ рдПрдЬрдВрдЯ (рд▓реЗрдЦрдХ) рдХрдбреЗ рдкрд╛рдард╡рд╛
    sender = servicebus_client.get_queue_sender(next_queue)
    message = ServiceBusMessage(
        body=json.dumps({
            'task_id': task_id,
            'topic': topic,
            'research': research_results,
            'next_queue': 'editor-tasks'
        }),
        content_type='application/json'
    )
    
    with sender:
        sender.send_messages(message)
    
    print(f"тЬЕ Research complete for task {task_id}")

def main():
    """Listen to research queue"""
    receiver = servicebus_client.get_queue_receiver('research-tasks')
    
    print("ЁЯФм Research Agent started, listening for tasks...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_research_task(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"тЭМ Error processing message: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

### 6. рд▓реЗрдЦрдХ рдПрдЬрдВрдЯ

**рдлрд╛рдЗрд▓: `src/agents/writer/app.py`**

```python
from azure.servicebus import ServiceBusClient, ServiceBusMessage
from openai import AzureOpenAI
import json
import os
from shared.state_manager import StateManager

state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

openai_client = AzureOpenAI(
    api_key=os.environ['AZURE_OPENAI_API_KEY'],
    api_version="2024-02-01",
    azure_endpoint=os.environ['AZURE_OPENAI_ENDPOINT']
)

def process_writing_task(message_data):
    """Write article based on research"""
    task_id = message_data['task_id']
    topic = message_data['topic']
    research = message_data['research']
    next_queue = message_data['next_queue']
    
    print(f"тЬНя╕П Writing article: {topic}")
    
    # Azure OpenAI рд▓рд╛ рдХреЙрд▓ рдХрд░рд╛ рд▓реЗрдЦ рд▓рд┐рд╣рд┐рдгреНрдпрд╛рд╕рд╛рдареА
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are a professional writer. Write engaging, well-structured articles."},
            {"role": "user", "content": f"Based on this research:\n\n{research}\n\nWrite a comprehensive article about: {topic}"}
        ],
        max_tokens=2000
    )
    
    article_draft = response.choices[0].message.content
    
    # рд╕реНрдерд┐рддреА рдЕрджреНрдпрддрдирд┐рдд рдХрд░рд╛
    state_manager.update_task_step(
        task_id=task_id,
        step_name='writing',
        result={'draft': article_draft}
    )
    
    # рд╕рдВрдкрд╛рджрдХрд╛рдХрдбреЗ рдкрд╛рдард╡рд╛
    sender = servicebus_client.get_queue_sender(next_queue)
    message = ServiceBusMessage(
        body=json.dumps({
            'task_id': task_id,
            'topic': topic,
            'draft': article_draft
        }),
        content_type='application/json'
    )
    
    with sender:
        sender.send_messages(message)
    
    print(f"тЬЕ Article draft complete for task {task_id}")

def main():
    """Listen to writer queue"""
    receiver = servicebus_client.get_queue_receiver('writer-tasks')
    
    print("тЬНя╕П Writer Agent started, listening for tasks...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_writing_task(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"тЭМ Error: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

### 7. рд╕рдВрдкрд╛рджрдХ рдПрдЬрдВрдЯ

**рдлрд╛рдЗрд▓: `src/agents/editor/app.py`**

```python
from azure.servicebus import ServiceBusClient
from openai import AzureOpenAI
import json
import os
from shared.state_manager import StateManager

state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

openai_client = AzureOpenAI(
    api_key=os.environ['AZURE_OPENAI_API_KEY'],
    api_version="2024-02-01",
    azure_endpoint=os.environ['AZURE_OPENAI_ENDPOINT']
)

def process_editing_task(message_data):
    """Edit and finalize article"""
    task_id = message_data['task_id']
    topic = message_data['topic']
    draft = message_data['draft']
    
    print(f"ЁЯУЭ Editing article: {topic}")
    
    # Azure OpenAI рд▓рд╛ рд╕рдВрдкрд╛рджрд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рдХреЙрд▓ рдХрд░рд╛
    response = openai_client.chat.completions.create(
        model="gpt-4",
        messages=[
            {"role": "system", "content": "You are an expert editor. Improve grammar, clarity, and structure."},
            {"role": "user", "content": f"Edit and improve this article:\n\n{draft}"}
        ],
        max_tokens=2000
    )
    
    final_article = response.choices[0].message.content
    
    # рдХрд╛рд░реНрдп рдкреВрд░реНрдг рдореНрд╣рдгреВрди рдЪрд┐рдиреНрд╣рд╛рдВрдХрд┐рдд рдХрд░рд╛
    state_manager.complete_task(
        task_id=task_id,
        final_result={
            'topic': topic,
            'final_article': final_article,
            'word_count': len(final_article.split())
        }
    )
    
    print(f"тЬЕ Article finalized for task {task_id}")

def main():
    """Listen to editor queue"""
    receiver = servicebus_client.get_queue_receiver('editor-tasks')
    
    print("ЁЯУЭ Editor Agent started, listening for tasks...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_editing_task(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"тЭМ Error: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

### 8. рддреИрдирд╛рдд рдХрд░рд╛ рдЖрдгрд┐ рдЪрд╛рдЪрдгреА рдХрд░рд╛

```bash
# рдкреНрд░рд╛рд░рдВрдн рдХрд░рд╛ рдЖрдгрд┐ рддреИрдирд╛рдд рдХрд░рд╛
azd init
azd up

# рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░ URL рдорд┐рд│рд╡рд╛
ORCHESTRATOR_URL=$(azd env get-values | grep ORCHESTRATOR_URL | cut -d '=' -f2 | tr -d '"')

# рд╕рд╛рдордЧреНрд░реА рддрдпрд╛рд░ рдХрд░рд╛
curl -X POST $ORCHESTRATOR_URL/create-content \
  -H "Content-Type: application/json" \
  -d '{"topic": "The Future of AI in Healthcare"}'
```

**тЬЕ рдЕрдкреЗрдХреНрд╖рд┐рдд рдЖрдЙрдЯрдкреБрдЯ:**
```json
{
  "task_id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "status": "started",
  "workflow": "sequential",
  "steps": ["research", "write", "edit", "publish"],
  "message": "Content creation pipeline initiated"
}
```

**рдХрд╛рд░реНрдп рдкреНрд░рдЧрддреА рддрдкрд╛рд╕рд╛:**
```bash
TASK_ID="a1b2c3d4-e5f6-7890-abcd-ef1234567890"
curl $ORCHESTRATOR_URL/task/$TASK_ID
```

**тЬЕ рдЕрдкреЗрдХреНрд╖рд┐рдд рдЖрдЙрдЯрдкреБрдЯ (рдкреВрд░реНрдг рдЭрд╛рд▓реЗ):**
```json
{
  "id": "a1b2c3d4-e5f6-7890-abcd-ef1234567890",
  "type": "content_creation",
  "status": "completed",
  "steps": [
    {
      "name": "research",
      "completed_at": "2025-11-19T10:30:00Z",
      "result": {"research": "..."}
    },
    {
      "name": "writing",
      "completed_at": "2025-11-19T10:32:00Z",
      "result": {"draft": "..."}
    }
  ],
  "result": {
    "topic": "The Future of AI in Healthcare",
    "final_article": "...",
    "word_count": 1500
  }
}
```

---

## рдзрдбрд╛ 2: рд╕рдорд╛рдВрддрд░ рд╕рдордиреНрд╡рдп рдкрджреНрдзрдд

### рдЕрдВрдорд▓рдмрдЬрд╛рд╡рдгреА: рдорд▓реНрдЯреА-рд╕реЛрд░реНрд╕ рд░рд┐рд╕рд░реНрдЪ рдЕреЕрдЧреНрд░реАрдЧреЗрдЯрд░

рдЪрд▓рд╛ рдПрдХ рд╕рдорд╛рдВрддрд░ рдкреНрд░рдгрд╛рд▓реА рддрдпрд╛рд░ рдХрд░реВрдпрд╛ рдЬреА рдПрдХрд╛рдЪ рд╡реЗрд│реА рдЕрдиреЗрдХ рд╕реНрд░реЛрддрд╛рдВрдХрдбреВрди рдорд╛рд╣рд┐рддреА рдЧреЛрд│рд╛ рдХрд░рддреЗ.

### рд╕рдорд╛рдВрддрд░ рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░

**рдлрд╛рдЗрд▓: `src/orchestrator/parallel_workflow.py`**

```python
from flask import Flask, request, jsonify
from azure.servicebus import ServiceBusClient, ServiceBusMessage
import json
import uuid
import os
from shared.state_manager import StateManager

app = Flask(__name__)
state_manager = StateManager()

servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

@app.route('/research-parallel', methods=['POST'])
def research_parallel():
    """
    Parallel workflow: Multiple agents work simultaneously
    """
    data = request.json
    query = data.get('query')
    
    task_id = str(uuid.uuid4())
    task = state_manager.create_task(
        task_id=task_id,
        task_type='parallel_research',
        input_data={
            'query': query,
            'agents': ['web', 'academic', 'news', 'social']
        }
    )
    
    # рдлреЕрди-рдЖрдЙрдЯ: рд╕рд░реНрд╡ рдПрдЬрдВрдЯреНрд╕рдирд╛ рдПрдХрд╛рдЪ рд╡реЗрд│реА рдкрд╛рдард╡рд╛
    agents = [
        ('web-research-queue', 'web'),
        ('academic-research-queue', 'academic'),
        ('news-research-queue', 'news'),
        ('social-research-queue', 'social')
    ]
    
    for queue_name, agent_type in agents:
        sender = servicebus_client.get_queue_sender(queue_name)
        message = ServiceBusMessage(
            body=json.dumps({
                'task_id': task_id,
                'query': query,
                'agent_type': agent_type,
                'result_queue': 'aggregation-queue'
            }),
            content_type='application/json'
        )
        
        with sender:
            sender.send_messages(message)
    
    return jsonify({
        'task_id': task_id,
        'status': 'started',
        'workflow': 'parallel',
        'agents_dispatched': 4,
        'message': 'Parallel research initiated'
    }), 202

if __name__ == '__main__':
    app.run(host='0.0.0.0', port=8080)
```

### рдПрдХрддреНрд░реАрдХрд░рдг рд▓реЙрдЬрд┐рдХ

**рдлрд╛рдЗрд▓: `src/agents/aggregator/app.py`**

```python
from azure.servicebus import ServiceBusClient
import json
import os
from collections import defaultdict
from shared.state_manager import StateManager

state_manager = StateManager()
servicebus_client = ServiceBusClient.from_connection_string(
    os.environ['SERVICEBUS_CONNECTION_STRING']
)

# рдкреНрд░рддреНрдпреЗрдХ рдХрд╛рд░реНрдпрд╛рд╕рд╛рдареА рдкрд░рд┐рдгрд╛рдо рдЯреНрд░реЕрдХ рдХрд░рд╛
task_results = defaultdict(list)
expected_agents = 4  # рд╡реЗрдм, рд╢реИрдХреНрд╖рдгрд┐рдХ, рдмрд╛рддрдореНрдпрд╛, рд╕рд╛рдорд╛рдЬрд┐рдХ

def process_result(message_data):
    """Aggregate results from parallel agents"""
    task_id = message_data['task_id']
    agent_type = message_data['agent_type']
    result = message_data['result']
    
    # рдкрд░рд┐рдгрд╛рдо рд╕рд╛рдард╡рд╛
    task_results[task_id].append({
        'agent': agent_type,
        'data': result
    })
    
    print(f"ЁЯУК Received result from {agent_type} agent ({len(task_results[task_id])}/{expected_agents})")
    
    # рд╕рд░реНрд╡ рдПрдЬрдВрдЯ рдкреВрд░реНрдг рдЭрд╛рд▓реЗ рдЖрд╣реЗрдд рдХрд╛ рддреЗ рддрдкрд╛рд╕рд╛ (рдлреЕрди-рдЗрди)
    if len(task_results[task_id]) == expected_agents:
        print(f"тЬЕ All agents completed for task {task_id}. Aggregating...")
        
        # рдкрд░рд┐рдгрд╛рдо рдПрдХрддреНрд░ рдХрд░рд╛
        aggregated = {
            'query': message_data['query'],
            'sources': task_results[task_id],
            'summary': generate_summary(task_results[task_id])
        }
        
        # рдкреВрд░реНрдг рдореНрд╣рдгреВрди рдЪрд┐рдиреНрд╣рд╛рдВрдХрд┐рдд рдХрд░рд╛
        state_manager.complete_task(task_id, aggregated)
        
        # рд╕рд╛рдл рдХрд░рд╛
        del task_results[task_id]
        
        print(f"тЬЕ Aggregation complete for task {task_id}")

def generate_summary(results):
    """Generate summary from all sources"""
    summaries = [r['data'].get('summary', '') for r in results]
    return '\n\n'.join(summaries)

def main():
    """Listen to aggregation queue"""
    receiver = servicebus_client.get_queue_receiver('aggregation-queue')
    
    print("ЁЯУК Aggregator started, listening for results...")
    
    with receiver:
        while True:
            messages = receiver.receive_messages(max_wait_time=5)
            for message in messages:
                try:
                    message_data = json.loads(str(message))
                    process_result(message_data)
                    receiver.complete_message(message)
                except Exception as e:
                    print(f"тЭМ Error: {e}")
                    receiver.abandon_message(message)

if __name__ == '__main__':
    main()
```

**рд╕рдорд╛рдВрддрд░ рдкрджреНрдзрддреАрдЪреЗ рдлрд╛рдпрджреЗ:**
- тЪб **4x рдЬрд▓рдж** (рдПрдЬрдВрдЯреНрд╕ рдПрдХрд╛рдЪ рд╡реЗрд│реА рдЪрд╛рд▓рддрд╛рдд)
- ЁЯФД **рджреЛрд╖-рд╕рд╣рдирд╢реАрд▓** (рдЖрдВрд╢рд┐рдХ рдирд┐рдХрд╛рд▓ рд╕реНрд╡реАрдХрд╛рд░реНрдп)
- ЁЯУИ **рд╕реНрдХреЗрд▓реЗрдмрд▓** (рд╕рд╣рдЬрдкрдгреЗ рдЕрдзрд┐рдХ рдПрдЬрдВрдЯреНрд╕ рдЬреЛрдбрд╛)

---

## рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд╕рд░рд╛рд╡

### рд╕рд░рд╛рд╡ 1: рдЯрд╛рдЗрдордЖрдЙрдЯ рд╣рд╛рддрд╛рд│рдгреА рдЬреЛрдбрд╛ тнРтнР (рдордзреНрдпрдо)

**рдЙрджреНрджрд┐рд╖реНрдЯ**: рдЯрд╛рдЗрдордЖрдЙрдЯ рд▓реЙрдЬрд┐рдХ рдЕрдВрдорд▓рд╛рдд рдЖрдгрд╛ рдЬреЗрдгреЗрдХрд░реВрди рдЕреЕрдЧреНрд░реАрдЧреЗрдЯрд░ рд╣рд│реВ рдПрдЬрдВрдЯреНрд╕рдЪреА рдЕрдирдВрдд рдХрд╛рд│ рд╡рд╛рдЯ рдкрд╛рд╣рдгрд╛рд░ рдирд╛рд╣реА.

**рдкрд╛рдпрд▒реНрдпрд╛**:

1. **рдЕреЕрдЧреНрд░реАрдЧреЗрдЯрд░рдордзреНрдпреЗ рдЯрд╛рдЗрдордЖрдЙрдЯ рдЯреНрд░реЕрдХрд┐рдВрдЧ рдЬреЛрдбрд╛:**

```python
from datetime import datetime, timedelta

task_timeouts = {}  # task_id -> рд╕рдорд╛рдкреНрддреА рд╡реЗрд│

def process_result(message_data):
    task_id = message_data['task_id']
    
    # рдкрд╣рд┐рд▓реНрдпрд╛ рдкрд░рд┐рдгрд╛рдорд╛рд╡рд░ рдЯрд╛рдЗрдордЖрдЙрдЯ рд╕реЗрдЯ рдХрд░рд╛
    if task_id not in task_timeouts:
        task_timeouts[task_id] = datetime.utcnow() + timedelta(seconds=30)
    
    task_results[task_id].append({
        'agent': message_data['agent_type'],
        'data': message_data['result']
    })
    
    # рдкреВрд░реНрдг рдЭрд╛рд▓реЗ рдЖрд╣реЗ рдХрд┐рдВрд╡рд╛ рдЯрд╛рдЗрдордЖрдЙрдЯ рдЭрд╛рд▓рд╛ рдЖрд╣реЗ рдХрд╛ рддреЗ рддрдкрд╛рд╕рд╛
    if len(task_results[task_id]) == expected_agents or \
       datetime.utcnow() > task_timeouts[task_id]:
        
        print(f"ЁЯУК Aggregating with {len(task_results[task_id])}/{expected_agents} results")
        
        aggregated = {
            'query': message_data['query'],
            'sources': task_results[task_id],
            'completed_agents': len(task_results[task_id]),
            'timed_out': len(task_results[task_id]) < expected_agents
        }
        
        state_manager.complete_task(task_id, aggregated)
        
        # рд╕рд╛рдлрд╕рдлрд╛рдИ
        del task_results[task_id]
        del task_timeouts[task_id]
```

2. **рдХреГрддреНрд░рд┐рдо рд╡рд┐рд▓рдВрдмрд╛рдВрд╕рд╣ рдЪрд╛рдЪрдгреА рдХрд░рд╛:**

```python
# рдПрдХрд╛ рдПрдЬрдВрдЯрдордзреНрдпреЗ, рдзреАрдореНрдпрд╛ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдЕрдиреБрдХрд░рдг рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА рд╡рд┐рд▓рдВрдм рдЬреЛрдбрд╛
import time
time.sleep(35)  # 30-рд╕реЗрдХрдВрджрд╛рдВрдЪрд╛ рдЯрд╛рдЗрдордЖрдЙрдЯ рдУрд▓рд╛рдВрдбрддреЛ
```

3. **рддреИрдирд╛рдд рдХрд░рд╛ рдЖрдгрд┐ рд╕рддреНрдпрд╛рдкрд┐рдд рдХрд░рд╛:**

```bash
azd deploy aggregator

# рдХрд╛рд░реНрдп рд╕рдмрдорд┐рдЯ рдХрд░рд╛
curl -X POST $ORCHESTRATOR_URL/research-parallel \
  -H "Content-Type: application/json" \
  -d '{"query": "AI safety research"}'

# рейреж рд╕реЗрдХрдВрджрд╛рдВрдирдВрддрд░ рдкрд░рд┐рдгрд╛рдо рддрдкрд╛рд╕рд╛
curl $ORCHESTRATOR_URL/task/$TASK_ID
```

**тЬЕ рдпрд╢ рдирд┐рдХрд╖:**
- тЬЕ рдХрд╛рд░реНрдп 30 рд╕реЗрдХрдВрджрд╛рдВрдирдВрддрд░ рдкреВрд░реНрдг рд╣реЛрддреЗ рдЬрд░реА рдПрдЬрдВрдЯреНрд╕ рдЕрдкреВрд░реНрдг рдЕрд╕рд▓реЗ рддрд░реА
- тЬЕ рдкреНрд░рддрд┐рд╕рд╛рдж рдЖрдВрд╢рд┐рдХ рдирд┐рдХрд╛рд▓ рджрд░реНрд╢рд╡рддреЛ (`"timed_out": true`)
- тЬЕ рдЙрдкрд▓рдмреНрдз рдирд┐рдХрд╛рд▓ рдкрд░рдд рдХреЗрд▓реЗ рдЬрд╛рддрд╛рдд (4 рдкреИрдХреА 3 рдПрдЬрдВрдЯреНрд╕)

**рд╡реЗрд│**: 20-25 рдорд┐рдирд┐рдЯреЗ

---

### рд╕рд░рд╛рд╡ 2: рд░рд┐рдЯреНрд░рд╛рдп рд▓реЙрдЬрд┐рдХ рдЕрдВрдорд▓рд╛рдд рдЖрдгрд╛ тнРтнРтнР (рдкреНрд░рдЧрдд)

**рдЙрджреНрджрд┐рд╖реНрдЯ**: рдЕрдкрдпрд╢реА рдПрдЬрдВрдЯ рдХрд╛рд░реНрдпреЗ рдЖрдкреЛрдЖрдк рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди рдХрд░рд╛.

**рдкрд╛рдпрд▒реНрдпрд╛**:

1. **рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░рдордзреНрдпреЗ рд░рд┐рдЯреНрд░рд╛рдп рдЯреНрд░реЕрдХрд┐рдВрдЧ рдЬреЛрдбрд╛:**

```python
from dataclasses import dataclass
from typing import Dict

@dataclass
class RetryConfig:
    max_retries: int = 3
    backoff_seconds: int = 5

retry_counts: Dict[str, int] = {}  # рд╕рдВрджреЗрд╢_рдЖрдпрдбреА -> рдкреБрдирд░реНрдкреНрд░рдпрддреНрди_рдЧрдгрдирд╛

def send_with_retry(queue_name: str, message_data: dict, retry_config: RetryConfig):
    """Send message with retry metadata"""
    message_id = message_data.get('message_id', str(uuid.uuid4()))
    message_data['message_id'] = message_id
    message_data['retry_count'] = retry_counts.get(message_id, 0)
    message_data['max_retries'] = retry_config.max_retries
    
    sender = servicebus_client.get_queue_sender(queue_name)
    message = ServiceBusMessage(
        body=json.dumps(message_data),
        content_type='application/json',
        message_id=message_id
    )
    
    with sender:
        sender.send_messages(message)
```

2. **рдПрдЬрдВрдЯреНрд╕рдордзреНрдпреЗ рд░рд┐рдЯреНрд░рд╛рдп рд╣рдБрдбрд▓рд░ рдЬреЛрдбрд╛:**

```python
def process_with_retry(message, receiver, process_func):
    """Process message with automatic retry on failure"""
    try:
        message_data = json.loads(str(message))
        
        # рд╕рдВрджреЗрд╢ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░рд╛
        process_func(message_data)
        
        # рдпрд╢рд╕реНрд╡реА - рдкреВрд░реНрдг
        receiver.complete_message(message)
        
    except Exception as e:
        message_id = message.message_id
        retry_count = message_data.get('retry_count', 0)
        max_retries = message_data.get('max_retries', 3)
        
        if retry_count < max_retries:
            # рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди: рд╕реЛрдбреВрди рджреНрдпрд╛ рдЖрдгрд┐ рд╡рд╛рдврд▓реЗрд▓реНрдпрд╛ рдЧрдгрдиреЗрд╕рд╣ рдкреБрдиреНрд╣рд╛ рд░рд╛рдВрдЧреЗрдд рд▓рд╛рд╡рд╛
            print(f"тЪая╕П Retry {retry_count + 1}/{max_retries} for message {message_id}")
            
            message_data['retry_count'] = retry_count + 1
            
            # рд╡рд┐рд▓рдВрдмрд╛рд╕рд╣ рддреНрдпрд╛рдЪ рд░рд╛рдВрдЧреЗрдд рдкрд░рдд рдкрд╛рдард╡рд╛
            time.sleep(5 * (retry_count + 1))  # рдШрд╛рддрд╛рдВрдХреАрдп рдмреЕрдХрдСрдл
            send_with_retry(queue_name, message_data, RetryConfig())
            
            receiver.complete_message(message)  # рдореВрд│ рдХрд╛рдврд╛
        else:
            # рдЬрд╛рд╕реНрддреАрдд рдЬрд╛рд╕реНрдд рдкреБрдирд░реНрдкреНрд░рдпрддреНрди рдУрд▓рд╛рдВрдбрд▓реЗ - рдореГрдд рдкрддреНрд░ рд░рд╛рдВрдЧреЗрдд рд╣рд▓рд╡рд╛
            print(f"тЭМ Max retries exceeded for message {message_id}")
            receiver.dead_letter_message(
                message,
                reason="MaxRetriesExceeded",
                error_description=str(e)
            )
```

3. **рдбреЗрдб рд▓реЗрдЯрд░ рд░рд╛рдВрдЧ рдореЙрдирд┐рдЯрд░ рдХрд░рд╛:**

```python
def monitor_dead_letters():
    """Check dead letter queue for failed messages"""
    receiver = servicebus_client.get_queue_receiver(
        'research-queue',
        sub_queue='deadletter'
    )
    
    with receiver:
        messages = receiver.receive_messages(max_wait_time=5)
        for message in messages:
            print(f"тШая╕П Dead letter: {message.message_id}")
            print(f"Reason: {message.dead_letter_reason}")
            print(f"Description: {message.dead_letter_error_description}")
```

**тЬЕ рдпрд╢ рдирд┐рдХрд╖:**
- тЬЕ рдЕрдкрдпрд╢реА рдХрд╛рд░реНрдпреЗ рдЖрдкреЛрдЖрдк рдкреБрдиреНрд╣рд╛ рдкреНрд░рдпрддреНрди рдХрд░рддрд╛рдд (3 рд╡реЗрд│рд╛ рдкрд░реНрдпрдВрдд)
- тЬЕ рд░рд┐рдЯреНрд░рд╛рдп рджрд░рдореНрдпрд╛рди рдШрд╕рд░рдгреАрдЪрд╛ рдХрд╛рд▓рд╛рд╡рдзреА (5s, 10s, 15s)
- тЬЕ рдЬрд╛рд╕реНрддреАрдд рдЬрд╛рд╕реНрдд рд░рд┐рдЯреНрд░рд╛рдпрдирдВрддрд░, рд╕рдВрджреЗрд╢ рдбреЗрдб рд▓реЗрдЯрд░ рд░рд╛рдВрдЧреЗрдд рдЬрд╛рддрд╛рдд
- тЬЕ рдбреЗрдб рд▓реЗрдЯрд░ рд░рд╛рдВрдЧ рдореЙрдирд┐рдЯрд░ рдХреЗрд▓реА рдЬрд╛рдК рд╢рдХрддреЗ рдЖрдгрд┐ рдкреБрдиреНрд╣рд╛ рдкреНрд▓реЗ рдХреЗрд▓реА рдЬрд╛рдК рд╢рдХрддреЗ

**рд╡реЗрд│**: 30-40 рдорд┐рдирд┐рдЯреЗ

---

### рд╕рд░рд╛рд╡ 3: рд╕рд░реНрдХрд┐рдЯ рдмреНрд░реЗрдХрд░ рдЕрдВрдорд▓рд╛рдд рдЖрдгрд╛ тнРтнРтнР (рдкреНрд░рдЧрдд)

**рдЙрджреНрджрд┐рд╖реНрдЯ**: рдЕрдкрдпрд╢реА рдПрдЬрдВрдЯреНрд╕рдХрдбреЗ рд╡рд┐рдирдВрддреНрдпрд╛ рдерд╛рдВрдмрд╡реВрди рдХреЕрд╕реНрдХреЗрдбрд┐рдВрдЧ рдЕрдкрдпрд╢ рдЯрд╛рд│рд╛.

**рдкрд╛рдпрд▒реНрдпрд╛**:

1. **рд╕рд░реНрдХрд┐рдЯ рдмреНрд░реЗрдХрд░ рдХреНрд▓рд╛рд╕ рддрдпрд╛рд░ рдХрд░рд╛:**

```python
from enum import Enum
from datetime import datetime, timedelta

class CircuitState(Enum):
    CLOSED = "closed"      # рд╕рд╛рдорд╛рдиреНрдп рдСрдкрд░реЗрд╢рди
    OPEN = "open"          # рдЕрдпрд╢рд╕реНрд╡реА, рд╡рд┐рдирдВрддреНрдпрд╛ рдирд╛рдХрд╛рд░
    HALF_OPEN = "half_open"  # рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдЭрд╛рд▓реЗ рдЖрд╣реЗ рдХрд╛ рддрдкрд╛рд╕рдд рдЖрд╣реЗ

class CircuitBreaker:
    def __init__(self, failure_threshold=5, timeout_seconds=60):
        self.failure_threshold = failure_threshold
        self.timeout_seconds = timeout_seconds
        self.failure_count = 0
        self.last_failure_time = None
        self.state = CircuitState.CLOSED
    
    def call(self, func):
        """Execute function with circuit breaker protection"""
        if self.state == CircuitState.OPEN:
            # рдЯрд╛рдЗрдордЖрдЙрдЯ рд╕рдВрдкрд▓рд╛ рдЖрд╣реЗ рдХрд╛ рддрдкрд╛рд╕рд╛
            if datetime.utcnow() - self.last_failure_time > timedelta(seconds=self.timeout_seconds):
                self.state = CircuitState.HALF_OPEN
                print("ЁЯФД Circuit breaker: HALF_OPEN (testing)")
            else:
                raise Exception(f"Circuit breaker OPEN for agent. Try again in {self.timeout_seconds}s")
        
        try:
            result = func()
            
            # рдпрд╢
            if self.state == CircuitState.HALF_OPEN:
                self.state = CircuitState.CLOSED
                self.failure_count = 0
                print("тЬЕ Circuit breaker: CLOSED (recovered)")
            
            return result
            
        except Exception as e:
            self.failure_count += 1
            self.last_failure_time = datetime.utcnow()
            
            if self.failure_count >= self.failure_threshold:
                self.state = CircuitState.OPEN
                print(f"ЁЯФ┤ Circuit breaker: OPEN (too many failures)")
            
            raise e
```

2. **рдПрдЬрдВрдЯ рдХреЙрд▓реНрд╕рд╡рд░ рд▓рд╛рдЧреВ рдХрд░рд╛:**

```python
# рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░рдордзреНрдпреЗ
agent_circuits = {
    'web': CircuitBreaker(failure_threshold=5, timeout_seconds=60),
    'academic': CircuitBreaker(failure_threshold=5, timeout_seconds=60),
    'news': CircuitBreaker(failure_threshold=5, timeout_seconds=60),
    'social': CircuitBreaker(failure_threshold=5, timeout_seconds=60)
}

def send_to_agent(agent_type, message_data):
    """Send with circuit breaker protection"""
    circuit = agent_circuits[agent_type]
    
    try:
        circuit.call(lambda: send_message(agent_type, message_data))
    except Exception as e:
        print(f"тЪая╕П Skipping {agent_type} agent: {e}")
        # рдЗрддрд░ рдПрдЬрдВрдЯреНрд╕рд╕рд╣ рдкреБрдвреЗ рдЬрд╛
```

3. **рд╕рд░реНрдХрд┐рдЯ рдмреНрд░реЗрдХрд░ рдЪрд╛рдЪрдгреА рдХрд░рд╛:**

```bash
# рд╡рд╛рд░рдВрд╡рд╛рд░ рдЕрдкрдпрд╢рд╛рдВрдЪреЗ рдЕрдиреБрдХрд░рдг рдХрд░рд╛ (рдПрдХ рдПрдЬрдВрдЯ рдерд╛рдВрдмрд╡рд╛)
az containerapp stop --name web-research-agent --resource-group rg-agents

# рдЕрдиреЗрдХ рд╡рд┐рдирдВрддреНрдпрд╛ рдкрд╛рдард╡рд╛
for i in {1..10}; do
  curl -X POST $ORCHESTRATOR_URL/research-parallel \
    -H "Content-Type: application/json" \
    -d '{"query": "test query '$i'"}'
  sleep 2
done

# рд▓реЙрдЧреНрд╕ рддрдкрд╛рд╕рд╛ - 5 рдЕрдкрдпрд╢рд╛рдВрдирдВрддрд░ рд╕рд░реНрдХрд┐рдЯ рдЙрдШрдбрд▓реЗрд▓реЗ рджрд┐рд╕рд▓реЗ рдкрд╛рд╣рд┐рдЬреЗ
azd logs orchestrator --tail 50
```

**тЬЕ рдпрд╢ рдирд┐рдХрд╖:**
- тЬЕ 5 рдЕрдкрдпрд╢рд╛рдВрдирдВрддрд░, рд╕рд░реНрдХрд┐рдЯ рдЙрдШрдбрддреЗ (рд╡рд┐рдирдВрддреНрдпрд╛ рдирд╛рдХрд╛рд░рддреЗ)
- тЬЕ 60 рд╕реЗрдХрдВрджрд╛рдВрдирдВрддрд░, рд╕рд░реНрдХрд┐рдЯ рдЕрд░реНрдзрд╡рдЯ рдЙрдШрдбрддреЗ (рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрддреА рдЪрд╛рдЪрдгреА рдХрд░рддреЗ)
- тЬЕ рдЗрддрд░ рдПрдЬрдВрдЯреНрд╕ рд╕рд╛рдорд╛рдиреНрдпрдкрдгреЗ рдХрд╛рдо рдХрд░рдд рд░рд╛рд╣рддрд╛рдд
- тЬЕ рдПрдЬрдВрдЯ рдкреБрдирд░реНрдкреНрд░рд╛рдкреНрдд рдЭрд╛рд▓реНрдпрд╛рд╡рд░ рд╕рд░реНрдХрд┐рдЯ рдЖрдкреЛрдЖрдк рдмрдВрдж рд╣реЛрддреЗ

**рд╡реЗрд│**: 40-50 рдорд┐рдирд┐рдЯреЗ

---

## рдирд┐рд░реАрдХреНрд╖рдг рдЖрдгрд┐ рдбреАрдмрдЧрд┐рдВрдЧ

### рдЕреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕рд╕рд╣ рд╡рд┐рддрд░рд┐рдд рдЯреНрд░реЗрд╕рд┐рдВрдЧ

**рдлрд╛рдЗрд▓: `src/shared/tracing.py`**

```python
from opencensus.ext.azure.log_exporter import AzureLogHandler
from opencensus.ext.azure.trace_exporter import AzureExporter
from opencensus.trace import config_integration
from opencensus.trace.tracer import Tracer
from opencensus.trace.samplers import AlwaysOnSampler
import logging
import os

# рдЯреНрд░реЗрд╕рд┐рдВрдЧ рдХреЙрдиреНрдлрд┐рдЧрд░ рдХрд░рд╛
config_integration.trace_integrations(['requests', 'logging'])

connection_string = os.environ.get('APPLICATIONINSIGHTS_CONNECTION_STRING')

# рдЯреНрд░реЗрд╕рд░ рддрдпрд╛рд░ рдХрд░рд╛
tracer = Tracer(
    exporter=AzureExporter(connection_string=connection_string),
    sampler=AlwaysOnSampler()
)

# рд▓реЙрдЧрд┐рдВрдЧ рдХреЙрдиреНрдлрд┐рдЧрд░ рдХрд░рд╛
logger = logging.getLogger(__name__)
logger.addHandler(AzureLogHandler(connection_string=connection_string))
logger.setLevel(logging.INFO)

def trace_agent_call(agent_name, task_id, operation):
    """Trace agent operations"""
    with tracer.span(name=f'{agent_name}.{operation}') as span:
        span.add_attribute('agent', agent_name)
        span.add_attribute('task_id', task_id)
        span.add_attribute('operation', operation)
        
        try:
            result = operation()
            span.add_attribute('status', 'success')
            return result
        except Exception as e:
            span.add_attribute('status', 'error')
            span.add_attribute('error', str(e))
            raise
```

### рдЕреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕ рдХреНрд╡реЗрд░реАрдЬ

**рдорд▓реНрдЯреА-рдПрдЬрдВрдЯ рдХрд╛рд░реНрдпрдкреНрд░рд╡рд╛рд╣ рдЯреНрд░реЕрдХ рдХрд░рд╛:**

```kusto
// Trace complete workflow for a task
traces
| where customDimensions.task_id == "a1b2c3d4-..."
| project timestamp, message, customDimensions.agent, customDimensions.operation
| order by timestamp asc
```

**рдПрдЬрдВрдЯ рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рддреБрд▓рдирд╛:**

```kusto
// Compare agent execution times
dependencies
| where name contains "agent"
| summarize 
    avg_duration = avg(duration),
    p95_duration = percentile(duration, 95),
    count = count()
  by agent = tostring(customDimensions.agent)
| order by avg_duration desc
```

**рдЕрдкрдпрд╢ рд╡рд┐рд╢реНрд▓реЗрд╖рдг:**

```kusto
// Find which agents fail most
exceptions
| where customDimensions.agent != ""
| summarize 
    failure_count = count(),
    unique_errors = dcount(outerMessage)
  by agent = tostring(customDimensions.agent)
| order by failure_count desc
```

---

## рдЦрд░реНрдЪ рд╡рд┐рд╢реНрд▓реЗрд╖рдг

### рдорд▓реНрдЯреА-рдПрдЬрдВрдЯ рд╕рд┐рд╕реНрдЯрдо рдЦрд░реНрдЪ (рдорд╛рд╕рд┐рдХ рдЕрдВрджрд╛рдЬ)

| рдШрдЯрдХ | рдХреЙрдиреНрдлрд┐рдЧрд░реЗрд╢рди | рдЦрд░реНрдЪ |
|------|-------------|------|
| **рдСрд░реНрдХреЗрд╕реНрдЯреНрд░реЗрдЯрд░** | 1 рдХрдВрдЯреЗрдирд░ рдЕреЕрдк (1 vCPU, 2GB) | $30-50 |
| **4 рдПрдЬрдВрдЯреНрд╕** | 4 рдХрдВрдЯреЗрдирд░ рдЕреЕрдкреНрд╕ (0.5 vCPU, 1GB рдкреНрд░рддреНрдпреЗрдХ) | $60-120 |
| **рд╕рд░реНрд╡реНрд╣рд┐рд╕ рдмрд╕** | рд╕реНрдЯрдБрдбрд░реНрдб рдЯрд┐рдпрд░, 10M рд╕рдВрджреЗрд╢ | $10-20 |
| **рдХреЙрд╕рдореЙрд╕ DB** | рд╕рд░реНрд╡реНрд╣рд░рд▓реЗрд╕, 5GB рд╕реНрдЯреЛрд░реЗрдЬ, 1M RUs | $25-50 |
| **рдмреНрд▓реЙрдм рд╕реНрдЯреЛрд░реЗрдЬ** | 10GB рд╕реНрдЯреЛрд░реЗрдЬ, 100K рдСрдкрд░реЗрд╢рдиреНрд╕ | $5-10 |
| **рдЕреЕрдкреНрд▓рд┐рдХреЗрд╢рди рдЗрдирд╕рд╛рдЗрдЯреНрд╕** | 5GB рдЗрдирдЬреЗрдХреНрд╢рди | $10-15 |
| **Azure OpenAI** | GPT-4, 10M рдЯреЛрдХрдиреНрд╕ | $100-300 |
| **рдПрдХреВрдг** | | **$240-565/рдорд╣рд┐рдирд╛** |

### рдЦрд░реНрдЪ рдСрдкреНрдЯрд┐рдорд╛рдпрдЭреЗрд╢рди рдзреЛрд░рдг
## рд╕рдорд╕реНрдпрд╛ рдирд┐рд╡рд╛рд░рдг рдорд╛рд░реНрдЧрджрд░реНрд╢рдХ

### рд╕рдорд╕реНрдпрд╛: рд╕рдВрджреЗрд╢ рд░рд╛рдВрдЧреЗрдд рдЕрдбрдХрд▓реЗ рдЖрд╣реЗрдд

**рд▓рдХреНрд╖рдгреЗ:**
- рд╕рдВрджреЗрд╢ рд░рд╛рдВрдЧреЗрдд рд╕рд╛рдЪрдд рдЖрд╣реЗрдд
- рдПрдЬрдВрдЯ рдкреНрд░рдХреНрд░рд┐рдпрд╛ рдХрд░рдд рдирд╛рд╣реАрдд
- рдХрд╛рд░реНрдп рд╕реНрдерд┐рддреА "рдкреНрд░рд▓рдВрдмрд┐рдд" рд╡рд░ рдЕрдбрдХрд▓реЗрд▓реА рдЖрд╣реЗ

**рдирд┐рджрд╛рди:**
```bash
# рд░рд╛рдВрдЧреЗрдЪреА рдЦреЛрд▓реА рддрдкрд╛рд╕рд╛
az servicebus queue show \
  --namespace-name mybus \
  --name research-tasks \
  --query "countDetails"

# рдПрдЬрдВрдЯрдЪреА рдкреНрд░рдХреГрддреА рддрдкрд╛рд╕рд╛
azd logs research-agent --tail 50
```

**рдЙрдкрд╛рдп:**

1. **рдПрдЬрдВрдЯ рдкреНрд░рддрд┐рдХреГрддреА рд╡рд╛рдврд╡рд╛:**
   ```bash
   az containerapp update \
     --name research-agent \
     --min-replicas 3 \
     --max-replicas 10
   ```

2. **рдбреЗрдб рд▓реЗрдЯрд░ рд░рд╛рдВрдЧ рддрдкрд╛рд╕рд╛:**
   ```bash
   az servicebus queue show \
     --namespace-name mybus \
     --name research-tasks \
     --query "countDetails.deadLetterMessageCount"
   ```

---

### рд╕рдорд╕реНрдпрд╛: рдХрд╛рд░реНрдп рд╡реЗрд│ рд╕рдВрдкрдгреЗ/рдХрдзреАрдЪ рдкреВрд░реНрдг рд╣реЛрдд рдирд╛рд╣реА

**рд▓рдХреНрд╖рдгреЗ:**
- рдХрд╛рд░реНрдп рд╕реНрдерд┐рддреА "рдкреНрд░рдЧрддреАрдд" рд░рд╛рд╣рддреЗ
- рдХрд╛рд╣реА рдПрдЬрдВрдЯ рдкреВрд░реНрдг рдХрд░рддрд╛рдд, рдХрд╛рд╣реА рдирд╛рд╣реАрдд
- рдХреЛрдгрддреЗрд╣реА рддреНрд░реБрдЯреА рд╕рдВрджреЗрд╢ рдирд╛рд╣реАрдд

**рдирд┐рджрд╛рди:**
```bash
# рдХрд╛рд░реНрдпрд╛рдЪреА рд╕реНрдерд┐рддреА рддрдкрд╛рд╕рд╛
curl $ORCHESTRATOR_URL/task/$TASK_ID

# рдЕрдиреБрдкреНрд░рдпреЛрдЧ рдЕрдВрддрд░реНрджреГрд╖реНрдЯреА рддрдкрд╛рд╕рд╛
# рдХреНрд╡реЗрд░реА рдЪрд╛рд▓рд╡рд╛: traces | where customDimensions.task_id == "..."
```

**рдЙрдкрд╛рдп:**

1. **рдПрдЧреНрд░реАрдЧреЗрдЯрд░рдордзреНрдпреЗ рд╡реЗрд│ рдорд░реНрдпрд╛рджрд╛ рд▓рд╛рдЧреВ рдХрд░рд╛ (рд╡реНрдпрд╛рдпрд╛рдо 1)**

2. **рдПрдЬрдВрдЯ рдЕрдкрдпрд╢ рддрдкрд╛рд╕рд╛:**
   ```bash
   azd logs --follow | grep "ERROR\|FAIL"
   ```

3. **рд╕рд░реНрд╡ рдПрдЬрдВрдЯ рдЪрд╛рд▓реВ рдЖрд╣реЗрдд рдпрд╛рдЪреА рдЦрд╛рддреНрд░реА рдХрд░рд╛:**
   ```bash
   az containerapp list \
     --resource-group rg-agents \
     --query "[].{name:name, status:properties.runningStatus}"
   ```

---

## рдЕрдзрд┐рдХ рдЬрд╛рдгреВрди рдШреНрдпрд╛

### рдЕрдзрд┐рдХреГрдд рджрд╕реНрддрдРрд╡рдЬ
- [Azure Service Bus](https://learn.microsoft.com/azure/service-bus-messaging/service-bus-messaging-overview)
- [Cosmos DB](https://learn.microsoft.com/azure/cosmos-db/introduction)
- [Container Apps DAPR](https://learn.microsoft.com/azure/container-apps/dapr-overview)
- [Multi-Agent Design Patterns](https://learn.microsoft.com/azure/architecture/guide/ai/multi-agent-systems)

### рдпрд╛ рдХреЛрд░реНрд╕рдордзреАрд▓ рдкреБрдвреАрд▓ рдЪрд░рдг
- тЖР рдорд╛рдЧреАрд▓: [рдХреНрд╖рдорддрд╛ рдирд┐рдпреЛрдЬрди](capacity-planning.md)
- тЖТ рдкреБрдвреАрд▓: [SKU рдирд┐рд╡рдб](sku-selection.md)
- ЁЯПа [рдХреЛрд░реНрд╕ рдореБрдЦреНрдпрдкреГрд╖реНрда](../../README.md)

### рд╕рдВрдмрдВрдзрд┐рдд рдЙрджрд╛рд╣рд░рдгреЗ
- [рдорд╛рдпрдХреНрд░реЛрд╕рд░реНрд╡реНрд╣рд┐рд╕реЗрд╕ рдЙрджрд╛рд╣рд░рдг](../../../../examples/microservices) - рд╕реЗрд╡рд╛ рд╕рдВрд╡рд╛рдж рдирдореБрдиреЗ
- [Azure OpenAI рдЙрджрд╛рд╣рд░рдг](../../../../examples/azure-openai-chat) - AI рдПрдХрддреНрд░реАрдХрд░рдг

---

## рд╕рд╛рд░рд╛рдВрд╢

**рддреБрдореНрд╣реА рд╢рд┐рдХрд▓реЗ:**
- тЬЕ рдкрд╛рдЪ рд╕рдордиреНрд╡рдп рдирдореБрдиреЗ (рдХреНрд░рдорд┐рдХ, рд╕рдорд╛рдВрддрд░, рд╢реНрд░реЗрдгреАрдмрджреНрдз, рдЗрд╡реНрд╣реЗрдВрдЯ-рдбреНрд░рд┐рд╡реНрд╣рди, рд╕рд╣рдорддреА)
- тЬЕ Azure рд╡рд░ рдорд▓реНрдЯреА-рдПрдЬрдВрдЯ рдЖрд░реНрдХрд┐рдЯреЗрдХреНрдЪрд░ (Service Bus, Cosmos DB, Container Apps)
- тЬЕ рд╡рд┐рддрд░рд┐рдд рдПрдЬрдВрдЯреНрд╕рдордзреНрдпреЗ рд╕реНрдерд┐рддреА рд╡реНрдпрд╡рд╕реНрдерд╛рдкрди
- тЬЕ рд╡реЗрд│ рдорд░реНрдпрд╛рджрд╛ рд╣рд╛рддрд╛рд│рдгреЗ, рдкреБрдирд░реНрдкреНрд░рдпрддреНрди, рдЖрдгрд┐ рд╕рд░реНрдХрд┐рдЯ рдмреНрд░реЗрдХрд░реНрд╕
- тЬЕ рд╡рд┐рддрд░рд┐рдд рдкреНрд░рдгрд╛рд▓реАрдВрдЪреЗ рдирд┐рд░реАрдХреНрд╖рдг рдЖрдгрд┐ рдбреАрдмрдЧрд┐рдВрдЧ
- тЬЕ рдЦрд░реНрдЪ рдЕрдиреБрдХреВрд▓рди рдзреЛрд░рдгреЗ

**рдорд╣рддреНрддреНрд╡рд╛рдЪреЗ рдореБрджреНрджреЗ:**
1. **рдпреЛрдЧреНрдп рдирдореБрдирд╛ рдирд┐рд╡рдбрд╛** - рдХреНрд░рдорд┐рдХ рдХрд╛рд░реНрдпрд╛рдВрд╕рд╛рдареА, рдЧрддреАрд╕рд╛рдареА рд╕рдорд╛рдВрддрд░, рд▓рд╡рдЪрд┐рдХрддреЗрд╕рд╛рдареА рдЗрд╡реНрд╣реЗрдВрдЯ-рдбреНрд░рд┐рд╡реНрд╣рди
2. **рд╕реНрдерд┐рддреА рдХрд╛рд│рдЬреАрдкреВрд░реНрд╡рдХ рд╡реНрдпрд╡рд╕реНрдерд╛рдкрд┐рдд рдХрд░рд╛** - рд╕рд╛рдорд╛рдпрд┐рдХ рд╕реНрдерд┐рддреАрд╕рд╛рдареА Cosmos DB рдХрд┐рдВрд╡рд╛ рддрддреНрд╕рдо рд╡рд╛рдкрд░рд╛
3. **рдЕрдкрдпрд╢ рд╡реНрдпрд╡рд╕реНрдерд┐рдд рд╣рд╛рддрд╛рд│рд╛** - рд╡реЗрд│ рдорд░реНрдпрд╛рджрд╛, рдкреБрдирд░реНрдкреНрд░рдпрддреНрди, рд╕рд░реНрдХрд┐рдЯ рдмреНрд░реЗрдХрд░реНрд╕, рдбреЗрдб рд▓реЗрдЯрд░ рд░рд╛рдВрдЧрд╛
4. **рд╕рд░реНрд╡рдХрд╛рд╣реА рдирд┐рд░реАрдХреНрд╖рдг рдХрд░рд╛** - рдбреАрдмрдЧрд┐рдВрдЧрд╕рд╛рдареА рд╡рд┐рддрд░рд┐рдд рдЯреНрд░реЗрд╕рд┐рдВрдЧ рдЖрд╡рд╢реНрдпрдХ рдЖрд╣реЗ
5. **рдЦрд░реНрдЪ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рд╛** - рд╢реВрдиреНрдпрд╛рдкрд░реНрдпрдВрдд рд╕реНрдХреЗрд▓ рдХрд░рд╛, рд╕рд░реНрд╡реНрд╣рд░рд▓реЗрд╕ рд╡рд╛рдкрд░рд╛, рдХреЕрд╢рд┐рдВрдЧ рд▓рд╛рдЧреВ рдХрд░рд╛

**рдкреБрдвреАрд▓ рдЪрд░рдг:**
1. рд╡реНрдпрд╛рд╡рд╣рд╛рд░рд┐рдХ рд╡реНрдпрд╛рдпрд╛рдо рдкреВрд░реНрдг рдХрд░рд╛
2. рддреБрдордЪреНрдпрд╛ рдЙрдкрдпреЛрдЧ рдкреНрд░рдХрд░рдгрд╛рд╕рд╛рдареА рдорд▓реНрдЯреА-рдПрдЬрдВрдЯ рдкреНрд░рдгрд╛рд▓реА рддрдпрд╛рд░ рдХрд░рд╛
3. [SKU рдирд┐рд╡рдб](sku-selection.md) рдЕрднреНрдпрд╛рд╕ рдХрд░рд╛, рдХрд╛рд░реНрдпрдХреНрд╖рдорддрд╛ рдЖрдгрд┐ рдЦрд░реНрдЪ рдЕрдиреБрдХреВрд▓рд┐рдд рдХрд░рдгреНрдпрд╛рд╕рд╛рдареА

---

<!-- CO-OP TRANSLATOR DISCLAIMER START -->
**рдЕрд╕реНрд╡реАрдХрд░рдг**:  
рд╣рд╛ рджрд╕реНрддрдРрд╡рдЬ AI рднрд╛рд╖рд╛рдВрддрд░ рд╕реЗрд╡рд╛ [Co-op Translator](https://github.com/Azure/co-op-translator) рд╡рд╛рдкрд░реВрди рднрд╛рд╖рд╛рдВрддрд░рд┐рдд рдХрд░рдгреНрдпрд╛рдд рдЖрд▓рд╛ рдЖрд╣реЗ. рдЖрдореНрд╣реА рдЕрдЪреВрдХрддреЗрд╕рд╛рдареА рдкреНрд░рдпрддреНрдирд╢реАрд▓ рдЕрд╕рд▓реЛ рддрд░реА, рдХреГрдкрдпрд╛рд╕ рд▓рдХреНрд╖рд╛рдд рдареЗрд╡рд╛ рдХреА рд╕реНрд╡рдпрдВрдЪрд▓рд┐рдд рднрд╛рд╖рд╛рдВрддрд░реЗ рддреНрд░реБрдЯреА рдХрд┐рдВрд╡рд╛ рдЕрдЪреВрдХрддреЗрдЪреНрдпрд╛ рдЕрднрд╛рд╡рд╛рдиреЗ рдпреБрдХреНрдд рдЕрд╕реВ рд╢рдХрддрд╛рдд. рдореВрд│ рднрд╛рд╖реЗрддреАрд▓ рджрд╕реНрддрдРрд╡рдЬ рдЕрдзрд┐рдХреГрдд рд╕реНрд░реЛрдд рдорд╛рдирд▓рд╛ рдЬрд╛рд╡рд╛. рдорд╣рддреНрддреНрд╡рд╛рдЪреНрдпрд╛ рдорд╛рд╣рд┐рддреАрд╕рд╛рдареА, рд╡реНрдпрд╛рд╡рд╕рд╛рдпрд┐рдХ рдорд╛рдирд╡реА рднрд╛рд╖рд╛рдВрддрд░рд╛рдЪреА рд╢рд┐рдлрд╛рд░рд╕ рдХреЗрд▓реА рдЬрд╛рддреЗ. рдпрд╛ рднрд╛рд╖рд╛рдВрддрд░рд╛рдЪрд╛ рд╡рд╛рдкрд░ рдХрд░реВрди рдЙрджреНрднрд╡рд▓реЗрд▓реНрдпрд╛ рдХреЛрдгрддреНрдпрд╛рд╣реА рдЧреИрд░рд╕рдордЬ рдХрд┐рдВрд╡рд╛ рдЪреБрдХреАрдЪреНрдпрд╛ рдЕрд░реНрдерд╛рд╕рд╛рдареА рдЖрдореНрд╣реА рдЬрдмрд╛рдмрджрд╛рд░ рдирд╛рд╣реА.
<!-- CO-OP TRANSLATOR DISCLAIMER END -->